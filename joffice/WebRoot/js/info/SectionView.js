Portlet=Ext.extend(Ext.ux.Portlet,{tools:null,url:null,constructor:function(b){Ext.applyIf(this,b);this.initTool(b);if(b.sectionType==2){this.url=__ctxPath+"/pages/indexpages/deskNewsListPage.jsp?sectionId="+b.sectionId;}else{if(b.sectionType==3){this.url=__ctxPath+"/pages/indexpages/noticeScrollPage.jsp?sectionId="+b.sectionId;}else{this.url=__ctxPath+"/pages/indexpages/newsListPage.jsp?sectionId="+b.sectionId;}}Portlet.superclass.constructor.call(this,{title:b.title,iconCls:b.iconCls,tools:this.tools,autoLoad:{url:this.url,scripts:true}});},initTool:function(b){this.tools=[{id:"refresh",scope:this,handler:function(){this.getUpdater().update(this.url);}},{id:"close",scope:this,handler:function(e,f,a){Ext.Msg.confirm("提示信息","确认删除此模块吧？",function(c){if(c=="yes"){a.ownerCt.remove(a,true);Ext.Ajax.request({url:__ctxPath+"/info/disableSection.do",method:"POST",params:{sectionId:b.sectionId},success:function(){},failure:function(){}});}});}}];}});SectionView=Ext.extend(Ext.Panel,{toolbar:null,constructor:function(b){Ext.applyIf(this,b);this.initUIComponents();SectionView.superclass.constructor.call(this,{title:"栏目管理",closable:false,id:"SectionView",iconCls:"menu-section-view",layout:"fit",defaults:{padding:"0 5 0 0"},tbar:this.toolbar,items:[]});},initUIComponents:function(){this.toolbar=new Ext.Toolbar({height:30,items:[{iconCls:"btn-add",text:"添加栏目",xtype:"button",scope:this,handler:this.createRs},"-",{iconCls:"btn-refresh",text:"刷新视图",xtype:"button",scope:this,handler:this.refreshRs.createCallback(this)},"-",{xtype:"button",text:"保存视图",scope:this,iconCls:"btn-save",handler:this.positionRs.createCallback(this)},"-",{xtype:"button",text:"添加模块",scope:this,iconCls:"btn-add",handler:function(){var a=this.getCmpByName("FirstColumn");new SectionSelector({isSingle:false,status:0,callback:function(k,o,l){this.close();var i=k.split(",");var m=o.split(",");var p=l.split(",");for(var n=0;n<i.length;n++){if(i[n]!=null&&i[n]!=""&&i[n]!="undefined"){a.add(new Portlet({title:m[n],sectionId:i[n],sectionType:p[n]}));}}a.ownerCt.doLayout();Ext.Ajax.request({url:__ctxPath+"/info/enableSection.do",method:"POST",params:{secIds:k},success:function(){},failure:function(){}});}}).show();}},"-",{xtype:"button",text:"视图设置",iconCls:"btn-system-setting",scope:this,handler:this.viewSettingRs.createCallback(this)}]});var b=[{id:"gear",handler:function(){Ext.Msg.alert("Message","The Settings tool was clicked.");}},{id:"close",handler:function(e,f,a){a.ownerCt.remove(a,true);}}];this.refreshRs(this);},createRs:function(){new SectionForm().show();},refreshRs:function(g,i){g.removeAll(true);g.doLayout();var h=[];var j=[];var f=[];Ext.Ajax.request({url:__ctxPath+"/info/listSection.do",method:"POST",params:{"Q_status_SN_EQ":1},success:function(m){var d=Ext.util.JSON.decode(m.responseText);var c=d.result;if(i==null||i==undefined||i==""){i=d.columnType;}for(var e=0;e<d.totalCounts;e++){var a=c[e];if(i==1){h.push(new Portlet({title:a.sectionName,sectionId:a.sectionId,sectionType:a.sectionType}));}else{if(i==2){if(a.colNumber==1){h.push(new Portlet({title:a.sectionName,sectionId:a.sectionId,sectionType:a.sectionType}));}else{j.push(new Portlet({title:a.sectionName,sectionId:a.sectionId,sectionType:a.sectionType}));}}else{if(a.colNumber==1){h.push(new Portlet({title:a.sectionName,sectionId:a.sectionId,sectionType:a.sectionType}));}else{if(a.colNumber==2){j.push(new Portlet({title:a.sectionName,sectionId:a.sectionId,sectionType:a.sectionType}));}else{f.push(new Portlet({title:a.sectionName,sectionId:a.sectionId,sectionType:a.sectionType}));}}}}}var b=null;if(i==1){b=[{columnWidth:0.98,style:"padding:10px 0 10px 10px",name:"FirstColumn",items:h}];}else{if(i==2){b=[{columnWidth:0.64,style:"padding:10px 0 10px 10px",name:"FirstColumn",items:h},{columnWidth:0.35,style:"padding:10px 10px 10px 10px",items:j}];}else{b=[{columnWidth:0.33,style:"padding:10px 0 10px 10px",name:"FirstColumn",items:h},{columnWidth:0.33,style:"padding:10px 10px 10px 10px",items:j},{columnWidth:0.33,style:"padding:10px 0px 10px 0px",items:f}];}}g.add({xtype:"portal",region:"center",border:false,id:"SectionPortal",margins:"35 5 5 0",items:b});g.doLayout();},failure:function(){}});},positionRs:function(){var k=Ext.getCmp("SectionPortal");var p=k.items;var l=new Array();for(var n=0;n<p.length;n++){var i=p.itemAt(n);for(var o=0;o<i.items.getCount();o++){var j=i.items.itemAt(o);var m=new SectionItem(j.sectionId,n+1,o+1);l.push(m);}}Ext.Ajax.request({method:"post",url:__ctxPath+"/info/positionSection.do",params:{sections:Ext.encode(l)},success:function(a){Ext.ux.Toast.msg("操作信息","保存成功");},failure:function(a){Ext.MessageBox.show({title:"操作信息",msg:"信息保存出错，请联系管理员！",buttons:Ext.MessageBox.OK,icon:"ext-mb-error"});}});},viewSettingRs:function(e){var d=new Ext.FormPanel({layout:"form",bodyStyle:"padding:10px",border:false,defaults:{anchor:"98%,98%"},items:[{xtype:"radiogroup",id:"columnLayout",autoHeight:true,columns:1,items:[{boxLabel:"一列布局",name:"columnType",inputValue:"1"},{boxLabel:"两列布局",name:"columnType",inputValue:"2",checked:true},{boxLabel:"三列布局",name:"columnType",inputValue:"3"}]}]});var f=new Ext.Window({layout:"fit",iconCls:"btn-system-setting",items:d,modal:true,minHeight:149,minWidth:499,height:150,width:500,maximizable:true,title:"视图设置",buttonAlign:"center",buttons:[{text:"确定",iconCls:"btn-save",handler:function(){var a="";var c=Ext.getCmp("columnLayout");var b=c.getValue().getGroupValue();Ext.Ajax.request({url:__ctxPath+"/info/columnSection.do",method:"POST",params:{columnType:b},success:function(){Ext.ux.Toast.msg("操作信息","视图设置成功.");},failure:function(){}});e.refreshRs(e,b);f.close();}},{text:"取消",iconCls:"btn-cancel",handler:function(){f.close();}}]});f.show();}});