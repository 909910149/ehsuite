var NewsDetail=function(b){return new Ext.Panel({title:"新闻详情",iconCls:"menu-news",id:"NewsDetail",autoScroll:true,autoWidth:true,border:false,tbar:new Ext.Toolbar({height:30,bodyStyle:"text-align:left",defaultType:"button",items:[{text:"关闭",iconCls:"btn-mail_remove",handler:function(){var a=Ext.getCmp("centerTabPanel");var d=a.getItem("NewsDetail");a.remove(d);}},{text:"上一条",iconCls:"btn-up",handler:function(){var d=document.getElementById("__haveNextNewsFlag");if(d!=null&&d.value!="endPre"){var a=document.getElementById("__curNewsId").value;Ext.getCmp("HomeNewsDisplayPanel").load({url:__ctxPath+"/pages/info/newsdetail.jsp?opt=_pre&newsId="+a,callback:function(){var f=document.getElementById("__curNewsId").value;var c=Ext.getCmp("NewsCommentContainer");c.removeAll();c.add(NewsCommentDisplayGrid(f));c.doLayout(true);}});}else{Ext.ux.Toast.msg("提示信息","这里已经是第一条了");}}},{text:"下一条",iconCls:"btn-last",handler:function(){var d=document.getElementById("__haveNextNewsFlag");if(d!=null&&d.value!="endNext"){var a=document.getElementById("__curNewsId").value;Ext.getCmp("HomeNewsDisplayPanel").load({url:__ctxPath+"/pages/info/newsdetail.jsp?opt=_next&newsId="+a,callback:function(){var f=document.getElementById("__curNewsId").value;var c=Ext.getCmp("NewsCommentContainer");c.removeAll();c.add(NewsCommentDisplayGrid(f));c.doLayout(true);}});}else{Ext.ux.Toast.msg("提示信息","这里已经是最后一条了.");}}}]}),defaults:{width:"80%"},items:[new Ext.Panel({id:"HomeNewsDisplayPanel",autoScroll:true,style:"padding-left:10%;padding-top:10px;",autoHeight:true,border:false,autoLoad:{url:__ctxPath+"/pages/info/newsdetail.jsp?newsId="+b,scripts:true}}),{xtype:"panel",border:false,id:"NewsCommentContainer",style:"padding-left:10%;padding-top:10px;",items:[new NewsCommentDisplayGrid(b)]},new Ext.FormPanel({url:__ctxPath+"/info/saveNewsComment.do",id:"NewsCommentForm",iconCls:"menu-info",title:"我要评论",autoScroll:true,style:"padding-left:10%;padding-top:10px;padding-bottom:25px;",autoHeight:true,defaultType:"textfield",formId:"NewsCommentFormId",labelWidth:55,defaults:{width:550,anchor:"98%,98%"},layout:"form",items:[{name:"newsComment.newsId",xtype:"hidden",id:"newsCommentNewsId"},{name:"newsComment.userId",xtype:"hidden",value:curUserInfo.userId},{fieldLabel:"用户",name:"newsComment.fullname",readOnly:true,value:curUserInfo.fullname},{fieldLabel:"内容",xtype:"textarea",blankText:"评论内容为必填!",allowBlank:false,name:"newsComment.content",id:"newsCommentContent"}],buttonAlign:"center",buttons:[{text:"提交",iconCls:"btn-save",handler:function(){Ext.getCmp("newsCommentNewsId").setValue(document.getElementById("__curNewsId").value);var a=Ext.getCmp("NewsCommentForm");if(a.getForm().isValid()){a.getForm().submit({method:"post",waitMsg:"正在提交数据...",success:function(h,f){Ext.ux.Toast.msg("操作信息","成功保存信息！");Ext.getCmp("newsCommentContent").setValue("");Ext.getCmp("NewsCommentDispalyGrid").getStore().reload();var g=Ext.getCmp("NewsCommentGrid");if(g!=null){g.getStore().reload();}},failure:function(f,e){Ext.MessageBox.show({title:"操作信息",msg:"信息保存出错，请联系管理员！",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});}});}}},{text:"重置",iconCls:"reset",handler:function(){Ext.getCmp("newsCommentContent").setValue("");}}]})]});};var NewsCommentDisplayGrid=function(g){var f=new Ext.grid.ColumnModel({columns:[{width:40,dataIndex:"start",renderer:function(b,c,j,a,d){return parseInt(b)+a+1+"楼";}},{dataIndex:"commentId",hidden:true},{width:400,dataIndex:"content",renderer:function(b,c,j,a,d){html='<table width="100%"><tr><td><font color="gray">评论人:'+j.data.fullname+'</font></td><td align="right"><font color="gray">'+j.data.createtime+'</font></td></tr><tr><td rowspan="2"><font style="font:13px 宋体;color: black;line-height:24px;">'+b+"</font></td></tr></table>";return html;}}],defaults:{sortable:true,menuDisabled:false,width:100}});var e=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:__ctxPath+"/info/listNewsComment.do?Q_news.newsId_L_EQ="+g}),reader:new Ext.data.JsonReader({root:"result",totalProperty:"totalCounts",id:"id",fields:[{name:"commentId",type:"int"},"content","createtime","fullname","start"]}),remoteSort:false});e.setDefaultSort("createtime","asc");e.load({params:{start:0,limit:10}});var h=new Ext.grid.GridPanel({store:e,hideHeaders:true,trackMouseOver:true,disableSelection:false,loadMask:true,autoHeight:true,id:"NewsCommentDispalyGrid",autoWidth:true,title:"查看评论",iconCls:"menu-info",collapsible:true,collapsed:true,cm:f,viewConfig:{forceFit:true,enableRowBody:false,showPreview:false},bbar:new HT.PagingBar({store:e,pageSize:10})});return h;};