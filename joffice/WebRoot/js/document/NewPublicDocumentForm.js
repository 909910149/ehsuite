var NewPublicDocumentForm=function(c,d){return this.setup(c,d);};NewPublicDocumentForm.prototype.setup=function(i,j){var l;this.docId=i;var k=this.initToolbar();var h=new Ext.FormPanel({url:__ctxPath+"/document/saveDocument.do",layout:"form",id:"NewPublicDocumentFormPanel",autoScroll:true,border:false,bodyStyle:"padding:10px 10px 10px 10px;",formId:"NewPublicDocumentFormId",reader:new Ext.data.JsonReader({root:"data"},[{name:"NewPublicDocumentForm.docId",mapping:"docId"},{name:"NewPublicDocumentForm.docName",mapping:"docName"},{name:"NewPublicDocumentForm.content",mapping:"content"}]),items:[{xtype:"hidden",id:"NewPublicDocumentForm.docId",name:"document.docId"},{xtype:"hidden",id:"NewPublicDocumentForm.folderId",name:"folderId"},{xtype:"container",layout:"column",height:32,items:[{text:"选择目录:",xtype:"label",width:104},{name:"docFolderName",id:"NewPublicDocumentForm.docFolderName",xtype:"textfield",width:430,readOnly:true,allowBlank:false},{xtype:"button",text:"请选择目录",iconCls:"menu-mail_folder",handler:function(){DocFolderSelector.getView(function(a,d){var b=Ext.getCmp("NewPublicDocumentForm.docFolderName");var c=Ext.getCmp("NewPublicDocumentForm.folderId");b.setValue(d);c.setValue(a);}).show();}},{xtype:"button",text:"清除目录",iconCls:"reset",handler:function(){var a=Ext.getCmp("NewPublicDocumentForm.docFolderName");var b=Ext.getCmp("NewPublicDocumentForm.folderId");a.setValue("");b.setValue("");}}]},{fieldLabel:"文档名称",name:"document.docName",id:"NewPublicDocumentForm.docName",xtype:"textfield",anchor:"98%",allowBlank:false},{height:350,anchor:"96%",xtype:"fckeditor",fieldLabel:"内容",name:"document.content",allowBlank:false,id:"NewPublicDocumentForm.content"},{layout:"column",border:false,anchor:"98%",items:[{columnWidth:0.7,layout:"form",border:false,items:[{fieldLabel:"附件",xtype:"panel",id:"NewPublicDocumentForm.filePanel",frame:false,height:80,autoScroll:true,html:""}]},{columnWidth:0.3,border:false,items:[{xtype:"button",text:"添加附件",iconCls:"menu-attachment",handler:function(){var a=App.createUploadDialog({file_cat:"document",callback:function(b){var e=Ext.getCmp("NewPublicDocumentForm.fileIds");var c=Ext.getCmp("NewPublicDocumentForm.filePanel");for(var d=0;d<b.length;d++){if(e.getValue()!=""){e.setValue(e.getValue()+",");}e.setValue(e.getValue()+b[d].fileId);Ext.DomHelper.append(c.body,'<span><a href="#" onclick="FileAttachDetail.show('+b[d].fileId+')">'+b[d].fileName+'</a> <img class="img-delete" src="'+__ctxPath+'/images/system/delete.gif" onclick="removeFile(this,'+b[d].fileId+')"/>&nbsp;|&nbsp;</span>');}}});a.show(this);}},{xtype:"button",text:"清除附件",iconCls:"reset",handler:function(){var a=Ext.getCmp("NewPublicDocumentForm.fileIds");var b=Ext.getCmp("NewPublicDocumentForm.filePanel");b.body.update("");a.setValue("");}},{xtype:"hidden",id:"NewPublicDocumentForm.fileIds",name:"fileIds"}]}]}]});if(this.docId!=null&&this.docId!="undefined"){h.getForm().load({deferredRender:false,url:__ctxPath+"/document/getDocument.do?docId="+this.docId,waitMsg:"正在载入数据...",success:function(w,e){var b=Ext.util.JSON.decode(e.response.responseText).data[0];var v=b.docFolder;var a=b.attachFiles;var c=Ext.getCmp("NewPublicDocumentForm.filePanel");var y=Ext.getCmp("NewPublicDocumentForm.fileIds");for(var d=0;d<a.length;d++){if(y.getValue()!=""){y.setValue(y.getValue()+",");}y.setValue(y.getValue()+a[d].fileId);Ext.DomHelper.append(c.body,'<span><a href="#" onclick="FileAttachDetail.show('+a[d].fileId+')">'+a[d].fileName+'</a><img class="img-delete" src="'+__ctxPath+'/images/system/delete.gif" onclick="removeFormFile(this,'+a[d].fileId+')"/>&nbsp;|&nbsp;</span>');}var x=v.folderId;var t=v.folderName;var f=Ext.getCmp("NewPublicDocumentForm.folderId");var u=Ext.getCmp("NewPublicDocumentForm.docFolderName");f.setValue(x);u.setValue(t);},failure:function(b,a){Ext.MessageBox.show({title:"操作信息",msg:"载入信息失败，请联系管理员！",buttons:Ext.MessageBox.OK,icon:"ext-mb-error"});}});}var g=new Ext.Panel({id:"NewPublicDocumentForm",title:j==null?"新建公共文档":j,iconCls:"menu-new-document",layout:"fit",tbar:k,items:[h]});return g;};NewPublicDocumentForm.prototype.initToolbar=function(){var b=new Ext.Toolbar({height:30,items:[{text:"保存",iconCls:"btn-save",handler:function(){var a=Ext.getCmp("NewPublicDocumentFormPanel");if(a.getForm().isValid()){a.getForm().submit({waitMsg:"正在提交,请稍候...",success:function(j,g){Ext.ux.Toast.msg("操作信息","提交成功！");var j=Ext.getCmp("NewPublicDocumentFormPanel");j.getForm().reset();var h=Ext.getCmp("NewPublicDocumentForm.fileIds");var i=Ext.getCmp("NewPublicDocumentForm.filePanel");i.body.update("");h.setValue("");},failure:function(f,e){Ext.ux.Toast.msg("错误信息",e.result.msg);}});}}},{text:"重置",iconCls:"reset",handler:function(){var a=Ext.getCmp("NewPublicDocumentFormPanel");a.getForm().reset();var e=Ext.getCmp("NewPublicDocumentForm.fileIds");var f=Ext.getCmp("NewPublicDocumentForm.filePanel");f.body.update("");e.setValue("");}}]});return b;};function removeFormFile(h,g){var f=Ext.getCmp("NewPublicDocumentForm.fileIds");var i=f.getValue();if(i.indexOf(",")<0){f.setValue("");}else{i=i.replace(","+g,"").replace(g+",","");f.setValue(i);}var j=Ext.get(h.parentNode);j.remove();}