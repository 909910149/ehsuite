Ext.ns("PublicDocumentView");var PublicDocumentView=function(){};PublicDocumentView.prototype.getView=function(){return new Ext.Panel({id:"PublicDocumentView",title:"公共文档列表",autoScroll:true,region:"center",layout:"border",items:[new Ext.FormPanel({id:"PublicDocumentSearchForm",region:"north",height:40,frame:false,border:false,layout:"hbox",layoutConfig:{padding:"5",align:"middle"},defaults:{xtype:"label",margins:{top:0,right:4,bottom:4,left:4}},items:[{text:"文档名称"},{xtype:"textfield",name:"document.docName",width:90},{text:"创建时间 从"},{xtype:"datefield",format:"Y-m-d",name:"from"},{text:"至"},{xtype:"datefield",format:"Y-m-d",name:"to"},{xtype:"button",text:"查询",iconCls:"btn-search",handler:function(){var d=Ext.getCmp("PublicDocumentSearchForm");var c=Ext.getCmp("PublicDocumentGrid");if(d.getForm().isValid()){d.getForm().submit({waitMsg:"正在提交查询",url:__ctxPath+"/document/publicListDocument.do",params:{folderId:DocumentView.folderId},success:function(b,a){var f=Ext.util.JSON.decode(a.response.responseText);c.getStore().loadData(f);}});}}}]}),this.setup()]});};PublicDocumentView.prototype.setFolderId=function(b){this.folderId=b;PublicDocumentView.folderId=b;};PublicDocumentView.prototype.getFolderId=function(){return this.folderId;};PublicDocumentView.prototype.setup=function(){return this.grid();};PublicDocumentView.prototype.grid=function(){var h=new Ext.grid.CheckboxSelectionModel();var g=new Ext.grid.ColumnModel({columns:[h,new Ext.grid.RowNumberer(),{header:"docId",dataIndex:"docId",hidden:true},{header:"文档名称",dataIndex:"docName",width:120},{header:"创建 人",dataIndex:"fullname",width:120},{header:"修改时间",dataIndex:"createtime"},{header:"文件夹",dataIndex:"forlderName"},{header:"附件",dataIndex:"haveAttach",renderer:function(b,d,m){if(b==""||b=="0"){return"无附件";}else{var c=m.data.attachFiles;var a="";for(var e=0;e<c.length;e++){a+='<a href="#" onclick="FileAttachDetail.show('+c[e].fileId+');" class="attachment">'+c[e].fileName+"</a>";a+="&nbsp;";}return a;}}},{header:"管理",dataIndex:"docId",width:50,renderer:function(d,e,n,a,m){var b=n.data.docId;var c='<button title="查看" value="" class="btn-readdocument" onclick="PublicDocumentView.detail('+b+')">&nbsp;</button>';if(isGranted("__ALL")){c+='<button title="删除" value="" class="btn-del" onclick="PublicDocumentView.remove('+b+')">&nbsp;</button>';}return c;}}],defaults:{menuDisabled:false,width:100}});var f=this.store();f.load({params:{start:0,limit:25}});var i=new Ext.grid.GridPanel({id:"PublicDocumentGrid",store:f,trackMouseOver:true,disableSelection:false,loadMask:true,region:"center",maxHeight:600,cm:g,sm:h,viewConfig:{forceFit:true,enableRowBody:false,showPreview:false},bbar:new HT.PagingBar({store:f})});i.addListener("rowdblclick",function(b,c,a){b.getSelectionModel().each(function(d){PublicDocumentView.detail(d.data.docId);});});if(isGranted("__ALL")){var j=Ext.getCmp("PublicDocumentSearchForm");j.add(new Ext.Button({text:"删除",iconCls:"btn-del",handler:function(){var b=Ext.getCmp("PublicDocumentGrid");var d=b.getSelectionModel().getSelections();if(d.length==0){Ext.ux.Toast.msg("信息","请选择要删除的记录！");return;}var a=Array();for(var c=0;c<d.length;c++){a.push(d[c].data.docId);}PublicDocumentView.remove(a);}}));}return i;};PublicDocumentView.prototype.store=function(){var b=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:__ctxPath+"/document/publicListDocument.do"}),reader:new Ext.data.JsonReader({root:"result",totalProperty:"totalCounts",id:"id",fields:[{name:"docId",type:"int"},{name:"forlderName",mapping:"docFolder.folderName"},"fullname","docName","content","createtime","haveAttach","attachFiles","isShared"]}),remoteSort:true});return b;};PublicDocumentView.remove=function(c){var d=Ext.getCmp("PublicDocumentGrid");Ext.Msg.confirm("信息确认","您确认要删除该记录吗？",function(a){if(a=="yes"){Ext.Ajax.request({url:__ctxPath+"/document/multiDelDocument.do",params:{ids:c},method:"post",success:function(){Ext.ux.Toast.msg("信息提示","成功删除所选记录！");d.getStore().reload({params:{start:0,limit:25}});}});}});};PublicDocumentView.detail=function(b){Ext.Ajax.request({url:__ctxPath+"/document/rightDocument.do",params:{docId:b},method:"POST",success:function(o,k){var a=Ext.util.JSON.decode(o.responseText);var l=a.rightM;var p=a.rightD;var r=a.docName;if(b!=null){var m=Ext.getCmp("centerTabPanel");var q=Ext.getCmp("PulicDocumentDetail");if(q==null){q=new PublicDocumentDetail({docId:b,docName:r});m.add(q);m.activate(q);}else{m.remove("PulicDocumentDetail");q=new PublicDocumentDetail({docId:b,docName:r});m.add(q);m.activate(q);}}if(isGranted("__ALL")){l=1;p=1;}if(l==1){var n=Ext.getCmp("PublicDocumentTopBar");n.add(new Ext.Button({iconCls:"btn-add",text:"修改公共文档 ",xtype:"button",handler:function(){var c=Ext.getCmp("centerTabPanel");var d=Ext.getCmp("NewPublicDocumentForm");c.remove("PulicDocumentDetail");if(d==null){d=new NewPublicDocumentForm(b,r+"-文档信息");c.add(d);c.activate(d);}else{c.remove("NewPublicDocumentForm");d=new NewPublicDocumentForm(b,r+"-文档信息");c.add(d);c.activate(d);}}}));n.doLayout(true);}if(p==1){var n=Ext.getCmp("PublicDocumentTopBar");n.add(new Ext.Button({iconCls:"btn-del",text:"删除公共文档",xtype:"button",handler:function(){Ext.Msg.confirm("信息确认","您确认要删除该文档吗？",function(c){if(c=="yes"){Ext.Ajax.request({url:__ctxPath+"/document/multiDelDocument.do",params:{ids:b},method:"post",success:function(){var d=Ext.getCmp("centerTabPanel");d.remove("PulicDocumentDetail");Ext.ux.Toast.msg("信息提示","成功删除所选记录！");var e=Ext.getCmp("PublicDocumentGrid");e.getStore().reload({params:{start:0,limit:25}});}});}});}}));n.doLayout(true);}},failure:function(a,d){},scope:this});};