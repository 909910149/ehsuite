KnowledgeForm=Ext.extend(Ext.Window,{formPanel:null,constructor:function(b){Ext.applyIf(this,b);this.initUI();KnowledgeForm.superclass.constructor.call(this,{id:"KnowledgeFormWin",title:"知识详细信息",iconCls:"menu-personal-doc",width:700,height:560,modal:true,maximizable:true,layout:"fit",items:this.formPanel,buttonAlign:"center",buttons:this.buttons});},initUI:function(){this.formPanel=new HT.FormPanel({url:__ctxPath+"/document/saveDocument.do",id:"KnowledgeForm",formId:"KnowledgeFormId",defaults:{anchor:"98%,98%",margins:{top:4,right:4,bottom:4,left:4}},items:[{name:"folderId",xtype:"hidden",value:this.folderId},{name:"document.docId",xtype:"hidden",value:this.docId==null?"":this.docId},{xtype:"textfield",fieldLabel:"文档名称",name:"document.docName",anchor:"98%",allowBlank:false},{xtype:"container",layout:"column",height:32,items:[{text:"选择目录:",xtype:"label",width:104},{name:"docFolderName",xtype:"textfield",width:200,readOnly:true,allowBlank:false,value:this.folderName},{xtype:"button",text:"请选择目录",scope:this,iconCls:"menu-mail_folder",handler:function(){DocFolderSelector.getView(function(g,j){var a=Ext.getCmp("KnowledgeForm");var h=a.getCmpByName("docFolderName");var i=a.getCmpByName("folderId");h.setValue(j);i.setValue(g);}).show();}},{xtype:"button",text:"清除目录",iconCls:"reset",scope:this,handler:function(){var a=Ext.getCmp("KnowledgeForm");var e=a.getCmpByName("docFolderName");var f=a.getCmpByName("folderId");e.setValue("");f.setValue("");}}]},{xtype:"textfield",fieldLabel:"作者",name:"document.author",anchor:"98%"},{xtype:"textfield",fieldLabel:"关键字",name:"document.keywords",anchor:"98%"},{height:280,anchor:"96%",xtype:"fckeditor",fieldLabel:"内容",name:"document.content",allowBlank:false},{xtype:"hidden",name:"document.docType",value:"文档"},{xtype:"container",layout:"column",border:false,defaults:{border:false},items:[{columnWidth:0.7,layout:"form",border:false,items:[{fieldLabel:"附件",xtype:"panel",id:"personFilePanel",frame:false,border:true,bodyStyle:"padding:4px 4px 4px 4px",height:80,autoScroll:true,html:""}]},{columnWidth:0.3,items:[{border:false,xtype:"button",text:"添加附件",iconCls:"menu-attachment",handler:function(){var a=App.createUploadDialog({file_cat:"document/knowledgeManage",callback:function(g){var j=Ext.getCmp("KnowledgeFormFileIds");var h=Ext.getCmp("personFilePanel");for(var i=0;i<g.length;i++){if(j.getValue()!=""){j.setValue(j.getValue()+",");}j.setValue(j.getValue()+g[i].fileId);Ext.DomHelper.append(h.body,'<span><a href="#" onclick="FileAttachDetail.show('+g[i].fileId+')">'+g[i].fileName+'</a> <img class="img-delete" src="'+__ctxPath+'/images/system/delete.gif" onclick="removeFile(this,'+g[i].fileId+')"/>&nbsp;|&nbsp;</span>');}}});a.show(this);}},{xtype:"button",text:"清除附件",iconCls:"reset",handler:function(){var d=Ext.getCmp("KnowledgeFormFileIds");var a=Ext.getCmp("personFilePanel");a.body.update("");d.setValue("");}},{xtype:"hidden",name:"fileIds",id:"KnowledgeFormFileIds"}]}]}]});if(this.docId!=null&&this.docId!="undefined"){var b=this.formPanel;this.formPanel.loadData({url:__ctxPath+"/document/getDocument.do?docId="+this.docId,waitMsg:"正在载入数据...",preName:"document",root:"data",success:function(p,a){var m=Ext.util.JSON.decode(p.responseText).data;var r=m.docFolder.folderId;var q=m.docFolder.folderName;b.getCmpByName("folderId").setValue(r);b.getCmpByName("docFolderName").setValue(q);var l=m.attachFiles;var n=Ext.getCmp("personFilePanel");var i=Ext.getCmp("KnowledgeFormFileIds");for(var o=0;o<l.length;o++){if(i.getValue()!=""){i.setValue(i.getValue()+",");}i.setValue(i.getValue()+l[o].fileId);Ext.DomHelper.append(n.body,'<span><a href="#" onclick="FileAttachDetail.show('+l[o].fileId+')">'+l[o].fileName+'</a><img class="img-delete" src="'+__ctxPath+'/images/system/delete.gif" onclick="removeFile(this,'+l[o].fileId+')"/>&nbsp;|&nbsp;</span>');}},failure:function(a,d){Ext.MessageBox.show({title:"操作信息",msg:"载入信息失败，请联系管理员！",buttons:Ext.MessageBox.OK,icon:"ext-mb-error"});}});}this.buttons=[{xtype:"button",text:"保存",iconCls:"btn-save",handler:this.saveRecord,scope:this},{xtype:"button",text:"关闭",iconCls:"btn-cancel",scope:this,handler:function(){this.close();}}];},saveRecord:function(){var d=this.formPanel;var c=this;if(d.getForm().isValid()){d.getForm().submit({method:"post",waitMsg:"正在提交数据...",success:function(f,a){Ext.ux.Toast.msg("操作信息","成功信息保存！");var b=Ext.getCmp("KnowledgeGrid");if(b!=null&&b!=undefined){b.getStore().reload();}c.close();},failure:function(b,a){Ext.MessageBox.show({title:"操作信息",msg:"信息保存出错，请联系管理员！",buttons:Ext.MessageBox.OK,icon:"ext-mb-error"});c.close();}});}}});function removeFile(h,g){var f=Ext.getCmp("KnowledgeFormFileIds");var i=f.getValue();if(i.indexOf(",")<0){f.setValue("");}else{i=i.replace(","+g,"").replace(g+",","");f.setValue(i);}var j=Ext.get(h.parentNode);j.remove();}