var MyPlanTaskView=function(){Ext.QuickTips.init();return my_calendar();};function updateStoreincalendar(){var j=prueba.currentView;if(j=="month"){var h=parseInt(prueba.currentdate.format("m"));var i=prueba.currentdate.format("m/d/Y");calendarStore.baseParams={action:"month",displaymonth:h,monthday:i};calendarStore.reload();}else{if(j=="day"){var f=prueba.currentdate.format("m/d/Y");calendarStore.baseParams={action:"day",day:f};calendarStore.reload();}else{if(j=="week"){var f=parseInt(prueba.currentdate.format("W"));var g=prueba.getDateRangeOfWeek(f);calendarStore.baseParams={action:"week",weeknumber:f,startweek:g[0].format("m/d/Y"),endweek:g[1].format("m/d/Y")};calendarStore.reload();}else{if(j=="schedule"){if(prueba.viewscheduler.listbody.periodType==0){var f=prueba.currentdate.format("m/d/Y");calendarStore.baseParams={action:"day",day:f};calendarStore.reload();}else{if(prueba.viewscheduler.listbody.periodType==1){var f=parseInt(prueba.currentdate.format("W"));var g=prueba.getDateRangeOfWeek(f);calendarStore.baseParams={action:"week",weeknumber:f,startweek:g[0].format("m/d/Y"),endweek:g[1].format("m/d/Y")};calendarStore.reload();}else{if(prueba.viewscheduler.listbody.periodType==2){var h=parseInt(prueba.currentdate.format("m"));var i=prueba.currentdate.format("m/d/Y");calendarStore.baseParams={action:"month",displaymonth:h,monthday:i};calendarStore.reload();}else{if(prueba.viewscheduler.listbody.periodType==3){var g=prueba.viewscheduler.getDatesforBimonth(prueba.currentdate);calendarStore.baseParams={action:"period",start:g[0].format("m/d/Y"),ends:g[1].format("m/d/Y")};calendarStore.reload();}else{if(prueba.viewscheduler.listbody.periodType==4){var g=prueba.viewscheduler.getDatesforBimonth(prueba.currentdate);calendarStore.baseParams={action:"period",start:g[0].format("m/d/Y"),ends:g[1].format("m/d/Y")};calendarStore.reload();}}}}}}}}}}function my_calendar(){var n=new Ext.menu.Item({id:"buttonx1_task",iconCls:"x-calendar-month-btnmv_task",text:"Custom menu test 1"});var o=new Ext.menu.Item({id:"buttonx2_task",iconCls:"x-calendar-month-btnmv_task",text:"Custom menu test 2"});var l=new Ext.menu.Item({id:"buttonz1_task",iconCls:"x-calendar-month-btnmv_task",text:"Custom action 1"});var m=new Ext.menu.Item({id:"buttonz2_task",iconCls:"x-calendar-month-btnmv_task",text:"Custom action 2"});var r=new Ext.menu.Item({id:"btnTimerTask",iconCls:"task_time",text:"Set Task Alarm...."});var q=new Ext.menu.Item({id:"btnTimerOff",iconCls:"task_time_off",text:"Delete Task's Alarm...."});var j=new Ext.menu.Item({id:"buttonx1_task",iconCls:"x-calendar-month-btnmv_task",text:"Custom menu  on sched test 1"});var k=new Ext.menu.Item({id:"buttonx2_task",iconCls:"x-calendar-month-btnmv_task",text:"Custom menu  on sched test 2"});var p=new Date();calendarStore=new Ext.data.Store({url:__ctxPath+"/task/myCalendarPlan.do",baseParams:{action:"all",action:"month",displaymonth:12,monthday:p.format("m/d/Y")},reader:new Ext.data.JsonReader({root:"records",id:"id",totalProperty:"totalCount"},[{name:"recid",mapping:"id",type:"string"},{name:"subject",mapping:"subject",type:"string"},{name:"description",mapping:"description",type:"string"},{name:"startdate",mapping:"startdate",type:"string"},{name:"enddate",mapping:"enddate",type:"string"},{name:"color",mapping:"color",type:"string"},{name:"parent",mapping:"parent",type:"int"},{name:"priority",mapping:"priority",type:"int"}])});prueba=new Ext.ECalendar({id:"MyPlanTaskView",name:"MyPlanTaskView",title:"日程管理",mytitle:"",height:500,fieldsRefer:{id:"recid",subject:"subject",description:"description",color:"color",startdate:"startdate",enddate:"enddate",priority:"priority",parent:"parent",html:""},storeOrderby:"priority",storeOrder:"DESC",showCal_tbar:true,showRefreshbtn:true,refreshAction:"view",currentView:"month",currentdate:p,dateSelector:true,dateSelectorIcon:__ctxPath+"/ext3/ux/caltask/images/date.png",dateSelectorIconCls:"x-cmscalendar-icon-date-selector",dateformat:"d/m/Y",header:true,title:"我的日程管理",mytitle:" ",iconCls:"x-cmscalendar-icon-main",dateSelector:true,store:calendarStore,monitorBrowserResize:true,widgetsBind:{bindMonth:null,bindDay:null,binWeek:null},tplTaskZoom:new Ext.XTemplate('<tpl for=".">','<div class="ecal-show-basetasktpl-div"><b>主题:</b>{subject}<br>',"<b>开始1:</b>{startdate}<br><b>结束1:</b>{enddate}","<br><b>明细:</b><hr>{description}</div>","</tpl>"),iconToday:__ctxPath+"/ext3/ux/caltask/images/cms_calendar.png",iconMonthView:__ctxPath+"/ext3/ux/caltask/images/calendar_view_month.png",iconWeekView:__ctxPath+"/ext3/ux/caltask/images/calendar_view_week.png",iconDayView:__ctxPath+"/ext3/ux/caltask/images/calendar_view_day.png",iconSchedView:__ctxPath+"/ext3/ux/caltask/images/calendar_view_schedule.png",iconRefresh:__ctxPath+"/ext3/ux/caltask/images/calendar_view_refresh.png",iconAddTask:__ctxPath+"/ext3/ux/caltask/images/calendar_view_addTask.png",loadMask:true,customMaskText:"系统信息<br>请稍等!<br>正在处理日程的信息",sview:{header:true,headerFormat:"Y-M",headerButtons:true,headerAction:"event",periodselector:false,blankzonebg:"#6C90B4",blankHTML:'<div id="{calx}-test-img" class="custom_image_addNewEvent_scheduler" style=" width:100%; background-color:#6C90B4"><div align="center" id="{sched_addevent_id}"><img src="'+__ctxPath+'/ext3/ux/caltask/images/no_events_default.jpg" width="174" height="143"></div><div class="custom_text_addNewEvent_scheduler">点击图片加日程任务</div></div>',listItems:{headerTitle:"日程任务",periodFormats:{Day:"星期l - d - F - Y",DayScheduler_format:"d",hourFormat:"h:i a",startTime:"7:00:00 am",endTime:"10:00:00 pm",WeekTPL:'<tpl for=".">Week No.{numweek} Starting on {datestart} Ending on {dateend}</tpl>',WeekFormat:"W",DatesFormat:"d/m/Y",Month:"M-Y",TwoMonthsTPL:'<tpl for=".">Period No.{numperiod} Starting on {datestart} Ending on {dateend}</tpl>',QuarterTPL:'<tpl for=".">Period No.{numperiod} Starting on {datestart} Ending on {dateend}</tpl>'},useStoreColor:false,descriptionWidth:246,parentLists:false,launchEventOn:"click",editableEvents:true,ShowMenuItems:[1,1,1,1,1,1,1,1],taskdd_ShowMenuItems:[1,1,1],moreMenuItems:[j,k],taskdd_BaseColor:"#6C90B4",taskdd_clsOver:"test_taskovercss_sched",taskdd_showqtip:true,taskdd_shownames:true},listbody:{periodType:e2cs.schedviews.subView.Month,headerUnit:e2cs.schedviews.Units.Days,headerUnitWidth:25}},mview:{header:true,headerFormat:"Y-F",headerButtons:true,dayAction:"viewday",moreMenuItems:[n,o],showTaskcount:false,startDay:0,taskStyle:"margin-top:2px;",showTaskList:true,showNumTasks:10,TaskList_launchEventOn:"click",ShowMenuItems:[1,1,1,1,1,1],TaskList_moreMenuItems:[l,m],TaskList_ShowMenuItems:[1,1,1]},wview:{headerlabel:"周 #",headerButtons:true,dayformatLabel:"D j",moreMenuItems:[n,o],style:"google",alldayTaksMore:"window",alldayTasksMaxView:6,store:null,task_width:25,tasksOffset:40,headerDayClick:"viewday",ShowMenuItems:[1,1,1,1,1,1],task_ShowMenuItems:[1,1,1,1,1],task_eventLaunch:"click",startDay:0,task_clsOver:"test_taskovercss",forceTaskFit:true},dview:{header:true,headerFormat:"星期l - d - F  - Y",headerButtons:true,moreMenuItems:[],hourFormat:"h",startTime:"00:00:00 am",endTime:"11:59:59 pm",store:null,taskBaseColor:"#ffffff",task_width:60,taskAdd_dblclick:true,taskAdd_timer_dblclick:true,useMultiColorTasks:false,multiColorTasks:[],tasks:[],moreMenuItems:[n,o],task_clsOver:"test_taskovercss",ShowMenuItems:[1,1,1,1,1,1],task_DDeditable:true,task_eventLaunch:"click",task_ShowMenuItems:[1,1,1,1,1],customHTMLinpos:"before",forceTaskFit:true}});prueba.viewscheduler.on({"headerClick":{fn:function(b,d,a,c){},scope:this},"beforePeriodChange":{fn:function(c,b,a){if(c==1){}else{}return true;},scope:this},"afterPeriodChange":{fn:function(b,a){if(b==1){}else{}updateStoreincalendar();}}});prueba.viewmonth.on({"dayClick":{fn:function(c,a,b){},scope:this},"beforeMonthChange":{fn:function(a,b){prueba.currentdate=b;return true;},scope:this},"afterMonthChange":{fn:function(a){updateStoreincalendar();},scope:this}});prueba.viewweek.on({"dblClickTaskAllDay":{fn:function(c,b,a){new CalendarPlanDetailView(c[1]);},scope:this},"beforeWeekChange":{fn:function(a,b){return true;}},"afterWeekChange":{fn:function(a){prueba.currentdate=a;updateStoreincalendar();return false;}}});prueba.viewday.on({"beforeDayChange":{fn:function(a,b){return true;},scope:this},"afterDayChange":{fn:function(a){prueba.currentdate=a;updateStoreincalendar();},scope:this}});prueba.on({"onReload":{fn:function(){prueba.store.reload();}},"beforeContextMenuTask":{fn:function(c,b,d,a){return false;}},"beforeChangeDate":{fn:function(a,b){return true;}},"afterChangeDate":{fn:function(a,b){updateStoreincalendar();}},"onChangeView":{fn:function(a,c,b){updateStoreincalendar();},scope:this},"beforeChangeView":{fn:function(a,c,b){if(a==c){return true;}return true;},scope:this},"taskAdd":{fn:function(a){new CalendarPlanForm(null,function(){updateStoreincalendar();});}},"taskDblClick":{fn:function(d,c,b,a){new CalendarPlanDetailView(d[1]);},scope:this},"beforeTaskDelete":{fn:function(b,a){return false;},scope:this},"onTaskDelete":{fn:function(b){var a=confirm("Delete event "+b[1]+" "+b[2]+"...? YES/NO");return a;},scope:this},"afterTaskDelete":{fn:function(b,a){a?alert("Event: "+b[1]+" "+b[2]+" Deleted"):alert("Event Delete was canceled..!");updateStoreincalendar();},scope:this},"beforeTaskEdit":{fn:function(b,a){return false;},scope:this},"onTaskEdit":{fn:function(a){return true;},scope:this},"afterTaskEdit":{fn:function(b,a){if(a){}else{alert("Event Edit was canceled..!");}return false;},scope:this},"beforeTaskMove":{fn:function(d,c,b,a){return false;},scope:this},"TaskMoved":{fn:function(c,d,b,a){var e=21;task=c;new CalendarPlanDetailView(task[0]);},scope:this},"customMenuAction":{fn:function(a,c,d,e,b){var f="";if(c=="month"){}else{if(c=="day"){task=d;f="Task id:"+task[0]+" "+task[1]+"<br>";f+="starts:"+task[2]+"<br>";f+="Ends:"+task[3]+"<br>";f+="contents:"+task[4]+"<br>";f+="index:"+task[5]+"<br>";f+="Test Menu:"+a+"<br>";Ext.Msg.alert("(Day) Task information"+c,f);}else{if(c=="week"){}else{if(c=="scheduler"){task=d;f="Task id:"+task[0]+":"+task[2]+"<br>";f+="starts:"+task[3]+"<br>";f+="Ends:"+task[4]+"<br>";f+="contents:"+task[5]+"<br>";f+="index:"+task[6]+"<br>";f+="Test Menu:"+a+"<br>";Ext.Msg.alert("(Scheduler) Task information"+c,f);}}}}},scope:this}});prueba.on({"render":{fn:function(a){calendarStore.load();myMasktest=new Ext.LoadMask(a.id,{msg:e2cs.cal_locale.loadmaskText});calendarStore.on({"beforeload":{fn:function(){a.calendarMask.show();}},"load":{fn:function(d,b,c){if(d==false){alert("加载日程任务数据出错！");}else{a.refreshCalendarView(true);}a.calendarMask.hide();}}});Ext.EventManager.onWindowResize(function(){a.refreshCalendarView();});}}});return prueba;}