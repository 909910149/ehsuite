PersonalWorkPlanForm=Ext.extend(Ext.Window,{formPanel:null,buttons:null,constructor:function(b){Ext.applyIf(this,b);this.initUI();PersonalWorkPlanForm.superclass.constructor.call(this,{id:"PersonalWorkPlanWin",layout:"fit",iconCls:"menu-myplan",title:"我的计划详细信息",items:this.formPanel,modal:true,width:770,minWidth:700,maximizable:true,buttonAlign:"center",buttons:this.buttons,keys:{key:Ext.EventObject.ENTER,scope:this,fn:this.saveRecord}});},initUI:function(){this.formPanel=new HT.FormPanel({url:__ctxPath+"/task/saveWorkPlan.do",autoHeight:true,frame:false,border:false,layout:"form",region:"center",id:"NewWorkPlanFormPanel",bodyStyle:"padding-left:8%;padding-bottom:20px;",formId:"NewWorkPlanFormId",items:[{name:"workPlan.planId",xtype:"hidden",value:this.planId==null?"":this.planId},{name:"workPlan.isPersonal",value:1,xtype:"hidden"},{xtype:"panel",id:"PersonalWorkPlanFormPanel",layout:"form",border:false,width:680,defaultType:"textfield",bodyStyle:"padding-top:10px",defaults:{border:false},items:[{fieldLabel:"计划类型",hiddenName:"workPlan.proTypeId",xtype:"combo",width:520,editable:false,allowBlank:false,triggerAction:"all",displayField:"name",valueField:"id",mode:"local",store:new Ext.data.SimpleStore({autoLoad:true,baseParams:{catKey:"PWP"},url:__ctxPath+"/system/comboGlobalType.do",fields:["id","name"]})},{fieldLabel:"计划名称",name:"workPlan.planName",width:520,allowBlank:false},{xtype:"container",border:false,layout:"hbox",layoutConfig:{padding:"0",align:"middle"},defaults:{xtype:"label",margins:{top:0,right:4,bottom:4,left:0}},width:650,items:[{text:"时间范围:",width:101,name:"display",style:"padding-left:0px;padding-top:3px;"},{xtype:"datetimefield",width:250,format:"Y-m-d H:i:s",allowBlank:false,editable:false,name:"workPlan.startTime"},{text:"至",style:"padding-left:0px;padding-top:3px;",width:8},{xtype:"datetimefield",width:250,format:"Y-m-d H:i:s",allowBlank:false,editable:false,name:"workPlan.endTime"}]},{fieldLabel:"计划内容",name:"workPlan.planContent",xtype:"htmleditor",height:180,width:520,allowBlank:false},{layout:"column",style:"padding-left:0px;",width:670,border:false,xtype:"container",items:[{columnWidth:0.82,border:false,style:"padding-left:0px;",layout:"form",items:[{fieldLabel:"附件",xtype:"panel",frame:false,id:"planFilePanel",height:50,autoScroll:true,html:""}]},{columnWidth:0.18,border:false,items:[{iconCls:"menu-attachment",xtype:"button",text:"添加附件",handler:function(){var b=App.createUploadDialog({file_cat:"task/plan/personalWorkPlan",callback:function(f){var a=Ext.getCmp("planFileIds");var g=Ext.getCmp("planFilePanel");for(var h=0;h<f.length;h++){if(a.getValue()!=""){a.setValue(a.getValue()+",");}a.setValue(a.getValue()+f[h].fileId);Ext.DomHelper.append(g.body,'<span><a href="#" onclick="FileAttachDetail.show('+f[h].fileId+')">'+f[h].fileName+'</a> <img class="img-delete" src="'+__ctxPath+'/images/system/delete.gif" onclick="removeResumeFile(this,'+f[h].fileId+')"/>&nbsp;|&nbsp;</span>');}}});b.show(this);}},{iconCls:"reset",xtype:"button",text:"清除附件",handler:function(){var c=Ext.getCmp("planFileIds");var d=Ext.getCmp("planFilePanel");d.body.update("");c.setValue("");}},{xtype:"hidden",id:"planFileIds",name:"planFileIds"}]}]},{xtype:"radiogroup",fieldLabel:"是否启用",autoHeight:true,columns:2,width:520,items:[{boxLabel:"是",name:"workPlan.status",inputValue:1,checked:true},{boxLabel:"否",name:"workPlan.status",inputValue:0}]},{fieldLabel:"标识",hiddenName:"workPlan.icon",id:"icon",xtype:"iconcomb",mode:"local",allowBlank:false,width:520,editable:false,store:new Ext.data.SimpleStore({fields:["flagStyle","flagName"],data:[["ux-flag-blue","日常计划"],["ux-flag-orange","重要计划"],["ux-flag-green","特殊计划"],["ux-flag-pink","个人计划"],["ux-flag-red","紧急计划"],["ux-flag-purple","部门计划"],["ux-flag-yellow","待定计划"]]}),valueField:"flagStyle",displayField:"flagName",triggerAction:"all",value:"ux-flag-blue"},{fieldLabel:"备注",name:"workPlan.note",xtype:"textarea",width:520,height:50}]}]});if(this.planId!=""&&this.planId!=null&&this.planId!=undefined){this.formPanel.loadData({url:__ctxPath+"/task/getWorkPlan.do?planId="+this.planId,preName:"workPlan",root:"data",waitMsg:"正在载入数据...",success:function(x,i){var o=Ext.util.JSON.decode(x.responseText);var r=o.data;var y=r.startTime;var w=r.status;var u=r.endTime;var q=r.planFiles;var s=Ext.getCmp("planFilePanel");var p=Ext.getCmp("planFileIds");for(var v=0;v<q.length;v++){if(p.getValue()!=""){p.setValue(p.getValue()+",");}p.setValue(p.getValue()+q[v].fileId);Ext.DomHelper.append(s.body,'<span><a href="#" onclick="FileAttachDetail.show('+q[v].fileId+')">'+q[v].fileName+'</a><img class="img-delete" src="'+__ctxPath+'/images/system/delete.gif" onclick="removeResumeFile(this,'+q[v].fileId+')"/>&nbsp;|&nbsp;</span>');}var z=o.proTypeId;var t=Ext.getCmp("PersonalWorkPlanFormPanel").getCmpByName("workPlan.proTypeId");t.getStore().on("load",function(){t.setValue(z);},this);},failure:function(d,c){Ext.ux.Toast.msg("编辑","载入失败");}});}this.buttons=[{text:"保存",iconCls:"btn-save",scope:this,handler:this.saveRecord},{text:"关闭",iconCls:"btn-cancel",scope:this,handler:this.closeWin}];},saveRecord:function(){var d=this.formPanel;var c=this;if(d.getForm().isValid()){d.getForm().submit({method:"post",waitMsg:"正在提交数据...",success:function(b,a){Ext.ux.Toast.msg("操作信息","成功保存信息！");Ext.getCmp("PersonalWorkPlanGrid").getStore().reload();c.close();},failure:function(b,a){Ext.MessageBox.show({title:"操作信息",msg:"信息保存出错，请联系管理员！",buttons:Ext.MessageBox.OK,icon:"ext-mb-error"});c.close();}});}},closeWin:function(){this.close();}});function removeResumeFile(h,g){var f=Ext.getCmp("planFileIds");var i=f.getValue();if(i.indexOf(",")<0){f.setValue("");}else{i=i.replace(","+g,"").replace(g+",","");f.setValue(i);}var j=Ext.get(h.parentNode);j.remove();}