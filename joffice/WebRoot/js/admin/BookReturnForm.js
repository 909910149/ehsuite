var BookReturnForm=function(d){this.recordId=d;var e=this.setup();var f=new Ext.Window({id:"BookReturnFormWin",title:"图书归还详细记录",iconCls:"menu-book-return",width:520,height:240,modal:true,layout:"fit",buttonAlign:"center",items:[this.setup()],buttons:[{text:"归还图书",iconCls:"btn-save",handler:function(){var a=Ext.getCmp("BookReturnForm");if(a.getForm().isValid()){a.getForm().submit({method:"post",waitMsg:"正在提交数据...",success:function(j,c){Ext.ux.Toast.msg("操作信息","成功保存信息！");var i=Ext.getCmp("BookBorrowGrid");if(i!=null){i.getStore().reload();}var b=Ext.getCmp("BookReturnGrid");if(b!=null){b.getStore().reload();}f.close();},failure:function(c,b){Ext.MessageBox.show({title:"操作信息",msg:"信息保存出错，请联系管理员！",buttons:Ext.MessageBox.OK,icon:"ext-mb-error"});f.close();}});}}},{text:"取消",iconCls:"btn-cancel",handler:function(){f.close();}}]});f.show();};BookReturnForm.prototype.setup=function(){var b=new Ext.FormPanel({url:__ctxPath+"/admin/saveReturnBookBorRet.do",layout:"form",id:"BookReturnForm",bodyStyle:"padding:5px;",border:false,defaultType:"textfield",items:[{name:"bookBorRet.recordId",id:"recordId",xtype:"hidden",value:this.recordId==null?"":this.recordId},{name:"bookBorRet.bookSnId",id:"bookSnId",xtype:"hidden"},{xtype:"container",height:32,layout:"hbox",layoutConfigs:{align:"middle"},defaults:{margins:"0 2 0 2"},items:[{xtype:"label",text:"借出图书名称:",width:100},{xtype:"textfield",name:"bookBorRet.bookName",id:"bookName",allowBlank:false,blankText:"借出图书名称不能为空",readOnly:true,width:200},{xtype:"button",id:"ReturnFormButtonSel",text:"选择图书",iconCls:"menu-book-manage",handler:function(){BookSelector.getView(function(f,g){var h=Ext.getCmp("bookName");h.setValue(g);var a=Ext.getCmp("borrowIsbn").getStore();a.reload({params:{bookId:f}});},true).show();}},{xtype:"button",text:" 清除记录",iconCls:"reset",id:"ReturnFormButtonCle",handler:function(){var a=Ext.getCmp("bookName");a.setValue("");}}]},{xtype:"container",height:32,layout:"hbox",layoutConfigs:{align:"middle"},defaults:{margins:"0 2 0 2"},items:[{xtype:"label",text:"借出图书的ISBN:",width:100},{name:"bookBorRet.borrowIsbn",id:"borrowIsbn",allowBlank:false,blankText:"借出图书的ISBN不能为空",width:200,maxHeight:200,xtype:"combo",mode:"local",editable:false,triggerAction:"all",emptyText:"请选择图书系列",store:new Ext.data.SimpleStore({url:__ctxPath+"/admin/getReturnSnBookSn.do",fields:["bookSnId","bookSn"]}),displayField:"bookSn",valueField:"bookSnId",listeners:{select:function(f,h,g){Ext.getCmp("bookSnId").setValue(f.value);var a=f.value;Ext.Ajax.request({url:__ctxPath+"/admin/getBorRetTimeBookBorRet.do?bookSnId="+a,success:function(t){var c=Ext.util.JSON.decode(t.responseText).data;var e=c.borrowTime;var s=Ext.getCmp("borrowTime");var v=c.returnTime;var p=Ext.getCmp("returnTime");var u=c.recordId;var q=Ext.getCmp("recordId");var d=c.fullname;var r=Ext.getCmp("fullname");q.setValue(u);s.setValue(e);p.setValue(v);r.setValue(d);}});},focus:function(f,a,h){var g=Ext.getCmp("bookName").getValue();if(g==""){Ext.ux.Toast.msg("提示信息","请先选择图书！");}}}}]},{fieldLabel:"借阅人",xtype:"textfield",id:"fullname",name:"bookBorRet.fullname",readOnly:true,allowBlank:false,width:200},{fieldLabel:"借出时间",name:"bookBorRet.borrowTime",id:"borrowTime",readOnly:true,width:200,allowBlank:false,blankText:"借出时间不能为空"},{fieldLabel:"应还时间",name:"bookBorRet.returnTime",id:"returnTime",readOnly:true,width:200,allowBlank:false,blankText:"应还时间不能为空"}]});if(this.recordId!=null&&this.recordId!="undefined"){b.getForm().load({deferredRender:false,url:__ctxPath+"/admin/getBookBorRet.do?recordId="+this.recordId,method:"post",waitMsg:"正在载入数据...",success:function(i,h){var l=h.result.data.borrowTime;var j=Ext.getCmp("borrowTime");var k=h.result.data.returnTime;var a=Ext.getCmp("returnTime");j.setValue(l);a.setValue(k);},failure:function(a,d){}});}return b;};