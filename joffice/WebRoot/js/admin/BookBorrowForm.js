var BookBorrowForm=function(e,g){this.recordId=e;this.bookId=g;var f=this.setup();var h=new Ext.Window({id:"BookBorrowFormWin",title:"图书借出详细记录",iconCls:"menu-book-borrow",width:520,height:220,modal:true,layout:"fit",buttonAlign:"center",items:[this.setup()],buttons:[{text:"借出图书",iconCls:"btn-save",handler:function(){var a=Ext.getCmp("BookBorrowForm");if(a.getForm().isValid()){a.getForm().submit({method:"post",waitMsg:"正在提交数据...",success:function(d,b){Ext.ux.Toast.msg("操作信息","成功保存信息！");var c=Ext.getCmp("BookBorrowGrid");if(c==null){Ext.getCmp("BookGrid").getStore().reload();}else{Ext.getCmp("BookBorrowGrid").getStore().reload();}h.close();},failure:function(c,b){Ext.MessageBox.show({title:"操作信息",msg:"信息保存出错，请联系管理员！",buttons:Ext.MessageBox.OK,icon:"ext-mb-error"});h.close();}});}}},{text:"取消",iconCls:"btn-cancel",handler:function(){h.close();}}]});h.show();};BookBorrowForm.prototype.setup=function(){var b=new Ext.FormPanel({url:__ctxPath+"/admin/saveBorrowBookBorRet.do",layout:"form",bodyStyle:"padding:5px;",id:"BookBorrowForm",border:false,defaultType:"textfield",items:[{name:"bookBorRet.recordId",id:"recordId",xtype:"hidden",value:this.recordId==null?"":this.recordId},{name:"bookId",id:"bookId",xtype:"hidden",value:this.bookId==null?"":this.bookId},{name:"bookBorRet.bookSnId",id:"bookSnId",xtype:"hidden"},{xtype:"container",height:32,layout:"hbox",layoutConfigs:{align:"middle"},defaults:{margins:"0 2 0 2"},items:[{xtype:"label",text:"借出图书名称:",width:100},{xtype:"textfield",name:"bookBorRet.bookName",id:"bookName",allowBlank:false,blankText:"借出图书名称不能为空",readOnly:true,width:200},{xtype:"button",text:"选择图书",iconCls:"menu-book-manage",handler:function(){BookSelector.getView(function(f,g){var h=Ext.getCmp("bookName");h.setValue(g);var a=Ext.getCmp("borrowIsbn").getStore();a.reload({params:{bookId:f}});},true).show();}},{xtype:"button",text:" 清除记录",iconCls:"reset",handler:function(){var a=Ext.getCmp("bookName");a.setValue("");}}]},{xtype:"container",height:32,layout:"hbox",layoutConfigs:{align:"middle"},defaults:{margins:"0 2 0 2"},items:[{xtype:"label",text:"借出图书的ISBN:",width:100},{name:"bookBorRet.borrowIsbn",id:"borrowIsbn",allowBlank:false,blankText:"借出图书的ISBN不能为空",width:200,maxHeight:200,xtype:"combo",mode:"local",editable:false,triggerAction:"all",emptyText:"请选择图书系列",store:new Ext.data.SimpleStore({url:__ctxPath+"/admin/getBorrowSnBookSn.do",fields:["bookSnId","bookSn"]}),displayField:"bookSn",valueField:"bookSnId",listeners:{select:function(e,a,f){Ext.getCmp("bookSnId").setValue(e.value);},focus:function(f,a,h){var g=Ext.getCmp("bookName").getValue();if(g==""){Ext.ux.Toast.msg("提示信息","请先选择图书");}}}}]},{xtype:"container",height:32,layout:"hbox",layoutConfigs:{align:"middle"},defaults:{margins:"0 2 0 2"},items:[{xtype:"label",text:"借阅人:",width:100},{name:"bookBorRet.fullname",id:"fullname",xtype:"textfield",readOnly:true,allowBlank:false,width:200},{xtype:"button",text:"选择人员",iconCls:"btn-user-sel",handler:function(){UserSelector.getView(function(d,a){Ext.getCmp("fullname").setValue(a);},true).show();}},{xtype:"button",text:"清除记录",iconCls:"reset",handler:function(){Ext.getCmp("fullname").setValue("");}}]},{fieldLabel:"应还时间",name:"bookBorRet.returnTime",id:"returnTime",xtype:"datefield",format:"Y-m-d",editable:false,allowBlank:false,width:200,blankText:"应还时间不能为空"}]});if(this.recordId!=null&&this.recordId!="undefined"){b.getForm().load({deferredRender:false,url:__ctxPath+"/admin/getBookBorRet.do?recordId="+this.recordId,waitMsg:"正在载入数据...",success:function(g,f){var h=f.result.data.returnTime;var a=Ext.getCmp("returnTime");a.setValue(new Date(getDateFromFormat(h,"yyyy-MM-dd HH:mm:ss")));},failure:function(a,d){}});}return b;};