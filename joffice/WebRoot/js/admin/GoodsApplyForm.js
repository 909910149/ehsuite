GoodsApplyForm=Ext.extend(Ext.Window,{formPanel:null,constructor:function(b){Ext.applyIf(this,b);this.initUIComponents();GoodsApplyForm.superclass.constructor.call(this,{layout:"fit",id:"GoodsApplyFormWin",title:"申请表详细信息",iconCls:"menu-goods-apply",width:450,height:300,minWidth:449,minHeight:299,items:this.formPanel,maximizable:true,border:false,modal:true,plain:true,buttonAlign:"center",buttons:this.buttons,keys:{key:Ext.EventObject.ENTER,fn:this.submitRecord,scope:this}});},initUIComponents:function(){this.formPanel=new Ext.FormPanel({url:__ctxPath+"/admin/saveGoodsApply.do",layout:"form",id:"GoodsApplyForm",frame:false,bodyStyle:"padding : 5px;",defaults:{widht:450,anchor:"100%,100%"},formId:"GoodsApplyFormId",defaultType:"textfield",items:[{name:"goodsApply.applyId",id:"applyId",xtype:"hidden",value:this.applyId==null?"":this.applyId},{name:"goodsApply.goodsId",id:"goodsId",xtype:"hidden"},{name:"goodsApply.userId",id:"userId",xtype:"hidden"},{fieldLabel:"申请号",name:"goodsApply.applyNo",id:"applyNo",readOnly:true},{width:"100%",xtype:"container",layout:"column",fieldLabel:"商品名称",style:"padding-left:0px;margin-bottom:4px;",items:[{columnWidth:0.999,xtype:"textfield",name:"inStock.officeGoods.goodsName",id:"goodsName",allowBlank:false,readOnly:true},{xtype:"button",text:"选择商品",iconCls:"btn-select",handler:function(){GoodsSelector.getView(function(g,e){var f=Ext.getCmp("goodsId");f.setValue(g);var h=Ext.getCmp("goodsName");h.setValue(e);},true).show();}},{xtype:"button",text:" 清除记录",iconCls:"reset",handler:function(){var d=Ext.getCmp("goodsId");d.setValue("");var c=Ext.getCmp("goodsName");c.setValue("");}}]},{fieldLabel:"申请日期",name:"goodsApply.applyDate",id:"applyDate",xtype:"datefield",format:"Y-m-d",allowBlank:false,editable:false},{fieldLabel:"申请数量",name:"goodsApply.useCounts",allowBlank:false,xtype:"numberfield",id:"useCounts"},{xtype:"container",layout:"column",fieldLabel:"申请人",style:"padding-left:0px;margin-bottom:4px;",border:true,items:[{columnWidth:0.999,xtype:"textfield",name:"goodsApply.proposer",id:"proposer",allowBlank:false,readOnly:true},{xtype:"button",text:"选择人员",iconCls:"btn-user-sel",handler:function(){UserSelector.getView(function(f,d){var e=Ext.getCmp("proposer");e.setValue(d);Ext.getCmp("userId").setValue(f);},true).show();}},{xtype:"button",text:" 清除记录",iconCls:"reset",handler:function(){var b=Ext.getCmp("proposer");b.setValue("");}}]},{fieldLabel:"审批状态 ",name:"goodsApply.approvalStatus",id:"approvalStatus",xtype:"hidden"},{fieldLabel:"备注",name:"goodsApply.notes",id:"notes",xtype:"textarea"}]});if(this.applyId!=null&&this.applyId!="undefined"){this.formPanel.getForm().load({deferredRender:false,url:__ctxPath+"/admin/getGoodsApply.do?applyId="+this.applyId,method:"post",waitMsg:"正在载入数据...",success:function(m,l){var n=l.result.data.applyDate;var o=Ext.getCmp("applyDate");o.setValue(new Date(getDateFromFormat(n,"yyyy-MM-dd")));var i=l.result.data.officeGoods.goodsId;var j=l.result.data.officeGoods.goodsName;var p=Ext.getCmp("goodsId");var k=Ext.getCmp("goodsName");p.setValue(i);k.setValue(j);},failure:function(d,c){Ext.ux.Toast.msg("编辑","载入失败");}});}this.buttons=[{text:"保存草稿",iconCls:"btn-save",handler:this.saveRecord},{text:"提交审核",iconCls:"btn-ok",handler:this.submitRecord},{text:"取消",iconCls:"btn-cancel",scope:this,handler:function(){this.close();}}];},saveRecord:function(){Ext.getCmp("approvalStatus").setValue(0);var b=Ext.getCmp("GoodsApplyForm");if(b.getForm().isValid()){b.getForm().submit({method:"post",waitMsg:"正在提交数据...",success:function(a,d){Ext.ux.Toast.msg("操作信息","成功保存信息！");Ext.getCmp("GoodsApplyGrid").getStore().reload();Ext.getCmp("GoodsApplyFormWin").close();},failure:function(a,e){var f=e.result.message;Ext.MessageBox.show({title:"操作信息",msg:f==null&&f==""?"信息保存出错，请联系管理员！":f,buttons:Ext.MessageBox.OK,icon:"ext-mb-error"});Ext.getCmp("GoodsApplyFormWin").close();}});}},submitRecord:function(){Ext.getCmp("approvalStatus").setValue(1);var b=Ext.getCmp("GoodsApplyForm");if(b.getForm().isValid()){b.getForm().submit({method:"post",waitMsg:"正在提交数据...",success:function(a,d){Ext.ux.Toast.msg("操作信息","成功保存信息！");Ext.getCmp("GoodsApplyGrid").getStore().reload();Ext.getCmp("GoodsApplyFormWin").close();},failure:function(a,e){var f=e.result.message;Ext.MessageBox.show({title:"操作信息",msg:f==null&&f==""?"信息保存出错，请联系管理员！":f,buttons:Ext.MessageBox.OK,icon:"ext-mb-error"});Ext.getCmp("GoodsApplyFormWin").close();}});}}});