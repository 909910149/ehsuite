Ext.ns("BookManageView");var BookManageView=function(){var m;var p=new BookView();var o=new Ext.tree.TreePanel({region:"west",id:"leftBookManagePanel",title:"图书类别",collapsible:true,split:true,width:150,height:800,tbar:new Ext.Toolbar({id:"BookManageBar",items:[{xtype:"button",iconCls:"btn-refresh",text:"刷新",handler:function(){o.root.reload();}}]}),loader:new Ext.tree.TreeLoader({url:__ctxPath+"/admin/treeBookType.do"}),root:new Ext.tree.AsyncTreeNode({expanded:true}),rootVisible:false,listeners:{"click":function(a){if(a!=null){p.setTypeId(a.id);var c=Ext.getCmp("BookView");if(a.id==0){c.setTitle("所有图书列表");}else{c.setTitle("["+a.text+"]列表");}var b=Ext.getCmp("BookGrid");var d=b.getStore();d.url=__ctxPath+"/admin/listBook.do";d.baseParams={"Q_bookType.typeId_L_EQ":a.id==0?null:a.id};d.params={start:0,limit:25};d.reload({params:{start:0,limit:25}});}}}});function q(b,a){m=new Ext.tree.TreeNode({id:b.id,text:b.text});l.showAt(a.getXY());}if(isGranted("_BookTypeAdd")||isGranted("_BookTypeEdit")||isGranted("_BookTypeDel")){o.on("contextmenu",q,o);Ext.getCmp("BookManageBar").add(new Ext.Button({text:"添加类别",iconCls:"btn-add",handler:function(){var a=Ext.getCmp("bookTypeForm");if(a==null){new BookTypeForm();}else{a.getForm().reset();}}}));}var l=new Ext.menu.Menu({id:"BookManageTreeMenu",items:[]});if(isGranted("_BookTypeAdd")){l.add({text:"添加类别",scope:this,iconCls:"btn-add",handler:j});}if(isGranted("_BookTypeEdit")){l.add({text:"修改类别",scope:this,iconCls:"btn-edit",handler:k});}if(isGranted("_BookTypeDel")){l.add({text:"删除类别",scope:this,iconCls:"btn-delete",handler:n});}function j(){new BookTypeForm(null);}function k(){var a=m.id;if(a>0){new BookTypeForm(a);}else{Ext.MessageBox.show({title:"操作信息",msg:"该处不能被修改",buttons:Ext.MessageBox.OK,icon:"ext-mb-error"});}}function n(){var a=m.id;Ext.Msg.confirm("信息确认","您确认要删除该记录吗？",function(b){if(b=="yes"){Ext.Ajax.request({url:__ctxPath+"/admin/multiDelBookType.do",params:{ids:a},method:"post",success:function(d,e){var c=Ext.util.JSON.decode(d.responseText);if(c.success==false){Ext.ux.Toast.msg("操作信息",c.message);}else{Ext.ux.Toast.msg("操作信息","成功删除目录！");o.root.reload();}},failure:function(d,c){Ext.MessageBox.show({title:"操作信息",msg:"信息保存出错，请联系管理员！",buttons:Ext.MessageBox.OK,icon:"ext-mb-error"});}});}});}var r=new Ext.Panel({id:"BookManageView",title:"图书管理",iconCls:"menu-book-manage",layout:"border",height:800,items:[o,p.getView()]});return r;};