Ext.ns("BookTypeTree");var BookTypeTree=function(){return this.setup();};BookTypeTree.prototype.setup=function(){var h;var n=new Ext.tree.TreePanel({id:"typeTree",title:"图书类别",region:"west",width:200,height:480,autoScroll:true,collapsible:true,split:true,tbar:new Ext.Toolbar({height:30,items:[{text:"添加",iconCls:"add-info",handler:function(){var a=Ext.getCmp("bookTypeForm");if(a==null){new BookTypeForm();}else{a.getForm().reset();}}},{xtype:"button",iconCls:"btn-refresh",text:"刷新",handler:function(){n.root.reload();}}]}),loader:new Ext.tree.TreeLoader({url:__ctxPath+"/admin/treeBookType.do"}),root:new Ext.tree.AsyncTreeNode({expanded:true}),rootVisible:false,listeners:{"click":BookTypeTree.clickNode}});if(isGranted("_BookTypeAdd")||isGranted("_BookTypeEdit")||isGranted("_BookTypeDel")){n.on("contextmenu",m,n);}var j=new Ext.menu.Menu({id:"BookTypeTreeMenu",items:[]});if(isGranted("_BookTypeAdd")){j.add({text:"新建",scope:this,handler:l});}if(isGranted("_BookTypeEdit")){j.add({text:"修改",scope:this,handler:i});}if(isGranted("_BookTypeDel")){j.add({text:"删除",scope:this,handler:k});}function m(b,a){h=new Ext.tree.TreeNode({id:b.id,text:b.text});j.showAt(a.getXY());}function l(){var a=Ext.getCmp("bookTypeForm");if(a==null){new BookTypeForm();}}function k(){var a=h.id;var b=Ext.getCmp("typeTree");if(a>0){Ext.Msg.confirm("删除操作","你确定删除图书类别吗?",function(c){if(c=="yes"){Ext.Ajax.request({url:__ctxPath+"/admin/removeBookType.do",params:{typeId:a},method:"post",success:function(){Ext.ux.Toast.msg("操作信息","删除成功!");var d=Ext.getCmp("BookTypeView");if(d!=null){d.getStore().reload();}if(b!=null){b.root.reload();}}});}});}}function i(){var a=h.id;var b=Ext.getCmp("bookTypeForm");if(b==null){new BookTypeForm(null);b=Ext.getCmp("bookTypeForm");}b.form.load({url:__ctxPath+"/admin/getBookType.do",params:{typeId:a},method:"post",deferredRender:true,layoutOnTabChange:true,waitMsg:"正在载入数据...",success:function(){},failure:function(){Ext.ux.Toast.msg("编辑","载入失败");}});}return n;};BookTypeTree.clickNode=function(f){if(f!=null){var d=Ext.getCmp("BookGrid");var e=d.getStore();e.proxy=new Ext.data.HttpProxy({url:__ctxPath+"/admin/categoryBook.do"});e.baseParams={typeId:f.id};e.reload({params:{start:0,limit:25}});}};