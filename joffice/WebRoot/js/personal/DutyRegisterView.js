Ext.ns("DutyRegisterView");var DutyRegisterView=function(){return new Ext.Panel({id:"DutyRegisterView",iconCls:"menu-dutyRegister",title:"考勤管理",layout:"border",region:"center",autoScroll:true,items:[new Ext.FormPanel({id:"DutyRegisterSearchForm",region:"north",height:40,frame:false,border:false,layout:"form",width:"100%",keys:{key:Ext.EventObject.ENTER,fn:function(){DutyRegisterView.search();},scope:this},items:[{xtype:"hidden",name:"Q_appUser.userId_L_EQ",id:"Q_appUser.userId_L_EQ"},{border:false,layout:"hbox",region:"center",width:"100%",layoutConfig:{padding:"5",align:"middle"},defaults:{xtype:"label",margins:{top:0,right:4,bottom:2,left:4}},items:[{text:"查询条件:"},{text:"上下班"},{hiddenName:"Q_inOffFlag_SN_EQ",xtype:"combo",width:"10%",mode:"local",editable:true,triggerAction:"all",store:[["1","上班"],["2","下班"]]},{text:"所属用户"},{xtype:"textfield",readOnly:true,name:"DR_fullname",id:"DR_fullname",width:"10%"},{xtype:"button",text:"选择",iconCls:"btn-user-sel",width:50,handler:function(){UserSelector.getView(function(h,g){var e=Ext.getCmp("Q_appUser.userId_L_EQ");var f=Ext.getCmp("DR_fullname").setValue(g);e.setValue(h);},true).show();}},{text:"考勤选项"},{hiddenName:"Q_regFlag_SN_EQ",xtype:"combo",width:"10%",mode:"local",editable:true,triggerAction:"all",store:[["1","√"],["2","迟到"],["3","早退"]]},{xtype:"button",text:"查询",iconCls:"search",handler:function(){DutyRegisterView.search();}},{xtype:"button",text:"清空",iconCls:"reset",handler:function(){Ext.getCmp("DutyRegisterSearchForm").getForm().reset();}}]}]}),this.setup()]});};DutyRegisterView.prototype.setup=function(){return this.grid();};DutyRegisterView.prototype.grid=function(){var f=["周日","周一","周二","周三","周四","周五","周六"];var h=new Ext.grid.CheckboxSelectionModel();var g=new Ext.grid.ColumnModel({columns:[h,new Ext.grid.RowNumberer(),{header:"registerId",dataIndex:"registerId",hidden:true},{header:"登记时间",dataIndex:"registerDate"},{header:"登记人",dataIndex:"fullname"},{header:"登记标识",dataIndex:"regFlag",renderer:function(a){if(a==1){return'<font color="green">√</font>';}else{if(a==2){return'<font color="red">迟到</font>';}else{if(a==3){return'<font color="red">早退</font>';}}}}},{header:"周几",dataIndex:"dayOfWeek",renderer:function(a){return f[a-1];}},{header:"上下班标识",dataIndex:"inOffFlag",renderer:function(a){if(a==1){return"上班";}else{return"下班";}}},{header:"迟到或早退分钟",dataIndex:"regMins"},{header:"迟到或早退原因",dataIndex:"reason"},{header:"管理",dataIndex:"registerId",width:50,sortable:false,renderer:function(d,e,n,a,m){var b=n.data.registerId;var c="";if(isGranted("_DutyRegisterDel")){c='<button title="删除" value=" " class="btn-del" onclick="DutyRegisterView.remove('+b+')">&nbsp;&nbsp;</button>';}return c;}}],defaults:{sortable:true,menuDisabled:true,width:100}});var j=this.store();j.load({params:{start:0,limit:25}});var i=new Ext.grid.GridPanel({id:"DutyRegisterGrid",tbar:this.topbar(),store:j,trackMouseOver:true,disableSelection:false,loadMask:true,region:"center",cm:g,sm:h,viewConfig:{forceFit:true,enableRowBody:false,showPreview:false},bbar:new HT.PagingBar({store:j})});AppUtil.addPrintExport(i);return i;};DutyRegisterView.prototype.store=function(){var b=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:__ctxPath+"/personal/listDutyRegister.do"}),reader:new Ext.data.JsonReader({root:"result",totalProperty:"totalCounts",id:"id",fields:[{name:"registerId",type:"int"},"registerDate","fullname","regFlag","regMins","reason","dayOfWeek","inOffFlag"]}),remoteSort:true});b.setDefaultSort("registerDate","desc");return b;};DutyRegisterView.prototype.topbar=function(){var b=new Ext.Toolbar({id:"DutyRegisterFootBar",height:30,bodyStyle:"text-align:left",items:[]});if(isGranted("_DutyRegisterAdd")){b.add(new Ext.Button({iconCls:"btn-add",text:"补签",handler:function(){new DutyRegisterForm();}}));}if(isGranted("_DutyRegisterDel")){b.add(new Ext.Button({iconCls:"btn-del",text:"删除考勤",handler:function(){var d=Ext.getCmp("DutyRegisterGrid");var a=d.getSelectionModel().getSelections();if(a.length==0){Ext.ux.Toast.msg("信息","请选择要删除的记录！");return;}Ext.MessageBox.confirm("操作信息","你确定要删除该记录吗？",function(c){if(c=="yes"){var g=Array();for(var h=0;h<a.length;h++){g.push(a[h].data.registerId);}DutyRegisterView.remove(g);}});}}));}return b;};DutyRegisterView.remove=function(c){var d=Ext.getCmp("DutyRegisterGrid");Ext.Msg.confirm("信息确认","您确认要删除该记录吗？",function(a){if(a=="yes"){Ext.Ajax.request({url:__ctxPath+"/personal/multiDelDutyRegister.do",params:{ids:c},method:"post",success:function(){Ext.ux.Toast.msg("信息提示","成功删除所选记录！");d.getStore().reload({params:{start:0,limit:25}});}});}});};DutyRegisterView.search=function(){var d=Ext.getCmp("DutyRegisterSearchForm");var c=Ext.getCmp("DutyRegisterGrid");if(d.getForm().isValid()){$search({searchPanel:d,gridPanel:c});}};