var DutySystemForm=function(e){this.systemId=e;var d=this.setup();var f=new Ext.Window({id:"DutySystemFormWin",title:"班制定义详细信息",width:830,iconCls:"btn-clock",height:230,modal:true,layout:"fit",buttonAlign:"center",items:[this.setup()],buttons:[{text:"保存",iconCls:"btn-save",handler:function(){var m=Ext.getCmp("DutySystemForm");if(m.getForm().isValid()){var a=[];var n=Ext.getCmp("DutySystemSettingGird").getStore();var b=true;for(i=0,cnt=n.getCount();i<cnt;i+=1){var o=n.getAt(i);for(var l=0;l<7;l++){var c=o.get("day"+l);if(c==null||c==""){b=false;break;}}a.push(o.data);}if(!b){Ext.Msg.alert("警告","没有完全设置星期的班次!");return;}m.getForm().submit({method:"post",waitMsg:"正在提交数据...",params:{data:Ext.encode(a)},success:function(h,g){Ext.ux.Toast.msg("操作信息","成功保存信息！");Ext.getCmp("DutySystemGrid").getStore().reload();f.close();},failure:function(h,g){Ext.MessageBox.show({title:"操作信息",msg:"信息保存出错，请联系管理员！",buttons:Ext.MessageBox.OK,icon:"ext-mb-error"});f.close();}});}}},{text:"取消",iconCls:"btn-cancel",handler:function(){f.close();}}]});f.show();};DutySystemForm.prototype.setup=function(){var c=DutySystemForm.grid(this.systemId);var d=new Ext.FormPanel({url:__ctxPath+"/personal/saveDutySystem.do",layout:"form",id:"DutySystemForm",border:false,defaults:{anchor:"98%,98%"},bodyStyle:"padding:5px;",defaultType:"textfield",items:[{name:"dutySystem.systemId",id:"systemId",xtype:"hidden",value:this.systemId==null?"":this.systemId},{fieldLabel:"班制名称",name:"dutySystem.systemName",id:"systemName",allowBlank:false},{xtype:"radiogroup",fieldLabel:"是否缺省",autoHeight:true,columns:2,items:[{boxLabel:"是",name:"dutySystem.isDefault",inputValue:1,id:"isDefault1",checked:true},{boxLabel:"否",name:"dutySystem.isDefault",inputValue:0,id:"isDefault0"}]},c]});if(this.systemId!=null&&this.systemId!=undefined){d.getForm().load({deferredRender:false,url:__ctxPath+"/personal/getDutySystem.do?systemId="+this.systemId,waitMsg:"正在载入数据...",success:function(f,a){var b=a.result.data;if(b.isDefault==1){Ext.getCmp("isDefault1").setValue(true);}else{Ext.getCmp("isDefault0").setValue(true);}},failure:function(b,a){Ext.ux.Toast.msg("编辑","载入失败");}});}return d;};DutySystemForm.grid=function(h){if(h==undefined){h="";}var m=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:__ctxPath+"/personal/settingDutySystem.do?systemId="+h}),reader:new Ext.data.JsonReader({root:"result",fields:["day0","day1","day2","day3","day4","day5","day6","dayId0","dayId1","dayId2","dayId3","dayId4","dayId5","dayId6"]})});m.load();var j=0;var l=0;var g=new Ext.form.TriggerField({onTriggerClick:function(a){DutySectionSelector.getView(function(b,o){var c=Ext.getCmp("DutySystemSettingGird");var e=c.getStore();var f=e.getAt(0);var d=(l-1)/2;f.set("dayId"+d,b);f.set("day"+d,o);}).show();}});var k=new Ext.grid.EditorGridPanel({id:"DutySystemSettingGird",region:"center",title:"班次设置",height:100,store:m,columns:[new Ext.grid.RowNumberer(),{header:"周日",dataIndex:"day0",editor:g},{dataIndex:"dayId0",hidden:true},{header:"周一",dataIndex:"day1",editor:g},{dataIndex:"dayId1",hidden:true},{header:"周二",dataIndex:"day2",editor:g},{dataIndex:"dayId2",hidden:true},{header:"周三",dataIndex:"day3",editor:g},{dataIndex:"dayId3",hidden:true},{header:"周四",dataIndex:"day4",editor:g},{dataIndex:"dayId4",hidden:true},{header:"周五",dataIndex:"day5",editor:g},{dataIndex:"dayId5",hidden:true},{header:"周六",dataIndex:"day6",editor:g},{dataIndex:"dayId6",hidden:true}]});k.on("cellclick",function(d,a,c,b){j=a;l=c;});return k;};