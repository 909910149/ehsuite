var FCKW3CRange=function(b){this._Document=b;this.startContainer=null;this.startOffset=null;this.endContainer=null;this.endOffset=null;this.collapsed=true;};FCKW3CRange.CreateRange=function(b){return new FCKW3CRange(b);};FCKW3CRange.CreateFromRange=function(d,f){var e=FCKW3CRange.CreateRange(d);e.setStart(f.startContainer,f.startOffset);e.setEnd(f.endContainer,f.endOffset);return e;};FCKW3CRange.prototype={_UpdateCollapsed:function(){this.collapsed=(this.startContainer==this.endContainer&&this.startOffset==this.endOffset);},setStart:function(d,c){this.startContainer=d;this.startOffset=c;if(!this.endContainer){this.endContainer=d;this.endOffset=c;}this._UpdateCollapsed();},setEnd:function(d,c){this.endContainer=d;this.endOffset=c;if(!this.startContainer){this.startContainer=d;this.startOffset=c;}this._UpdateCollapsed();},setStartAfter:function(b){this.setStart(b.parentNode,FCKDomTools.GetIndexOf(b)+1);},setStartBefore:function(b){this.setStart(b.parentNode,FCKDomTools.GetIndexOf(b));},setEndAfter:function(b){this.setEnd(b.parentNode,FCKDomTools.GetIndexOf(b)+1);},setEndBefore:function(b){this.setEnd(b.parentNode,FCKDomTools.GetIndexOf(b));},collapse:function(b){if(b){this.endContainer=this.startContainer;this.endOffset=this.startOffset;}else{this.startContainer=this.endContainer;this.startOffset=this.endOffset;}this.collapsed=true;},selectNodeContents:function(b){this.setStart(b,0);this.setEnd(b,b.nodeType==3?b.data.length:b.childNodes.length);},insertNode:function(d){var f=this.startContainer;var e=this.startOffset;if(f.nodeType==3){f.splitText(e);if(f==this.endContainer){this.setEnd(f.nextSibling,this.endOffset-this.startOffset);}FCKDomTools.InsertAfterNode(f,d);return;}else{f.insertBefore(d,f.childNodes[e]||null);if(f==this.endContainer){this.endOffset++;this.collapsed=false;}}},deleteContents:function(){if(this.collapsed){return;}this._ExecContentsAction(0);},extractContents:function(){var b=new FCKDocumentFragment(this._Document);if(!this.collapsed){this._ExecContentsAction(1,b);}return b;},cloneContents:function(){var b=new FCKDocumentFragment(this._Document);if(!this.collapsed){this._ExecContentsAction(2,b);}return b;},_ExecContentsAction:function(F,T){var j=this.startContainer;var I=this.endContainer;var D=this.startOffset;var N=this.endOffset;var G=false;var M=false;if(I.nodeType==3){I=I.splitText(N);}else{if(I.childNodes.length>0){if(N>I.childNodes.length-1){I=FCKDomTools.InsertAfterNode(I.lastChild,this._Document.createTextNode(""));M=true;}else{I=I.childNodes[N];}}}if(j.nodeType==3){j.splitText(D);if(j==I){I=j.nextSibling;}}else{if(D==0){j=j.insertBefore(this._Document.createTextNode(""),j.firstChild);G=true;}else{if(D>j.childNodes.length-1){j=j.appendChild(this._Document.createTextNode(""));G=true;}else{j=j.childNodes[D].previousSibling;}}}var B=FCKDomTools.GetParents(j);var R=FCKDomTools.GetParents(I);var C,i,k;for(C=0;C<B.length;C++){i=B[C];k=R[C];if(i!=k){break;}}var A,J,K,P,L;if(T){A=T.RootNode;}for(var E=C;E<B.length;E++){J=B[E];if(A&&J!=j){K=A.appendChild(J.cloneNode(J==j));}P=J.nextSibling;while(P){if(P==R[E]||P==I){break;}L=P.nextSibling;if(F==2){A.appendChild(P.cloneNode(true));}else{P.parentNode.removeChild(P);if(F==1){A.appendChild(P);}}P=L;}if(A){A=K;}}if(T){A=T.RootNode;}for(var H=C;H<R.length;H++){J=R[H];if(F>0&&J!=I){K=A.appendChild(J.cloneNode(J==I));}if(!B[H]||J.parentNode!=B[H].parentNode){P=J.previousSibling;while(P){if(P==B[H]||P==j){break;}L=P.previousSibling;if(F==2){A.insertBefore(P.cloneNode(true),A.firstChild);}else{P.parentNode.removeChild(P);if(F==1){A.insertBefore(P,A.firstChild);}}P=L;}}if(A){A=K;}}if(F==2){var S=this.startContainer;if(S.nodeType==3){S.data+=S.nextSibling.data;S.parentNode.removeChild(S.nextSibling);}var O=this.endContainer;if(O.nodeType==3&&O.nextSibling){O.data+=O.nextSibling.data;O.parentNode.removeChild(O.nextSibling);}}else{if(i&&k&&(j.parentNode!=i.parentNode||I.parentNode!=k.parentNode)){var Q=FCKDomTools.GetIndexOf(k);if(G&&k.parentNode==j.parentNode){Q--;}this.setStart(k.parentNode,Q);}this.collapse(true);}if(G){j.parentNode.removeChild(j);}if(M&&I.parentNode){I.parentNode.removeChild(I);}},cloneRange:function(){return FCKW3CRange.CreateFromRange(this._Document,this);}};