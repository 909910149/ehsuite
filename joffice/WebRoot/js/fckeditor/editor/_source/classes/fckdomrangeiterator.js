var FCKDomRangeIterator=function(b){this.Range=b;this.ForceBrBreak=false;this.EnforceRealBlocks=false;};FCKDomRangeIterator.CreateFromSelection=function(c){var d=new FCKDomRange(c);d.MoveToSelection();return new FCKDomRangeIterator(d);};FCKDomRangeIterator.prototype={GetNextParagraph:function(){var x;var u;var w;var r;var E;var y=this.ForceBrBreak?FCKListsLib.ListBoundaries:FCKListsLib.BlockBoundaries;if(!this._LastNode){var u=this.Range.Clone();u.Expand(this.ForceBrBreak?"list_contents":"block_contents");this._NextNode=u.GetTouchedStartNode();this._LastNode=u.GetTouchedEndNode();u=null;}var B=this._NextNode;var D=this._LastNode;this._NextNode=null;while(B){var z=false;var A=(B.nodeType!=1);var s=false;if(!A){var t=B.nodeName.toLowerCase();if(y[t]&&(!FCKBrowserInfo.IsIE||B.scopeName=="HTML")){if(t=="br"){A=true;}else{if(!u&&B.childNodes.length==0&&t!="hr"){x=B;w=B==D;break;}}if(u){u.SetEnd(B,3,true);if(t!="br"){this._NextNode=FCKDomTools.GetNextSourceNode(B,true,null,D)||B;}}z=true;}else{if(B.firstChild){if(!u){u=new FCKDomRange(this.Range.Window);u.SetStart(B,3,true);}B=B.firstChild;continue;}A=true;}}else{if(B.nodeType==3){if(/^[\r\n\t ]+$/.test(B.nodeValue)){A=false;}}}if(A&&!u){u=new FCKDomRange(this.Range.Window);u.SetStart(B,3,true);}w=((!z||A)&&B==D);if(u&&!z){while(!B.nextSibling&&!w){var v=B.parentNode;if(y[v.nodeName.toLowerCase()]){z=true;w=w||(v==D);break;}B=v;A=true;w=(B==D);s=true;}}if(A){u.SetEnd(B,4,true);}if((z||w)&&u){u._UpdateElementInfo();if(u.StartNode==u.EndNode&&u.StartNode.parentNode==u.StartBlockLimit&&u.StartNode.getAttribute&&u.StartNode.getAttribute("_fck_bookmark")){u=null;}else{break;}}if(w){break;}B=FCKDomTools.GetNextSourceNode(B,s,null,D);}if(!x){if(!u){this._NextNode=null;return null;}x=u.StartBlock;if(!x&&!this.EnforceRealBlocks&&u.StartBlockLimit.nodeName.IEquals("DIV","TH","TD")&&u.CheckStartOfBlock()&&u.CheckEndOfBlock()){x=u.StartBlockLimit;}else{if(!x||(this.EnforceRealBlocks&&x.nodeName.toLowerCase()=="li")){x=this.Range.Window.document.createElement(FCKConfig.EnterMode=="p"?"p":"div");u.ExtractContents().AppendTo(x);FCKDomTools.TrimNode(x);u.InsertNode(x);r=true;E=true;}else{if(x.nodeName.toLowerCase()!="li"){if(!u.CheckStartOfBlock()||!u.CheckEndOfBlock()){x=x.cloneNode(false);u.ExtractContents().AppendTo(x);FCKDomTools.TrimNode(x);var q=u.SplitBlock();r=!q.WasStartOfBlock;E=!q.WasEndOfBlock;u.InsertNode(x);}}else{if(!w){this._NextNode=x==D?null:FCKDomTools.GetNextSourceNode(u.EndNode,true,null,D);return x;}}}}}if(r){var F=x.previousSibling;if(F&&F.nodeType==1){if(F.nodeName.toLowerCase()=="br"){F.parentNode.removeChild(F);}else{if(F.lastChild&&F.lastChild.nodeName.IEquals("br")){F.removeChild(F.lastChild);}}}}if(E){var C=x.lastChild;if(C&&C.nodeType==1&&C.nodeName.toLowerCase()=="br"){x.removeChild(C);}}if(!this._NextNode){this._NextNode=(w||x==D)?null:FCKDomTools.GetNextSourceNode(x,true,null,D);}return x;}};