var FCKContextMenu=function(g,h){this.CtrlDisable=false;var e=this._Panel=new FCKPanel(g);e.AppendStyleSheet(FCKConfig.SkinEditorCSS);e.IsContextMenu=true;if(FCKBrowserInfo.IsGecko){e.Document.addEventListener("draggesture",function(a){a.preventDefault();return false;},true);}var f=this._MenuBlock=new FCKMenuBlock();f.Panel=e;f.OnClick=FCKTools.CreateEventListener(FCKContextMenu_MenuBlock_OnClick,this);this._Redraw=true;};FCKContextMenu.prototype.SetMouseClickWindow=function(b){if(!FCKBrowserInfo.IsIE){this._Document=b.document;if(FCKBrowserInfo.IsOpera&&!("oncontextmenu" in document.createElement("foo"))){this._Document.addEventListener("mousedown",FCKContextMenu_Document_OnMouseDown,false);this._Document.addEventListener("mouseup",FCKContextMenu_Document_OnMouseUp,false);}this._Document.addEventListener("contextmenu",FCKContextMenu_Document_OnContextMenu,false);}};FCKContextMenu.prototype.AddItem=function(l,g,j,h,i){var k=this._MenuBlock.AddItem(l,g,j,h,i);this._Redraw=true;return k;};FCKContextMenu.prototype.AddSeparator=function(){this._MenuBlock.AddSeparator();this._Redraw=true;};FCKContextMenu.prototype.RemoveAllItems=function(){this._MenuBlock.RemoveAllItems();this._Redraw=true;};FCKContextMenu.prototype.AttachToElement=function(b){if(FCKBrowserInfo.IsIE){FCKTools.AddEventListenerEx(b,"contextmenu",FCKContextMenu_AttachedElement_OnContextMenu,this);}else{b._FCKContextMenu=this;}};function FCKContextMenu_Document_OnContextMenu(c){if(FCKConfig.BrowserContextMenu){return true;}var d=c.target;while(d){if(d._FCKContextMenu){if(d._FCKContextMenu.CtrlDisable&&(c.ctrlKey||c.metaKey)){return true;}FCKTools.CancelEvent(c);FCKContextMenu_AttachedElement_OnContextMenu(c,d._FCKContextMenu,d);return false;}d=d.parentNode;}return true;}var FCKContextMenu_OverrideButton;function FCKContextMenu_Document_OnMouseDown(h){if(!h||h.button!=2){return false;}if(FCKConfig.BrowserContextMenu){return true;}var j=h.target;while(j){if(j._FCKContextMenu){if(j._FCKContextMenu.CtrlDisable&&(h.ctrlKey||h.metaKey)){return true;}var e=FCKContextMenu_OverrideButton;if(!e){var i=FCKTools.GetElementDocument(h.target);e=FCKContextMenu_OverrideButton=i.createElement("input");e.type="button";var g=i.createElement("p");i.body.appendChild(g);g.appendChild(e);}e.style.cssText="position:absolute;top:"+(h.clientY-2)+"px;left:"+(h.clientX-2)+"px;width:5px;height:5px;opacity:0.01";}j=j.parentNode;}return false;}function FCKContextMenu_Document_OnMouseUp(f){if(FCKConfig.BrowserContextMenu){return true;}var e=FCKContextMenu_OverrideButton;if(e){var d=e.parentNode;d.parentNode.removeChild(d);FCKContextMenu_OverrideButton=undefined;if(f&&f.button==2){FCKContextMenu_Document_OnContextMenu(f);return false;}}return true;}function FCKContextMenu_AttachedElement_OnContextMenu(j,g,k){if((g.CtrlDisable&&(j.ctrlKey||j.metaKey))||FCKConfig.BrowserContextMenu){return true;}var l=k||this;if(g.OnBeforeOpen){g.OnBeforeOpen.call(g,l);}if(g._MenuBlock.Count()==0){return false;}if(g._Redraw){g._MenuBlock.Create(g._Panel.MainNode);g._Redraw=false;}FCKTools.DisableSelection(g._Panel.Document.body);var h=0;var i=0;if(FCKBrowserInfo.IsIE){h=j.screenX;i=j.screenY;}else{if(FCKBrowserInfo.IsSafari){h=j.clientX;i=j.clientY;}else{h=j.pageX;i=j.pageY;}}g._Panel.Show(h,i,j.currentTarget||null);return false;}function FCKContextMenu_MenuBlock_OnClick(c,d){d._Panel.Hide();FCKTools.RunFunction(d.OnItemClick,d,c);}