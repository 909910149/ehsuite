var FCKEditingArea=function(b){this.TargetElement=b;this.Mode=FCK_EDITMODE_WYSIWYG;if(FCK.IECleanup){FCK.IECleanup.AddItem(this,FCKEditingArea_Cleanup);}};FCKEditingArea.prototype.Start=function(s,o){var w=this.TargetElement;var u=FCKTools.GetElementDocument(w);while(w.firstChild){w.removeChild(w.firstChild);}if(this.Mode==FCK_EDITMODE_WYSIWYG){if(FCK_IS_CUSTOM_DOMAIN){s='<script>document.domain="'+FCK_RUNTIME_DOMAIN+'";<\/script>'+s;}if(FCKBrowserInfo.IsIE){s=s.replace(/(<base[^>]*?)\s*\/?>(?!\s*<\/base>)/gi,"$1></base>");}else{if(!o){var r=s.match(FCKRegexLib.BeforeBody);var x=s.match(FCKRegexLib.AfterBody);if(r&&x){var p=s.substr(r[1].length,s.length-r[1].length-x[1].length);s=r[1]+"&nbsp;"+x[1];if(FCKBrowserInfo.IsGecko&&(p.length==0||FCKRegexLib.EmptyParagraph.test(p))){p='<br type="_moz">';}this._BodyHTML=p;}else{this._BodyHTML=s;}}}var t=this.IFrame=u.createElement("iframe");var m='<script type="text/javascript" _fcktemp="true">window.onerror=function(){return true;};<\/script>';t.frameBorder=0;t.style.width=t.style.height="100%";if(FCK_IS_CUSTOM_DOMAIN&&FCKBrowserInfo.IsIE){window._FCKHtmlToLoad=s.replace(/<head>/i,"<head>"+m);t.src="javascript:void( (function(){"+"document.open() ;"+'document.domain="'+document.domain+'" ;'+"document.write( window.parent._FCKHtmlToLoad );"+"document.close() ;"+"window.parent._FCKHtmlToLoad = null ;"+"})() )";}else{if(!FCKBrowserInfo.IsGecko){t.src="javascript:void(0)";}}w.appendChild(t);this.Window=t.contentWindow;if(!FCK_IS_CUSTOM_DOMAIN||!FCKBrowserInfo.IsIE){var n=this.Window.document;n.open();n.write(s.replace(/<head>/i,"<head>"+m));n.close();}if(FCKBrowserInfo.IsAIR){FCKAdobeAIR.EditingArea_Start(n,s);}if(FCKBrowserInfo.IsGecko10&&!o){this.Start(s,true);return;}if(t.readyState&&t.readyState!="completed"){var q=this;setTimeout(function(){try{q.Window.document.documentElement.doScroll("left");}catch(a){setTimeout(arguments.callee,0);return;}q.Window._FCKEditingArea=q;FCKEditingArea_CompleteStart.call(q.Window);},0);}else{this.Window._FCKEditingArea=this;if(FCKBrowserInfo.IsGecko10){this.Window.setTimeout(FCKEditingArea_CompleteStart,500);}else{FCKEditingArea_CompleteStart.call(this.Window);}}}else{var v=this.Textarea=u.createElement("textarea");v.className="SourceField";v.dir="ltr";FCKDomTools.SetElementStyles(v,{width:"100%",height:"100%",border:"none",resize:"none",outline:"none"});w.appendChild(v);v.value=s;FCKTools.RunFunction(this.OnLoad);}};function FCKEditingArea_CompleteStart(){if(!this.document.body){this.setTimeout(FCKEditingArea_CompleteStart,50);return;}var b=this._FCKEditingArea;b.Document=b.Window.document;b.MakeEditable();FCKTools.RunFunction(b.OnLoad);}FCKEditingArea.prototype.MakeEditable=function(){var d=this.Document;if(FCKBrowserInfo.IsIE){d.body.disabled=true;d.body.contentEditable=true;d.body.removeAttribute("disabled");}else{try{d.body.spellcheck=(this.FFSpellChecker!==false);if(this._BodyHTML){d.body.innerHTML=this._BodyHTML;d.body.offsetLeft;this._BodyHTML=null;}d.designMode="on";d.execCommand("enableObjectResizing",false,!FCKConfig.DisableObjectResizing);d.execCommand("enableInlineTableEditing",false,!FCKConfig.DisableFFTableHandles);}catch(c){FCKTools.AddEventListener(this.Window.frameElement,"DOMAttrModified",FCKEditingArea_Document_AttributeNodeModified);}}};function FCKEditingArea_Document_AttributeNodeModified(d){var c=d.currentTarget.contentWindow._FCKEditingArea;if(c._timer){window.clearTimeout(c._timer);}c._timer=FCKTools.SetTimeout(FCKEditingArea_MakeEditableByMutation,1000,c);}function FCKEditingArea_MakeEditableByMutation(){delete this._timer;FCKTools.RemoveEventListener(this.Window.frameElement,"DOMAttrModified",FCKEditingArea_Document_AttributeNodeModified);this.MakeEditable();}FCKEditingArea.prototype.Focus=function(){try{if(this.Mode==FCK_EDITMODE_WYSIWYG){if(FCKBrowserInfo.IsIE){this._FocusIE();}else{this.Window.focus();}}else{var d=FCKTools.GetElementDocument(this.Textarea);if((!d.hasFocus||d.hasFocus())&&d.activeElement==this.Textarea){return;}this.Textarea.focus();}}catch(c){}};FCKEditingArea.prototype._FocusIE=function(){this.Document.body.setActive();this.Window.focus();var d=this.Document.selection.createRange();var e=d.parentElement();var f=e.nodeName.toLowerCase();if(e.childNodes.length>0||!(FCKListsLib.BlockElements[f]||FCKListsLib.NonEmptyBlockElements[f])){return;}d=new FCKDomRange(this.Window);d.MoveToElementEditStart(e);d.Select();};function FCKEditingArea_Cleanup(){if(this.Document){this.Document.selection.empty();this.Document.body.innerHTML="";}this.TargetElement=null;this.IFrame=null;this.Document=null;this.Textarea=null;if(this.Window){this.Window._FCKEditingArea=null;this.Window=null;}}