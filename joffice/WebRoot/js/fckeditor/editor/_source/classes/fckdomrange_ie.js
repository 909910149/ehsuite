FCKDomRange.prototype.MoveToSelection=function(){this.Release(true);this._Range=new FCKW3CRange(this.Window.document);var f=this.Window.document.selection;if(f.type!="Control"){var h=this._GetSelectionMarkerTag(true);var g=this._GetSelectionMarkerTag(false);if(!h&&!g){this._Range.setStart(this.Window.document.body,0);this._UpdateElementInfo();return;}this._Range.setStart(h.parentNode,FCKDomTools.GetIndexOf(h));h.parentNode.removeChild(h);this._Range.setEnd(g.parentNode,FCKDomTools.GetIndexOf(g));g.parentNode.removeChild(g);this._UpdateElementInfo();}else{var e=f.createRange().item(0);if(e){this._Range.setStartBefore(e);this._Range.setEndAfter(e);this._UpdateElementInfo();}}};FCKDomRange.prototype.Select=function(b){if(this._Range){this.SelectBookmark(this.CreateBookmark(true),b);}};FCKDomRange.prototype.SelectBookmark=function(l,q){var k=this.CheckIsCollapsed();var j;var m;var p=this.GetBookmarkNode(l,true);if(!p){return;}var o;if(!k){o=this.GetBookmarkNode(l,false);}var r=this.Window.document.body.createTextRange();r.moveToElementText(p);r.moveStart("character",1);if(o){var n=this.Window.document.body.createTextRange();n.moveToElementText(o);r.setEndPoint("EndToEnd",n);r.moveEnd("character",-1);}else{j=q||!p.previousSibling||p.previousSibling.nodeName.toLowerCase()=="br";m=this.Window.document.createElement("span");m.innerHTML="&#65279;";p.parentNode.insertBefore(m,p);if(j){p.parentNode.insertBefore(this.Window.document.createTextNode("\ufeff"),p);}}if(!this._Range){this._Range=this.CreateRange();}this._Range.setStartBefore(p);p.parentNode.removeChild(p);if(k){if(j){r.moveStart("character",-1);r.select();this.Window.document.selection.clear();}else{r.select();}FCKDomTools.RemoveNode(m);}else{this._Range.setEndBefore(o);o.parentNode.removeChild(o);r.select();}};FCKDomRange.prototype._GetSelectionMarkerTag=function(h){var j=this.Window.document;var l=j.selection;var i;try{i=l.createRange();}catch(k){return null;}if(i.parentElement().document!=j){return null;}i.collapse(h===true);var e="fck_dom_range_temp_"+(new Date()).valueOf()+"_"+Math.floor(Math.random()*1000);i.pasteHTML('<span id="'+e+'"></span>');return j.getElementById(e);};