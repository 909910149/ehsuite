FCK.Description="FCKeditor for Gecko Browsers";FCK.InitializeBehaviors=function(){if(window.onresize){window.onresize();}FCKFocusManager.AddWindow(this.EditorWindow);this.ExecOnSelectionChange=function(){FCK.Events.FireEvent("OnSelectionChange");};this._ExecDrop=function(d){if(FCK.MouseDownFlag){FCK.MouseDownFlag=false;return;}if(FCKConfig.ForcePasteAsPlainText){if(d.dataTransfer){var c=d.dataTransfer.getData("Text");c=FCKTools.HTMLEncode(c);c=FCKTools.ProcessLineBreaks(window,FCKConfig,c);FCK.InsertHtml(c);}else{if(FCKConfig.ShowDropDialog){FCK.PasteAsPlainText();}}d.preventDefault();d.stopPropagation();}};this._ExecCheckCaret=function(f){if(FCK.EditMode!=FCK_EDITMODE_WYSIWYG){return;}if(f.type=="keypress"){var e=f.keyCode;if(e<33||e>40){return;}}var g=function(a){if(a.nodeType!=1){return false;}var b=a.tagName.toLowerCase();return(FCKListsLib.BlockElements[b]||FCKListsLib.EmptyElements[b]);};var h=function(){var d=FCKSelection.GetSelection();var o=d.getRangeAt(0);if(!o||!o.collapsed){return;}var c=o.endContainer;if(c.nodeType!=3){return;}if(c.nodeValue.length!=o.endOffset){return;}var a=c.parentNode.tagName.toLowerCase();if(!(a=="a"||(!FCKBrowserInfo.IsOpera&&String(c.parentNode.contentEditable)=="false")||(!(FCKListsLib.BlockElements[a]||FCKListsLib.NonEmptyBlockElements[a])&&e==35))){return;}var m=FCKTools.GetNextTextNode(c,c.parentNode,g);if(m){return;}o=FCK.EditorDocument.createRange();m=FCKTools.GetNextTextNode(c,c.parentNode.parentNode,g);if(m){if(FCKBrowserInfo.IsOpera&&e==37){return;}o.setStart(m,0);o.setEnd(m,0);}else{while(c.parentNode&&c.parentNode!=FCK.EditorDocument.body&&c.parentNode!=FCK.EditorDocument.documentElement&&c==c.parentNode.lastChild&&(!FCKListsLib.BlockElements[c.parentNode.tagName.toLowerCase()]&&!FCKListsLib.NonEmptyBlockElements[c.parentNode.tagName.toLowerCase()])){c=c.parentNode;}if(FCKListsLib.BlockElements[a]||FCKListsLib.EmptyElements[a]||c==FCK.EditorDocument.body){o.setStart(c,c.childNodes.length);o.setEnd(c,c.childNodes.length);}else{var n=c.nextSibling;while(n){if(n.nodeType!=1){n=n.nextSibling;continue;}var b=n.tagName.toLowerCase();if(FCKListsLib.BlockElements[b]||FCKListsLib.EmptyElements[b]||FCKListsLib.NonEmptyBlockElements[b]){break;}n=n.nextSibling;}var p=FCK.EditorDocument.createTextNode("");if(n){c.parentNode.insertBefore(p,n);}else{c.parentNode.appendChild(p);}o.setStart(p,0);o.setEnd(p,0);}}d.removeAllRanges();d.addRange(o);FCK.Events.FireEvent("OnSelectionChange");};setTimeout(h,1);};this.ExecOnSelectionChangeTimer=function(){if(FCK.LastOnChangeTimer){window.clearTimeout(FCK.LastOnChangeTimer);}FCK.LastOnChangeTimer=window.setTimeout(FCK.ExecOnSelectionChange,100);};this.EditorDocument.addEventListener("mouseup",this.ExecOnSelectionChange,false);this.EditorDocument.addEventListener("keyup",this.ExecOnSelectionChangeTimer,false);this._DblClickListener=function(b){FCK.OnDoubleClick(b.target);b.stopPropagation();};this.EditorDocument.addEventListener("dblclick",this._DblClickListener,true);this.EditorDocument.addEventListener("keydown",this._KeyDownListener,false);if(FCKBrowserInfo.IsGecko){this.EditorWindow.addEventListener("dragdrop",this._ExecDrop,true);}else{if(FCKBrowserInfo.IsSafari){this.EditorDocument.addEventListener("dragover",function(b){if(!FCK.MouseDownFlag&&FCK.Config.ForcePasteAsPlainText){b.returnValue=false;}},true);this.EditorDocument.addEventListener("drop",this._ExecDrop,true);this.EditorDocument.addEventListener("mousedown",function(c){var d=c.srcElement;if(d.nodeName.IEquals("IMG","HR","INPUT","TEXTAREA","SELECT")){FCKSelection.SelectNode(d);}},true);this.EditorDocument.addEventListener("mouseup",function(b){if(b.srcElement.nodeName.IEquals("INPUT","TEXTAREA","SELECT")){b.preventDefault();}},true);this.EditorDocument.addEventListener("click",function(b){if(b.srcElement.nodeName.IEquals("INPUT","TEXTAREA","SELECT")){b.preventDefault();}},true);}}if(FCKBrowserInfo.IsGecko||FCKBrowserInfo.IsOpera){this.EditorDocument.addEventListener("keypress",this._ExecCheckCaret,false);this.EditorDocument.addEventListener("click",this._ExecCheckCaret,false);}FCK.ContextMenu._InnerContextMenu.SetMouseClickWindow(FCK.EditorWindow);FCK.ContextMenu._InnerContextMenu.AttachToElement(FCK.EditorDocument);};FCK.MakeEditable=function(){this.EditingArea.MakeEditable();};function Document_OnContextMenu(b){if(!b.target._FCKShowContextMenu){b.preventDefault();}}document.oncontextmenu=Document_OnContextMenu;FCK._BaseGetNamedCommandState=FCK.GetNamedCommandState;FCK.GetNamedCommandState=function(b){switch(b){case"Unlink":return FCKSelection.HasAncestorNode("A")?FCK_TRISTATE_OFF:FCK_TRISTATE_DISABLED;default:return FCK._BaseGetNamedCommandState(b);}};FCK.RedirectNamedCommands={Print:true,Paste:true};FCK.ExecuteRedirectedNamedCommand=function(e,d){switch(e){case"Print":FCK.EditorWindow.print();break;case"Paste":try{if(FCKBrowserInfo.IsSafari){throw"";}if(FCK.Paste()){FCK.ExecuteNamedCommand("Paste",null,true);}}catch(f){if(FCKConfig.ForcePasteAsPlainText){FCK.PasteAsPlainText();}else{FCKDialog.OpenDialog("FCKDialog_Paste",FCKLang.Paste,"dialog/fck_paste.html",400,330,"Security");}}break;default:FCK.ExecuteNamedCommand(e,d);}};FCK._ExecPaste=function(){FCKUndo.SaveUndoStep();if(FCKConfig.ForcePasteAsPlainText){FCK.PasteAsPlainText();return false;}return true;};FCK.InsertHtml=function(o){var k=FCK.EditorDocument,j;o=FCKConfig.ProtectedSource.Protect(o);o=FCK.ProtectEvents(o);o=FCK.ProtectUrls(o);o=FCK.ProtectTags(o);FCKUndo.SaveUndoStep();if(FCKBrowserInfo.IsGecko){o=o.replace(/&nbsp;$/,'$&<span _fcktemp="1"/>');var p=new FCKDocumentFragment(this.EditorDocument);p.AppendHtml(o);var m=p.RootNode.lastChild;j=new FCKDomRange(this.EditorWindow);j.MoveToSelection();var e=p.RootNode.firstChild;while(e&&e.nodeType!=1){e=e.nextSibling;}if(e&&FCKListsLib.BlockElements[e.nodeName.toLowerCase()]){j.SplitBlock();}j.DeleteContents();j.InsertNode(p.RootNode);j.MoveToPosition(m,4);}else{k.execCommand("inserthtml",false,o);}this.Focus();if(!j){j=new FCKDomRange(this.EditorWindow);j.MoveToSelection();}var n=j.CreateBookmark();FCKDocumentProcessor.Process(k);try{j.MoveToBookmark(n);j.Select();}catch(l){}this.Events.FireEvent("OnSelectionChange");};FCK.PasteAsPlainText=function(){FCKTools.RunFunction(FCKDialog.OpenDialog,FCKDialog,["FCKDialog_Paste",FCKLang.PasteAsText,"dialog/fck_paste.html",400,330,"PlainText"]);};FCK.GetClipboardHTML=function(){return"";};FCK.CreateLink=function(h,l){var i=new Array();if(FCKSelection.GetSelection().isCollapsed){return i;}FCK.ExecuteNamedCommand("Unlink",null,false,!!l);if(h.length>0){var m="javascript:void(0);/*"+(new Date().getTime())+"*/";FCK.ExecuteNamedCommand("CreateLink",m,false,!!l);var k=this.EditorDocument.evaluate("//a[@href='"+m+"']",this.EditorDocument.body,null,XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,null);for(var n=0;n<k.snapshotLength;n++){var j=k.snapshotItem(n);j.href=h;i.push(j);}}return i;};FCK._FillEmptyBlock=function(c){if(!c||c.nodeType!=1){return;}var d=c.tagName.toLowerCase();if(d!="p"&&d!="div"){return;}if(c.firstChild){return;}FCKTools.AppendBogusBr(c);};FCK._ExecCheckEmptyBlock=function(){FCK._FillEmptyBlock(FCK.EditorDocument.body.firstChild);var c=FCKSelection.GetSelection();if(!c||c.rangeCount<1){return;}var d=c.getRangeAt(0);FCK._FillEmptyBlock(d.startContainer);};