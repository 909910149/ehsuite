FCKSelection.GetType=function(){var e="Text";var h;try{h=this.GetSelection();}catch(g){}if(h&&h.rangeCount==1){var f=h.getRangeAt(0);if(f.startContainer==f.endContainer&&(f.endOffset-f.startOffset)==1&&f.startContainer.nodeType==1&&FCKListsLib.StyleObjectElements[f.startContainer.childNodes[f.startOffset].nodeName.toLowerCase()]){e="Control";}}return e;};FCKSelection.GetSelectedElement=function(){var d=!!FCK.EditorWindow&&this.GetSelection();if(!d||d.rangeCount<1){return null;}var e=d.getRangeAt(0);if(e.startContainer!=e.endContainer||e.startContainer.nodeType!=1||e.startOffset!=e.endOffset-1){return null;}var f=e.startContainer.childNodes[e.startOffset];if(f.nodeType!=1){return null;}return f;};FCKSelection.GetParentElement=function(){if(this.GetType()=="Control"){return FCKSelection.GetSelectedElement().parentNode;}else{var p=this.GetSelection();if(p){if(p.anchorNode&&p.anchorNode==p.focusNode){var k=p.getRangeAt(0);if(k.collapsed||k.startContainer.nodeType==3){return p.anchorNode.parentNode;}else{return p.anchorNode;}}var l=new FCKElementPath(p.anchorNode);var i=new FCKElementPath(p.focusNode);var o=null;var j=null;if(l.Elements.length>i.Elements.length){o=l.Elements;j=i.Elements;}else{o=i.Elements;j=l.Elements;}var m=o.length-j.length;for(var n=0;n<j.length;n++){if(o[m+n]==j[n]){return j[n];}}return null;}}return null;};FCKSelection.GetBoundaryParentElement=function(g){if(!FCK.EditorWindow){return null;}if(this.GetType()=="Control"){return FCKSelection.GetSelectedElement().parentNode;}else{var f=this.GetSelection();if(f&&f.rangeCount>0){var e=f.getRangeAt(g?0:(f.rangeCount-1));var h=g?e.startContainer:e.endContainer;return(h.nodeType==1?h:h.parentNode);}}return null;};FCKSelection.SelectNode=function(d){var f=FCK.EditorDocument.createRange();f.selectNode(d);var e=this.GetSelection();e.removeAllRanges();e.addRange(f);};FCKSelection.Collapse=function(c){var d=this.GetSelection();if(c==null||c===true){d.collapseToStart();}else{d.collapseToEnd();}};FCKSelection.HasAncestorNode=function(f){var e=this.GetSelectedElement();if(!e&&FCK.EditorWindow){try{e=this.GetSelection().getRangeAt(0).startContainer;}catch(d){}}while(e){if(e.nodeType==1&&e.nodeName.IEquals(f)){return true;}e=e.parentNode;}return false;};FCKSelection.MoveToAncestorNode=function(f){var d;var e=this.GetSelectedElement();if(!e){e=this.GetSelection().getRangeAt(0).startContainer;}while(e){if(e.nodeName.IEquals(f)){return e;}e=e.parentNode;}return null;};FCKSelection.Delete=function(){var d=this.GetSelection();for(var c=0;c<d.rangeCount;c++){d.getRangeAt(c).deleteContents();}return d;};FCKSelection.GetSelection=function(){return FCK.EditorWindow.getSelection();};FCKSelection.Save=function(){};FCKSelection.Restore=function(){};FCKSelection.Release=function(){};