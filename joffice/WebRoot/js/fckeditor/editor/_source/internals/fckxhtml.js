var FCKXHtml=new Object();FCKXHtml.CurrentJobNum=0;FCKXHtml.GetXHTML=function(l,k,j){FCKDomTools.CheckAndRemovePaddingNode(FCKTools.GetElementDocument(l),FCKConfig.EnterMode);FCKXHtmlEntities.Initialize();this._NbspEntity=(FCKConfig.ProcessHTMLEntities?"nbsp":"#160");var h=FCK.IsDirty();FCKXHtml.SpecialBlocks=new Array();this.XML=FCKTools.CreateXmlObject("DOMDocument");this.MainNode=this.XML.appendChild(this.XML.createElement("xhtml"));FCKXHtml.CurrentJobNum++;if(k){this._AppendNode(this.MainNode,l);}else{this._AppendChildNodes(this.MainNode,l,false);}if(FCKBrowserInfo.IsIE){FCKXHtml._RemoveXHtmlJobProperties(l);}var m=this._GetMainXmlString();this.XML=null;if(FCKBrowserInfo.IsSafari){m=m.replace(/^<xhtml.*?>/,"<xhtml>");}m=m.substr(7,m.length-15).Trim();if(FCKConfig.DocType.length>0&&FCKRegexLib.HtmlDocType.test(FCKConfig.DocType)){m=m.replace(FCKRegexLib.SpaceNoClose,">");}else{m=m.replace(FCKRegexLib.SpaceNoClose," />");}if(FCKConfig.ForceSimpleAmpersand){m=m.replace(FCKRegexLib.ForceSimpleAmpersand,"&");}if(j){m=FCKCodeFormatter.Format(m);}for(var n=0;n<FCKXHtml.SpecialBlocks.length;n++){var i=new RegExp("___FCKsi___"+n);m=m.replace(i,FCKXHtml.SpecialBlocks[n]);}m=m.replace(FCKRegexLib.GeckoEntitiesMarker,"&");if(!h){FCK.ResetIsDirty();}FCKDomTools.EnforcePaddingNode(FCKTools.GetElementDocument(l),FCKConfig.EnterMode);return m;};FCKXHtml._AppendAttribute=function(e,g,j){try{if(j==undefined||j==null){j="";}else{if(j.replace){if(FCKConfig.ForceSimpleAmpersand){j=j.replace(/&/g,"___FCKAmp___");}j=j.replace(FCKXHtmlEntities.EntitiesRegex,FCKXHtml_GetEntity);}}var i=this.XML.createAttribute(g);i.value=j;e.attributes.setNamedItem(i);}catch(h){}};FCKXHtml._AppendChildNodes=function(h,l,k){var i=l.firstChild;while(i){this._AppendNode(h,i);i=i.nextSibling;}if(k&&l.tagName&&l.tagName.toLowerCase()!="pre"){FCKDomTools.TrimNode(h);if(FCKConfig.FillEmptyBlocks){var g=h.lastChild;if(g&&g.nodeType==1&&g.nodeName=="br"){this._AppendEntity(h,this._NbspEntity);}}}if(h.childNodes.length==0){if(k&&FCKConfig.FillEmptyBlocks){this._AppendEntity(h,this._NbspEntity);return h;}var j=h.nodeName;if(FCKListsLib.InlineChildReqElements[j]){return null;}if(!FCKListsLib.EmptyElements[j]){h.appendChild(this.XML.createTextNode(""));}}return h;};FCKXHtml._AppendNode=function(i,e){if(!e){return false;}switch(e.nodeType){case 1:if(FCKBrowserInfo.IsGecko&&e.tagName.toLowerCase()=="br"&&e.parentNode.tagName.toLowerCase()=="pre"){var j="\r";if(e==e.parentNode.firstChild){j+="\r";}return FCKXHtml._AppendNode(i,this.XML.createTextNode(j));}if(e.getAttribute("_fckfakelement")){return FCKXHtml._AppendNode(i,FCK.GetRealElement(e));}if(FCKBrowserInfo.IsGecko&&(e.hasAttribute("_moz_editor_bogus_node")||e.getAttribute("type")=="_moz")){if(e.nextSibling){return false;}else{e.removeAttribute("_moz_editor_bogus_node");e.removeAttribute("type");}}if(e.getAttribute("_fcktemp")){return false;}var k=e.tagName.toLowerCase();if(FCKBrowserInfo.IsIE){if(e.scopeName&&e.scopeName!="HTML"&&e.scopeName!="FCK"){k=e.scopeName.toLowerCase()+":"+k;}}else{if(k.StartsWith("fck:")){k=k.Remove(0,4);}}if(!FCKRegexLib.ElementName.test(k)){return false;}if(e._fckxhtmljob&&e._fckxhtmljob==FCKXHtml.CurrentJobNum){return false;}var l=this.XML.createElement(k);FCKXHtml._AppendAttributes(i,e,l,k);e._fckxhtmljob=FCKXHtml.CurrentJobNum;var m=FCKXHtml.TagProcessors[k];if(m){l=m(l,e,i);}else{l=this._AppendChildNodes(l,e,Boolean(FCKListsLib.NonEmptyBlockElements[k]));}if(!l){return false;}i.appendChild(l);break;case 3:if(e.parentNode&&e.parentNode.nodeName.IEquals("pre")){return this._AppendTextNode(i,e.nodeValue);}return this._AppendTextNode(i,e.nodeValue.ReplaceNewLineChars(" "));case 8:if(FCKBrowserInfo.IsIE&&!e.innerHTML){break;}try{i.appendChild(this.XML.createComment(e.nodeValue));}catch(n){}break;default:i.appendChild(this.XML.createComment("Element not supported - Type: "+e.nodeType+" Name: "+e.nodeName));break;}return true;};FCKXHtml._AppendSpecialItem=function(b){return"___FCKsi___"+(FCKXHtml.SpecialBlocks.push(b)-1);};FCKXHtml._AppendEntity=function(c,d){c.appendChild(this.XML.createTextNode("#?-:"+d+";"));};FCKXHtml._AppendTextNode=function(f,e){var d=e.length>0;if(d){f.appendChild(this.XML.createTextNode(e.replace(FCKXHtmlEntities.EntitiesRegex,FCKXHtml_GetEntity)));}return d;};function FCKXHtml_GetEntity(c){var d=FCKXHtmlEntities.Entities[c]||("#"+c.charCodeAt(0));return"#?-:"+d+";";}FCKXHtml.TagProcessors={a:function(d,f){if(f.innerHTML.Trim().length==0&&!f.name){return false;}var e=f.getAttribute("_fcksavedurl");if(e!=null){FCKXHtml._AppendAttribute(d,"href",e);}if(FCKBrowserInfo.IsIE){if(f.name){FCKXHtml._AppendAttribute(d,"name",f.name);}}d=FCKXHtml._AppendChildNodes(d,f,false);return d;},area:function(i,h){var f=h.getAttribute("_fcksavedurl");if(f!=null){FCKXHtml._AppendAttribute(i,"href",f);}if(FCKBrowserInfo.IsIE){if(!i.attributes.getNamedItem("coords")){var g=h.getAttribute("coords",2);if(g&&g!="0,0,0"){FCKXHtml._AppendAttribute(i,"coords",g);}}if(!i.attributes.getNamedItem("shape")){var j=h.getAttribute("shape",2);if(j&&j.length>0){FCKXHtml._AppendAttribute(i,"shape",j.toLowerCase());}}}return i;},body:function(d,c){d=FCKXHtml._AppendChildNodes(d,c,false);d.removeAttribute("spellcheck");return d;},iframe:function(e,d){var f=d.innerHTML;if(FCKBrowserInfo.IsGecko){f=FCKTools.HTMLDecode(f);}f=f.replace(/\s_fcksavedurl="[^"]*"/g,"");e.appendChild(FCKXHtml.XML.createTextNode(FCKXHtml._AppendSpecialItem(f)));return e;},img:function(d,f){if(!d.attributes.getNamedItem("alt")){FCKXHtml._AppendAttribute(d,"alt","");}var e=f.getAttribute("_fcksavedurl");if(e!=null){FCKXHtml._AppendAttribute(d,"src",e);}if(f.style.width){d.removeAttribute("width");}if(f.style.height){d.removeAttribute("height");}return d;},li:function(f,e,h){if(h.nodeName.IEquals(["ul","ol"])){return FCKXHtml._AppendChildNodes(f,e,true);}var g=FCKXHtml.XML.createElement("ul");e._fckxhtmljob=null;do{FCKXHtml._AppendNode(g,e);do{e=FCKDomTools.GetNextSibling(e);}while(e&&e.nodeType==3&&e.nodeValue.Trim().length==0);}while(e&&e.nodeName.toLowerCase()=="li");return g;},ol:function(e,h,g){if(h.innerHTML.Trim().length==0){return false;}var f=g.lastChild;if(f&&f.nodeType==3){f=f.previousSibling;}if(f&&f.nodeName.toUpperCase()=="LI"){h._fckxhtmljob=null;FCKXHtml._AppendNode(f,h);return false;}e=FCKXHtml._AppendChildNodes(e,h);return e;},pre:function(e,d){var f=d.firstChild;if(f&&f.nodeType==3){e.appendChild(FCKXHtml.XML.createTextNode(FCKXHtml._AppendSpecialItem("\r\n")));}FCKXHtml._AppendChildNodes(e,d,true);return e;},script:function(d,c){if(!d.attributes.getNamedItem("type")){FCKXHtml._AppendAttribute(d,"type","text/javascript");}d.appendChild(FCKXHtml.XML.createTextNode(FCKXHtml._AppendSpecialItem(c.text)));return d;},span:function(d,c){if(c.innerHTML.length==0){return false;}d=FCKXHtml._AppendChildNodes(d,c,false);return d;},style:function(d,f){if(!d.attributes.getNamedItem("type")){FCKXHtml._AppendAttribute(d,"type","text/css");}var e=f.innerHTML;if(FCKBrowserInfo.IsIE){e=e.replace(/^(\r\n|\n|\r)/,"");}d.appendChild(FCKXHtml.XML.createTextNode(FCKXHtml._AppendSpecialItem(e)));return d;},title:function(d,c){d.appendChild(FCKXHtml.XML.createTextNode(FCK.EditorDocument.title));return d;}};FCKXHtml.TagProcessors.ul=FCKXHtml.TagProcessors.ol;