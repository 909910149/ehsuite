FCKSelection.GetType=function(){try{var c=FCKSelection.GetSelection().type;if(c=="Control"||c=="Text"){return c;}if(this.GetSelection().createRange().parentElement){return"Text";}}catch(d){}return"None";};FCKSelection.GetSelectedElement=function(){if(this.GetType()=="Control"){var b=this.GetSelection().createRange();if(b&&b.item){return this.GetSelection().createRange().item(0);}}return null;};FCKSelection.GetParentElement=function(){switch(this.GetType()){case"Control":var b=FCKSelection.GetSelectedElement();return b?b.parentElement:null;case"None":return null;default:return this.GetSelection().createRange().parentElement();}};FCKSelection.GetBoundaryParentElement=function(e){switch(this.GetType()){case"Control":var h=FCKSelection.GetSelectedElement();return h?h.parentElement:null;case"None":return null;default:var g=FCK.EditorDocument;var f=g.selection.createRange();f.collapse(e!==false);var h=f.parentElement();return FCKTools.GetElementDocument(h)==g?h:null;}};FCKSelection.SelectNode=function(e){FCK.Focus();this.GetSelection().empty();var f;try{f=FCK.EditorDocument.body.createControlRange();f.addElement(e);f.select();}catch(d){f=FCK.EditorDocument.body.createTextRange();f.moveToElementText(e);f.select();}};FCKSelection.Collapse=function(d){FCK.Focus();if(this.GetType()=="Text"){var c=this.GetSelection().createRange();c.collapse(d==null||d===true);c.select();}};FCKSelection.HasAncestorNode=function(f){var e;if(this.GetSelection().type=="Control"){e=this.GetSelectedElement();}else{var d=this.GetSelection().createRange();e=d.parentElement();}while(e){if(e.nodeName.IEquals(f)){return true;}e=e.parentNode;}return false;};FCKSelection.MoveToAncestorNode=function(f){var d,e;if(!FCK.EditorDocument){return null;}if(this.GetSelection().type=="Control"){e=this.GetSelection().createRange();for(i=0;i<e.length;i++){if(e(i).parentNode){d=e(i).parentNode;break;}}}else{e=this.GetSelection().createRange();d=e.parentElement();}while(d&&!d.nodeName.Equals(f)){d=d.parentNode;}return d;};FCKSelection.Delete=function(){var b=this.GetSelection();if(b.type.toLowerCase()!="none"){b.clear();}return b;};FCKSelection.GetSelection=function(){this.Restore();return FCK.EditorDocument.selection;};FCKSelection.Save=function(e){var j=FCK.EditorDocument;if(!j){return;}if(this.locked){return;}this.locked=!!e;var k=j.selection;var g;if(k){try{g=k.createRange();}catch(h){}if(g){if(g.parentElement&&FCKTools.GetElementDocument(g.parentElement())!=j){g=null;}else{if(g.item&&FCKTools.GetElementDocument(g.item(0))!=j){g=null;}}}}this.SelectionData=g;};FCKSelection._GetSelectionDocument=function(c){var d=c.createRange();if(!d){return null;}else{if(d.item){return FCKTools.GetElementDocument(d.item(0));}else{return FCKTools.GetElementDocument(d.parentElement());}}};FCKSelection.Restore=function(){if(this.SelectionData){FCK.IsSelectionChangeLocked=true;try{if(String(this._GetSelectionDocument(FCK.EditorDocument.selection).body.contentEditable)=="true"){FCK.IsSelectionChangeLocked=false;return;}this.SelectionData.select();}catch(b){}FCK.IsSelectionChangeLocked=false;}};FCKSelection.Release=function(){this.locked=false;delete this.SelectionData;};