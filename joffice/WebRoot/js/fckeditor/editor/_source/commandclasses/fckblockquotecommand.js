var FCKBlockQuoteCommand=function(){};FCKBlockQuoteCommand.prototype={Execute:function(){FCKUndo.SaveUndoStep();var V=this.GetState();var M=new FCKDomRange(FCK.EditorWindow);M.MoveToSelection();var S=M.CreateBookmark();if(FCKBrowserInfo.IsIE){var O=M.GetBookmarkNode(S,true);var X=M.GetBookmarkNode(S,false);var W;if(O&&O.parentNode.nodeName.IEquals("blockquote")&&!O.previousSibling){W=O;while((W=W.nextSibling)){if(FCKListsLib.BlockElements[W.nodeName.toLowerCase()]){FCKDomTools.MoveNode(O,W,true);}}}if(X&&X.parentNode.nodeName.IEquals("blockquote")&&!X.previousSibling){W=X;while((W=W.nextSibling)){if(FCKListsLib.BlockElements[W.nodeName.toLowerCase()]){if(W.firstChild==O){FCKDomTools.InsertAfterNode(O,X);}else{FCKDomTools.MoveNode(X,W,true);}}}}}var H=new FCKDomRangeIterator(M);var Q;if(V==FCK_TRISTATE_OFF){var P=[];while((Q=H.GetNextParagraph())){P.push(Q);}if(P.length<1){para=M.Window.document.createElement(FCKConfig.EnterMode.IEquals("p")?"p":"div");M.InsertNode(para);para.appendChild(M.Window.document.createTextNode("\ufeff"));M.MoveToBookmark(S);M.MoveToNodeContents(para);M.Collapse(true);S=M.CreateBookmark();P.push(para);}var N=P[0].parentNode;var B=[];for(var D=0;D<P.length;D++){Q=P[D];N=FCKDomTools.GetCommonParents(Q.parentNode,N).pop();}while(N.nodeName.IEquals("table","tbody","tr","ol","ul")){N=N.parentNode;}var C=null;while(P.length>0){Q=P.shift();while(Q.parentNode!=N){Q=Q.parentNode;}if(Q!=C){B.push(Q);}C=Q;}while(B.length>0){Q=B.shift();if(Q.nodeName.IEquals("blockquote")){var Y=FCKTools.GetElementDocument(Q).createDocumentFragment();while(Q.firstChild){Y.appendChild(Q.removeChild(Q.firstChild));P.push(Y.lastChild);}Q.parentNode.replaceChild(Y,Q);}else{P.push(Q);}}var G=M.Window.document.createElement("blockquote");N.insertBefore(G,P[0]);while(P.length>0){Q=P.shift();G.appendChild(Q);}}else{if(V==FCK_TRISTATE_ON){var i=[];var E={};while((Q=H.GetNextParagraph())){var L=null;var J=null;while(Q.parentNode){if(Q.parentNode.nodeName.IEquals("blockquote")){L=Q.parentNode;J=Q;break;}Q=Q.parentNode;}if(L&&J&&!J._fckblockquotemoveout){i.push(J);FCKDomTools.SetElementMarker(E,J,"_fckblockquotemoveout",true);}}FCKDomTools.ClearAllMarkers(E);var Z=[];var R=[],E={};var K=function(a){for(var b=0;b<a.childNodes.length;b++){if(FCKListsLib.BlockElements[a.childNodes[b].nodeName.toLowerCase()]){return false;}}return true;};while(i.length>0){var F=i.shift();var G=F.parentNode;if(F==F.parentNode.firstChild){G.parentNode.insertBefore(G.removeChild(F),G);}else{if(F==F.parentNode.lastChild){G.parentNode.insertBefore(G.removeChild(F),G.nextSibling);}else{FCKDomTools.BreakParent(F,F.parentNode,M);}}if(!G._fckbqprocessed){R.push(G);FCKDomTools.SetElementMarker(E,G,"_fckbqprocessed",true);}Z.push(F);}for(var D=R.length-1;D>=0;D--){var G=R[D];if(K(G)){FCKDomTools.RemoveNode(G);}}FCKDomTools.ClearAllMarkers(E);if(FCKConfig.EnterMode.IEquals("br")){while(Z.length){var F=Z.shift();var T=true;if(F.nodeName.IEquals("div")){var Y=FCKTools.GetElementDocument(F).createDocumentFragment();var I=T&&F.previousSibling&&!FCKListsLib.BlockBoundaries[F.previousSibling.nodeName.toLowerCase()];if(T&&I){Y.appendChild(FCKTools.GetElementDocument(F).createElement("br"));}var U=F.nextSibling&&!FCKListsLib.BlockBoundaries[F.nextSibling.nodeName.toLowerCase()];while(F.firstChild){Y.appendChild(F.removeChild(F.firstChild));}if(U){Y.appendChild(FCKTools.GetElementDocument(F).createElement("br"));}F.parentNode.replaceChild(Y,F);T=false;}}}}}M.MoveToBookmark(S);M.Select();FCK.Focus();FCK.Events.FireEvent("OnSelectionChange");},GetState:function(){if(FCK.EditMode!=FCK_EDITMODE_WYSIWYG||!FCK.EditorWindow){return FCK_TRISTATE_DISABLED;}var f=new FCKElementPath(FCKSelection.GetBoundaryParentElement(true));var d=f.Block||f.BlockLimit;if(!d||d.nodeName.toLowerCase()=="body"){return FCK_TRISTATE_OFF;}for(var e=0;e<f.Elements.length;e++){if(f.Elements[e].nodeName.IEquals("blockquote")){return FCK_TRISTATE_ON;}}return FCK_TRISTATE_OFF;}};