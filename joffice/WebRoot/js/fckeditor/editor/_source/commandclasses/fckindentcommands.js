var FCKIndentCommand=function(d,c){this.Name=d;this.Offset=c;this.IndentCSSProperty=FCKConfig.ContentLangDirection.IEquals("ltr")?"marginLeft":"marginRight";};FCKIndentCommand._InitIndentModeParameters=function(){if(FCKConfig.IndentClasses&&FCKConfig.IndentClasses.length>0){this._UseIndentClasses=true;this._IndentClassMap={};for(var b=0;b<FCKConfig.IndentClasses.length;b++){this._IndentClassMap[FCKConfig.IndentClasses[b]]=b+1;}this._ClassNameRegex=new RegExp("(?:^|\\s+)("+FCKConfig.IndentClasses.join("|")+")(?=$|\\s)");}else{this._UseIndentClasses=false;}};FCKIndentCommand.prototype={Execute:function(){FCKUndo.SaveUndoStep();var d=new FCKDomRange(FCK.EditorWindow);d.MoveToSelection();var f=d.CreateBookmark();var e=FCKDomTools.GetCommonParentNode(d.StartNode||d.StartContainer,d.EndNode||d.EndContainer,["ul","ol"]);if(e){this._IndentList(d,e);}else{this._IndentBlock(d);}d.MoveToBookmark(f);d.Select();FCK.Focus();FCK.Events.FireEvent("OnSelectionChange");},GetState:function(){if(FCK.EditMode!=FCK_EDITMODE_WYSIWYG||!FCK.EditorWindow){return FCK_TRISTATE_DISABLED;}if(FCKIndentCommand._UseIndentClasses==undefined){FCKIndentCommand._InitIndentModeParameters();}var p=FCKSelection.GetBoundaryParentElement(true);var j=FCKSelection.GetBoundaryParentElement(false);var o=FCKDomTools.GetCommonParentNode(p,j,["ul","ol"]);if(o){if(this.Name.IEquals("outdent")){return FCK_TRISTATE_OFF;}var n=FCKTools.GetElementAscensor(p,"li");if(!n||!n.previousSibling){return FCK_TRISTATE_DISABLED;}return FCK_TRISTATE_OFF;}if(!FCKIndentCommand._UseIndentClasses&&this.Name.IEquals("indent")){return FCK_TRISTATE_OFF;}var k=new FCKElementPath(p);var m=k.Block||k.BlockLimit;if(!m){return FCK_TRISTATE_DISABLED;}if(FCKIndentCommand._UseIndentClasses){var r=m.className.match(FCKIndentCommand._ClassNameRegex);var l=0;if(r!=null){r=r[1];l=FCKIndentCommand._IndentClassMap[r];}if((this.Name=="outdent"&&l==0)||(this.Name=="indent"&&l==FCKConfig.IndentClasses.length)){return FCK_TRISTATE_DISABLED;}return FCK_TRISTATE_OFF;}else{var q=parseInt(m.style[this.IndentCSSProperty],10);if(isNaN(q)){q=0;}if(q<=0){return FCK_TRISTATE_DISABLED;}return FCK_TRISTATE_OFF;}},_IndentBlock:function(m){var n=new FCKDomRangeIterator(m);n.EnforceRealBlocks=true;m.Expand("block_contents");var q=FCKDomTools.GetCommonParents(m.StartContainer,m.EndContainer);var o=q[q.length-1];var p;while((p=n.GetNextParagraph())){if(!(p==o||p.parentNode==o)){continue;}if(FCKIndentCommand._UseIndentClasses){var r=p.className.match(FCKIndentCommand._ClassNameRegex);var j=0;if(r!=null){r=r[1];j=FCKIndentCommand._IndentClassMap[r];}if(this.Name.IEquals("outdent")){j--;}else{if(this.Name.IEquals("indent")){j++;}}j=Math.min(j,FCKConfig.IndentClasses.length);j=Math.max(j,0);var l=p.className.replace(FCKIndentCommand._ClassNameRegex,"");if(j<1){p.className=l;}else{p.className=(l.length>0?l+" ":"")+FCKConfig.IndentClasses[j-1];}}else{var k=parseInt(p.style[this.IndentCSSProperty],10);if(isNaN(k)){k=0;}k+=this.Offset;k=Math.max(k,0);k=Math.ceil(k/this.Offset)*this.Offset;p.style[this.IndentCSSProperty]=k?k+FCKConfig.IndentUnit:"";if(p.getAttribute("style")==""){p.removeAttribute("style");}}}},_IndentList:function(w,y){var C=w.StartContainer;var i=w.EndContainer;while(C&&C.parentNode!=y){C=C.parentNode;}while(i&&i.parentNode!=y){i=i.parentNode;}if(!C||!i){return;}var A=C;var z=[];var v=false;while(v==false){if(A==i){v=true;}z.push(A);A=A.nextSibling;}if(z.length<1){return;}var E=FCKDomTools.GetParents(y);for(var x=0;x<E.length;x++){if(E[x].nodeName.IEquals(["ul","ol"])){y=E[x];break;}}var u=this.Name.IEquals("indent")?1:-1;var r=z[0];var s=z[z.length-1];var B={};var D=FCKDomTools.ListToArray(y,B);var t=D[s._FCK_ListArray_Index].indent;for(var x=r._FCK_ListArray_Index;x<=s._FCK_ListArray_Index;x++){D[x].indent+=u;}for(var x=s._FCK_ListArray_Index+1;x<D.length&&D[x].indent>t;x++){D[x].indent+=u;}var F=FCKDomTools.ArrayToList(D);if(F){y.parentNode.replaceChild(F.listNode,y);}FCKDomTools.ClearAllMarkers(B);}};