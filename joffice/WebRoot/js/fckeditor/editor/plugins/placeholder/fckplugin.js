FCKCommands.RegisterCommand("Placeholder",new FCKDialogCommand("Placeholder",FCKLang.PlaceholderDlgTitle,FCKPlugins.Items["placeholder"].Path+"fck_placeholder.html",340,160));var oPlaceholderItem=new FCKToolbarButton("Placeholder",FCKLang.PlaceholderBtn);oPlaceholderItem.IconPath=FCKPlugins.Items["placeholder"].Path+"placeholder.gif";FCKToolbarItems.RegisterItem("Placeholder",oPlaceholderItem);var FCKPlaceholders=new Object();FCKPlaceholders.Add=function(d){var c=FCK.InsertElement("span");this.SetupSpan(c,d);};FCKPlaceholders.SetupSpan=function(c,d){c.innerHTML="[[ "+d+" ]]";c.style.backgroundColor="#ffff00";c.style.color="#000000";if(FCKBrowserInfo.IsGecko){c.style.cursor="default";}c._fckplaceholder=d;c.contentEditable=false;c.onresizestart=function(){FCK.EditorWindow.event.returnValue=false;return false;};};FCKPlaceholders._SetupClickListener=function(){FCKPlaceholders._ClickListener=function(b){if(b.target.tagName=="SPAN"&&b.target._fckplaceholder){FCKSelection.SelectNode(b.target);}};FCK.EditorDocument.addEventListener("click",FCKPlaceholders._ClickListener,true);};FCKPlaceholders.OnDoubleClick=function(b){if(b.tagName=="SPAN"&&b._fckplaceholder){FCKCommands.GetCommand("Placeholder").Execute();}};FCK.RegisterDoubleClickHandler(FCKPlaceholders.OnDoubleClick,"SPAN");FCKPlaceholders.Exist=function(d){var e=FCK.EditorDocument.getElementsByTagName("SPAN");for(var f=0;f<e.length;f++){if(e[f]._fckplaceholder==d){return true;}}return false;};if(FCKBrowserInfo.IsIE){FCKPlaceholders.Redraw=function(){if(FCK.EditMode!=FCK_EDITMODE_WYSIWYG){return;}var f=FCK.EditorDocument.body.innerText.match(/\[\[[^\[\]]+\]\]/g);if(!f){return;}var g=FCK.EditorDocument.body.createTextRange();for(var e=0;e<f.length;e++){if(g.findText(f[e])){var h=f[e].match(/\[\[\s*([^\]]*?)\s*\]\]/)[1];g.pasteHTML('<span style="color: #000000; background-color: #ffff00" contenteditable="false" _fckplaceholder="'+h+'">'+f[e]+"</span>");}}};}else{FCKPlaceholders.Redraw=function(){if(FCK.EditMode!=FCK_EDITMODE_WYSIWYG){return;}var m=FCK.EditorDocument.createTreeWalker(FCK.EditorDocument.body,NodeFilter.SHOW_TEXT,FCKPlaceholders._AcceptNode,true);var i=new Array();while((oNode=m.nextNode())){i[i.length]=oNode;}for(var j=0;j<i.length;j++){var n=i[j].nodeValue.split(/(\[\[[^\[\]]+\]\])/g);for(var h=0;h<n.length;h++){if(n[h].length>0){if(n[h].indexOf("[[")==0){var k=n[h].match(/\[\[\s*([^\]]*?)\s*\]\]/)[1];var l=FCK.EditorDocument.createElement("span");FCKPlaceholders.SetupSpan(l,k);i[j].parentNode.insertBefore(l,i[j]);}else{i[j].parentNode.insertBefore(FCK.EditorDocument.createTextNode(n[h]),i[j]);}}}i[j].parentNode.removeChild(i[j]);}FCKPlaceholders._SetupClickListener();};FCKPlaceholders._AcceptNode=function(b){if(/\[\[[^\[\]]+\]\]/.test(b.nodeValue)){return NodeFilter.FILTER_ACCEPT;}else{return NodeFilter.FILTER_SKIP;}};}FCK.Events.AttachEvent("OnAfterSetHTML",FCKPlaceholders.Redraw);FCKXHtml.TagProcessors["span"]=function(d,c){if(c._fckplaceholder){d=FCKXHtml.XML.createTextNode("[["+c._fckplaceholder+"]]");}else{FCKXHtml._AppendChildNodes(d,c,false);}return d;};