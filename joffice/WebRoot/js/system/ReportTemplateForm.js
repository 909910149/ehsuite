var ReportTemplateForm=function(e,h){this.reportId=e;this.isDefaultIn=h;var f=this.setup();var g=new Ext.Window({id:"ReportTemplateFormWin",title:"报表详细信息",width:600,autoHeight:true,modal:true,layout:"anchor",plain:true,bodyStyle:"padding:5px;",buttonAlign:"center",items:[this.setup()],buttons:[{text:"保存",iconCls:"btn-save",disabled:this.isDefaultIn==1?true:false,handler:function(){var b=Ext.getCmp("ReportTemplateForm");if(b.getForm().isValid()){var a=b.getForm().findField("reportKey").getValue();if(a==null||a==""||a=="undefined"||(e!=null&&e!="undefined")){b.getForm().submit({method:"post",waitMsg:"正在提交数据...",success:function(d,c){Ext.ux.Toast.msg("操作信息","成功保存信息！");Ext.getCmp("ReportTemplateGrid").getStore().reload();g.close();},failure:function(d,c){Ext.MessageBox.show({title:"操作信息",msg:"信息保存出错，请联系管理员！",buttons:Ext.MessageBox.OK,icon:"ext-mb-error"});g.close();}});}else{Ext.Ajax.request({url:__ctxPath+"/system/checkKeyReportTemplate.do",method:"POST",success:function(l,d){var c=Ext.decode(l.responseText);var k=c.totalCounts*1;if(k<1){b.getForm().submit({method:"post",waitMsg:"正在提交数据...",success:function(j,i){Ext.ux.Toast.msg("操作信息","成功保存信息！");Ext.getCmp("ReportTemplateGrid").getStore().reload();g.close();},failure:function(j,i){Ext.MessageBox.show({title:"操作信息",msg:"信息保存出错，请联系管理员！",buttons:Ext.MessageBox.OK,icon:"ext-mb-error"});g.close();}});}else{Ext.ux.Toast.msg("操作信息","该报表Key已存在,不能重复保存!");return;}},failure:function(d,c){},params:{Q_reportKey_S_EQ:b.getForm().findField("reportKey").getValue()}});}}}},{text:"取消",iconCls:"btn-cancel",handler:function(){g.close();}}]});g.show();};ReportTemplateForm.prototype.setup=function(){function f(b){var a;for(var c=0;c<b.length;c++){a=b[c].filePath;Ext.getCmp("reportLocation").setValue(a);}}var e=new Ext.FormPanel({url:__ctxPath+"/system/saveReportTemplate.do",layout:"form",id:"ReportTemplateForm",frame:true,defaults:{widht:400,anchor:"100%,100%"},formId:"ReportTemplateFormId",defaultType:"textfield",items:[{name:"reportTemplate.reportId",id:"reportId",xtype:"hidden",value:this.reportId==null?"":this.reportId},{name:"reportTemplate.createtime",id:"createtime",xtype:"hidden"},{fieldLabel:"报表标题",readOnly:this.isDefaultIn==1?true:false,name:"reportTemplate.title",id:"title",allowBlank:false,blankText:"报表标题不能为空"},{fieldLabel:"报表描述",readOnly:this.isDefaultIn==1?true:false,name:"reportTemplate.descp",id:"descp",xtype:"htmleditor",height:200,allowBlank:false,blankText:"报表描述不能为空"},{xtype:"container",height:26,layout:"column",defaultType:"textfield",items:[{xtype:"label",style:"padding-left:0px;margin-left:0px;margin-bottom:2px;",text:"报表模块路径:",width:103},{columnWidth:0.8,name:"reportTemplate.reportLocation",id:"reportLocation",readOnly:this.isDefaultIn==1?true:false,allowBlank:false,blankText:"报表模块jasper文件路径不能为空"},{xtype:"button",text:"上传附件",columnWidth:0.2,disabled:this.isDefaultIn==1?true:false,handler:function(){var a=App.createUploadDialog({permitted_extensions:["zip","jasper"],url:__ctxPath+"/jasper-upload",file_cat:"report",callback:f});a.show("queryBtn");}}]},{fieldLabel:"报表Key",readOnly:this.isDefaultIn==1?true:false,name:"reportTemplate.reportKey",id:"reportKey",allowBlank:true},{fieldLabel:"是否缺省",readOnly:this.isDefaultIn==1?true:false,hiddenName:"reportTemplate.isDefaultIn",id:"isDefaultIn",allowBlank:false,blankText:"是否缺省不能为空",xtype:"combo",value:0,store:new Ext.data.ArrayStore({fields:["i","n"],data:[[0,"否"],[1,"是"]]}),displayField:"n",valueField:"i",typeAhead:true,mode:"local",triggerAction:"all",forceSelection:true}]});var d=this.reportId;e.on("afterrender",function(a){if(d!=null&&d!="undefined"){a.getForm().load({deferredRender:false,url:__ctxPath+"/system/getReportTemplate.do?reportId="+d,waitMsg:"正在载入数据...",success:function(c,b){},failure:function(c,b){Ext.ux.Toast.msg("编辑","载入失败");}});a.getForm().findField("reportKey").readOnly=true;}});return e;};