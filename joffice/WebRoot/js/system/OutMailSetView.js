OutMailSetView=Ext.extend(Ext.Panel,{constructor:function(b){Ext.applyIf(this,b);this.initUIComponents();OutMailSetView.superclass.constructor.call(this,{id:"OutMailSetView",title:"外部邮箱配置",iconCls:"menu-mail_send",region:"center",layout:"border",items:[this.searchPanel,this.gridPanel]});},initUIComponents:function(){this.searchPanel=new Ext.FormPanel({id:"OutMailSetSearchForm",region:"north",height:40,frame:false,border:false,layout:"hbox",layoutConfig:{padding:"5",align:"middle"},defaults:{xtype:"label",margins:{top:0,right:4,bottom:4,left:4}},keys:{key:Ext.EventObject.ENTER,fn:this.search.createCallback(this),scope:this},items:[{text:"查询条件:"},{text:"用户名称"},{anchor:"40%",xtype:"textfield",name:"userName"},{xtype:"button",text:"查询",iconCls:"search",handler:this.search.createCallback(this)},{xtype:"button",text:"清空",iconCls:"reset",handler:this.clear,scope:this}]});this.store=new Ext.data.JsonStore({url:__ctxPath+"/system/listOutMailSet.do",totalProperty:"totalCounts",root:"result",baseParams:{start:0,limit:25},remoteSort:true,fields:[{name:"id",type:"int"},{name:"reuserId",mapping:"userId",type:"int"},"userName","mailAddress","mailPass","smtpHost","smtpPort","popHost","popPort"]});this.store.setDefaultSort("id","desc");this.store.load({params:{start:0,limit:25}});var c=new Ext.grid.CheckboxSelectionModel();var d=new Ext.grid.ColumnModel({columns:[c,new Ext.grid.RowNumberer(),{header:"id",dataIndex:"id",hidden:true},{header:"userId",dataIndex:"reuserId",hidden:true},{header:"用户名称",dataIndex:"userName"},{header:"外部邮件地址",dataIndex:"mailAddress",vtype:"email",editor:new Ext.form.TextField({allowBlank:false,vtype:"email"})},{header:"密码",dataIndex:"mailPass",renderer:function(b){var g=b.length;var a="";for(var h=0;h<g;h++){a+="*";}return a;},editor:new Ext.form.TextField({allowBlank:false,inputType:"password"})},{header:"smtp主机",dataIndex:"smtpHost",editor:new Ext.form.TextField({allowBlank:false})},{header:"smtp端口",dataIndex:"smtpPort",vtype:"alphanum",editor:new Ext.form.NumberField({allowBlank:false,vtype:"alphanum",blankText:"端口必须是填写数字"})},{header:"pop主机",dataIndex:"popHost",editor:new Ext.form.TextField({allowBlank:false})},{header:"pop端口",dataIndex:"popPort",vtype:"alphanum",blankText:"端口必须是填写数字",editor:new Ext.form.NumberField({allowBlank:false,vtype:"alphanum",blankText:"端口必须是填写数字"})}],defaults:{sortable:true,menuDisabled:true,width:100}});this.topbar=new Ext.Toolbar({height:30,bodyStyle:"text-align:left",items:[]});if(isGranted("_OutMailSetAdd")){this.topbar.add(new Ext.Button({text:"保存外部邮箱配置",iconCls:"btn-save",handler:this.saveRecord,scope:this}));}this.gridPanel=new Ext.grid.EditorGridPanel({id:"OutMailSetGrid",tbar:this.topbar,clicksToEdit:1,region:"center",stripeRows:true,prunemodifiedrecords:true,store:this.store,trackMouseOver:true,disableSelection:false,loadMask:true,cm:d,sm:c,viewConfig:{forceFit:true,autoFill:true,forceFit:true},bbar:new Ext.PagingToolbar({pageSize:25,store:this.store,displayInfo:true,displayMsg:"当前页记录索引{0}-{1}， 共{2}条记录",emptyMsg:"当前没有记录"})});},search:function(m){var h=Ext.getCmp("OutMailSetSearchForm");if(h.getForm().isValid()){var k=Ext.getCmp("OutMailSetGrid");var g=k.getStore();var j=Ext.Ajax.serializeForm(h.getForm().getEl());var l=Ext.urlDecode(j);l.start=0;l.limit=g.baseParams.limit;g.baseParams=l;k.getBottomToolbar().moveFirst();}},clear:function(){Ext.getCmp("OutMailSetSearchForm").getForm().reset();},saveRecord:function(){var g=[];var h=Ext.getCmp("OutMailSetGrid");var e=h.getStore();for(i=0,cnt=e.getCount();i<cnt;i+=1){var f=e.getAt(i);if(f.data.id==""||f.data.id==null){f.set("id",-1);}if(f.dirty){g.push(f.data);}}if(g.length==0){Ext.ux.Toast.msg("信息","没有对数据进行任何更改");return;}Ext.Ajax.request({method:"post",url:__ctxPath+"/system/saveOutMailSet.do",success:function(a){Ext.ux.Toast.msg("操作信息","成功设置外部邮箱！");e.reload();h.getView().refresh();},failure:function(a){Ext.MessageBox.show({title:"操作信息",msg:"信息保存出错，请联系管理员！",buttons:Ext.MessageBox.OK,icon:"ext-mb-error"});},params:{data:Ext.encode(g)}});}});