var AppUserForm=function(f,h,g,e){return this.setup(f,h,g,e);};AppUserForm.prototype.setup=function(r,y,w,v){var A=this.initDepSelectPanel(y);var t=A.findByType("editorgrid")[0];var u=this.initJopSelectPanel(y);var C=u.findByType("editorgrid")[0];var z=this.initRoleSelectPanel(y);var E=z.findByType("editorgrid")[0];var B=this.initFooterToolbar(y,t,C,E);var x=__ctxPath+"/system/listDepartment.do?opt=appUser";var s=new TreeSelector("depTreeSelector",x,null,"appUser.depId",false);var F=__ctxPath+"/hrm/treeLoadJob.do";var G=new TreeSelector("jobTreeSelector",F,null,"appUser.jobId",false);var D=new Ext.form.FormPanel({reader:new Ext.data.JsonReader({root:"data"},[{name:"appUser.userId",mapping:"userId"},{name:"appUser.jobId",mapping:"jobId"},{name:"appUser.jobName",mapping:"jobName"},{name:"appUser.username",mapping:"username"},{name:"appUser.password",mapping:"password"},{name:"appUser.fullname",mapping:"fullname"},{name:"appUser.email",mapping:"email"},{name:"appUser.depName",mapping:"department.depName"},{name:"appUser.accessionTime",mapping:"accessionTime"},{name:"appUserStatus",mapping:"status"},{name:"appUserTitle",mapping:"title"},{name:"appUser.phone",mapping:"phone"},{name:"appUser.mobile",mapping:"mobile"},{name:"appUser.fax",mapping:"fax"},{name:"appUser.address",mapping:"address"},{name:"appUser.zip",mapping:"zip"},{name:"appUser.photo",mapping:"photo"},{name:"appUser.dynamicPwd",mapping:"dynamicpwd"},{name:"appUser.dyPwdStatus",mapping:"dyPwdStatus"}]),id:"AppUserForm",title:r,iconCls:"menu-customer",border:false,autoScroll:true,bodyStyle:"background-color: transparent;",labelAlign:"right",tbar:B,defaults:{anchor:"98%,100%",xtype:"panel"},url:__ctxPath+"/system/saveAppUser.do",layout:"form",items:[{xtype:"fieldset",title:"基本信息",collapsible:true,autoHeight:true,defaults:{anchor:"100%,100%"},items:{xtype:"panel",border:false,layout:"hbox",layoutConfig:{padding:"5",align:"middle"},defaults:{style:"padding:0px 5px 0px 5px;",anchor:"98%,98%",height:250,width:"38%"},items:[{id:"displayUserPhoto",xtype:"panel",bodyStyle:"MARGIN-RIGHT: auto; MARGIN-LEFT: auto;",title:"个人照片",width:"20%",html:'<div style="MARGIN-RIGHT: auto; MARGIN-LEFT: auto;"><img src="'+__ctxPath+'/images/default_image_male.jpg" style=""/></div>',tbar:new Ext.Toolbar({height:30,items:[{text:"上传",iconCls:"btn-upload",handler:function(){AppUserForm.uploadPhotoBtn(y);}},{text:"删除",iconCls:"btn-delete",handler:function(){AppUserForm.deletePhotoBtn(y);}}]})},{id:"AppUserMustInfo",xtype:"panel",title:"必填信息",labelWidth:55,defaults:{anchor:"98%,98%"},bodyStyle:"padding:5px;",layout:"form",defaultType:"textfield",labelAlign:"right",hideLabels:false,items:[{xtype:"hidden",fieldLabel:"账号ID",name:"appUser.userId",id:"appUser.userId"},{fieldLabel:"登录账号",name:"appUser.username",id:"appUser.username",allowBlank:false,blankText:"登录账号不能为空!"},{fieldLabel:"登录密码",name:"appUser.password",id:"appUser.password",inputType:"password",allowBlank:false,blankText:"登录密码不能为空!"},{fieldLabel:"账号姓名",name:"appUser.fullname",id:"appUser.fullname",allowBlank:false,blankText:"账号姓名不能为空!"},{fieldLabel:"E-mail",name:"appUser.email",id:"appUser.email",vtype:"email",allowBlank:false,blankText:"邮箱不能为空!",vtypeText:"邮箱格式不正确!"},{layout:"hbox",hideLabel:true,xtype:"compositefield",width:300,items:[{xtype:"label",text:"主部门:",style:"padding:0px 0px 0px 15px;",width:55},s,{xtype:"button",text:"更多部门",handler:function(d,a){var b=Ext.getCmp("AppUserForm");var c=b.findByType("fieldset");for(i=0;i<c.length;i++){if(c[i].getId()!="depFieldset"){c[i].collapse();}}Ext.getCmp("depFieldset").expand();}}]},{layout:"hbox",hideLabel:true,xtype:"compositefield",width:300,items:[{xtype:"label",text:"主职位:",style:"padding:0px 0px 0px 15px;",width:55},G,{xtype:"button",text:"更多职位",handler:function(d,a){var b=Ext.getCmp("AppUserForm");var c=b.findByType("fieldset");for(i=0;i<c.length;i++){if(c[i].getId()!="jobFieldset"){c[i].collapse();}}Ext.getCmp("jobFieldset").expand();}}]},{fieldLabel:"入职时间",xtype:"datefield",format:"Y-m-d",name:"appUser.accessionTime",id:"appUser.accessionTime",allowBlank:false,blankText:"入职时间不能为空!",length:50},{fieldLabel:"状态",id:"appUserStatus",hiddenName:"appUser.status",xtype:"combo",mode:"local",editable:false,triggerAction:"all",store:[["1","激活"],["0","禁用"]],value:1},{xtype:"hidden",name:"appUser.department.depId",id:"appUser.depId"},{xtype:"hidden",name:"appUser.jobId",id:"appUser.jobId"}]},{xtype:"panel",title:"选填信息",layout:"form",defaultType:"textfield",labelWidth:55,defaults:{anchor:"98%,98%"},hideLabel:false,labelAlign:"right",items:[{fieldLabel:"性别",xtype:"combo",hiddenName:"appUser.title",id:"appUserTitle",mode:"local",editable:false,triggerAction:"all",store:[["1","先生"],["0","女士"]],value:"1",listeners:{select:function(a,e,c){var d=Ext.getCmp("appUser.photo");if(d.value==""||d.value=="undefined"||d.value==null){var b=Ext.getCmp("displayUserPhoto");if(a.value=="0"){b.body.update('<img src="'+__ctxPath+'/images/default_image_female.jpg"/>');}else{b.body.update('<img src="'+__ctxPath+'/images/default_image_male.jpg"/>');}}}}},{fieldLabel:"家庭电话",name:"appUser.phone",id:"appUser.phone"},{fieldLabel:"移动电话",xtype:"numberfield",name:"appUser.mobile",id:"appUser.mobile"},{fieldLabel:"传真",name:"appUser.fax",id:"appUser.fax"},{fieldLabel:"家庭住址",name:"appUser.address",id:"appUser.address"},{fieldLabel:"邮编",xtype:"numberfield",name:"appUser.zip",id:"appUser.zip"},{filedLabel:"照片",xtype:"hidden",id:"appUser.photo",name:"appUser.photo"}]}]}},{xtype:"fieldset",id:"rolesFieldset",columnWidth:0.5,title:"角色信息",collapsed:true,collapsible:true,autoHeight:true,defaults:{anchor:"100%,100%"},items:z},{xtype:"fieldset",id:"depFieldset",columnWidth:0.5,title:"部门信息",collapsed:true,collapsible:true,autoHeight:true,defaults:{anchor:"100%,100%"},items:A},{xtype:"fieldset",id:"jobFieldset",columnWidth:0.5,title:"职位信息",collapsed:true,collapsible:true,autoHeight:true,defaults:{anchor:"100%,100%"},items:u}]});if(w){Ext.getCmp("appUser.depId").setValue(w);Ext.getCmp("depTreeSelector").setValue(v);}return D;};AppUserForm.prototype.initFooterToolbar=function(f,j,h,g){var k=new Ext.Toolbar({id:"AppUserFormToolbar",height:30,items:[{text:"保存",iconCls:"btn-save",handler:function(){var C=Ext.getCmp("AppUserForm");if(C.getForm().isValid()){var G=j.getStore();var z=[];var e=G.getCount();var D=C.getForm().findField("appUser.depId").getValue();var K=true;for(i=0;i<e;i++){var B=G.getAt(i);if((B.data.department.depId*1)==(D*1)){K=false;B.data.ismain=1;}z.push(B.data);}if(K==true){var b={};Ext.apply(b,{depId:C.getForm().findField("appUser.depId").getValue()});var d=new G.recordType();d.data={};d.data.ismain=1;d.data.sn=0;Ext.apply(d.data,{department:b});z.push(d.data);}var F=h.getStore();var a=[];var c=F.getCount();var y=C.getForm().findField("appUser.jobId").getValue();var J=true;for(i=0;i<c;i++){var B=F.getAt(i);if((B.data.job.jobId*1)==(y*1)){J=false;B.data.isMain=1;}a.push(B.data);}if(J==true){var A={};Ext.apply(A,{jobId:C.getForm().findField("appUser.jobId").getValue()});var d=new F.recordType();d.data={};d.data.isMain=1;Ext.apply(d.data,{job:A});a.push(d.data);}var I=g.getStore();var E=[];var H=I.getCount();for(i=0;i<H;i++){var B=I.getAt(i);E.push(B.data);}C.getForm().submit({waitMsg:"正在提交用户信息",params:{depParams:Ext.encode(z),jobParams:Ext.encode(a),roleParams:Ext.encode(E)},success:function(n,l){Ext.ux.Toast.msg("操作信息","保存成功！");var m=Ext.getCmp("AppUserGrid");if(m!=null){m.getStore().reload({start:0,limit:25});}AppUtil.removeTab("AppUserForm");},failure:function(m,l){Ext.ux.Toast.msg("错误信息",l.result.msg);Ext.getCmp("appUser.username").setValue("");}});}}},{text:"取消",iconCls:"reset",handler:function(){var a=Ext.getCmp("centerTabPanel");a.remove("AppUserForm");}},{text:"修改密码",id:"resetPassword",iconCls:"btn-password",hidden:true,handler:function(){new ResetPasswordForm(f);}},{text:"令牌设置",iconCls:"btn-dynamic-pwd",hidden:sysConfigInfo.dynamicPwd=="2"?true:false,handler:function(){new DynamicPwdForm({userId:f}).show();}}]});return k;};AppUserForm.uploadPhotoBtn=function(h){var f=Ext.getCmp("appUser.photo");var e=App.createUploadDialog({file_cat:"system/appUser",callback:uploadUserPhoto,permitted_extensions:["jpg"]});if(f.value!=""&&f.value!=null&&f.value!="undefined"){var g="再次上传需要先删除原有图片,";Ext.Msg.confirm("信息确认",g+"是否删除？",function(a){if(a=="yes"){Ext.Ajax.request({url:__ctxPath+"/system/deleteFileAttach.do",method:"post",params:{filePath:f.value},success:function(){if(h!=""&&h!=null&&h!="undefined"){Ext.Ajax.request({url:__ctxPath+"/system/photoAppUser.do",method:"post",params:{userId:h},success:function(){f.setValue("");var k=Ext.getCmp("appUserTitle");var d=Ext.getCmp("displayUserPhoto");if(k.value==1){d.body.update('<img src="'+__ctxPath+'/images/default_image_male.jpg"  width="100%" height="100%"/>');}else{d.body.update('<img src="'+__ctxPath+'/images/default_image_female.jpg"  width="100%" height="100%"/>');}e.show("queryBtn");}});}else{f.setValue("");var c=Ext.getCmp("appUserTitle");var b=Ext.getCmp("displayUserPhoto");if(c.value==1){b.body.update('<img src="'+__ctxPath+'/images/default_image_male.jpg"  width="100%" height="100%"/>');}else{b.body.update('<img src="'+__ctxPath+'/images/default_image_female.jpg"  width="100%" height="100%"/>');}e.show("queryBtn");}}});}});}else{e.show("queryBtn");}};AppUserForm.deletePhotoBtn=function(c){var d=Ext.getCmp("appUser.photo");if(d.value!=null&&d.value!=""&&d.value!="undefined"){Ext.Msg.confirm("确认信息","照片一旦删除将不可恢复, 是否删除?",function(a){if(a=="yes"){Ext.Ajax.request({url:__ctxPath+"/system/deleteFileAttach.do",method:"post",params:{filePath:d.value},success:function(){if(c!=""&&c!=null&&c!="undefined"){Ext.Ajax.request({url:__ctxPath+"/system/photoAppUser.do",method:"post",params:{userId:c},success:function(){d.setValue("");var h=Ext.getCmp("appUserTitle");var e=Ext.getCmp("displayUserPhoto");if(h.value==1){e.body.update('<img src="'+__ctxPath+'/images/default_image_male.jpg"  width="100%" height="100%"/>');}else{e.body.update('<img src="'+__ctxPath+'/images/default_image_female.jpg"  width="100%" height="100%"/>');}}});}else{d.setValue("");var f=Ext.getCmp("appUserTitle");var b=Ext.getCmp("displayUserPhoto");if(f.value==1){b.body.update('<img src="'+__ctxPath+'/images/default_image_male.jpg"  width="100%" height="100%"/>');}else{b.body.update('<img src="'+__ctxPath+'/images/default_image_female.jpg"  width="100%" height="100%"/>');}}}});}});}else{Ext.ux.Toast.msg("提示信息","您还未增加照片.");}};function uploadUserPhoto(d){var e=Ext.getCmp("appUser.photo");var f=Ext.getCmp("displayUserPhoto");e.setValue(d[0].filePath);f.body.update('<img src="'+__ctxPath+"/attachFiles/"+d[0].filePath+'"  width="100%" height="100%"/>');}AppUserForm.prototype.initDepSelectPanel=function(A){Ext.QuickTips.init();var E=null;var y=__ctxPath+"/system/listDepartment.do";var x=new Ext.tree.TreePanel({height:220,flex:7,useArrows:false,autoScroll:true,animate:false,enableDD:false,containerScroll:true,border:true,dataUrl:y,rootVisible:false,root:{nodeType:"async",text:"Ext JS",draggable:false,id:"source"},listeners:{"click":function(a){E=a;},"beforeload":function(a){a.attributes.qtip="双击添加";a.attributes.description="双击添加";}}});var D=function(a){Ext.Ajax.request({url:__ctxPath+"/system/multiDelDepUsers.do",params:{ids:a},method:"POST",success:function(c,b){Ext.ux.Toast.msg("操作信息","成功删除该明细！");},failure:function(c,b){Ext.ux.Toast.msg("操作信息","操作出错，请联系管理员！");}});};var t=function(){if(E==null){Ext.ux.Toast.msg("信息","请选择要添加的部门！");return;}var d=false;for(i=0;i<F.getCount();i++){var a=F.getAt(i);if(a.data.department.depId==E.id){d=true;}}if(d==true){Ext.ux.Toast.msg("信息","部门重复，请选择其它部门！");return;}var c={};Ext.apply(c,{depId:E.id,depName:E.text});var b=new F.recordType();b.data={};b.data.ismain=0;b.data.sn=0;Ext.apply(b.data,{department:c});F.insert(0,b);F.commitChanges();E=null;};var v=function(){var a=w.getSelectionModel().getSelections();if(a.length==0){Ext.ux.Toast.msg("信息","请选择要删除的记录！");return;}if(a[0].data.depUserId!=null&&a[0].data.depUserId!=""){D(a[0].data.depUserId);}F.remove(a[0]);F.commitChanges();};var H=new Ext.Panel({frame:false,border:false,hideBorders:true,height:220,flex:0.4,layout:{type:"vbox",pack:"center",align:"stretch"},defaults:{anchor:"100%,100%"},defaults:{margins:"0 3 0 0"},items:[{xtype:"button",iconCls:"btn-right",scope:this,handler:t},{xtype:"button",iconCls:"btn-left",scope:this,handler:v}]});var C=function(){var b=Array();for(i=0;i<F.getCount();i++){var a=F.getAt(i);if(a.data.depUserId!=null&&a.data.depUserId!=""){b.push(a.data.depUserId);}}if(b.length>0){D(b);}F.removeAll();F.commitChanges();};var B=new Ext.Toolbar({items:[{text:"清除所选",scope:this,handler:C}]});var z=Ext.data.Record.create([{name:"depUserId",type:"int"},"department","appUser","isMain","sn"]);var u=new Ext.data.HttpProxy({url:__ctxPath+"/system/listDepUsers.do"});var s=new Ext.data.JsonReader({root:"result",totalProperty:"totalCounts",idProperty:"depUserId"},z);var F=new Ext.data.Store({id:"AppUserForm.depStore",proxy:u,reader:s});F.on("beforeload",function(a){a.baseParams={start:0,limit:10000,"Q_appUser.userId_L_EQ":A};});F.setDefaultSort("sn");if(A!=""&&A!=null&&A!="undefined"){F.load();}var G=new Ext.grid.CheckboxSelectionModel({singleSelect:true});var w=new Ext.grid.EditorGridPanel({frame:false,border:true,flex:6,height:220,tbar:B,store:F,clicksToEdit:1,sm:G,viewConfig:{forceFit:true,autoFill:true},columns:[{header:"depUserId",dataIndex:"depUserId",sortable:true,hidden:true},{header:"部门",sortable:true,dataIndex:"department",renderer:function(a){if(a){return'<font qtip="双击删除">'+a.depName+"</font>";}}},{header:"是否主部门",sortable:true,width:55,dataIndex:"ismain",editable:true,renderer:function(a){return a==1?"是":"否";}}]});Ext.QuickTips.init();w.on("dblclick",function(a){var b=w.getSelectionModel().getSelections();if(b.length==0){Ext.ux.Toast.msg("信息","请选择要删除的记录！");return;}if(b[0].data.depUserId!=null&&b[0].data.depUserId!=""){D(b[0].data.depUserId);}F.remove(b[0]);F.commitChanges();},this);x.on("dblclick",function(c){if(c==null){Ext.ux.Toast.msg("信息","请选择要添加的部门！");return;}var e=false;for(i=0;i<F.getCount();i++){var a=F.getAt(i);if(a.data.department.depId==c.id){e=true;}}if(e==true){Ext.ux.Toast.msg("信息","部门重复，请选择其它部门！");return;}var d={};Ext.apply(d,{depId:c.id,depName:c.text});var b=new F.recordType();b.data={};b.data.ismain=0;b.data.sn=0;Ext.apply(b.data,{department:d});F.insert(0,b);F.commitChanges();c=null;},this);var I=new Ext.Panel({xtype:"panel",height:220,border:false,layout:{type:"hbox",align:"stretch"},height:220,items:[x,H,w]});return I;};AppUserForm.prototype.initJopSelectPanel=function(B){Ext.QuickTips.init();var F=null;var z=__ctxPath+"/hrm/treeLoadJob.do";var w=new Ext.tree.TreePanel({height:220,flex:7,useArrows:false,autoScroll:true,animate:false,enableDD:false,containerScroll:true,border:true,dataUrl:z,rootVisible:false,root:{nodeType:"async",text:"Ext JS",draggable:false},listeners:{"click":function(a){F=a;},"beforeload":function(a){a.attributes.qtip="双击添加";a.attributes.description="双击添加";}}});var E=function(a){Ext.Ajax.request({url:__ctxPath+"/system/multiDelUserJob.do",params:{ids:a},method:"POST",success:function(c,b){Ext.ux.Toast.msg("操作信息","成功删除该明细！");},failure:function(c,b){Ext.ux.Toast.msg("操作信息","操作出错，请联系管理员！");}});};var t=function(){if(F==null){Ext.ux.Toast.msg("信息","请选择要添加的部门！");return;}var d=false;for(i=0;i<y.getCount();i++){var b=y.getAt(i);if(b.data.job.jobId==F.id){d=true;}}if(d==true){Ext.ux.Toast.msg("信息","部门重复，请选择其它部门！");return;}var a={};Ext.apply(a,{jobId:F.id,jobName:F.text});var c=new y.recordType();c.data={};c.data.ismain=0;Ext.apply(c.data,{job:a});y.insert(0,c);y.commitChanges();F=null;};var x=function(){var a=v.getSelectionModel().getSelections();if(a.length==0){Ext.ux.Toast.msg("信息","请选择要删除的记录！");return;}if(a[0].data.userJobId!=null&&a[0].data.userJobId!=""){E(a[0].data.userJobId);}y.remove(a[0]);y.commitChanges();};var H=new Ext.Panel({frame:false,border:false,hideBorders:true,height:220,flex:0.4,layout:{type:"vbox",pack:"center",align:"stretch"},defaults:{anchor:"100%,100%"},defaults:{margins:"0 3 0 0"},items:[{xtype:"button",iconCls:"btn-right",scope:this,handler:t},{xtype:"button",iconCls:"btn-left",scope:this,handler:x}]});var D=function(){var b=Array();for(i=0;i<y.getCount();i++){var a=y.getAt(i);if(a.data.userJobId!=null&&a.data.userJobId!=""){b.push(a.data.userJobId);}}if(b.length>0){E(b);}y.removeAll();y.commitChanges();};var C=new Ext.Toolbar({items:[{text:"清除所选",scope:this,handler:D}]});var A=Ext.data.Record.create([{name:"userJobId",type:"int"},"isMain","job","appUser"]);var u=new Ext.data.HttpProxy({url:__ctxPath+"/system/listUserJob.do"});var s=new Ext.data.JsonReader({root:"result",totalProperty:"totalCounts",idProperty:"userJobId"},A);var y=new Ext.data.Store({id:"AppUserForm.JopStore",proxy:u,reader:s});y.on("beforeload",function(a){a.baseParams={start:0,limit:10000,"Q_appUser.userId_L_EQ":B};});y.setDefaultSort("userJobId");if(B!=""&&B!=null&&B!="undefined"){y.load();}var G=new Ext.grid.CheckboxSelectionModel({singleSelect:true});var v=new Ext.grid.EditorGridPanel({frame:false,border:true,flex:6,height:220,tbar:C,store:y,clicksToEdit:1,sm:G,viewConfig:{forceFit:true,autoFill:true},columns:[{header:"userJobId",dataIndex:"userJobId",sortable:true,hidden:true},{header:"职位",sortable:true,dataIndex:"job",renderer:function(a){if(a){return'<font qtip="双击删除">'+a.jobName+"</font>";}}},{header:"是否主职位",sortable:true,width:55,dataIndex:"isMain",editable:true,renderer:function(a){return a==1?"是":"否";}}]});Ext.QuickTips.init();v.on("dblclick",function(a){var b=v.getSelectionModel().getSelections();if(b.length==0){Ext.ux.Toast.msg("信息","请选择要删除的记录！");return;}if(b[0].data.userJobId!=null&&b[0].data.userJobId!=""){E(b[0].data.userJobId);}y.remove(b[0]);y.commitChanges();},this);w.on("dblclick",function(d){if(d==null){Ext.ux.Toast.msg("信息","请选择要添加的部门！");return;}var e=false;for(i=0;i<y.getCount();i++){var b=y.getAt(i);if(b.data.job.jobId==d.id){e=true;}}if(e==true){Ext.ux.Toast.msg("信息","部门重复，请选择其它部门！");return;}var a={};Ext.apply(a,{jobId:d.id,jobName:d.text});var c=new y.recordType();c.data={};c.data.ismain=0;Ext.apply(c.data,{job:a});y.insert(0,c);y.commitChanges();d=null;},this);var I=new Ext.Panel({xtype:"panel",height:220,border:false,layout:{type:"hbox",align:"stretch"},height:220,items:[w,H,v]});return I;};AppUserForm.prototype.initRoleSelectPanel=function(y){Ext.QuickTips.init();var C=null;var H=__ctxPath+"/system/chooseRolesAppUser.do";var G=new Ext.tree.TreePanel({height:220,flex:7,useArrows:false,autoScroll:true,animate:false,enableDD:false,containerScroll:true,border:true,dataUrl:H,rootVisible:false,root:{nodeType:"async",text:"Ext JS",draggable:false},listeners:{"click":function(a){C=a;},"beforeload":function(a){a.attributes.qtip="双击添加";a.attributes.description="双击添加";}}});var B=function(a){Ext.Ajax.request({url:__ctxPath+"/system/multiDelRoleAppUser.do",params:{ids:a,userId:y},method:"POST",success:function(c,b){Ext.ux.Toast.msg("操作信息","成功删除该明细！");},failure:function(c,b){Ext.ux.Toast.msg("操作信息","操作出错，请联系管理员！");}});};var t=function(){if(C==null){Ext.ux.Toast.msg("信息","请选择要添加的角色！");return;}var c=false;for(i=0;i<x.getCount();i++){var a=x.getAt(i);if(a.data.role.roleId==C.id){c=true;}}if(c==true){Ext.ux.Toast.msg("信息","部门重复，请选择其它部门！");return;}var b=new x.recordType();b.data={};b.data.ismain=0;Ext.apply(b.data,{roleId:C.id,roleName:C.text});x.insert(0,b);x.commitChanges();C=null;};var v=function(){var a=F.getSelectionModel().getSelections();if(a.length==0){Ext.ux.Toast.msg("信息","请选择要删除的记录！");return;}if(a[0].data.roleId!=null&&a[0].data.roleId!=""){B(a[0].data.roleId);}x.remove(a[0]);x.commitChanges();};var E=new Ext.Panel({frame:false,border:false,hideBorders:true,height:220,flex:0.4,layout:{type:"vbox",pack:"center",align:"stretch"},defaults:{anchor:"100%,100%"},defaults:{margins:"0 3 0 0"},items:[{xtype:"button",iconCls:"btn-right",scope:this,handler:t},{xtype:"button",iconCls:"btn-left",scope:this,handler:v}]});var A=function(){var b=Array();for(i=0;i<x.getCount();i++){var a=x.getAt(i);if(a.data.roleId!=null&&a.data.roleId!=""){b.push(a.data.roleId);}}if(b.length>0){B(b);}x.removeAll();x.commitChanges();};var z=new Ext.Toolbar({items:[{text:"清除所选",scope:this,handler:A}]});var w=Ext.data.Record.create([{name:"roleId",type:"int"},"roleName","appUser"]);var u=new Ext.data.HttpProxy({url:__ctxPath+"/system/selectedRolesAppUser.do"});var s=new Ext.data.JsonReader({root:"result",totalProperty:"totalCounts",idProperty:"roleId"},w);var x=new Ext.data.Store({id:"AppUserForm.RoleStore",proxy:u,reader:s});x.on("beforeload",function(a){a.baseParams={start:0,limit:10000,userId:y};});x.setDefaultSort("roleId");if(y!=""&&y!=null&&y!="undefined"){x.load();}var D=new Ext.grid.CheckboxSelectionModel({singleSelect:true});var F=new Ext.grid.EditorGridPanel({frame:false,border:true,flex:6,height:220,tbar:z,store:x,clicksToEdit:1,sm:D,viewConfig:{forceFit:true,autoFill:true},columns:[{header:"roleId",dataIndex:"roleId",sortable:true,hidden:true},{header:"角色",sortable:true,dataIndex:"roleName"}]});Ext.QuickTips.init();F.on("dblclick",function(a){var b=F.getSelectionModel().getSelections();if(b.length==0){Ext.ux.Toast.msg("信息","请选择要删除的记录！");return;}if(b[0].data.roleId!=null&&b[0].data.roleId!=""){B(b[0].data.roleId);}x.remove(b[0]);x.commitChanges();},this);G.on("dblclick",function(c){if(c==null){Ext.ux.Toast.msg("信息","请选择要添加的部门！");return;}var d=false;for(i=0;i<x.getCount();i++){var a=x.getAt(i);if(a.data.roleId==c.id){d=true;}}if(d==true){Ext.ux.Toast.msg("信息","角色重复，请选择其它角色！");return;}var b=new x.recordType();b.data={};Ext.apply(b.data,{roleId:c.id,roleName:c.text});x.insert(0,b);x.commitChanges();c=null;},this);var I=new Ext.Panel({xtype:"panel",height:220,border:false,layout:{type:"hbox",align:"stretch"},height:220,items:[G,E,F]});return I;};