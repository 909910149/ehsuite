var ReportTemplatePreview=function(j,h){searchButton=new Ext.Button({text:"查询",iconCls:"search",width:20});xlsButton=new Ext.Button({text:"excel",iconCls:"btn-xls"});htmlButton=new Ext.Button({text:"html",iconCls:"btn-ie"});pdfButton=new Ext.Button({text:"pdf",iconCls:"btn-pdf"});formPanel=new Ext.FormPanel({defaults:{anchor:"10%,10%"},frame:false,border:false,layout:"hbox",layoutConfig:{padding:"5",align:"middle"},defaults:{xtype:"label",margins:{top:0,right:4,bottom:4,left:4}},items:[],scope:this,listeners:{"afterrender":function(a){pdfButton.on("click",function(b){if(a.getForm().isValid()){a.getForm().submit({waitMsg:"正在提交查询",url:__ctxPath+"/system/submitReportTemplate.do",method:"post",success:function(d,c){var e=Ext.util.JSON.decode(c.response.responseText);document.location.href=__ctxPath+"/report/report.jsp?reportId="+j+encodeURI(encodeURI(e.data))+"&reportType=pdf";},failure:function(d,c){}});}},this);htmlButton.on("click",function(b){if(a.getForm().isValid()){a.getForm().submit({waitMsg:"正在提交查询",url:__ctxPath+"/system/submitReportTemplate.do",method:"post",success:function(d,c){var e=Ext.util.JSON.decode(c.response.responseText);window.open(__ctxPath+"/report/report.jsp?reportId="+j+encodeURI(encodeURI(e.data))+"&reportType=html","blank");},failure:function(d,c){}});}},this);xlsButton.on("click",function(b){if(a.getForm().isValid()){a.getForm().submit({waitMsg:"正在提交查询",url:__ctxPath+"/system/submitReportTemplate.do",method:"post",success:function(d,c){var e=Ext.util.JSON.decode(c.response.responseText);document.location.href=__ctxPath+"/report/report.jsp?reportId="+j+encodeURI(encodeURI(e.data))+"&reportType=xls";},failure:function(d,c){}});}},this);searchButton.on("click",function(b){if(a.getForm().isValid()){a.getForm().submit({waitMsg:"正在提交查询",url:__ctxPath+"/system/submitReportTemplate.do",method:"post",success:function(d,c){var e=Ext.util.JSON.decode(c.response.responseText);var l=Ext.getCmp("reportTemp"+j);l.body.update('<iframe src="'+__ctxPath+"/report/report.jsp?reportId="+j+encodeURI(encodeURI(e.data))+'" height="98%" width="98%" scrolling="auto"></iframe>');},failure:function(d,c){}});}},this);}}}).show();var f=new Ext.Container({layout:"table",layoutConfig:{columns:8},defaults:{bodyStyle:"padding:20px"}});Ext.Ajax.request({url:__ctxPath+"/system/loadReportTemplate.do?reportId="+j,method:"POST",async:false,success:function(K,I){var d=0;var A=new Date();var G=new Date(A.getFullYear(),A.getMonth(),1);var J=new Date(A.getFullYear(),(A.getMonth())+1,1);formPanel.removeAll(true);var b=Ext.util.JSON.decode(K.responseText);for(var e=0;e<b.data.length;e++){var C=b.data[e].paramName;var F=b.data[e].paramType;var a=b.data[e].paramKey;var z=b.data[e].defaultVal;var s=b.data[e].paramTypeStr;var E=Ext.decode(s);var D=new Ext.form.Label({text:C+": "});switch(F){case"combo":Ext.apply(E,{allowBlank:true,value:z,fieldLabel:"",hiddenName:a,id:a+new Date(),width:100});f.add(D);var c=new Ext.form.ComboBox(E);f.add(c);break;case"diccombo":Ext.apply(E,{allowBlank:true,value:z,fieldLabel:"",name:a,id:a+new Date(),width:100});f.add(D);var H=new DicCombo(E);f.add(H);break;case"datetimefield":var B=d%2;switch(B){case 0:Ext.apply(E,{allowBlank:false,value:G,format:"Y-m-d H:i:s",fieldLabel:"",name:a,id:a+new Date(),width:200});f.add(D);f.add(E);d++;break;case 1:Ext.apply(E,{allowBlank:false,value:J,format:"Y-m-d H:i:s",fieldLabel:"",name:a,id:a+new Date(),width:200});f.add(D);f.add(E);d++;break;}break;case"datefield":var B=d%2;switch(B){case 0:Ext.apply(E,{allowBlank:false,value:G,format:"Y-m-d",fieldLabel:"",name:a,id:a+new Date(),width:100});f.add(D);f.add(E);d++;break;case 1:Ext.apply(E,{allowBlank:false,value:J,format:"Y-m-d",fieldLabel:"",name:a,id:a+new Date(),width:100});f.add(D);f.add(E);d++;break;}break;default:Ext.apply(E,{allowBlank:true,value:z,fieldLabel:"",name:a,id:a+new Date(),width:100});f.add(D);f.add(E);}}f.add(searchButton);formPanel.add(f);f.doLayout(true);formPanel.doLayout(true);}});var i=new Ext.Toolbar({autoWidth:true,layout:"hbox",defaults:{anchor:"10%,10%"},items:[pdfButton,xlsButton,htmlButton]});var g=new Ext.Panel({id:"ReportPreview"+j,title:"查看-"+h,iconCls:"menu-report",autoScroll:false,autoHeight:true,border:false,frame:false,listeners:{"afterrender":function(e){var a=formPanel.getHeight();var b=i.getHeight();var c=Ext.getCmp("reportTemp"+j).getHeight();var d=Ext.getCmp("centerTabPanel").getInnerHeight();Ext.getCmp("reportTemp"+j).setHeight(d-(a+b));Ext.getCmp("reportTemp"+j).doLayout();searchButton.fireEvent("click");}},items:[formPanel,i,{id:"reportTemp"+j,autoHeight:false,autoWidth:false,autoScroll:false,border:false,xtype:"panel",height:415,autoLoad:false}]});return g;};