SendMailForm=Ext.extend(Ext.Window,{formPanel:null,constructor:function(b){Ext.applyIf(this,b);this.initUIComponents();SendMailForm.superclass.constructor.call(this,{layout:"fit",title:"邮件发送",iconCls:"btn-mail_send",id:"SendMailFormWin",width:650,height:530,minWidth:649,minHeight:529,items:this.formPanel,maximizable:true,border:false,modal:true,plain:true,buttonAlign:"center",buttons:this.buttons});},initUIComponents:function(){this.formPanel=new Ext.FormPanel({id:"CmailForm",frame:false,bodyStyle:"padding:5px;",defaultType:"textarea",url:__ctxPath+"/customer/send.do",method:"post",modal:true,layout:"form",plain:true,scope:this,labelWidth:60,defaults:{labelWidth:60},items:[{xtype:"hidden",id:"provideIds",name:"customerMail.ids",value:this.ids},{xtype:"hidden",id:"type",name:"customerMail.type",value:this.type},{xtype:"textfield",id:"receivedName",anchor:"98%",name:"customerMail.names",fieldLabel:"收件人",readOnly:true,value:this.names},{xtype:"textfield",id:"subject",name:"customerMail.subject",anchor:"98%",allowBlank:false,fieldLabel:"主题"},{xtype:"htmleditor",id:"content",name:"customerMail.mailContent",anchor:"98%",height:300,fieldLabel:"内容"},{layout:"column",xtype:"container",border:false,items:[{columnWidth:0.7,border:false,layout:"form",items:[{fieldLabel:"附件",xtype:"panel",id:"providerFilePanel",frame:false,height:80,autoScroll:true,html:""}]},{columnWidth:0.3,border:false,items:[{xtype:"button",iconCls:"btn-add",text:"添加附件",handler:function(){var b=App.createUploadDialog({file_cat:"customer",callback:function(f){var a=Ext.getCmp("providerfileIds");var g=Ext.getCmp("providerFilePanel");for(var h=0;h<f.length;h++){if(a.getValue()!=""){a.setValue(a.getValue()+",");}a.setValue(a.getValue()+f[h].fileId);Ext.DomHelper.append(g.body,'<span><a href="#" onclick="FileAttachDetail.show('+f[h].fileId+')">'+f[h].fileName+'</a> <img class="img-delete" src="'+__ctxPath+'/images/system/delete.gif" onclick="removeFile(this,'+f[h].fileId+')"/>&nbsp;|&nbsp;</span>');}}});b.show(this);}},{xtype:"button",iconCls:"btn-del",text:"清除附件",handler:function(){var c=Ext.getCmp("providerfileIds");var d=Ext.getCmp("providerFilePanel");d.body.update("");c.setValue("");}}]}]},{xtype:"hidden",id:"providerfileIds",name:"customerMail.files"}]});this.formPanel.getForm().load({deferredRender:false,url:__ctxPath+"/customer/loadVm.do",waitMsg:"正在载入数据...",success:function(d,f){var e=Ext.util.JSON.decode(f.response.responseText).data;Ext.getCmp("content").setValue(e);},failure:function(d,f){var e=f.result;Ext.ux.Toast.msg("信息提示",e.message);Ext.getCmp("SendMailFormWin").close();}});this.buttons=[{text:"发送",iconCls:"btn-mail_send",handler:function(){var b=Ext.getCmp("CmailForm");if(b.getForm().isValid()){b.getForm().submit({waitMsg:"正在 发送信息",success:function(a,e){var f=Ext.getCmp("SendMailFormWin");f.close();Ext.ux.Toast.msg("操作信息","邮件发送成功！");},failure:function(a,d){Ext.ux.Toast.msg("错误信息",d.result.message);}});}}},{text:"关闭",iconCls:"reset",handler:function(){var b=Ext.getCmp("SendMailFormWin");b.close();}}];}});