ArchivesMonitor=Ext.extend(Ext.Panel,{constructor:function(b){Ext.applyIf(this,b);this.initUIComponents();ArchivesMonitor.superclass.constructor.call(this,{id:"ArchivesMonitor",iconCls:"menu-archive-monitor",title:"流程监控",region:"center",layout:"border",items:[this.searchPanel,this.gridPanel]});},initUIComponents:function(){this.searchPanel=new Ext.FormPanel({height:35,region:"north",frame:false,border:false,layout:"hbox",layoutConfig:{padding:"5",align:"middle"},defaults:{style:"padding:0px 5px 0px 5px;",border:false,anchor:"98%,98%",labelWidth:75,xtype:"label"},items:[{text:"类型名称"},{name:"Q_typeName_S_LK",width:100,xtype:"textfield"},{text:"发文字号"},{width:100,name:"Q_archivesNo_S_LK",xtype:"textfield"},{text:"文件标题"},{width:100,name:"Q_subject_S_LK",xtype:"textfield"},{text:"公文状态"},{width:100,name:"Q_status_S_LK",xtype:"textfield"},{xtype:"button",text:"查询",iconCls:"search",handler:this.search.createCallback(this)}]});this.gridPanel=new HT.GridPanel({region:"center",rowActions:true,baseParams:{"sort":"createtime","dir":"desc"},url:__ctxPath+"/archive/listArchives.do",fields:[{name:"archivesId",type:"int"},"archivesType","archivesRecType","archivesNo","issueDep","depId","subject","issueDate","status","shortContent","fileCounts","privacyLevel","urgentLevel","issuer","issuerId","keywords","sources","archType","createtime","runId","tasks","archStatus"],columns:[{header:"archivesId",dataIndex:"archivesId",hidden:true},{header:"公文类型名称",dataIndex:"archivesType",renderer:function(f,d,e){if(f){return f.typeName;}else{if(e.data.archivesRecType){return e.data.archivesRecType.typeName;}}}},{header:"发文字号",dataIndex:"archivesNo"},{header:"发文机关或部门",dataIndex:"issueDep"},{header:"文件标题",dataIndex:"subject"},{header:"公文状态",dataIndex:"status"},{header:"秘密等级",dataIndex:"privacyLevel"},{header:"紧急程度",dataIndex:"urgentLevel"},{header:"发文时间",dataIndex:"createtime",renderer:function(b){return b.substring(0,10);}},{header:"工作流",dataIndex:"tasks",renderer:function(f){var e="";if(f.length>0){for(var d=0;d<f.length;d++){e+=f[d].taskName;if(f[d].userId){e+="(";if(curUserInfo.userId==f[d].userId){e+='<a href="#" onclick="App.MyDesktopClickTopTab(\'ProcessNextForm\',{taskId:'+f[d].taskId+",activityName:'"+f[d].taskName+"'})\">";}e+=f[d].fullname;if(curUserInfo.userId==f[d].userId){e+="</a>";}e+=")&nbsp;&nbsp;";}}}return e;}},new Ext.ux.grid.RowActions({header:"管理",width:100,actions:[{iconCls:"btn-archives-detail",qtip:"查阅详情",style:"margin:0 3px 0 3px"},{iconCls:"btn-archives-remind",qtip:"催办",style:"margin:0 3px 0 3px",fn:function(b){if(isGranted("_ArchivesIssueHasten")){return true;}return false;}}],listeners:{scope:this,"action":this.onRowAction}})]});this.gridPanel.addListener("rowdblclick",this.rowClick);},rowClick:function(d,e,f){d.getSelectionModel().each(function(a){new ArchivesDetailWin({archivesId:a.data.archivesId,runId:a.data.runId}).show();});},search:function(b){if(b.searchPanel.getForm().isValid()){$search({searchPanel:b.searchPanel,gridPanel:b.gridPanel});}},delRecords:function(){var h=this.gridPanel;var f=h.getSelectionModel().getSelections();if(f.length==0){Ext.ux.Toast.msg("信息","请选择要删除的记录！");return;}var g=Array();for(var e=0;e<f.length;e++){g.push(f[e].data.archivesId);}this.delByIds(g);},detail:function(b){new ArchivesDetailWin({archivesId:b.data.archivesId,runId:b.data.runId}).show();},remind:function(e){var f=e.data.status;var h=e.data.archStatus;var g="";if(h=="1"){Ext.ux.Toast.msg("提示信息","公文已归档!");return;}else{new ArchHastenForm({archivesId:e.data.archivesId,archivesNo:e.data.archivesNo,activityName:f}).show();}},approvalTask:function(f){var g=App.getContentPanel();var e=f.data.runId;var h=g.getItem("ProcessRunDetail"+e);if(h==null){h=new ProcessRunDetail(e,null,null,f.data.subject);g.add(h);}g.activate(h);},onRowAction:function(j,g,i,h,f){switch(i){case"btn-archives-detail":this.detail(g);break;case"btn-archives-remind":this.remind(g);break;case"btn-approvalTask":this.approvalTask(g);break;default:break;}}});ArchivesMonitor.jumpFlowTask=function(c,d){App.MyDesktopClickTopTab("ProcessNextForm",{taskId:c,activityName:d});};