ArchTemplateView=Ext.extend(Ext.Panel,{typeId:null,typeName:null,searchPanel:null,gridPanel:null,store:null,topbar:null,constructor:function(b){Ext.applyIf(this,b);this.initUIComponents();ArchTemplateView.superclass.constructor.call(this,{title:"公文模板管理",region:"center",layout:"border",items:[this.searchPanel,this.gridPanel]});},initUIComponents:function(){this.searchPanel=new Ext.FormPanel({layout:"column",region:"north",height:40,bodyStyle:"padding:6px 10px 6px 10px",border:false,defaults:{border:false},items:[{columnWidth:0.6,layout:"form",items:{fieldLabel:"模板名称",name:"Q_tempName_S_LK",anchor:"96%,96%",xtype:"textfield"}},{columnWidth:0.2,layout:"form",items:{xtype:"button",text:"查询",iconCls:"search",handler:this.search.createCallback(this)}}]});this.store=new Ext.data.JsonStore({url:__ctxPath+"/archive/listArchTemplate.do",root:"result",totalProperty:"totalCounts",remoteSort:true,fields:[{name:"templateId",type:"int"},"archivesType","tempName","tempPath","fileId"]});this.store.setDefaultSort("templateId","desc");this.store.load({params:{start:0,limit:25}});var d=[];if(this.allowEdit){if(isGranted("_ArchviesTempDel")){d.push({iconCls:"btn-del",qtip:"删除",style:"margin:0 3px 0 3px"});}if(isGranted("_ArchivesTempEdit")){d.push({iconCls:"btn-edit",qtip:"编辑",style:"margin:0 3px 0 3px"});}}if(isGranted("_ArchiveTypeTempQuery")){d.push({iconCls:"btn-readdocument",qtip:"查看",style:"margin:0 3px 0 3px"});}this.rowActions=new Ext.ux.grid.RowActions({header:"管理",width:80,actions:d});var f=null;if(this.singleSelect){f=new Ext.grid.CheckboxSelectionModel({singleSelect:true});}else{f=new Ext.grid.CheckboxSelectionModel();}var e=new Ext.grid.ColumnModel({columns:[f,new Ext.grid.RowNumberer(),{header:"templateId",dataIndex:"templateId",hidden:true},{header:"所属类型",dataIndex:"archivesType",renderer:function(a){if(a!=null){return a.typeName;}}},{header:"模板名称",dataIndex:"tempName"},{header:"文件路径",hidden:true,dataIndex:"tempPath"},this.rowActions],defaults:{sortable:true,menuDisabled:false,width:100}});this.topbar=new Ext.Toolbar({height:30,bodyStyle:"text-align:left",items:[]});if(isGranted("_ArchivesTempAdd")){this.topbar.add({iconCls:"btn-add",text:"添加公文模板",xtype:"button",scope:this,handler:this.createRecord});}if(isGranted("_ArchviesTempDel")){this.topbar.add({iconCls:"btn-del",text:"删除公文模板",xtype:"button",handler:this.delRecords,scope:this});}this.gridPanel=new Ext.grid.GridPanel({id:"ArchTemplateGrid",region:"center",stripeRows:true,tbar:this.topbar,store:this.store,trackMouseOver:true,disableSelection:false,loadMask:true,cm:e,sm:f,plugins:this.rowActions,viewConfig:{forceFit:true,autoFill:true,forceFit:true},bbar:new HT.PagingBar({store:this.store})});this.gridPanel.addListener("rowdblclick",function(b,c,a){b.getSelectionModel().each(function(g){new ArchTemplateView(g.data.templateId).show();});});this.rowActions.on("action",this.onRowAction,this);},search:function(b){if(b.searchPanel.getForm().isValid()){b.searchPanel.getForm().submit({waitMsg:"正在提交查询",url:__ctxPath+"/archive/listArchTemplate.do",params:{"Q_archivesType.typeId_L_EQ":b.typeId},success:function(f,e){var a=Ext.util.JSON.decode(e.response.responseText);b.gridPanel.getStore().loadData(a);}});}},createRecord:function(){new ArchTemplateForm({typeId:this.typeId,typeName:this.typeName}).show();},delByIds:function(c,d){Ext.Msg.confirm("信息确认","您确认要删除所选记录吗？",function(a){if(a=="yes"){Ext.Ajax.request({url:__ctxPath+"/archive/multiDelArchTemplate.do",params:{ids:c},method:"POST",success:function(f,b){Ext.ux.Toast.msg("操作信息","成功删除所选公文分类！");d.getStore().reload();},failure:function(f,b){Ext.ux.Toast.msg("操作信息","操作出错，请联系管理员！");}});}});},delRecords:function(){var e=this.gridPanel.getSelectionModel().getSelections();if(e.length==0){Ext.ux.Toast.msg("信息","请选择要删除的记录！");return;}var f=Array();for(var d=0;d<e.length;d++){f.push(e[d].data.templateId);}this.delByIds(f,this.gridPanel);},editRecord:function(b){new ArchTemplateForm({templateId:b.data.templateId}).show();},onRowAction:function(j,g,i,h,f){switch(i){case"btn-del":this.delByIds(g.data.templateId,j);break;case"btn-edit":this.editRecord(g);break;case"btn-readdocument":new OfficeTemplateView(g.data.fileId);break;default:break;}},setTypeId:function(b){if(b==0){this.typeId=null;return;}this.typeId=b;},setTypeName:function(b){if(b){this.typeName=b;}}});