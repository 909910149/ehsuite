ArchivesDocForm=Ext.extend(Ext.Window,{formPanel:null,constructor:function(b){Ext.applyIf(this,b);this.initUIComponents();ArchivesDocForm.superclass.constructor.call(this,{id:"ArchivesDocFormWin",layout:"fit",border:false,items:this.formPanel,modal:true,height:600,width:800,iconCls:"btn-archive-attachment",maximizable:true,title:"发文附件",buttonAlign:"center",buttons:this.buttons});},initUIComponents:function(){this.docPanel=new NtkOfficePanel({showToolbar:true,fileId:this.fileId,height:480});this.formPanel=new Ext.FormPanel({layout:"form",frame:true,url:__ctxPath+"/archive/saveArchivesDoc.do",id:"ArchivesDocForm",defaults:{anchor:"98%,98%"},items:[{name:"archivesDoc.docId",id:"docId",xtype:"hidden",value:this.docId==null?"":this.docId},{xtype:"hidden",name:"archivesDoc.fileId",id:"fileId"},{fieldLabel:"文档名称",name:"archivesDoc.docName",xtype:"textfield",allowBlank:false,id:"docName"},{xtype:"hidden",fieldLabel:"文档路径",name:"archivesDoc.docPath",id:"docPath"},this.docPanel.panel]});if(this.docId!=null&&this.docId!="undefined"&&this.docId!=0){this.formPanel.getForm().load({deferredRender:false,url:__ctxPath+"/archive/getArchivesDoc.do?docId="+this.docId,waitMsg:"正在载入数据...",success:function(d,c){},failure:function(d,c){}});}this.buttons=[{text:"保存",iconCls:"btn-save",scope:this,handler:this.onSave},{text:"重置",iconCls:"btn-reset",scope:this,handler:this.onReset},{text:"取消",iconCls:"btn-cancel",scope:this,handler:this.onCancel}];},show:function(){ArchivesDocForm.superclass.show.call(this);if(this.fileId){this.docPanel.openDoc(this.fileId);}},onReset:function(){this.formPanel.getForm().reset();},onCancel:function(){this.close();},onSave:function(){var n=this;var j=this.callback;if(this.formPanel.getForm().isValid()){var h=null;var i=null;var k=this.formPanel.getCmpByName("archivesDoc.docName").getValue();var l=this.docPanel.saveDoc({fileId:i,docName:k,doctype:"doc"});if(l&&l.success){i=l.fileId;h=l.filePath;Ext.getCmp("docPath").setValue(h);}else{Ext.ux.Toast.msg("操作信息","保存文档出错！");return;}if(this.docId==0){var m={docId:0,fileId:i,docPath:h,docName:k,curVersion:1};j.call(this,m);n.close();return;}this.formPanel.getForm().submit({method:"POST",params:{docPath:h,fileId:i},success:function(b,a){Ext.ux.Toast.msg("操作信息","成功保存附加文档！");var c=Ext.util.JSON.decode(a.response.responseText);j.call(this,c.data);n.close();},failure:function(b,a){Ext.MessageBox.show({title:"操作信息",msg:"信息保存出错，请联系管理员！",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});}});}},insertNewDoc:function(e,f){var d;if(e.recordType){d=new e.recordType();d.data={};d.data["docId"]=f.docId;d.data["fileId"]=f.fileId;d.data["docPath"]=f.docPath;d.data["docName"]=f.docName;d.data["curVersion"]=f.curVersion?f.curVersion:1;d.data.newRecord=true;d.commit();e.add(d);}}});