ProInstanceDetail=Ext.extend(Ext.Window,{gridPanel:null,constructor:function(b){Ext.applyIf(this,b);this.initUI();ProInstanceDetail.superclass.constructor.call(this,{title:this.subject+"--任务列表",width:800,modal:true,maximizable:true,height:400,iconCls:"menu-instance",layout:"border",defaults:{padding:"6",anchor:"98%,98%"},items:[this.showPanel],buttonAlign:"center",buttons:[{text:"关闭",iconCls:"btn-cancel",scope:this,handler:this.cancel}]});},initUI:function(){this.topbar=new Ext.Toolbar({items:[{iconCls:"btn-refresh",text:"刷新",xtype:"button",scope:this,handler:this.refreshRs},"-",{iconCls:"btn-detail",text:"查看",xtype:"button",scope:this,handler:this.detailRsM},"-",{text:"设置到期时间",scope:this,handler:this.setDueDate},"-",{text:"更改待办人",scope:this,handler:this.setHandler},"-",{text:"更改执行路径",scope:this,handler:this.setPath},"-",{text:"任务代办",scope:this,handler:this.handlerTask}]});this.gridPanel=new HT.GridPanel({region:"center",anchor:"100% 100%",rowActions:true,tbar:this.topbar,autoScroll:true,showPaging:false,url:__ctxPath+"/flow/tasksProcessRun.do",baseParams:{runId:this.runId},fields:["taskName","activityName","assignee","createTime","dueDate","executionId","pdId","taskId","isMultipleTask"],columns:[new Ext.grid.RowNumberer(),{header:"taskId",dataIndex:"taskId",hidden:true},{header:"任务名称",dataIndex:"taskName",width:350},{header:"执行人",width:70,fixed:true,dataIndex:"assignee",renderer:function(j,k,h,i,l){var g=h.data.assignee;if(g==null||g==""){return'<font color="red">暂无执行人</font>';}else{return g;}}},{header:"开始时间",dataIndex:"createTime",width:125,fixed:true,resizable:false},{header:"到期时间",fixed:true,resizable:false,width:125,dataIndex:"dueDate",renderer:function(b){if(b==""){return"无限制";}else{return b;}}},new Ext.ux.grid.RowActions({header:"管理",width:32,fixed:true,resizable:false,actions:[{iconCls:"btn-detail",qtip:"查看",style:"margin:0 3px 0 3px"}],listeners:{scope:this,"action":this.onRowAction}})]});this.showPanel=new Ext.FormPanel({layout:"hbox",region:"center",layoutConfig:{align:"stretch"},items:[{xtype:"fieldset",title:"任务列表",flex:1,layout:"form",items:[this.gridPanel]}]});},refreshRs:function(){this.gridPanel.getStore().reload();},detailRsM:function(){var b=this.gridPanel.getSelectionModel().getSelections();if(b.length==0){Ext.ux.Toast.msg("操作信息","请选择任务记录!");return;}if(b.length>1){Ext.ux.Toast.msg("操作信息","只能选择一条任务记录!");return;}this.detailRs(b[0]);},detailRs:function(b){new FlowFormDetail({taskId:b.data.taskId,activityName:b.data.activityName}).show();},cancel:function(){this.close();},setDueDate:function(){var b=this.gridPanel.getSelectionModel().getSelections();if(b.length==0){Ext.ux.Toast.msg("操作信息","请选择任务记录!");return;}new TaskDueDateWindow({taskGrid:this.gridPanel}).show();},setHandler:function(){var b=this.gridPanel.getSelectionModel().getSelections();if(b.length==0){Ext.ux.Toast.msg("操作信息","请选择任务记录!");return;}new TaskHandlerWindow({taskGrid:this.gridPanel}).show();},setPath:function(){var b=this.gridPanel.getSelectionModel().getSelections();if(b.length==0){Ext.ux.Toast.msg("操作信息","请选择任务记录!");return;}new PathChangeWindow({taskId:b[0].data.taskId,taskGrid:this.gridPanel}).show();},handlerTask:function(){var h=this.gridPanel.getSelectionModel().getSelections();if(h.length==0){Ext.ux.Toast.msg("操作信息","请选择任务记录!");return;}if(h.length>1){Ext.ux.Toast.msg("操作信息","只能选择一条任务记录!");return;}var f=h[0];var g=App.getContentPanel();var e=g.getItem("ProcessNextForm"+f.data.taskId);if(e==null){e=new ProcessNextForm({taskId:f.data.taskId,activityName:f.data.activityName});g.add(e);}g.activate(e);this.close();},onRowAction:function(j,g,i,h,f){switch(i){case"btn-detail":this.detailRs.call(this,g);break;default:break;}}});FlowFormDetail=Ext.extend(Ext.Window,{constructor:function(b){Ext.applyIf(this,b);this.initUI();FlowFormDetail.superclass.constructor.call(this,{layout:"form",width:800,height:500,iconCls:"menu-instance",modal:true,maximizable:true,defaults:{padding:"6"},autoScroll:true,title:this.activityName+"--任务详细信息",items:[this.formPanel,this.detailPanel],buttonAlign:"center",buttons:[{text:"关闭",iconCls:"btn-cancel",scope:this,handler:this.cancel}]});},initUI:function(){this.formPanel=new Ext.FormPanel({layout:"form",border:false,bodyStyle:"padding:8px",autoHeight:true,items:[{xtype:"fieldset",title:"业务表单",layout:"form",anchor:"90%,90%",autoScroll:true,autoLoad:{url:__ctxPath+"/flow/getProcessActivity.do?taskId="+this.taskId,nocache:true,scope:this,callback:this.getFormHtmlCallback}}]});this.detailPanel=new Ext.Panel({title:"审批信息",autoHeight:true,autoLoad:{url:__ctxPath+"/flow/processRunDetail.do?taskId="+this.taskId,nocache:true}});},cancel:function(){this.close();},getFormHtmlCallback:function(){var s=this.formPanel.getForm().getEl().dom;var q=this.formPanel;var r=s.elements||(document.forms[s]||Ext.getDom(s)).elements;try{var e=document.getElementById("entity_"+this.taskId);var t,m,l,p;if(e!=null){if(e.value!=""){var n=Ext.decode(e.value);$converDetail.call(this,n);}else{$converDetail.call(this,null);}}}catch(o){alert(o);}}});