FieldRightsForm=Ext.extend(Ext.Window,{constructor:function(b){Ext.applyIf(this,b);this.initUIComponents();FieldRightsForm.superclass.constructor.call(this,{id:"FieldRightsFormWin",layout:"fit",items:this.gridPanel,modal:true,height:400,width:500,maximizable:true,title:"表单字段权限详细信息",buttonAlign:"center",buttons:[{text:"保存",iconCls:"btn-save",scope:this,handler:this.save},{text:"取消",iconCls:"btn-cancel",scope:this,handler:this.cancel}]});},initUIComponents:function(){this.store=new Ext.data.GroupingStore({proxy:new Ext.data.HttpProxy({url:__ctxPath+"/flow/nodesFieldRights.do?defId="+this.defId}),reader:new Ext.data.JsonReader({root:"result",id:"id",fields:[{name:"rightId",type:"int"},{name:"mappingId",type:"int"},"taskName",{name:"readWrite",type:"int"},{name:"refieldId",type:"int"},"fieldName","fieldLabel"]}),groupField:"taskName"});this.store.load();var b=new Ext.grid.CheckboxSelectionModel();this.gridPanel=new Ext.grid.EditorGridPanel({store:this.store,sm:b,tbar:new Ext.Toolbar({items:[{text:"标为可写",iconCls:"",scope:this,handler:this.flagFunction.createCallback(this,2)},{text:"标为可读",iconCls:"",scope:this,handler:this.flagFunction.createCallback(this,1)},{text:"标为隐藏",iconCls:"",scope:this,handler:this.flagFunction.createCallback(this,0)}]}),columns:[b,new Ext.grid.RowNumberer(),{header:"rightId",dataIndex:"rightId",hidden:true},{dataIndex:"taskName",header:"taskName",hidden:true},{header:"字段名称",dataIndex:"fieldName",sortable:true},{header:"字段标签",dataIndex:"fieldLabel",sortable:true},{dataIndex:"readWrite",header:"权限",fixed:true,resizable:false,sortable:false,width:50,menuDisabled:true,renderer:function(a){if(a==0){return'<font color="gray">隐藏</font>';}else{if(a==1){return'<font color="red">读</font>';}else{if(a==2){return'<font color="green">写</font>';}}}},editor:new Ext.form.ComboBox({typeAhead:true,editable:false,triggerAction:"all",lazyRender:true,mode:"local",store:[["0","隐藏"],["1","读"],["2","写"]]})}],view:new Ext.grid.GroupingView({forceFit:true,startCollapsed:true,enableNoGroups:false,enableGroupingMenu:false,showGroupName:false,groupTextTpl:"{text} 节点"})});},cancel:function(){this.close();},selectData:function(){var b=this.gridPanel.getSelectionModel().getSelections();if(b.length<1){Ext.ux.Toast.msg("操作信息","请选择字段！");return null;}return b;},flagFunction:function(f,g){var h=f.selectData();if(h){for(var j=0;j<h.length;j++){var i=h[j];i.set("readWrite",g);}}},save:function(){var g=[];for(var e=0;e<this.store.getCount();e++){var h=this.store.getAt(e);if(h.data.rightId==""||h.data.rightId==null||h.data.rightId==undefined){h.set("rightId",-1);}if(h.dirty){g.push(h.data);}}if(g.length==0){Ext.ux.Toast.msg("操作信息","没有修改过数据！");}var f=this;Ext.Ajax.request({url:__ctxPath+"/flow/multSaveFieldRights.do",method:"post",params:{data:Ext.encode(g)},success:function(){Ext.ux.Toast.msg("操作信息","成功保存信息！");f.close();},failure:function(){Ext.ux.Toast.msg("操作信息","保存信息出错！");}});}});