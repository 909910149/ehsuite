Ext.ns("MyTaskView");var MyTaskView=function(){var b=new Ext.Panel({id:"MyTaskView",iconCls:"menu-flowWait",bodyStyle:"padding:2px 2px 2px 2px",layout:"border",region:"center",title:"待办事项",autoScroll:true,items:[this.setup()]});return b;};MyTaskView.prototype.setup=function(){var d=this.initData();d.load({params:{start:0,limit:25}});var e=new Ext.grid.ColumnModel({columns:[new Ext.grid.RowNumberer(),{header:"userId",dataIndex:"userId",width:20,hidden:true,sortable:true},{header:"事项名称",dataIndex:"taskName",width:120},{header:"执行人",dataIndex:"assignee",width:140,renderer:function(b,c,l,a,j){var k=l.data.assignee;if(k==null||k==""){return'<font color="red">暂无执行人</font>';}else{return k;}}},{header:"开始时间",dataIndex:"createTime",width:100},{header:"到期时间",dataIndex:"dueDate",width:100,renderer:function(a){if(a==""){return"无限制";}else{return a;}}},{hidden:true,dataIndex:"executionId"},{hidden:true,dataIndex:"taskId"},{hidden:"true",dataIndex:"isMultipleTask"},{header:"管理",dataIndex:"taskdbid",width:50,renderer:function(b,c,s,o,a){var q=s.data.taskId;var v=s.data.executionId;var r=s.data.assignee;var u=s.data.activityName;var t=s.data.isMultipleTask;var p="";if(r==""){p+='<button title="锁定任务" class="btn-lockTask" onclick="MyTaskView.lockTask('+q+')"></button>';}else{p+='<button title="审核任务" class="btn-approvalTask" onclick="MyTaskView.nextStep(\''+q+"','"+u+"')\"></button>";p+='&nbsp;<button title="任务代办" class="btn-changeTask" onclick="MyTaskView.changeTask('+q+",'"+u+"')\"></button>";if(t==1){p+='&nbsp;<button title="解锁任务" class="btn-unlockTask" onclick="MyTaskView.unlockTask('+q+')"></button>';}}return p;}}],defaults:{sortable:true,menuDisabled:true,width:100}});var f=new Ext.grid.GridPanel({id:"MyTaskGrid",closable:true,store:d,shim:true,region:"center",trackMouseOver:true,loadMask:true,tbar:new Ext.Toolbar({height:28,items:[{text:"刷新",iconCls:"btn-refresh",handler:function(){Ext.getCmp("MyTaskGrid").getStore().reload();}}]}),cm:e,viewConfig:{forceFit:true,showPreview:false},bbar:new HT.PagingBar({store:d})});f.addListener("rowdblclick",function(b,c,a){b.getSelectionModel().each(function(g){MyTaskView.nextStep(g.data.taskId,g.data.activityName);});});return f;};MyTaskView.prototype.initData=function(){var b=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:__ctxPath+"/flow/listTask.do"}),reader:new Ext.data.JsonReader({root:"result",totalProperty:"totalCounts",fields:["taskName","activityName","assignee","createTime","dueDate","executionId","pdId","taskId","isMultipleTask"]}),remoteSort:true});b.setDefaultSort("dbId","desc");return b;};MyTaskView.lockTask=function(b){Ext.Ajax.request({url:__ctxPath+"/flow/lockTask.do",params:{taskId:b},method:"post",success:function(a,h){var f=Ext.getCmp("MyTaskGrid");var g=Ext.util.JSON.decode(a.responseText);if(g.hasAssigned==true){Ext.ux.Toast.msg("操作提示","该任务已经被其他用户锁定执行！");}else{Ext.ux.Toast.msg("操作提示","该任务已经成功锁定，请执行下一步操作！");}f.getStore().reload();}});};MyTaskView.changeTask=function(c,d){new ChangeTaskView(c,d);};MyTaskView.unlockTask=function(b){Ext.Ajax.request({url:__ctxPath+"/flow/unlockTask.do",params:{taskId:b},method:"post",success:function(a,h){var f=Ext.getCmp("MyTaskGrid");var g=Ext.util.JSON.decode(a.responseText);if(g.unlocked==true){Ext.ux.Toast.msg("操作提示","该任务已经成功解锁！");}else{Ext.ux.Toast.msg("操作提示","该任务解锁失败(任务已经由其他人员执行完成)！");}f.getStore().reload();}});};MyTaskView.nextStep=function(e,g){var h=App.getContentPanel();var f=h.getItem("ProcessNextForm"+e);if(f==null){f=new ProcessNextForm({taskId:e,activityName:g});h.add(f);}h.activate(f);};