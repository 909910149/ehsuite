MyRunningTaskView=Ext.extend(Ext.Panel,{constructor:function(b){Ext.applyIf(this,b);this.initUI();MyRunningTaskView.superclass.constructor.call(this,{title:"我的任务追回",layout:"border",items:[this.gridPanel]});},initUI:function(){this.gridPanel=new HT.GridPanel({region:"center",tbar:[{text:"追回",iconCls:"btn-back",scope:this,handler:this.rollbackTask}],rowActions:true,url:__ctxPath+"/flow/myRunningProcessRun.do",fields:[{name:"runId",type:"int"},"subject","createtime","defId","piId","runStatus","tasks","exeUsers"],columns:[{header:"runId",dataIndex:"runId",hidden:true},{header:"标题",dataIndex:"subject",sortable:false},{header:"创建时间",dataIndex:"createtime",width:60,sortable:false},{header:"运行任务名",dataIndex:"tasks",sortable:false},{header:"执行人",dataIndex:"exeUsers",sortable:false},new Ext.ux.grid.RowActions({header:"管理",width:100,actions:[{iconCls:"btn-flowView",qtip:"详细",style:"margin:0 3px 0 3px"},{iconCls:"btn-back",qtip:"追回",style:"margin:0 3px 0 3px"}],listeners:{scope:this,"action":this.onRowAction}})]});},onRowAction:function(f,h,j,i,g){switch(j){case"btn-flowView":this.showRunDetail.call(this,h.data.runId,h.data.defId,h.data.piId,h.data.subject);break;case"btn-back":this.rollbackTask.call(this);break;default:break;}},showRunDetail:function(k,h,l,g){var i=App.getContentPanel();var j=i.getItem("ProcessRunDetail"+k);if(j==null){j=new ProcessRunDetail(k,h,l,g);i.add(j);}i.activate(j);},rollbackTask:function(){var d=this.gridPanel.getSelectionModel().getSelections();if(d.length==0){Ext.ux.Toast.msg("操作信息","请选择需要追回的流程!");return;}var c=d[0].data.runId;Ext.Ajax.request({url:__ctxPath+"/flow/rollbackProcessRun.do",method:"POST",params:{runId:c},scope:this,success:function(a,b){var f=Ext.decode(a.responseText);if(!f.success){Ext.ux.Toast.msg("操作信息","该流程目前已经完成下一步的处理，不能追回！");return;}Ext.ux.Toast.msg("操作信息","已经成功追回，请查看待办事项！");this.gridPanel.getStore().reload();},failture:function(a,b){Ext.ux.Toast.msg("操作信息","该流程目前已经完成下一步的处理，不能追回！");}});}});