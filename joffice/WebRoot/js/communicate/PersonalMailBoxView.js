Ext.ns("MailFolder");var PersonalMailBoxView=function(){var p;var m=new MailView();var r=new Ext.tree.TreePanel({collapsible:true,region:"west",title:"我的邮箱目录",width:180,autoScroll:true,id:"leftMailBoxTree",split:true,layout:"fit",tbar:new Ext.Toolbar({items:[{text:"收邮件",iconCls:"btn-mail_receive",handler:function(){m.setFolderId(1);Ext.getCmp("MailView").setTitle("[收件箱]");var a=Ext.getCmp("MailGrid");var b=a.getStore();b.url=__ctxPath+"/communicate/listMail.do";b.baseParams={folderId:1};b.reload({params:{start:0,limit:25}});}},{text:"发邮件",iconCls:"btn-mail_send",handler:function(){var b=Ext.getCmp("centerTabPanel");var a=Ext.getCmp("MailForm");if(a==null){a=new MailForm("","","");b.add(a);b.activate(a);}else{b.remove(a);a=new MailForm("","","");b.add(a);b.activate(a);}}},{xtype:"button",iconCls:"btn-refresh",text:"刷新",handler:function(){r.root.reload();}}]}),loader:new Ext.tree.TreeLoader({url:__ctxPath+"/communicate/listMailFolder.do"}),root:new Ext.tree.AsyncTreeNode({expanded:true}),rootVisible:false,listeners:{"click":function(e){if(e!=null){m.setFolderId(e.id);var f=Ext.getCmp("MailCenterView");var b=Ext.getCmp("MailView");var a=Ext.getCmp("ShowMailDetail");if(a!=null){f.remove("ShowMailDetail");b.show();f.doLayout();}if(e.id!=0){Ext.getCmp("MailView").setTitle("["+e.text+"]");var d=Ext.getCmp("MailGrid");var c=d.getStore();c.url=__ctxPath+"/communicate/listMail.do";c.baseParams={folderId:e.id};c.reload({params:{start:0,limit:25}});}}}}});function s(b,a){p=new Ext.tree.TreeNode({id:b.id,text:b.text});o.showAt(a.getXY());}r.on("contextmenu",s,r);var o=new Ext.menu.Menu({tbar:new Ext.Toolbar({items:[{text:"刷新",handler:function(){alert("refresh");}}]}),id:"MailFolderTreeMenu",items:[{text:"新建目录",scope:this,iconCls:"btn-add",handler:k},{text:"修改目录",scope:this,iconCls:"btn-edit",handler:n},{text:"删除目录",scope:this,iconCls:"btn-delete",handler:q}]});function k(b){var a=p.id;new MailFolderForm(null,a);}function n(){var a=p.id;if(a>4){new MailFolderForm(a);}}function q(){var a=p.id;if(a>4){Ext.Ajax.request({url:__ctxPath+"/communicate/countMailFolder.do",params:{folderId:a},method:"post",success:function(c,d){var b=Ext.util.JSON.decode(c.responseText);if(b.count==0){Ext.Ajax.request({url:__ctxPath+"/communicate/removeMailFolder.do",params:{folderId:a},method:"post",success:function(f,e){Ext.ux.Toast.msg("操作信息","成功删除目录！");r.root.reload();},failure:function(f,e){Ext.MessageBox.show({title:"操作信息",msg:"信息保存出错，请联系管理员！",buttons:Ext.MessageBox.OK,icon:"ext-mb-error"});}});}else{Ext.Msg.confirm("警告信息","该文件夹及其子目录下还有"+b.count+"封邮件,确定要删除吗?",function(e){if(e=="yes"){Ext.Ajax.request({url:__ctxPath+"/communicate/removeMailFolder.do",params:{folderId:a,count:b.count},method:"post",success:function(g,f){Ext.ux.Toast.msg("操作信息","成功删除目录！");r.root.reload();},failure:function(g,f){Ext.MessageBox.show({title:"操作信息",msg:"信息保存出错，请联系管理员！",buttons:Ext.MessageBox.OK,icon:"ext-mb-error"});}});}});}},failure:function(c,b){Ext.MessageBox.show({title:"操作信息",msg:"信息保存出错，请联系管理员！",buttons:Ext.MessageBox.OK,icon:"ext-mb-error"});}});}}var l=new Ext.Panel({id:"MailCenterView",region:"center",autoScroll:true,layout:"fit",items:[m.getView()]});var t=new Ext.Panel({title:"我的邮箱",iconCls:"menu-mail_box",layout:"border",id:"PersonalMailBoxView",items:[r,l]});return t;};