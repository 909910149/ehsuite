PhoneBookForm=Ext.extend(Ext.Window,{formPanel:null,buttons:null,constructor:function(b){Ext.applyIf(this,b);this.initUIComponents();PhoneBookForm.superclass.constructor.call(this,{id:"PhoneBookForm",title:"联系人详细信息",iconCls:"menu-personal-phoneBook",width:520,height:320,layout:"fit",defaults:{padding:"5"},plain:true,border:false,buttonAlign:"center",items:this.formPanel,buttons:this.buttons});},initUIComponents:function(){var d=__ctxPath+"/communicate/listPhoneGroup.do?method=1&&isPublic="+this.isPublic;var c=new TreeSelector("phoneGroupSelect",d,"分组*","groupId");this.formPanel=new Ext.FormPanel({url:__ctxPath+"/communicate/savePhoneBook.do",layout:"form",id:"PhoneBookFormPanel",frame:false,formId:"PhoneBookFormId",items:[{xtype:"hidden",name:"phoneBook.phoneId",id:"phoneId"},{layout:"column",border:false,items:[{layout:"form",columnWidth:0.6,border:false,items:[c,{xtype:"hidden",id:"groupId",allowBlank:false,name:"phoneBook.phoneGroup.groupId"},{xtype:"textfield",fieldLabel:"姓名*",allowBlank:false,width:162,name:"phoneBook.fullname",id:"fullname"},{xtype:"datefield",fieldLabel:"出生时间",name:"phoneBook.birthday",id:"birthday",editable:false,format:"Y-m-d",length:50,width:162}]},{layout:"form",columnWidth:0.4,border:false,items:[{fieldLabel:"称谓*",xtype:"combo",anchor:"95%",allowBlank:false,name:"phoneBook.title",id:"title",mode:"local",editable:false,triggerAction:"all",store:["先生","女士"]},{layout:"form",border:false,hidden:this.isPublic,defaults:{anchor:"100%,100%"},items:[{xtype:"combo",fieldLabel:"是否共享*",allowBlank:false,hiddenName:"phoneBook.isShared",id:"isShared",mode:"local",value:"0",editable:false,triggerAction:"all",store:[["0","否"],["1","是"]],anchor:"95%"}]},{xtype:"textfield",fieldLabel:"昵称",anchor:"95%",name:"phoneBook.nickName",id:"nickName"}]}]},{xtype:"tabpanel",plain:true,activeTab:0,height:170,defaults:{bodyStyle:"padding:10px"},items:[{title:"联系方式",layout:"form",defaults:{width:300},defaultType:"textfield",items:[{fieldLabel:"手机号码",allowBlank:false,blankText:"手机号码不能为空!",name:"phoneBook.mobile",id:"mobile"},{fieldLabel:"固定电话",name:"phoneBook.phone",id:"phone"},{fieldLabel:"Email",name:"phoneBook.email",vtype:"email",vtypeText:"邮箱格式不正确!",allowBlank:false,blankText:"邮箱不能为空!",id:"email"},{fieldLabel:"QQ",name:"phoneBook.qqNumber",id:"qqNumber"},{fieldLabel:"MSN",name:"phoneBook.msn",id:"msn"}]},{title:"公司",layout:"form",defaults:{width:300},defaultType:"textfield",items:[{fieldLabel:"职务",name:"phoneBook.duty",id:"duty"},{fieldLabel:"单位名称",name:"phoneBook.companyName",id:"companyName"},{fieldLabel:"单位地址",name:"phoneBook.companyAddress",id:"companyAddress"},{fieldLabel:"单位电话",name:"phoneBook.companyPhone",id:"companyPhone"},{fieldLabel:"单位传真",name:"phoneBook.companyFax",id:"companyFax"}]},{title:"家庭",layout:"form",defaults:{width:300},defaultType:"textfield",items:[{fieldLabel:"家庭住址",name:"phoneBook.homeAddress",id:"homeAddress"},{fieldLabel:"家庭邮编",name:"phoneBook.homeZip",id:"homeZip"},{fieldLabel:"配偶",name:"phoneBook.spouse",id:"spouse"},{fieldLabel:"子女",name:"phoneBook.childs",id:"childs"}]},{cls:"x-plain",title:"备注",layout:"fit",items:{xtype:"textarea",id:"note",fieldLabel:"备注",name:"phoneBook.note"}}]}]});if(this.phoneId!=null&&this.phoneId!="undefined"){this.formPanel.getForm().load({deferredRender:false,url:__ctxPath+"/communicate/getPhoneBook.do?phoneId="+this.phoneId,method:"post",waitMsg:"正在载入数据...",success:function(m,l){var n=l.result.data.birthday;if(n!=null){var a=Ext.getCmp("birthday");a.setValue(new Date(getDateFromFormat(n,"yyyy-MM-dd HH:mm:ss")));}var k=Ext.getCmp("phoneGroupSelect");var p=Ext.getCmp("groupId");var b=l.result.data.phoneGroup.groupName;var o=l.result.data.phoneGroup.groupId;if(b!=null&&o!=null){k.setValue(b);p.setValue(o);}},failure:function(b,a){Ext.ux.Toast.msg("编辑","载入失败");}});}this.buttons=[{xtype:"button",text:"保存",iconCls:"btn-save",handler:this.save.createCallback(this.formPanel,this)},{xtype:"button",text:"取消",iconCls:"btn-cancel",handler:this.cancel.createCallback(this)}];},save:function(d,f){var e=Ext.getCmp("phoneGroupSelect").getValue();if(e!=null&&e!=""&&e!="undefined"){if(d.getForm().isValid()){d.getForm().submit({method:"post",waitMsg:"正在提交数据...",success:function(i,b){Ext.ux.Toast.msg("操作信息","成功信息保存！");var c=Ext.getCmp("PhoneBookView");if(c!=null){var j=c.dataView.getStore();j.reload({params:{start:0,limit:15}});}var a=Ext.getCmp("PublicPhoneBookView");if(a!=null){var j=a.store;j.reload({params:{start:0,limit:15}});}f.close();},failure:function(b,a){Ext.MessageBox.show({title:"操作信息",msg:"信息保存出错，请联系管理员！",buttons:Ext.MessageBox.OK,icon:"ext-mb-error"});f.close();}});}}else{Ext.ux.Toast.msg("操作提示","分组不能为空！");}},cancel:function(b){b.close();}});