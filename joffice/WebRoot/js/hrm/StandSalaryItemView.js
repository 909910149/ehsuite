Ext.ns("StandSalaryItemView");var StandSalaryItemView=function(b){return this.setup(b);};StandSalaryItemView.prototype.setup=function(b){return this.grid(b);};StandSalaryItemView.prototype.grid=function(i){var h=new Ext.grid.CheckboxSelectionModel();var g=new Ext.grid.ColumnModel({columns:[h,new Ext.grid.RowNumberer(),{header:"itemId",dataIndex:"itemId",hidden:true},{header:"所属标准",dataIndex:"standardId",hidden:true},{header:"项目名称",dataIndex:"itemName"},{header:"金额",dataIndex:"amount",editor:new Ext.form.NumberField({allowBlank:false}),renderer:function(a){return'<img src="'+__ctxPath+'/images/flag/customer/rmb.png"/>'+a;}},{header:"所属工资组成ID",dataIndex:"salaryItemId",hidden:true},{header:"管理",dataIndex:"itemId",width:50,sortable:false,renderer:function(d,e,n,a,m){var b=n.data.itemId;var c='<button title="删除" value=" " class="btn-del" onclick="StandSalaryItemView.remove('+b+')">&nbsp;&nbsp;</button>';return c;}}],defaults:{sortable:true,menuDisabled:false,width:100}});var f=this.store(i);if(i!=""&&i!=null&&i!="undefined"){f.load({params:{start:0,limit:25}});}var j=new Ext.grid.EditorGridPanel({id:"StandSalaryItemGrid",iconCls:"menu-salary",title:"薪酬项目金额设置",tbar:this.topbar(),store:f,height:220,trackMouseOver:true,autoScroll:true,disableSelection:false,loadMask:true,cm:g,sm:h,viewConfig:{forceFit:true,enableRowBody:false,showPreview:false}});return j;};StandSalaryItemView.prototype.store=function(c){var d=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:__ctxPath+"/hrm/listStandSalaryItem.do?standardId="+c}),reader:new Ext.data.JsonReader({root:"result",totalProperty:"totalCounts",id:"id",fields:[{name:"itemId",type:"int"},"standardId","itemName","amount","salaryItemId"]}),remoteSort:true});d.setDefaultSort("itemId","desc");return d;};StandSalaryItemView.prototype.topbar=function(){var b=new Ext.Toolbar({id:"StandSalaryItemFootBar",height:30,bodyStyle:"text-align:left",items:[{iconCls:"btn-add",text:"添加薪酬项目",xtype:"button",handler:function(){var f=Ext.getCmp("StandSalaryItemGrid").getStore();var e="";for(var a=0;a<f.getCount();a++){e+=f.getAt(a).get("salaryItemId")+",";}SalaryItemSelector.getView(function(p,c,s){var x=p.split(",");var r=c.split(",");var d=s.split(",");var w=Ext.getCmp("StandSalaryItemGrid");var i=w.getStore();var t=w.getStore().recordType;w.stopEditing();for(var u=0;u<x.length;u++){var v=new t();v.set("salaryItemId",x[u]);v.set("itemName",r[u]);v.set("amount",d[u]);v.commit();i.insert(i.getCount(),v);}w.getView().refresh();w.startEditing(0,0);StandSalaryItemView.onCalcTotalMoney();},e).show();}}]});return b;};StandSalaryItemView.remove=function(i){var l=Ext.getCmp("StandSalaryItemGrid");l.stopEditing();var k=l.getSelectionModel().getSelections();for(var g=0,j;j=k[g];g++){l.getStore().remove(j);}var h=Ext.getCmp("deleteItemIds");h.setValue(h.getValue()+","+i);l.getView().refresh();StandSalaryItemView.onCalcTotalMoney();l.startEditing(0,0);};StandSalaryItemView.edit=function(b){new StandSalaryItemForm(b);};StandSalaryItemView.onCalcTotalMoney=function(){var d=Ext.getCmp("StandSalaryItemGrid").getStore();var f=0;for(var e=0;e<d.getCount();e++){f+=Number(d.getAt(e).get("amount"));}Ext.getCmp("standSalaryForm.totalMoney").setValue(f);};