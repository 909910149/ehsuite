var ResumeForm=function(e){this.resumeId=e;var h=this.setup();var g=new Ext.Toolbar({id:"ResumeFormToolbar",items:[{text:"保存",iconCls:"btn-save",handler:function(){var a=Ext.getCmp("ResumeForm");if(a.getForm().isValid()){a.getForm().submit({method:"post",waitMsg:"正在提交数据...",success:function(c,b){Ext.ux.Toast.msg("操作信息","成功保存信息！");Ext.getCmp("ResumeGrid").getStore().reload();AppUtil.removeTab("ResumeFormPanel");},failure:function(c,b){Ext.MessageBox.show({title:"操作信息",msg:"信息保存出错，请联系管理员！",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});AppUtil.removeTab("ResumeFormPanel");}});}}},{text:"取消",iconCls:"btn-cancel",handler:function(){var b=Ext.getCmp("centerTabPanel");var a=Ext.getCmp("ResumeFormPanel");if(a!=null){b.remove("ResumeFormPanel");}}}]});var f=new Ext.Panel({id:"ResumeFormPanel",iconCls:"menu-resume",title:"简历详细信息",width:500,tbar:g,height:420,modal:true,layout:"anchor",plain:true,bodyStyle:"padding:5px;",buttonAlign:"center",items:[this.setup()]});return f;};ResumeForm.prototype.setup=function(){var d=new Ext.FormPanel({url:__ctxPath+"/hrm/saveResume.do",layout:"form",id:"ResumeForm",defaults:{anchor:"98%,98%"},reader:new Ext.data.JsonReader({root:"data"},[{name:"ResumeForm.resumeId",mapping:"resumeId"},{name:"ResumeForm.registor",mapping:"registor"},{name:"ResumeForm.regTime",mapping:"regTime"},{name:"ResumeForm.status",mapping:"status"},{name:"ResumeForm.fullname",mapping:"fullname"},{name:"ResumeForm.age",mapping:"age"},{name:"ResumeForm.birthday",mapping:"birthday"},{name:"ResumeForm.birthPlace",mapping:"birthPlace"},{name:"ResumeForm.startWorkDate",mapping:"startWorkDate"},{name:"ResumeForm.idNo",mapping:"idNo"},{name:"ResumeForm.religion",mapping:"religion"},{name:"ResumeForm.party",mapping:"party"},{name:"ResumeForm.nationality",mapping:"nationality"},{name:"ResumeForm.race",mapping:"race"},{name:"ResumeForm.sex",mapping:"sex"},{name:"ResumeForm.position",mapping:"position"},{name:"ResumeForm.photo",mapping:"photo"},{name:"ResumeForm.address",mapping:"address"},{name:"ResumeForm.zip",mapping:"zip"},{name:"ResumeForm.email",mapping:"email"},{name:"ResumeForm.phone",mapping:"phone"},{name:"ResumeForm.mobile",mapping:"mobile"},{name:"ResumeForm.eduCollege",mapping:"eduCollege"},{name:"ResumeForm.eduDegree",mapping:"eduDegree"},{name:"ResumeForm.eduMajor",mapping:"eduMajor"},{name:"ResumeForm.hobby",mapping:"hobby"},{name:"ResumeForm.workCase",mapping:"workCase"},{name:"ResumeForm.trainCase",mapping:"trainCase"},{name:"ResumeForm.projectCase",mapping:"projectCase"},{name:"ResumeForm.memo",mapping:"memo"}]),bodyStyle:"padding-left:10px;",formId:"ResumeFormId",defaultType:"textfield",items:[{name:"resume.resumeId",id:"ResumeForm.resumeId",xtype:"hidden",value:this.resumeId==null?"":this.resumeId},{xtype:"hidden",name:"resume.registor",id:"ResumeForm.registor"},{xtype:"hidden",name:"resume.regTime",id:"regTime"},{xtype:"container",layout:"column",height:40,items:[{xtype:"label",style:"padding-left:48%;",html:'<span style="font-size:28px;color:blue;">简历</span>'},{xtype:"container",width:150,style:"float:right;",layout:"column",items:[{xtype:"label",width:30,text:"状态:",style:"padding-top:3px;"},{width:100,xtype:"combo",name:"resume.status",id:"ResumeForm.status",editable:false,mode:"local",triggerAction:"all",store:["通过","未通过","准备安排面试","通过面试"],value:"未通过"}]}]},{xtype:"fieldset",title:"基本资料",layout:"column",items:[{xtype:"container",columnWidth:0.37,defaultType:"textfield",layout:"form",defaults:{anchor:"100%,100%"},items:[{fieldLabel:"姓名",name:"resume.fullname",id:"ResumeForm.fullname",allowBlank:false,blankText:"姓名不可为空!"},{fieldLabel:"年龄",name:"resume.age",id:"ResumeForm.age",xtype:"numberfield"},{fieldLabel:"生日",name:"resume.birthday",id:"ResumeForm.birthday",xtype:"datefield",format:"Y-m-d"},{fieldLabel:"籍贯",name:"resume.birthPlace",id:"ResumeForm.birthPlace"},{fieldLabel:"参加工作时间",name:"resume.startWorkDate",id:"ResumeForm.startWorkDate",xtype:"datefield",format:"Y-m-d"},{fieldLabel:"身份证",name:"resume.idNo",id:"ResumeForm.idNo"}]},{xtype:"container",columnWidth:0.37,defaultType:"textfield",layout:"form",defaults:{anchor:"100%,100%"},items:[{fieldLabel:"宗教信仰",name:"resume.religion",id:"ResumeForm.religion",maxHeight:200,xtype:"combo",mode:"local",editable:true,triggerAction:"all",store:[],listeners:{focus:function(a){var b=Ext.getCmp("ResumeForm.religion").getStore();if(b.getCount()<=0){Ext.Ajax.request({url:__ctxPath+"/system/loadDictionary.do",method:"post",params:{itemName:"宗教信仰"},success:function(g){var h=Ext.util.JSON.decode(g.responseText);b.loadData(h);}});}}}},{fieldLabel:"政治面貌",name:"resume.party",id:"ResumeForm.party",maxHeight:200,xtype:"combo",mode:"local",editable:true,triggerAction:"all",store:[],listeners:{focus:function(a){var b=Ext.getCmp("ResumeForm.party").getStore();if(b.getCount()<=0){Ext.Ajax.request({url:__ctxPath+"/system/loadDictionary.do",method:"post",params:{itemName:"政治面貌"},success:function(g){var h=Ext.util.JSON.decode(g.responseText);b.loadData(h);}});}}}},{fieldLabel:"国籍",name:"resume.nationality",id:"ResumeForm.nationality",maxHeight:200,xtype:"combo",mode:"local",editable:true,triggerAction:"all",store:[],listeners:{focus:function(a){var b=Ext.getCmp("ResumeForm.nationality").getStore();if(b.getCount()<=0){Ext.Ajax.request({url:__ctxPath+"/system/loadDictionary.do",method:"post",params:{itemName:"国籍"},success:function(g){var h=Ext.util.JSON.decode(g.responseText);b.loadData(h);}});}}}},{fieldLabel:"民族",name:"resume.race",id:"ResumeForm.race",maxHeight:200,xtype:"combo",mode:"local",editable:true,triggerAction:"all",store:[],listeners:{focus:function(a){var b=Ext.getCmp("ResumeForm.race").getStore();if(b.getCount()<=0){Ext.Ajax.request({url:__ctxPath+"/system/loadDictionary.do",method:"post",params:{itemName:"民族"},success:function(g){var h=Ext.util.JSON.decode(g.responseText);b.loadData(h);}});}}}},{fieldLabel:"性别",name:"resume.sex",id:"ResumeForm.sex",xtype:"combo",editable:false,mode:"local",triggerAction:"all",store:["男","女"]},{fieldLabel:"职位名称",name:"resume.position",id:"ResumeForm.position"}]},{name:"resume.photo",id:"ResumeForm.photo",xtype:"hidden"},{xtype:"container",columnWidth:0.26,layout:"column",items:[{xtype:"label",text:"个人相片:",style:"padding-left:0px;"},{xtype:"container",layout:"form",width:100,items:[{id:"ResumePhotoPanel",height:120,width:88,xtype:"panel",border:true,html:'<img src="'+__ctxPath+'/images/default_person.gif" width="88" height="120"/>'},{xtype:"button",style:"padding-top:3px;",iconCls:"btn-upload",text:"上传照片",handler:function(){var f=Ext.getCmp("ResumeForm.photo");var b=App.createUploadDialog({file_cat:"hrm/Resume",callback:c,permitted_extensions:["jpg","png"]});if(f.getValue()!=""&&f.getValue()!=null&&f.getValue()!="undefined"){var a="再次上传需要先删除原有图片,";Ext.Msg.confirm("信息确认",a+"是否删除？",function(e){if(e=="yes"){var h=Ext.getCmp("ResumeForm.resumeId").getValue();Ext.Ajax.request({url:__ctxPath+"/hrm/delphotoResume.do",method:"post",params:{resumeId:h},success:function(){var g=f.value;Ext.getCmp("ResumeForm.photo").setValue("");Ext.getCmp("ResumePhotoPanel").body.update('<img src="'+__ctxPath+'/images/default_person.gif" width="88" height="120"/>');Ext.Ajax.request({url:__ctxPath+"/system/deleteFileAttach.do",method:"post",params:{filePath:g},success:function(){b.show("queryBtn");}});}});}});}else{b.show("queryBtn");}}}]}]}]},{xtype:"fieldset",title:"联系方式",defaultType:"textfield",layout:"form",items:[{fieldLabel:"地址",name:"resume.address",id:"ResumeForm.address",anchor:"100%"},{layout:"column",defaults:{anchor:"100%,100%"},style:"padding-left:0px;padding-right:0px;",xtype:"container",items:[{layout:"form",xtype:"container",style:"padding-left:0px;",columnWidth:0.5,defaults:{anchor:"100%,100%"},defaultType:"textfield",items:[{fieldLabel:"邮编",name:"resume.zip",id:"ResumeForm.zip"},{fieldLabel:"电子邮箱",name:"resume.email",id:"ResumeForm.email",vtype:"email"}]},{xtype:"container",columnWidth:0.5,style:"padding-right:0px;",defaultType:"textfield",layout:"form",items:[{fieldLabel:"电话号码",name:"resume.phone",id:"ResumeForm.phone",anchor:"100%"},{fieldLabel:"手机号码",name:"resume.mobile",id:"ResumeForm.mobile",anchor:"100%"}]}]}]},{xtype:"fieldset",title:"教育背景",defaultType:"textfield",layout:"form",items:[{fieldLabel:"毕业院校",name:"resume.eduCollege",id:"ResumeForm.eduCollege",anchor:"70%"},{fieldLabel:"学历",name:"resume.eduDegree",id:"ResumeForm.eduDegree",anchor:"50%",maxHeight:200,xtype:"combo",mode:"local",editable:true,triggerAction:"all",store:[],listeners:{focus:function(a){var b=Ext.getCmp("ResumeForm.eduDegree").getStore();if(b.getCount()<=0){Ext.Ajax.request({url:__ctxPath+"/system/loadDictionary.do",method:"post",params:{itemName:"学历"},success:function(g){var h=Ext.util.JSON.decode(g.responseText);b.loadData(h);}});}}}},{fieldLabel:"专业",name:"resume.eduMajor",id:"ResumeForm.eduMajor",anchor:"50%",maxHeight:200,xtype:"combo",mode:"local",editable:true,triggerAction:"all",store:[],listeners:{focus:function(a){var b=Ext.getCmp("ResumeForm.eduMajor").getStore();if(b.getCount()<=0){Ext.Ajax.request({url:__ctxPath+"/system/loadDictionary.do",method:"post",params:{itemName:"专业"},success:function(g){var h=Ext.util.JSON.decode(g.responseText);b.loadData(h);}});}}}}]},{xtype:"fieldset",title:"爱好",layout:"anchor",items:[{name:"resume.hobby",id:"ResumeForm.hobby",xtype:"textarea",anchor:"100%"}]},{xtype:"fieldset",title:"工作经历",layout:"anchor",items:[{name:"resume.workCase",id:"ResumeForm.workCase",xtype:"textarea",anchor:"100%"}]},{xtype:"fieldset",title:"培训经历",layout:"anchor",items:[{name:"resume.trainCase",id:"ResumeForm.trainCase",xtype:"textarea",anchor:"100%"}]},{xtype:"fieldset",title:"项目经验",layout:"anchor",items:[{name:"resume.projectCase",id:"ResumeForm.projectCase",xtype:"textarea",anchor:"100%"}]},{xtype:"fieldset",title:"备注",layout:"anchor",items:[{name:"resume.memo",id:"ResumeForm.memo",xtype:"textarea",anchor:"100%"}]},{xtype:"fieldset",title:"附件",layout:"column",items:[{columnWidth:0.8,layout:"form",items:[{xtype:"panel",id:"resumeFilePanel",height:50,border:false,autoScroll:true,html:""}]},{columnWidth:0.2,border:false,items:[{xtype:"button",text:"添加附件",iconCls:"menu-attachment",handler:function(){var a=App.createUploadDialog({file_cat:"hrm/resume",callback:function(b){var j=Ext.getCmp("resumefileIds");var h=Ext.getCmp("resumeFilePanel");for(var i=0;i<b.length;i++){if(j.getValue()!=""){j.setValue(j.getValue()+",");}j.setValue(j.getValue()+b[i].fileId);Ext.DomHelper.append(h.body,'<span><a href="#" onclick="FileAttachDetail.show('+b[i].fileId+')">'+b[i].fileName+'</a> <img class="img-delete" src="'+__ctxPath+'/images/system/delete.gif" onclick="removeResumeFile(this,'+b[i].fileId+')"/>&nbsp;|&nbsp;</span>');}}});a.show(this);}},{xtype:"button",text:"清除附件",iconCls:"reset",handler:function(){var a=Ext.getCmp("resumefileIds");var b=Ext.getCmp("resumeFilePanel");b.body.update("");a.setValue("");}},{xtype:"hidden",id:"resumefileIds",name:"fileIds"}]}]}]});if(this.resumeId!=null&&this.resumeId!="undefined"){d.getForm().load({url:__ctxPath+"/hrm/getResume.do?resumeId="+this.resumeId,waitMsg:"正在载入数据...",success:function(s,q){var o=Ext.util.JSON.decode(q.response.responseText).data[0];var t=o.photo;var i=o.resumeFiles;var r=o.startWorkDate;var a=o.birthday;if(r!=null){Ext.getCmp("ResumeForm.startWorkDate").setValue(new Date(getDateFromFormat(r,"yyyy-MM-dd HH:mm:ss")));}if(a!=null){Ext.getCmp("ResumeForm.birthday").setValue(new Date(getDateFromFormat(a,"yyyy-MM-dd HH:mm:ss")));}var n=Ext.getCmp("resumeFilePanel");var b=Ext.getCmp("resumefileIds");for(var p=0;p<i.length;p++){if(b.getValue()!=""){b.setValue(b.getValue()+",");}b.setValue(b.getValue()+i[p].fileId);Ext.DomHelper.append(n.body,'<span><a href="#" onclick="FileAttachDetail.show('+i[p].fileId+')">'+i[p].fileName+'</a><img class="img-delete" src="'+__ctxPath+'/images/system/delete.gif" onclick="removeResumeFile(this,'+i[p].fileId+')"/>&nbsp;|&nbsp;</span>');}if(t!=null&&t!=""){Ext.getCmp("ResumePhotoPanel").body.update('<img src="'+__ctxPath+"/attachFiles/"+t+'" width="88" height="120"/>');}},failure:function(b,a){}});}function c(b){var f=Ext.getCmp("ResumeForm.photo");var a=Ext.getCmp("ResumePhotoPanel");f.setValue(b[0].filePath);a.body.update('<img src="'+__ctxPath+"/attachFiles/"+b[0].filePath+'"  width="88" height="120"/>');}return d;};function removeResumeFile(h,g){var f=Ext.getCmp("resumefileIds");var i=f.getValue();if(i.indexOf(",")<0){f.setValue("");}else{i=i.replace(","+g,"").replace(g+",","");f.setValue(i);}var j=Ext.get(h.parentNode);j.remove();}