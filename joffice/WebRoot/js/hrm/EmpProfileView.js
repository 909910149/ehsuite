Ext.ns("EmpProfileView");EmpProfileView=Ext.extend(Ext.Panel,{constructor:function(b){if(b==null){b={};}Ext.apply(this,b);this.initComponents();EmpProfileView.superclass.constructor.call(this,{id:"EmpProfileView",title:"档案管理",iconCls:"menu-profile",region:"center",layout:"border",items:[this.searchPanel,this.gridPanel]});},typeId:null,searchPanel:null,gridPanel:null,store:null,topbar:null,initComponents:function(){this.searchPanel=new Ext.FormPanel({region:"north",height:40,frame:false,border:false,layout:"hbox",layoutConfig:{padding:"5",align:"middle"},defaults:{xtype:"label",margins:{top:0,right:4,bottom:4,left:4}},items:[{text:"查询条件：档案编号："},{name:"Q_profileNo_S_LK",width:80,xtype:"textfield"},{text:"员工姓名："},{name:"Q_fullname_S_LK",width:80,xtype:"textfield"},{text:"身份证号："},{width:80,name:"Q_idCard_S_LK",xtype:"textfield"},{text:"审核状态："},{hiddenName:"Q_approvalStatus_SN_EQ",width:110,xtype:"combo",editable:false,mode:"local",triggerAction:"all",store:[["","　"],["0","未审核"],["1","审核通过"],["2","审核未通过"]]},{xtype:"button",text:"查询",iconCls:"search",handler:this.search.createCallback(this)},{name:"Q_delFlag_SN_EQ",width:80,xtype:"hidden",value:0}]});this.store=new Ext.data.JsonStore({url:__ctxPath+"/hrm/listEmpProfile.do",baseParams:{"Q_delFlag_SN_EQ":0},root:"result",totalProperty:"totalCounts",remoteSort:true,fields:[{name:"profileId",type:"int"},"profileNo","fullname","designation","creator","createtime","approvalStatus","memo","depName"]});this.store.setDefaultSort("profileId","desc");this.store.load({params:{start:0,limit:25}});var c=new Ext.grid.CheckboxSelectionModel();var d=new Ext.grid.ColumnModel({columns:[c,new Ext.grid.RowNumberer(),{header:"profileId",dataIndex:"profileId",hidden:true},{header:"档案编号",dataIndex:"profileNo"},{header:"员工姓名",dataIndex:"fullname"},{header:"建档人",dataIndex:"creator"},{header:"建档时间",dataIndex:"createtime",renderer:function(a){return a.substring(0,10);}},{header:"部门或公司",dataIndex:"depName"},{header:"职称",dataIndex:"designation"},{header:"审核状态",dataIndex:"approvalStatus",renderer:function(a){if(a=="0"){return"未审核";}else{if(a=="1"){return'<img title="通过审核" src="'+__ctxPath+'/images/flag/customer/effective.png"/>';}else{return'<img title="没通过审核" src="'+__ctxPath+'/images/flag/customer/invalid.png"/>';}}}},{header:"管理",dataIndex:"profileId",width:100,sortable:false,renderer:function(l,m,o,a,n){var b=o.data.profileId;var p=o.data.approvalStatus;var k="";if(isGranted("_EmpProfileDel")){k+='<button title="删除" value=" " class="btn-del" onclick="EmpProfileView.remove('+b+')">&nbsp;&nbsp;</button>';}if(isGranted("_EmpProfileEdit")&&p!=1){k+='<button title="编辑" value=" " class="btn-edit" onclick="EmpProfileView.edit('+b+')">&nbsp;&nbsp;</button>';}if(p!=1&&p!=2){if(isGranted("_EmpProfileCheck")){k+='<button title="审核" value=" " class="btn-empProfile-check" onclick="EmpProfileView.check('+b+')">&nbsp;&nbsp;</button>';}}else{if(isGranted("_EmpProfileQuery")){k+='<button title="查看" value=" " class="btn-readdocument" onclick="EmpProfileView.look('+b+')">&nbsp;&nbsp;</button>';}}if(isGranted("_EmpProfileQuery")){k+='<button title="查看操作记录" value=" " class="btn-operation" onclick="EmpProfileView.operation('+b+')">&nbsp;&nbsp;</button>';}return k;}}],defaults:{sortable:true,menuDisabled:false,width:100}});this.topbar=new Ext.Toolbar({height:30,bodyStyle:"text-align:left",items:[]});if(isGranted("_EmpProfileAdd")){this.topbar.add(new Ext.Button({iconCls:"btn-add",text:"添加档案",handler:this.createRecord}));}if(isGranted("_EmpProfileDel")){this.topbar.add(new Ext.Button({iconCls:"btn-del",text:"删除档案",handler:this.delRecords,scope:this}));}if(isGranted("_EmpProfileRec")){this.topbar.add(new Ext.Button({iconCls:"btn-empProfile-recovery",text:"恢复档案",handler:this.recovery}));}this.gridPanel=new Ext.grid.GridPanel({id:"EmpProfileGrid",region:"center",stripeRows:true,tbar:this.topbar,store:this.store,trackMouseOver:true,disableSelection:false,loadMask:true,cm:d,sm:c,plugins:this.rowActions,viewConfig:{forceFit:true,autoFill:true,forceFit:true},bbar:new HT.PagingBar({store:this.store})});this.gridPanel.addListener("rowdblclick",function(b,e,a){b.getSelectionModel().each(function(h){if(isGranted("_EmpProfileEdit")){var f=h.data.profileId;if(h.data.approvalStatus==0){EmpProfileView.edit(f);}else{EmpProfileView.look(f);}}});});},search:function(b){if(b.searchPanel.getForm().isValid()){$search({searchPanel:b.searchPanel,gridPanel:b.gridPanel});}},createRecord:function(){var c=Ext.getCmp("centerTabPanel");var d=Ext.getCmp("EmpProfileForm");if(d!=null){c.remove("EmpProfileForm");}d=new EmpProfileForm();c.add(d);c.activate(d);},delRecords:function(f){var i=Ext.getCmp("EmpProfileGrid");var g=i.getSelectionModel().getSelections();if(g.length==0){Ext.ux.Toast.msg("信息","请选择要删除的记录！");return;}var h=Array();for(var j=0;j<g.length;j++){h.push(g[j].data.profileId);}EmpProfileView.remove(h);},recovery:function(b){new RecoveryProfileWin().show();}});EmpProfileView.remove=function(c){var d=Ext.getCmp("EmpProfileGrid");Ext.Msg.confirm("信息确认","您确认要删除该记录吗？",function(a){if(a=="yes"){Ext.Ajax.request({url:__ctxPath+"/hrm/multiDelEmpProfile.do",params:{ids:c},method:"POST",success:function(f,b){Ext.ux.Toast.msg("操作信息","成功删除该记录！");d.getStore().reload();},failure:function(f,b){Ext.ux.Toast.msg("操作信息","操作出错，请联系管理员！");}});}});};EmpProfileView.edit=function(f){var e=Ext.getCmp("centerTabPanel");var d=Ext.getCmp("EmpProfileForm");if(d==null){d=new EmpProfileForm({profileId:f});e.add(d);}else{e.remove("EmpProfileForm");d=new EmpProfileForm({profileId:f});e.add(d);}e.activate(d);};EmpProfileView.check=function(b){new CheckEmpProfileForm({profileId:b}).show();};EmpProfileView.look=function(c){var d=new CheckEmpProfileForm({profileId:c}).show();d.setTitle("档案详细信息");d.remove("CheckEmpProfileForm");Ext.getCmp("CheckEmpProfileButY").hide();Ext.getCmp("CheckEmpProfileButN").hide();};EmpProfileView.operation=function(c){var d=new Ext.Window({id:"EmpProfileViewOperationWin",title:"标准操作纪录",iconCls:"btn-operation",width:500,x:300,y:50,autoHeight:true,border:false,modal:true,layout:"anchor",plain:true,bodyStyle:"padding:5px;",buttonAlign:"center",items:[new Ext.Panel({autoScroll:true,autoHeight:true,border:false,autoLoad:{url:__ctxPath+"/pages/hrm/empProfileOperation.jsp?profileId="+c}})],buttons:[{text:"关闭",iconCls:"btn-cancel",handler:function(){d.close();}}]});d.show();};