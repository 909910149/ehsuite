Ext.ns("JobChangeView");JobChangeView=Ext.extend(Ext.Panel,{constructor:function(b){if(b==null){b={};}Ext.apply(this,b);this.initComponents();JobChangeView.superclass.constructor.call(this,{id:"JobChangeView",title:"职位调动管理",region:"center",iconCls:"menu-jobchange",layout:"border",items:[this.searchPanel,this.gridPanel]});},typeId:null,searchPanel:null,gridPanel:null,store:null,topbar:null,initComponents:function(){this.searchPanel=new Ext.FormPanel({region:"north",height:40,frame:false,border:false,layout:"hbox",layoutConfig:{padding:"5",align:"middle"},defaults:{xtype:"label",margins:{top:0,right:4,bottom:4,left:4}},items:[{text:"查询条件：档案编号："},{width:100,name:"Q_profileNo_S_LK",xtype:"textfield"},{text:"姓名："},{width:100,name:"Q_userName_S_LK",xtype:"textfield"},{text:"原职位："},{width:100,name:"Q_orgJobName_S_LK",xtype:"textfield"},{text:"新职位："},{width:100,name:"Q_newJobName_S_LK",xtype:"textfield"},{xtype:"button",text:"查询",iconCls:"search",handler:this.search.createCallback(this)}]});this.store=new Ext.data.JsonStore({url:__ctxPath+"/hrm/listJobChange.do",root:"result",totalProperty:"totalCounts",remoteSort:true,fields:[{name:"changeId",type:"int"},"profileId","profileNo","userName","orgJobId","orgJobName","newJobId","newJobName","orgStandardNo","orgStandardName","orgDepId","orgDepName","orgTotalMoney","newStandardNo","newStandardName","newDepId","newDepName","newTotalMoney","changeReason","regName","regTime","checkName","checkTime","checkOpinion","status","memo"]});this.store.setDefaultSort("changeId","desc");this.store.load({params:{start:0,limit:25}});var c=new Ext.grid.CheckboxSelectionModel();var d=new Ext.grid.ColumnModel({columns:[c,new Ext.grid.RowNumberer(),{header:"changeId",dataIndex:"changeId",hidden:true},{header:"档案编号",dataIndex:"profileNo"},{header:"姓名",dataIndex:"userName"},{header:"原职位名称",dataIndex:"orgJobName"},{header:"新职位名称",dataIndex:"newJobName"},{header:"原部门名称",dataIndex:"orgDepName"},{header:"新部门名称",dataIndex:"newDepName"},{header:"登记人",dataIndex:"regName"},{header:"登记时间",dataIndex:"regTime"},{header:"状态",dataIndex:"status",renderer:function(a){if(a==-1){return'<font color="red">草稿</font>';}else{if(a==1){return'<img title="通过审核" src="'+__ctxPath+'/images/flag/customer/effective.png"/>';}else{if(a==2){return'<img title="没通过审核" src="'+__ctxPath+'/images/flag/customer/invalid.png"/>';}else{return'<font color="green">提交审核</font>';}}}}},{header:"管理",dataIndex:"profileId",width:100,sortable:false,renderer:function(l,m,o,a,n){var b=o.data.changeId;var p=o.data.status;var k="";if(isGranted("_JobChangeDel")){k+='<button title="删除" value=" " class="btn-del" onclick="JobChangeView.remove('+b+')">&nbsp;&nbsp;</button>';}if(p!=1&&p!=2){if(isGranted("_JobChangeEdit")){k+='<button title="编辑" value=" " class="btn-edit" onclick="JobChangeView.edit('+b+')">&nbsp;&nbsp;</button>';}if(p!=-1){if(isGranted("_JobChangeCheck")){k+='<button title="审核" value=" " class="btn-empProfile-check" onclick="JobChangeView.check('+b+')">&nbsp;&nbsp;</button>';}}}else{if(isGranted("_JobChangeQuery")){k+='<button title="查看" value=" " class="btn-readdocument" onclick="JobChangeView.look('+b+')">&nbsp;&nbsp;</button>';}}if(isGranted("_JobChangeQuery")){k+='<button title="查看操作记录" value=" " class="btn-operation" onclick="JobChangeView.operation('+b+')">&nbsp;&nbsp;</button>';}return k;}}],defaults:{sortable:true,menuDisabled:false,width:100}});this.topbar=new Ext.Toolbar({height:30,bodyStyle:"text-align:left",items:[]});if(isGranted("_JobChangeAdd")){this.topbar.add(new Ext.Button({iconCls:"btn-add",text:"登记",handler:this.createRecord}));}if(isGranted("_JobChangeDel")){this.topbar.add(new Ext.Button({iconCls:"btn-del",text:"删除",handler:this.delRecords,scope:this}));}this.gridPanel=new Ext.grid.GridPanel({id:"JobChangeGrid",region:"center",stripeRows:true,tbar:this.topbar,store:this.store,trackMouseOver:true,disableSelection:false,loadMask:true,cm:d,sm:c,plugins:this.rowActions,viewConfig:{forceFit:true,autoFill:true,forceFit:true},bbar:new HT.PagingBar({store:this.store})});this.gridPanel.addListener("rowdblclick",function(b,e,a){b.getSelectionModel().each(function(k){var f=k.data.changeId;var n=k.data.status;if(n!=1&&n!=2){if(isGranted("_JobChangeEdit")){var l=Ext.getCmp("centerTabPanel");var m=Ext.getCmp("JobChangeForm");if(m!=null){l.remove("JobChangeForm");}m=new JobChangeForm({changeId:f});l.add(m);l.activate(m);}}else{JobChangeView.look(f);}});});},search:function(b){if(b.searchPanel.getForm().isValid()){$search({searchPanel:b.searchPanel,gridPanel:b.gridPanel});}},createRecord:function(){var c=Ext.getCmp("centerTabPanel");var d=Ext.getCmp("JobChangeForm");if(d!=null){c.remove("JobChangeForm");}d=new JobChangeForm();c.add(d);c.activate(d);},delRecords:function(){var h=Ext.getCmp("JobChangeGrid");var f=h.getSelectionModel().getSelections();if(f.length==0){Ext.ux.Toast.msg("信息","请选择要删除的记录！");return;}var g=Array();for(var e=0;e<f.length;e++){g.push(f[e].data.changeId);}JobChangeView.remove(g);}});JobChangeView.edit=function(f){var d=Ext.getCmp("centerTabPanel");var e=Ext.getCmp("JobChangeForm");if(e!=null){d.remove("JobChangeForm");}e=new JobChangeForm({changeId:f});d.add(e);d.activate(e);};JobChangeView.remove=function(b){Ext.Msg.confirm("信息确认","您确认要删除所选记录吗？",function(a){if(a=="yes"){Ext.Ajax.request({url:__ctxPath+"/hrm/multiDelJobChange.do",params:{ids:b},method:"POST",success:function(f,e){Ext.ux.Toast.msg("操作信息","成功删除记录！");Ext.getCmp("JobChangeGrid").getStore().reload();},failure:function(f,e){Ext.ux.Toast.msg("操作信息","操作出错，请联系管理员！");}});}});};JobChangeView.check=function(b){new CheckJobChangeWin({changeId:b}).show();};JobChangeView.operation=function(c){var d=new Ext.Window({id:"JobChangeViewOperationWin",title:"职位调动操作纪录",iconCls:"btn-operation",width:500,x:300,y:50,autoHeight:true,border:false,modal:true,layout:"anchor",plain:true,bodyStyle:"padding:5px;",buttonAlign:"center",items:[new Ext.Panel({autoScroll:true,autoHeight:true,border:false,autoLoad:{url:__ctxPath+"/pages/hrm/jobChangeOperation.jsp?changeId="+c}})],buttons:[{text:"关闭",iconCls:"btn-cancel",handler:function(){d.close();}}]});d.show();};JobChangeView.look=function(c){var d=new CheckJobChangeWin({changeId:c}).show();d.setTitle("职位调换详细信息");Ext.getCmp("CheckJobChangePanel").setHeight(280);d.remove("CheckJobChangeWin");Ext.getCmp("JobChangeBtnY").hide();Ext.getCmp("JobChangeBtnN").hide();};