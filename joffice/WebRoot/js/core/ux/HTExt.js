Ext.ns("HT");Ext.ns("HT.ux.plugins");function $getGdSelectedIds(grid,idName){var selRs=grid.getSelectionModel().getSelections();var ids=Array();for(var i=0;i<selRs.length;i++){ids.push(eval("selRs[i].data."+idName));}return ids;}function $postDel(b){Ext.Msg.confirm("信息确认","您确认要删除所选记录吗？",function(a){if(a=="yes"){Ext.Ajax.request({url:b.url,params:{ids:b.ids},method:"POST",success:function(f,e){Ext.ux.Toast.msg("操作信息","成功删除该记录！");if(b.callback){b.callback.call(this);return;}if(b.grid){b.grid.getStore().reload();}},failure:function(f,e){Ext.ux.Toast.msg("操作信息","操作出错，请联系管理员！");}});}});}function $postForm(d){if(d.formPanel.getForm().isValid()){var c=d.scope?d.scope:this;d.formPanel.getForm().submit({scope:c,url:d.url,method:"post",params:d.params,waitMsg:"正在提交数据...",success:function(b,a){Ext.ux.Toast.msg("操作信息","成功信息保存！");if(d.callback){d.callback.call(c,b,a);}},failure:function(b,a){Ext.MessageBox.show({title:"操作信息",msg:"信息保存出错，请联系管理员！",buttons:Ext.MessageBox.OK,icon:"ext-mb-error"});if(d.callback){d.callback.call(c);}}});}}function $delGridRs(e){var d=$getGdSelectedIds(e.grid,e.idName);if(d.length==0){Ext.ux.Toast.msg("操作信息","请选择要删除的记录！");return;}var f={url:e.url,ids:d,grid:e.grid};$postDel(f);}function $search(k){var h=k.searchPanel;var j=k.gridPanel;if(h.getForm().isValid()){var g=j.getStore();var i=Ext.Ajax.serializeForm(h.getForm().getEl());var l=Ext.urlDecode(i);l.start=0;l.limit=g.baseParams.limit;g.baseParams=l;j.getBottomToolbar().moveFirst();}}HT.SearchPanel=Ext.extend(Ext.form.FormPanel,{constructor:function(m){var n=m.colNums?m.colNums:1;Ext.apply(this,m);if(n>1&&m.items){this.items=[];var i=null;var l=0;for(var o=0;o<m.items.length;o++){var k=m.items[o];if(k.xtype!="hidden"){if(l%n==0){i={xtype:"compositefield",fieldLabel:k.fieldLabel,items:[]};this.items.push(i);}else{var r=":";if(this.superclass.labelSeparator){r=this.superclass.labelSeparator;}var p=100;if(this.labelWidth){p=this.labelWidth;}if(k.labelWidth){p=k.labelWidth;}var q="text-align:left";if("right"==this.labelAlign){q="text-align:right";}if(k.fieldLabel){i.items.push({xtype:"label",width:p,style:q,text:k.fieldLabel+r});}}k.style="margin:0 0 0 0";i.items.push(k);l++;}else{this.items.push(k);}}}HT.SearchPanel.superclass.constructor.call(this,{autoHeight:true,border:false,style:"padding:6px;background-color: white",buttonAlign:"center"});}});DicCombo=Ext.extend(Ext.form.ComboBox,{constructor:function(e){Ext.apply(this,e);var f=this.itemName;var d=this.isDisplayItemName;DicCombo.superclass.constructor.call(this,{triggerAction:"all",store:new Ext.data.ArrayStore({autoLoad:true,baseParams:{itemName:f},url:__ctxPath+"/system/loadItemDictionary.do",fields:["itemId","itemName"]}),displayField:"itemName",valueField:d?"itemName":"itemId"});}});Ext.reg("diccombo",DicCombo);HT.ux.plugins.Export=Ext.extend(Object,{constructor:function(b){Ext.apply(this,b);HT.ux.plugins.Export.superclass.constructor.call(this,b);},init:function(c){var d=new Ext.SplitButton({text:"导出",iconCls:"btn-export",menu:new Ext.menu.Menu({items:[{text:"导出当前页EXCEL",iconCls:"btn-export-excel",handler:function(){}},{text:"导出全部记录EXCEL",iconCls:"btn-export-excel",handler:function(){}},"-",{text:"导出当前页PDF",iconCls:"btn-export-pdf",handler:function(){}},{text:"导出全部记录PDF",iconCls:"btn-export-pdf",handler:function(){}}]})});c.add("->");c.add("-");c.add(d);c.add("-");c.on({beforedestroy:function(){d.destroy();}});}});HT.PagingBar=Ext.extend(Ext.PagingToolbar,{constructor:function(c){var d={pageSize:c.store.baseParams.limit?c.store.baseParams.limit:25,displayInfo:true,displayMsg:"当前显示从{0}至{1}， 共{2}条记录",emptyMsg:"当前没有记录",plugins:[new Ext.ux.plugins.PageComboResizer()]};Ext.apply(d,c);HT.PagingBar.superclass.constructor.call(this,d);}});HT.JsonStore=Ext.extend(Ext.data.JsonStore,{constructor:function(e){var f=e.baseParams?e.baseParams:{};f.start=0;f.limit=25;var d={baseParams:f,root:"result",totalProperty:"totalCounts",remoteSort:true};Ext.applyIf(d,e);HT.JsonStore.superclass.constructor.call(this,d);}});HT.initGridConfig=function(e){if(!e.store){e.store=new HT.JsonStore({url:e.url,fields:e.fields,baseParams:e.baseParams});if(e.url){e.store.load();}}e.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:e.singleSelect?e.singleSelect:false});if(e.columns){e.columns.unshift(e.sm);e.columns.unshift(new Ext.grid.RowNumberer());}else{e.columns=[e.sm,new Ext.grid.RowNumberer()];}if(!e.tbar&&e.isShowTbar!=false){e.tbar=new Ext.Toolbar();}if(e.addTool){e.tbar.add(new Ext.Button({text:"添加记录",iconCls:"btn-add",scope:this,handler:function(){var a=e.store.recordType;e.store.add(new a());}}));}this.cm=new Ext.grid.ColumnModel({columns:this.columns,defaults:{sortable:true,menuDisabled:false,width:100}});e.plugins=[];if(e.rowActions){var f=e.columns[e.columns.length-1];e.plugins.push(f);}var d={shim:true,trackMouseOver:true,disableSelection:false,loadMask:true,stripeRows:true,viewConfig:{forceFit:true,enableRowBody:false,showPreview:false},bbar:(e.showPaging==null||e.showPaging)?new HT.PagingBar({store:e.store}):null};Ext.apply(d,e);return d;};HT.GridPanel=Ext.extend(Ext.grid.GridPanel,{constructor:function(d){var c=HT.initGridConfig(d);HT.GridPanel.superclass.constructor.call(this,c);}});HT.EditorGridPanel=Ext.extend(Ext.grid.EditorGridPanel,{constructor:function(d){var c=HT.initGridConfig(d);HT.GridPanel.superclass.constructor.call(this,c);}});Ext.reg("htgrid",HT.GridPanel);Ext.reg("hteditorgrid",HT.EditorGridPanel);HT.FormPanel=Ext.extend(Ext.form.FormPanel,{constructor:function(d){var c={layout:"form",bodyStyle:"padding:5px",defaults:{anchor:"100%,100%"},defaultType:"textfield",border:false};Ext.apply(c,d);HT.FormPanel.superclass.constructor.call(this,c);}});Ext.override(Ext.Panel,{loadData:function(conf){if(!conf.root){conf.root="data";}var ct=this;var setByName=function(container,data){var items=container.items;if(items!=null&&items!=undefined&&items.getCount){for(var i=0;i<items.getCount();i++){var comp=items.get(i);if(comp.items){setByName(comp,data);continue;}var xtype=comp.getXType();try{if(xtype=="textfield"||xtype=="textarea"||xtype=="radio"||xtype=="checkbox"||xtype=="datefield"||xtype=="combo"||xtype=="hidden"||xtype=="datetimefield"||xtype=="htmleditor"||xtype=="displayfield"||xtype=="diccombo"||xtype=="fckeditor"||xtype=="numberfield"){var name=comp.getName();if(name){if(conf.preName){if(name.indexOf(conf.preName)!=-1){name=name.substring(conf.preName.length+1);}}var val=eval(conf.root+"."+name);if(val!=null&&val!=undefined){comp.setValue(val);}}}}catch(e){}}}};if(!ct.loadMask){ct.loadMask=new Ext.LoadMask(Ext.getBody());ct.loadMask.show();}var scope=conf.scope?conf.scope:ct;var params=conf.params?conf.params:{};Ext.Ajax.request({method:"POST",url:conf.url,scope:scope,params:params,success:function(response,options){var json=Ext.util.JSON.decode(response.responseText);var data=null;if(conf.root){data=eval("json."+conf.root);}else{data=json;}setByName(ct,data);if(ct.loadMask){ct.loadMask.hide();ct.loadMask=null;}if(conf.success){conf.success.call(scope,response,options);}},failure:function(response,options){if(ct.loadMask){ct.loadMask.hide();ct.loadMask=null;}if(conf.failure){conf.failure.call(scope,response,options);}}});}});Ext.form.TextField.prototype.size=20;Ext.form.TextField.prototype.initValue=function(){if(this.value!==undefined){this.setValue(this.value);}else{if(this.el.dom.value.length>0){this.setValue(this.el.dom.value);}}this.el.dom.size=this.size;if(!isNaN(this.maxLength)&&(this.maxLength*1)>0&&(this.maxLength!=Number.MAX_VALUE)){this.el.dom.maxLength=this.maxLength*1;}};Ext.override(Ext.Container,{getCmpByName:function(c){var d=function(l,i){var j=l.items;if(j&&j.getCount!=undefined){for(var b=0;b<j.getCount();b++){var k=j.get(b);if(i==k.name||(k.getName&&i==k.getName())){return k;break;}var a=d(k,i);if(a!=null){return a;}}}return null;};return d(this,c);},onResize:function(g,e,f,h){Ext.Container.superclass.onResize.apply(this,arguments);if((this.rendered&&this.layout&&this.layout.monitorResize)&&!this.suspendLayoutResize){this.layout.onResize();}},canLayout:function(){var b=this.getVisibilityEl();return b&&!b.isStyle("display","none");},doLayout:function(n,o){var k=this.rendered,l=o||this.forceLayout,p,c,i,m;if(!this.canLayout()||this.collapsed){this.deferLayout=this.deferLayout||!n;if(!l){return;}n=n&&!this.deferLayout;}else{delete this.deferLayout;}p=(n!==true&&this.items)?this.items.items:[];for(c=0,i=p.length;c<i;c++){if((m=p[c]).layout){m.suspendLayoutResize=true;}}if(k&&this.layout){this.layout.layout();}for(c=0;c<i;c++){if((m=p[c]).doLayout){m.doLayout(false,l);}}if(k){this.onLayout(n,l);}this.hasLayout=true;delete this.forceLayout;for(c=0;c<i;c++){if((m=p[c]).layout){delete m.suspendLayoutResize;}}}});Ext.override(Ext.layout.ContainerLayout,{setContainer:function(b){this.container=b;}});Ext.override(Ext.BoxComponent,{setSize:function(g,k){if(typeof g=="object"){k=g.height,g=g.width;}if(Ext.isDefined(g)&&Ext.isDefined(this.minWidth)&&(g<this.minWidth)){g=this.minWidth;}if(Ext.isDefined(k)&&Ext.isDefined(this.minHeight)&&(k<this.minHeight)){k=this.minHeight;}if(Ext.isDefined(g)&&Ext.isDefined(this.maxWidth)&&(g>this.maxWidth)){g=this.maxWidth;}if(Ext.isDefined(k)&&Ext.isDefined(this.maxHeight)&&(k>this.maxHeight)){k=this.maxHeight;}if(!this.boxReady){this.width=g,this.height=k;return this;}if(this.cacheSizes!==false&&this.lastSize&&this.lastSize.width==g&&this.lastSize.height==k){return this;}this.lastSize={width:g,height:k};var l=this.adjustSize(g,k),i=l.width,h=l.height,j;if(i!==undefined||h!==undefined){j=this.getResizeEl();if(j!=null){if(!this.deferHeight&&i!==undefined&&h!==undefined){j.setSize(i,h);}else{if(!this.deferHeight&&h!==undefined){j.setHeight(h);}else{if(i!==undefined){j.setWidth(i);}}}}this.onResize(i,h,g,k);}return this;},onResize:function(g,e,f,h){this.fireEvent("resize",this,g,e,f,h);}});Ext.override(Ext.Panel,{onResize:Ext.Panel.prototype.onResize.createSequence(Ext.Container.prototype.onResize)});Ext.override(Ext.Viewport,{fireResize:function(d,c){this.onResize(d,c,d,c);}});HT.ComboBox=Ext.extend(Ext.form.ComboBox,{constructor:function(b){Ext.apply(this,b);HT.ComboBox.superclass.constructor.call(this);}});Ext.reg("htcombo",HT.ComboBox);setFormValues=function(s,l){var r=s.elements||(document.forms[s]||Ext.getDom(s)).elements,m=encodeURIComponent,o,k,t,q,p="",n;Ext.each(r,function(a){t=a.name;n=a.type;if(!a.disabled&&t){if(/select-(one|multiple)/i.test(n)){Ext.each(a.options,function(b){if(b.value==l[t]){b.selected=true;}});}else{if(!/file|undefined|reset|button/i.test(n)){if(!(/radio|checkbox/i.test(n)&&!a.checked)&&!(n=="submit")){a.value=l[t];}}}}});};Ext.override(Ext.util.JSON,{encode:function(){},encodeDate:function(b){return'"'+b.getFullYear()+"-"+pad(b.getMonth()+1)+"-"+pad(b.getDate())+" "+pad(b.getHours())+":"+pad(b.getMinutes())+":"+pad(b.getSeconds())+'"';}});HT.JSON=new (function(){var l=!!{}.hasOwnProperty,n=function(){var a=null;return function(){if(a===null){a=Ext.USE_NATIVE_JSON&&window.JSON&&JSON.toString()=="[object JSON]";}return a;};}(),k=function(a){return a<10?"0"+a:a;},m=function(a){if(!Ext.isDefined(a)||a===null){return"null";}else{if(Ext.isArray(a)){return j(a);}else{if(Ext.isDate(a)){return HT.JSON.encodeDate(a);}else{if(Ext.isString(a)){return h(a);}else{if(typeof a=="number"){return isFinite(a)?String(a):"null";}else{if(Ext.isBoolean(a)){return String(a);}else{var d=["{"],e,b,c;for(b in a){if(!a.getElementsByTagName){if(!l||a.hasOwnProperty(b)){c=a[b];switch(typeof c){case"undefined":case"function":case"unknown":break;default:if(e){d.push(",");}d.push(m(b),":",c===null?"null":m(c));e=true;}}}}d.push("}");return d.join("");}}}}}}},i={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},h=function(a){if(/["\\\x00-\x1f]/.test(a)){return'"'+a.replace(/([\x00-\x1f\\"])/g,function(c,d){var b=i[d];if(b){return b;}b=d.charCodeAt();return"\\u00"+Math.floor(b/16).toString(16)+(b%16).toString(16);})+'"';}return'"'+a+'"';},j=function(e){var b=["["],d,f,c=e.length,a;for(f=0;f<c;f+=1){a=e[f];switch(typeof a){case"undefined":case"function":case"unknown":break;default:if(d){b.push(",");}b.push(a===null?"null":HT.JSON.encode(a));d=true;}}b.push("]");return b.join("");};this.encodeDate=function(a){return'"'+a.getFullYear()+"-"+k(a.getMonth()+1)+"-"+k(a.getDate())+" "+k(a.getHours())+":"+k(a.getMinutes())+":"+k(a.getSeconds())+'"';};this.encode=function(){var a;return function(b){if(!a){a=n()?JSON.stringify:m;}return a(b);};}();})();HT.encode=HT.JSON.encode;Ext.useShims=true;