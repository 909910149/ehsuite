var Base64=(function(){var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function c(h){h=h.replace(/\r\n/g,"\n");var i="";for(var a=0;a<h.length;a++){var b=h.charCodeAt(a);if(b<128){i+=String.fromCharCode(b);}else{if((b>127)&&(b<2048)){i+=String.fromCharCode((b>>6)|192);i+=String.fromCharCode((b&63)|128);}else{i+=String.fromCharCode((b>>12)|224);i+=String.fromCharCode(((b>>6)&63)|128);i+=String.fromCharCode((b&63)|128);}}}return i;}return{encode:function(r){var t="";var a,i,o,b,n,p,q;var s=0;r=c(r);while(s<r.length){a=r.charCodeAt(s++);i=r.charCodeAt(s++);o=r.charCodeAt(s++);b=a>>2;n=((a&3)<<4)|(i>>4);p=((i&15)<<2)|(o>>6);q=o&63;if(isNaN(i)){p=q=64;}else{if(isNaN(o)){q=64;}}t=t+d.charAt(b)+d.charAt(n)+d.charAt(p)+d.charAt(q);}return t;}};})();Ext.ux.Exporter=function(){return{exportGrid:function(h,e,f){f=f||{};e=e||new Ext.ux.Exporter.ExcelFormatter();var g=[];Ext.each(h.getColumnModel().config,function(a){if(a.hidden!=true&&a.header!="管理"&&a.id!="numberer"&&a.id!="checker"){g.push(a);}});Ext.applyIf(f,{title:h.title,columns:g});return Base64.encode(e.format(h.store,f));},exportStore:function(e,f,d){d=d||{};f=f||new Ext.ux.Exporter.ExcelFormatter();Ext.applyIf(d,{columns:d.store.fields.items});return Base64.encode(f.format(e,d));},exportTree:function(f,g,h){h=h||{};g=g||new Ext.ux.Exporter.ExcelFormatter();var e=f.store||h.store;Ext.applyIf(h,{title:f.title});return Base64.encode(g.format(e,h));}};}();Ext.ux.Exporter.Button=Ext.extend(Ext.Button,{constructor:function(c){c=c||{iconCls:"btn-print"};Ext.applyIf(c,{exportFunction:"exportGrid",disabled:true,cls:"excel-cls",text:"导出"});if(c.store==undefined&&c.component!=undefined){Ext.applyIf(c,{store:c.component.store});}else{Ext.applyIf(c,{component:{store:c.store}});}Ext.ux.Exporter.Button.superclass.constructor.call(this,c);if(this.store&&Ext.isFunction(this.store.on)){var d=function(){this.getEl().child("a",true).href="data:application/vnd.ms-excel;base64,"+Ext.ux.Exporter[c.exportFunction](this.component,null,c);this.enable();};if(this.el){d.call(this);}else{this.on("render",d,this);}this.store.on("load",d,this);}},template:new Ext.Template('<table border="0" cellpadding="0" cellspacing="0" class="x-btn-wrap"><tbody><tr>','<td class="x-btn-left"><i> </i></td><td class="x-btn-center"><a class="x-btn-text" href="{1}" target="{2}">{0}</a></td><td class="x-btn-right"><i> </i></td>',"</tr></tbody></table>"),onRender:function(j,g){var f,h=[this.text||" ",this.href,this.target||"_self"];if(g){f=this.template.insertBefore(g,h,true);}else{f=this.template.append(j,h,true);}var i=f.child("a:first");i.on("focus",this.onFocus,this);i.on("blur",this.onBlur,this);this.initButtonEl(f,i);Ext.ButtonToggleMgr.register(this);},onClick:function(b){if(b.button!=0){return;}if(!this.disabled){this.fireEvent("click",this,b);if(this.handler){this.handler.call(this.scope||this,this,b);}}}});Ext.reg("exportbutton",Ext.ux.Exporter.Button);Ext.ux.Exporter.Formatter=function(b){b=b||{};Ext.applyIf(b,{});};Ext.ux.Exporter.Formatter.prototype={format:Ext.emptyFn};Ext.ux.Exporter.ExcelFormatter=Ext.extend(Ext.ux.Exporter.Formatter,{format:function(d,f){var e=new Ext.ux.Exporter.ExcelFormatter.Workbook(f);e.addWorksheet(d,f||{});return e.render();}});Ext.ux.Exporter.ExcelFormatter.Workbook=Ext.extend(Object,{constructor:function(b){b=b||{};Ext.apply(this,b,{title:"Workbook",worksheets:[],compiledWorksheets:[],cellBorderColor:"#e4e4e4",styles:[],compiledStyles:[],hasDefaultStyle:true,hasStripeStyles:true,windowHeight:9000,windowWidth:50000,protectStructure:false,protectWindows:false});if(this.hasDefaultStyle){this.addDefaultStyle();}if(this.hasStripeStyles){this.addStripedStyles();}this.addTitleStyle();this.addHeaderStyle();},render:function(){this.compileStyles();this.joinedCompiledStyles=this.compiledStyles.join("");this.compileWorksheets();this.joinedWorksheets=this.compiledWorksheets.join("");return this.tpl.apply(this);},addWorksheet:function(e,d){var f=new Ext.ux.Exporter.ExcelFormatter.Worksheet(e,d);this.worksheets.push(f);return f;},addStyle:function(d){var c=new Ext.ux.Exporter.ExcelFormatter.Style(d||{});this.styles.push(c);return c;},compileStyles:function(){this.compiledStyles=[];Ext.each(this.styles,function(b){this.compiledStyles.push(b.render());},this);return this.compiledStyles;},compileWorksheets:function(){this.compiledWorksheets=[];Ext.each(this.worksheets,function(b){this.compiledWorksheets.push(b.render());},this);return this.compiledWorksheets;},tpl:new Ext.XTemplate('<?xml version="1.0" encoding="utf-8"?>','<ss:Workbook xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns:o="urn:schemas-microsoft-com:office:office">',"<o:DocumentProperties>","<o:Title>{title}</o:Title>","</o:DocumentProperties>","<ss:ExcelWorkbook>","<ss:WindowHeight>{windowHeight}</ss:WindowHeight>","<ss:WindowWidth>{windowWidth}</ss:WindowWidth>","<ss:ProtectStructure>{protectStructure}</ss:ProtectStructure>","<ss:ProtectWindows>{protectWindows}</ss:ProtectWindows>","</ss:ExcelWorkbook>","<ss:Styles>","{joinedCompiledStyles}","</ss:Styles>","{joinedWorksheets}","</ss:Workbook>"),addDefaultStyle:function(){var b=[{name:"Color",value:this.cellBorderColor},{name:"Weight",value:"1"},{name:"LineStyle",value:"Continuous"}];this.addStyle({id:"Default",attributes:[{name:"Alignment",properties:[{name:"Vertical",value:"Top"},{name:"WrapText",value:"1"}]},{name:"Font",properties:[{name:"FontName",value:"arial"},{name:"Size",value:"10"}]},{name:"Interior"},{name:"NumberFormat"},{name:"Protection"},{name:"Borders",children:[{name:"Border",properties:[{name:"Position",value:"Top"}].concat(b)},{name:"Border",properties:[{name:"Position",value:"Bottom"}].concat(b)},{name:"Border",properties:[{name:"Position",value:"Left"}].concat(b)},{name:"Border",properties:[{name:"Position",value:"Right"}].concat(b)}]}]});},addTitleStyle:function(){this.addStyle({id:"title",attributes:[{name:"Borders"},{name:"Font"},{name:"NumberFormat",properties:[{name:"Format",value:"@"}]},{name:"Alignment",properties:[{name:"WrapText",value:"1"},{name:"Horizontal",value:"Center"},{name:"Vertical",value:"Center"}]}]});},addHeaderStyle:function(){this.addStyle({id:"headercell",attributes:[{name:"Font",properties:[{name:"Bold",value:"1"},{name:"Size",value:"10"}]},{name:"Interior",properties:[{name:"Pattern",value:"Solid"},{name:"Color",value:"#A3C9F1"}]},{name:"Alignment",properties:[{name:"WrapText",value:"1"},{name:"Horizontal",value:"Center"}]}]});},addStripedStyles:function(){this.addStyle({id:"even",attributes:[{name:"Interior",properties:[{name:"Pattern",value:"Solid"},{name:"Color",value:"#CCFFFF"}]}]});this.addStyle({id:"odd",attributes:[{name:"Interior",properties:[{name:"Pattern",value:"Solid"},{name:"Color",value:"#CCCCFF"}]}]});Ext.each(["even","odd"],function(b){this.addChildNumberFormatStyle(b,b+"date","[ENG][$-409]dd-mmm-yyyy;@");this.addChildNumberFormatStyle(b,b+"int","0");this.addChildNumberFormatStyle(b,b+"float","0.00");},this);},addChildNumberFormatStyle:function(e,f,d){this.addStyle({id:f,parentStyle:"even",attributes:[{name:"NumberFormat",properties:[{name:"Format",value:d}]}]});}});Ext.ux.Exporter.ExcelFormatter.Worksheet=Ext.extend(Object,{constructor:function(d,c){c=c||{};this.store=d;Ext.applyIf(c,{hasTitle:true,hasHeadings:true,stripeRows:true,title:"Workbook",columns:d.fields==undefined?{}:d.fields.items});Ext.apply(this,c);Ext.ux.Exporter.ExcelFormatter.Worksheet.superclass.constructor.apply(this,arguments);},dateFormatString:"Y-m-d",worksheetTpl:new Ext.XTemplate('<ss:Worksheet ss:Name="{title}">',"<ss:Names>",'<ss:NamedRange ss:Name="Print_Titles" ss:RefersTo="=\'{title}\'!R1:R2" />',"</ss:Names>",'<ss:Table x:FullRows="1" x:FullColumns="1" ss:ExpandedColumnCount="{colCount}" ss:ExpandedRowCount="{rowCount}">',"{columns}",'<ss:Row ss:Height="38">','<ss:Cell ss:StyleID="title" ss:MergeAcross="{colCount - 1}">','<ss:Data xmlns:html="http://www.w3.org/TR/REC-html40" ss:Type="String">','<html:B><html:U><html:Font html:Size="15">{title}','</html:Font></html:U></html:B></ss:Data><ss:NamedCell ss:Name="Print_Titles" />',"</ss:Cell>","</ss:Row>",'<ss:Row ss:AutoFitHeight="1">',"{header}","</ss:Row>","{rows}","</ss:Table>","<x:WorksheetOptions>","<x:PageSetup>",'<x:Layout x:CenterHorizontal="1" x:Orientation="Landscape" />','<x:Footer x:Data="Page &amp;P of &amp;N" x:Margin="0.5" />','<x:PageMargins x:Top="0.5" x:Right="0.5" x:Left="0.5" x:Bottom="0.8" />',"</x:PageSetup>","<x:FitToPage />","<x:Print>","<x:PrintErrors>Blank</x:PrintErrors>","<x:FitWidth>1</x:FitWidth>","<x:FitHeight>32767</x:FitHeight>","<x:ValidPrinterInfo />","<x:VerticalResolution>600</x:VerticalResolution>","</x:Print>","<x:Selected />","<x:DoNotDisplayGridlines />","<x:ProtectObjects>False</x:ProtectObjects>","<x:ProtectScenarios>False</x:ProtectScenarios>","</x:WorksheetOptions>","</ss:Worksheet>"),render:function(b){return this.worksheetTpl.apply({header:this.buildHeader(),columns:this.buildColumns().join(""),rows:this.buildRows().join(""),colCount:this.columns.length,rowCount:this.store.getCount()+2,title:this.title});},buildColumns:function(){var b=[];Ext.each(this.columns,function(a){b.push(this.buildColumn());},this);return b;},buildColumn:function(b){return String.format('<ss:Column ss:AutoFitWidth="1" ss:Width="{0}" />',b||164);},buildRows:function(){var b=[];this.store.each(function(a,d){b.push(this.buildRow(a,d));},this);return b;},buildHeader:function(){var b=[];Ext.each(this.columns,function(a){var d;if(a.header!=undefined){d=a.header;}else{d=a.name.replace(/_/g," ");d=d.charAt(0).toUpperCase()+d.substr(1).toLowerCase();}b.push(String.format('<ss:Cell ss:StyleID="headercell"><ss:Data ss:Type="String">{0}</ss:Data><ss:NamedCell ss:Name="Print_Titles" /></ss:Cell>',d));},this);return b.join("");},buildRow:function(f,h){var g,e=[];if(this.stripeRows===true){g=h%2==0?"even":"odd";}Ext.each(this.columns,function(c){var d=c.name||c.dataIndex;if(Ext.isFunction(c.renderer)){var a=c.renderer(f.get(d),null,f),b="String";}else{var a=f.get(d),b=this.typeMappings[c.type||f.fields.item(d).type];}e.push(this.buildCell(a,b,g).render());},this);return String.format("<ss:Row>{0}</ss:Row>",e.join(""));},buildCell:function(f,d,e){if(d=="DateTime"&&Ext.isFunction(f.format)){f=f.format(this.dateFormatString);}return new Ext.ux.Exporter.ExcelFormatter.Cell({value:f,type:d,style:e});},typeMappings:{"int":"Number","string":"String","float":"Number","date":"DateTime"}});Ext.ux.Exporter.ExcelFormatter.Cell=Ext.extend(Object,{constructor:function(b){Ext.applyIf(b,{type:"String"});Ext.apply(this,b);Ext.ux.Exporter.ExcelFormatter.Cell.superclass.constructor.apply(this,arguments);},render:function(){return this.tpl.apply(this);},tpl:new Ext.XTemplate('<ss:Cell ss:StyleID="{style}">','<ss:Data ss:Type="{type}">{value}</ss:Data>',"</ss:Cell>")});Ext.ux.Exporter.ExcelFormatter.Style=Ext.extend(Object,{constructor:function(b){b=b||{};Ext.apply(this,b,{parentStyle:"",attributes:[]});Ext.ux.Exporter.ExcelFormatter.Style.superclass.constructor.apply(this,arguments);if(this.id==undefined){throw new Error("An ID must be provided to Style");}this.preparePropertyStrings();},preparePropertyStrings:function(){Ext.each(this.attributes,function(d,c){this.attributes[c].propertiesString=this.buildPropertyString(d);this.attributes[c].children=d.children||[];Ext.each(d.children,function(a,b){this.attributes[c].children[b].propertiesString=this.buildPropertyString(a);},this);},this);},buildPropertyString:function(c){var d="";Ext.each(c.properties||[],function(a){d+=String.format('ss:{0}="{1}" ',a.name,a.value);},this);return d;},render:function(){return this.tpl.apply(this);},tpl:new Ext.XTemplate('<tpl if="parentStyle.length == 0">','<ss:Style ss:ID="{id}">',"</tpl>",'<tpl if="parentStyle.length != 0">','<ss:Style ss:ID="{id}" ss:Parent="{parentStyle}">',"</tpl>",'<tpl for="attributes">','<tpl if="children.length == 0">',"<ss:{name} {propertiesString} />","</tpl>",'<tpl if="children.length > 0">',"<ss:{name} {propertiesString}>",'<tpl for="children">',"<ss:{name} {propertiesString} />","</tpl>","</ss:{name}>","</tpl>","</tpl>","</ss:Style>")});