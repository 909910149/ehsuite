var OnlineUserSelector={getView:function(g,h){var f=this.initPanel(h);var e=new Ext.Window({title:"选择在线用户",iconCls:"menu-appuser",width:440,height:420,border:false,layout:"fit",items:[f],modal:true,buttonAlign:"center",buttons:[{text:"确认",iconCls:"btn-ok",scope:"true",handler:function(){var d=Ext.getCmp("contactGrid");var b=d.getSelectionModel().getSelections();var a="";var c="";for(var i=0;i<b.length;i++){if(i>0){a+=",";c+=",";}a+=b[i].data.userId;c+=b[i].data.fullname;}if(g!=null){g.call(this,a,c);}e.close();}},{text:"关闭",iconCls:"btn-cancel",handler:function(){e.close();}}]});return e;},initPanel:function(p){var m=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:__ctxPath+"/system/onlineAppUser.do"}),reader:new Ext.data.JsonReader({root:"result",totalProperty:"totalCounts",id:"id",fields:[{name:"userId",type:"int"},"fullname","title"]}),remoteSort:true});m.setDefaultSort("id","desc");m.load();var r=null;if(p){var r=new Ext.grid.CheckboxSelectionModel({singleSelect:true});}else{r=new Ext.grid.CheckboxSelectionModel();}var l=new Ext.grid.ColumnModel({columns:[r,new Ext.grid.RowNumberer(),{header:"用户名",dataIndex:"fullname",renderer:function(c,b,d){var a=d.data.title;if(a=="1"){return'<img src="'+__ctxPath+'/images/flag/man.png"/>&nbsp;'+c;}else{return'<img src="'+__ctxPath+'/images/flag/women.png"/>&nbsp;'+c;}},width:60}],defaults:{sortable:true,menuDisabled:true,width:120},listeners:{hiddenchange:function(c,b,a){saveConfig(b,a);}}});var q=new Ext.tree.TreePanel({id:"treePanels",title:"按部门分类 ",iconCls:"dep-user",autoScroll:true,loader:new Ext.tree.TreeLoader({url:__ctxPath+"/system/listDepartment.do"}),root:new Ext.tree.AsyncTreeNode({expanded:true}),rootVisible:false,listeners:{"click":this.clickNode}});var j=new Ext.tree.TreePanel({id:"rolePanel",iconCls:"role-user",title:"按角色分类 ",autoScroll:true,loader:new Ext.tree.TreeLoader({url:__ctxPath+"/system/treeAppRole.do"}),root:new Ext.tree.AsyncTreeNode({expanded:true}),rootVisible:false,listeners:{"click":this.clickRoleNode}});var o=new Ext.Panel({id:"onlinePanel",autoScroll:true,iconCls:"online-user",title:"所有在线人员  ",listeners:{"expand":this.clickOnlinePanel}});var k=new Ext.grid.GridPanel({id:"contactGrid",autoScroll:true,height:345,store:m,shim:true,trackMouseOver:true,disableSelection:false,loadMask:true,cm:l,sm:r,viewConfig:{forceFit:true,enableRowBody:false,showPreview:false}});var n=new Ext.Panel({id:"contactPanel",width:460,height:400,layout:"border",border:false,items:[{region:"west",split:true,header:false,collapsible:true,width:160,layout:"accordion",items:[q,j,o]},{region:"center",layout:"fit",width:250,items:[k]}]});return n;},clickNode:function(d){if(d!=null){var f=Ext.getCmp("contactGrid");var e=f.getStore();e.proxy.conn.url=__ctxPath+"/system/onlineAppUser.do";e.baseParams={depId:d.id};e.load();}},clickRoleNode:function(d){if(d!=null){var f=Ext.getCmp("contactGrid");var e=f.getStore();e.baseParams={roleId:d.id};e.proxy.conn.url=__ctxPath+"/system/onlineAppUser.do";e.load();}},clickOnlinePanel:function(){var c=Ext.getCmp("contactGrid");var d=c.getStore();d.baseParams={depId:null,roleId:null};d.proxy.conn.url=__ctxPath+"/system/onlineAppUser.do";d.load();}};