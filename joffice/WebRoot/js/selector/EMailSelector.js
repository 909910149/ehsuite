var EMailSelector={getView:function(h,j,i){var g=this.initPanel(j);var f=new Ext.Window({title:"选择联系人",iconCls:"menu-appuser",width:460,height:440,layout:"fit",border:false,items:[g],resizable:false,modal:true,buttonAlign:"center",buttons:[{text:"确认",iconCls:"btn-ok",scope:"true",handler:function(){var c=Ext.getCmp("emailContactGrid");var b=c.getSelectionModel().getSelections();var a="";for(var d=0;d<b.length;d++){a+=""+b[d].data.fullname+""+"<"+b[d].data.email+">"+";";}if(h!=null){h.call(this,a);}f.close();}},{text:"关闭",iconCls:"btn-cancel",handler:function(){f.close();}}]});return f;},initPanel:function(l){var i=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:__ctxPath+"/communicate/listPhoneBook.do"}),reader:new Ext.data.JsonReader({root:"result",totalProperty:"totalCounts",id:"id",fields:[{name:"phoneId",type:"int"},"fullname","email","title"]}),remoteSort:true});i.setDefaultSort("id","desc");i.load({params:{start:0,limit:12,"Q_appUser.userId_L_EQ":curUserInfo.userId}});var k=null;if(l){k=new Ext.grid.CheckboxSelectionModel({singleSelect:true});}else{k=new Ext.grid.CheckboxSelectionModel();}var j=new Ext.grid.ColumnModel({columns:[k,new Ext.grid.RowNumberer(),{header:"名称",dataIndex:"fullname",renderer:function(c,b,d){var a=d.data.title;if(a=="先生"){return'<img src="'+__ctxPath+'/images/flag/man.png"/>&nbsp;'+c;}else{return'<img src="'+__ctxPath+'/images/flag/women.png"/>&nbsp;'+c;}},width:60}],defaults:{sortable:true,menuDisabled:true,width:120},listeners:{hiddenchange:function(c,b,a){saveConfig(b,a);}}});var n=new Ext.tree.TreePanel({id:"treePanels",title:"个人录信录",iconCls:"menu-personal-phoneBook",loader:new Ext.tree.TreeLoader({url:__ctxPath+"/communicate/listPhoneGroup.do"}),root:new Ext.tree.AsyncTreeNode({expanded:true}),rootVisible:false,listeners:{"click":this.clickPersonlNode}});var p=new Ext.tree.TreePanel({id:"sharedPanel",iconCls:"menu-phonebook-shared",title:"共享通信录 ",loader:new Ext.tree.TreeLoader({url:__ctxPath+"/communicate/sharePhoneBook.do"}),root:new Ext.tree.AsyncTreeNode({text:"共享通信录",expanded:true}),rootVisible:true,listeners:{"click":this.clickSharedNode}});var m=new Ext.grid.GridPanel({id:"emailContactGrid",height:360,autoWidth:false,store:i,shim:true,trackMouseOver:true,border:false,disableSelection:false,loadMask:true,cm:j,sm:k,viewConfig:{forceFit:true,enableRowBody:false,showPreview:false},bbar:new HT.PagingBar({store:i})});var o=new Ext.Panel({id:"emailContactPanel",width:420,height:410,layout:"border",border:false,items:[{region:"west",split:true,collapsible:true,width:120,margins:"5 0 5 5",layout:"accordion",items:[n,p]},{region:"center",margins:"5 0 5 5",width:230,items:[m]}]});return o;},clickPersonlNode:function(d){if(d!=null){var f=Ext.getCmp("emailContactGrid");var e=f.getStore();e.proxy.conn.url=__ctxPath+"/communicate/listPhoneBook.do";if(d.id!=0&&d.id!="0"){e.load({params:{start:0,limit:12,"Q_appUser.userId_L_EQ":curUserInfo.userId,"Q_phoneGroup.groupId_L_EQ":d.id}});}else{e.load({params:{start:0,limit:12,"Q_appUser.userId_L_EQ":curUserInfo.userId}});}}},clickSharedNode:function(d){if(d!=null){var f=Ext.getCmp("emailContactGrid");var e=f.getStore();e.baseParams={Q_isShared_SN_EQ:1};e.proxy.conn.url=__ctxPath+"/communicate/listPhoneBook.do";e.load({params:{start:0,limit:12,Q_isShared_SN_EQ:1}});}}};