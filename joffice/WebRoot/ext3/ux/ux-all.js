Ext.ns("Ext.ux.grid");Ext.ux.grid.BufferView=Ext.extend(Ext.grid.GridView,{rowHeight:19,borderHeight:2,scrollDelay:100,cacheSize:20,cleanDelay:500,initTemplates:function(){Ext.ux.grid.BufferView.superclass.initTemplates.call(this);var a=this.templates;a.rowHolder=new Ext.Template('<div class="x-grid3-row {alt}" style="{tstyle}"></div>');a.rowHolder.disableFormats=true;a.rowHolder.compile();a.rowBody=new Ext.Template('<table class="x-grid3-row-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">',"<tbody><tr>{cells}</tr>",(this.enableRowBody?'<tr class="x-grid3-row-body-tr" style="{bodyStyle}"><td colspan="{cols}" class="x-grid3-body-cell" tabIndex="0" hidefocus="on"><div class="x-grid3-row-body">{body}</div></td></tr>':""),"</tbody></table>");a.rowBody.disableFormats=true;a.rowBody.compile();},getStyleRowHeight:function(){return Ext.isBorderBox?(this.rowHeight+this.borderHeight):this.rowHeight;},getCalculatedRowHeight:function(){return this.rowHeight+this.borderHeight;},getVisibleRowCount:function(){var b=this.getCalculatedRowHeight();var a=this.scroller.dom.clientHeight;return(a<1)?0:Math.ceil(a/b);},getVisibleRows:function(){var b=this.getVisibleRowCount();var c=this.scroller.dom.scrollTop;var a=(c==0?0:Math.floor(c/this.getCalculatedRowHeight())-1);return{first:Math.max(a,0),last:Math.min(a+b+2,this.ds.getCount()-1)};},doRender:function(d,f,w,D,t,m,g){var E=this.templates,b=E.cell,e=E.row,A=E.rowBody,k=t-1;var u=this.getStyleRowHeight();var C=this.getVisibleRows();var F="width:"+this.getTotalWidth()+";height:"+u+"px;";var s=[],z,v,y={},h={tstyle:F},n;for(var B=0,q=f.length;B<q;B++){n=f[B];z=[];var l=(B+D);var a=l>=C.first&&l<=C.last;if(a){for(var o=0;o<t;o++){v=d[o];y.id=v.id;y.css=o==0?"x-grid3-cell-first ":(o==k?"x-grid3-cell-last ":"");y.attr=y.cellAttr="";y.value=v.renderer(n.data[v.name],y,n,l,o,w);y.style=v.style;if(y.value==undefined||y.value===""){y.value="&#160;";}if(n.dirty&&typeof n.modified[v.name]!=="undefined"){y.css+=" x-grid3-dirty-cell";}z[z.length]=b.apply(y);}}var x=[];if(m&&((l+1)%2==0)){x[0]="x-grid3-row-alt";}if(n.dirty){x[1]=" x-grid3-dirty-row";}h.cols=t;if(this.getRowClass){x[2]=this.getRowClass(n,l,h,w);}h.alt=x.join(" ");h.cells=z.join("");s[s.length]=!a?E.rowHolder.apply(h):(g?A.apply(h):e.apply(h));}return s.join("");},isRowRendered:function(a){var b=this.getRow(a);return b&&b.childNodes.length>0;},syncScroll:function(){Ext.ux.grid.BufferView.superclass.syncScroll.apply(this,arguments);this.update();},update:function(){if(this.scrollDelay){if(!this.renderTask){this.renderTask=new Ext.util.DelayedTask(this.doUpdate,this);}this.renderTask.delay(this.scrollDelay);}else{this.doUpdate();}},onRemove:function(b,c,d,a){Ext.ux.grid.BufferView.superclass.onRemove.apply(this,arguments);if(a!==true){this.update();}},doUpdate:function(){if(this.getVisibleRowCount()>0){var b=this.grid,e=b.colModel,c=b.store;var a=this.getColumnData();var d=this.getVisibleRows();for(var h=d.first;h<=d.last;h++){if(!this.isRowRendered(h)){var f=this.doRender(a,[c.getAt(h)],c,h,e.getColumnCount(),b.stripeRows,true);this.getRow(h).innerHTML=f;}}this.clean();}},clean:function(){if(!this.cleanTask){this.cleanTask=new Ext.util.DelayedTask(this.doClean,this);}this.cleanTask.delay(this.cleanDelay);},doClean:function(){if(this.getVisibleRowCount()>0){var d=this.getVisibleRows();d.first-=this.cacheSize;d.last+=this.cacheSize;var a=0,b=this.getRows();if(d.first<=0){a=d.last+1;}for(var c=this.ds.getCount();a<c;a++){if((a<d.first||a>d.last)&&b[a].innerHTML){b[a].innerHTML="";}}}},layout:function(){Ext.ux.grid.BufferView.superclass.layout.call(this);this.update();}});Ext.ns("Ext.ux.layout");Ext.ux.layout.CenterLayout=Ext.extend(Ext.layout.FitLayout,{setItemSize:function(b,a){this.container.addClass("ux-layout-center");b.addClass("ux-layout-center-item");if(b&&a.height>0){if(b.width){a.width=b.width;}b.setSize(a);}}});Ext.Container.LAYOUTS["ux.center"]=Ext.ux.layout.CenterLayout;Ext.ns("Ext.ux.grid");Ext.ux.grid.CheckColumn=function(a){Ext.apply(this,a);if(!this.id){this.id=Ext.id();}this.renderer=this.renderer.createDelegate(this);};Ext.ux.grid.CheckColumn.prototype={init:function(a){this.grid=a;this.grid.on("render",function(){var b=this.grid.getView();b.mainBody.on("mousedown",this.onMouseDown,this);},this);},onMouseDown:function(b,a){if(Ext.fly(a).hasClass(this.createId())){b.stopEvent();var d=this.grid.getView().findRowIndex(a);var c=this.grid.store.getAt(d);c.set(this.dataIndex,!c.data[this.dataIndex]);}},renderer:function(c,a,b){a.css+=" x-grid3-check-col-td";return String.format('<div class="x-grid3-check-col{0} {1}">&#160;</div>',c?"-on":"",this.createId());},createId:function(){return"x-grid3-cc-"+this.id;}};Ext.preg("checkcolumn",Ext.ux.grid.CheckColumn);Ext.grid.CheckColumn=Ext.ux.grid.CheckColumn;Ext.ns("Ext.ux.grid");Ext.ux.grid.ColumnHeaderGroup=Ext.extend(Ext.util.Observable,{constructor:function(a){this.config=a;},init:function(a){Ext.applyIf(a.colModel,this.config);Ext.apply(a.getView(),this.viewConfig);},viewConfig:{initTemplates:function(){this.constructor.prototype.initTemplates.apply(this,arguments);var a=this.templates||{};if(!a.gcell){a.gcell=new Ext.XTemplate('<td class="x-grid3-hd x-grid3-gcell x-grid3-td-{id} ux-grid-hd-group-row-{row} {cls}" style="{style}">','<div {tooltip} class="x-grid3-hd-inner x-grid3-hd-{id}" unselectable="on" style="{istyle}">',this.grid.enableHdMenu?'<a class="x-grid3-hd-btn" href="#"></a>':"","{value}</div></td>");}this.templates=a;this.hrowRe=new RegExp("ux-grid-hd-group-row-(\\d+)","");},renderHeaders:function(){var j=this.templates,e=[],m=this.cm,d=m.rows,k="width:"+this.getTotalWidth()+";";for(var b=0,l=d.length;b<l;b++){var p=d[b],o=[];for(var g=0,f=0,h=p.length;g<h;g++){var n=p[g];n.colspan=n.colspan||1;var a=this.getColumnId(n.dataIndex?m.findColumnIndex(n.dataIndex):f),c=Ext.ux.grid.ColumnHeaderGroup.prototype.getGroupStyle.call(this,n,f);o[g]=j.gcell.apply({cls:"ux-grid-hd-group-cell",id:a,row:b,style:"width:"+c.width+";"+(c.hidden?"display:none;":"")+(n.align?"text-align:"+n.align+";":""),tooltip:n.tooltip?(Ext.QuickTips.isEnabled()?"ext:qtip":"title")+'="'+n.tooltip+'"':"",istyle:n.align=="right"?"padding-right:16px":"",btn:this.grid.enableHdMenu&&n.header,value:n.header||"&nbsp;"});f+=n.colspan;}e[b]=j.header.apply({tstyle:k,cells:o.join("")});}e.push(this.constructor.prototype.renderHeaders.apply(this,arguments));return e.join("");},onColumnWidthUpdated:function(){this.constructor.prototype.onColumnWidthUpdated.apply(this,arguments);Ext.ux.grid.ColumnHeaderGroup.prototype.updateGroupStyles.call(this);},onAllColumnWidthsUpdated:function(){this.constructor.prototype.onAllColumnWidthsUpdated.apply(this,arguments);Ext.ux.grid.ColumnHeaderGroup.prototype.updateGroupStyles.call(this);},onColumnHiddenUpdated:function(){this.constructor.prototype.onColumnHiddenUpdated.apply(this,arguments);Ext.ux.grid.ColumnHeaderGroup.prototype.updateGroupStyles.call(this);},getHeaderCell:function(a){return this.mainHd.query(this.cellSelector)[a];},findHeaderCell:function(a){return a?this.fly(a).findParent("td.x-grid3-hd",this.cellSelectorDepth):false;},findHeaderIndex:function(b){var a=this.findHeaderCell(b);return a?this.getCellIndex(a):false;},updateSortIcon:function(d,c){var b=this.sortClasses,a=this.mainHd.select(this.cellSelector).removeClass(b);a.item(d).addClass(b[c=="DESC"?1:0]);},handleHdDown:function(c,h){var a=Ext.get(h);if(a.hasClass("x-grid3-hd-btn")){c.stopEvent();var b=this.findHeaderCell(h);Ext.fly(b).addClass("x-grid3-hd-menu-open");var g=this.getCellIndex(b);this.hdCtxIndex=g;var f=this.hmenu.items,d=this.cm;f.get("asc").setDisabled(!d.isSortable(g));f.get("desc").setDisabled(!d.isSortable(g));this.hmenu.on("hide",function(){Ext.fly(b).removeClass("x-grid3-hd-menu-open");},this,{single:true});this.hmenu.show(h,"tl-bl?");}else{if(a.hasClass("ux-grid-hd-group-cell")||Ext.fly(h).up(".ux-grid-hd-group-cell")){c.stopEvent();}}},handleHdMove:function(a,g){var j=this.findHeaderCell(this.activeHdRef);if(j&&!this.headersDisabled&&!Ext.fly(j).hasClass("ux-grid-hd-group-cell")){var f=this.splitHandleWidth||5,h=this.activeHdRegion,c=a.getPageX(),d=j.style,b="";if(this.grid.enableColumnResize!==false){if(c-h.left<=f&&this.cm.isResizable(this.activeHdIndex-1)){b=Ext.isAir?"move":Ext.isWebKit?"e-resize":"col-resize";}else{if(h.right-c<=(!this.activeHdBtn?f:2)&&this.cm.isResizable(this.activeHdIndex)){b=Ext.isAir?"move":Ext.isWebKit?"w-resize":"col-resize";}}}d.cursor=b;}},handleHdOver:function(b,c){var a=this.findHeaderCell(c);if(a&&!this.headersDisabled){this.activeHdRef=c;this.activeHdIndex=this.getCellIndex(a);var d=this.fly(a);this.activeHdRegion=d.getRegion();if(!(this.cm.isMenuDisabled(this.activeHdIndex)||d.hasClass("ux-grid-hd-group-cell"))){d.addClass("x-grid3-hd-over");this.activeHdBtn=d.child(".x-grid3-hd-btn");if(this.activeHdBtn){this.activeHdBtn.dom.style.height=(a.firstChild.offsetHeight-1)+"px";}}}},handleHdOut:function(a,b){var c=this.findHeaderCell(b);if(c&&(!Ext.isIE||!a.within(c,true))){this.activeHdRef=null;this.fly(c).removeClass("x-grid3-hd-over");c.style.cursor="";}},handleHdMenuClick:function(b){var h=this.hdCtxIndex,o=this.cm,s=this.ds,n=b.getItemId();switch(n){case"asc":s.sort(o.getDataIndex(h),"ASC");break;case"desc":s.sort(o.getDataIndex(h),"DESC");break;default:if(n.substr(0,5)=="group"){var e=n.split("-"),k=parseInt(e[1],10),a=parseInt(e[2],10),m=this.cm.rows[k],q,c=0;for(var e=0,g=m.length;e<g;e++){q=m[e];if(a>=c&&a<c+q.colspan){break;}c+=q.colspan;}if(b.checked){var j=o.getColumnsBy(this.isHideableColumn,this).length;for(var e=c,g=c+q.colspan;e<g;e++){if(!o.isHidden(e)){j--;}}if(j<1){this.onDenyColumnHide();return false;}}for(var e=c,g=c+q.colspan;e<g;e++){if(o.config[e].fixed!==true&&o.config[e].hideable!==false){o.setHidden(e,b.checked);}}}else{h=o.getIndexById(n.substr(4));if(h!=-1){if(b.checked&&o.getColumnsBy(this.isHideableColumn,this).length<=1){this.onDenyColumnHide();return false;}o.setHidden(h,b.checked);}}b.checked=!b.checked;if(b.menu){var f=function(r){r.items.each(function(t){if(!t.disabled){t.setChecked(b.checked,false);if(t.menu){f(t.menu);}}});};f(b.menu);}var d=b,p;while(d=d.parentMenu){if(!d.parentMenu||!(p=d.parentMenu.items.get(d.getItemId()))||!p.setChecked){break;}var l=d.items.findIndexBy(function(r){return r.checked;})>=0;p.setChecked(l,true);}b.checked=!b.checked;}return true;},beforeColMenuShow:function(){var h=this.cm,k=this.cm.rows;this.colMenu.removeAll();for(var d=0,o=h.getColumnCount();d<o;d++){var a=this.colMenu,x=h.getColumnHeader(d),n=[];if(h.config[d].fixed!==true&&h.config[d].hideable!==false){for(var e=0,v=k.length;e<v;e++){var p=k[e],g,s=0;for(var w=0,j=p.length;w<j;w++){g=p[w];if(d>=s&&d<s+g.colspan){break;}s+=g.colspan;}if(g&&g.header){if(h.hierarchicalColMenu){var q="group-"+e+"-"+s;var l=a.items.item(q);var m=l?l.menu:null;if(!m){m=new Ext.menu.Menu({itemId:q});m.on("itemclick",this.handleHdMenuClick,this);var f=false,b=true;for(var u=s,t=s+g.colspan;u<t;u++){if(!h.isHidden(u)){f=true;}if(h.config[u].hideable!==false){b=false;}}a.add({itemId:q,text:g.header,menu:m,hideOnClick:false,checked:f,disabled:b});}a=m;}else{n.push(g.header);}}}n.push(x);a.add(new Ext.menu.CheckItem({itemId:"col-"+h.getColumnId(d),text:n.join(" "),checked:!h.isHidden(d),hideOnClick:false,disabled:h.config[d].hideable===false}));}}},renderUI:function(){this.constructor.prototype.renderUI.apply(this,arguments);Ext.apply(this.columnDrop,Ext.ux.grid.ColumnHeaderGroup.prototype.columnDropConfig);Ext.apply(this.splitZone,Ext.ux.grid.ColumnHeaderGroup.prototype.splitZoneConfig);}},splitZoneConfig:{allowHeaderDrag:function(a){return !a.getTarget(null,null,true).hasClass("ux-grid-hd-group-cell");}},columnDropConfig:{getTargetFromEvent:function(b){var a=Ext.lib.Event.getTarget(b);return this.view.findHeaderCell(a);},positionIndicator:function(f,c,b){var a=Ext.ux.grid.ColumnHeaderGroup.prototype.getDragDropData.call(this,f,c,b);if(a===false){return false;}var d=a.px+this.proxyOffsets[0];this.proxyTop.setLeftTop(d,a.r.top+this.proxyOffsets[1]);this.proxyTop.show();this.proxyBottom.setLeftTop(d,a.r.bottom);this.proxyBottom.show();return a.pt;},onNodeDrop:function(o,q,z,u){var y=u.header;if(y!=o){var B=Ext.ux.grid.ColumnHeaderGroup.prototype.getDragDropData.call(this,y,o,z);if(B===false){return false;}var j=this.grid.colModel,D=B.oldIndex<B.newIndex,k=j.rows;for(var f=B.row,p=k.length;f<p;f++){var l=k[f],x=l.length,t=0,s=1,v=x;for(var w=0,m=0;w<x;w++){var g=l[w];if(B.oldIndex>=m&&B.oldIndex<m+g.colspan){t=w;}if(B.oldIndex+B.colspan-1>=m&&B.oldIndex+B.colspan-1<m+g.colspan){s=w-t+1;}if(B.newIndex>=m&&B.newIndex<m+g.colspan){v=w;}m+=g.colspan;}var A=l.splice(t,s);k[f]=l.splice(0,v-(D?s:0)).concat(A).concat(l);}for(var C=0;C<B.colspan;C++){var b=B.oldIndex+(D?0:C),a=B.newIndex+(D?-1:C);j.moveColumn(b,a);this.grid.fireEvent("columnmove",b,a);}return true;}return false;}},getGroupStyle:function(c,f){var a=0,b=true;for(var g=f,d=f+c.colspan;g<d;g++){if(!this.cm.isHidden(g)){var e=this.cm.getColumnWidth(g);if(typeof e=="number"){a+=e;}b=false;}}return{width:(Ext.isBorderBox||(Ext.isWebKit&&!Ext.isSafari2)?a:Math.max(a-this.borderWidth,0))+"px",hidden:b};},updateGroupStyles:function(j){var d=this.mainHd.query(".x-grid3-header-offset > table"),b=this.getTotalWidth(),g=this.cm.rows;for(var f=0;f<d.length;f++){d[f].style.width=b;if(f<g.length){var e=d[f].firstChild.firstChild.childNodes;for(var a=0,k=0;a<e.length;a++){var c=g[f][a];if((typeof j!="number")||(j>=k&&j<k+c.colspan)){var h=Ext.ux.grid.ColumnHeaderGroup.prototype.getGroupStyle.call(this,c,k);e[a].style.width=h.width;e[a].style.display=h.hidden?"none":"";}k+=c.colspan;}}}},getGroupRowIndex:function(b){if(b){var a=b.className.match(this.hrowRe);if(a&&a[1]){return parseInt(a[1],10);}}return this.cm.rows.length;},getGroupSpan:function(c,f){if(c<0){return{col:0,colspan:this.cm.getColumnCount()};}var a=this.cm.rows[c];if(a){for(var g=0,e=0,d=a.length;g<d;g++){var b=a[g];if(f>=e&&f<e+b.colspan){return{col:e,colspan:b.colspan};}e+=b.colspan;}return{col:e,colspan:0};}return{col:f,colspan:1};},getDragDropData:function(m,l,o){if(m.parentNode!=l.parentNode){return false;}var f=this.grid.colModel,s=Ext.lib.Event.getPageX(o),c=Ext.lib.Dom.getRegion(l.firstChild),a,b;if((c.right-s)<=(c.right-c.left)/2){a=c.right+this.view.borderWidth;b="after";}else{a=c.left;b="before";}var q=this.view.getCellIndex(m),g=this.view.getCellIndex(l);if(f.isFixed(g)){return false;}var j=Ext.ux.grid.ColumnHeaderGroup.prototype.getGroupRowIndex.call(this.view,m),d=Ext.ux.grid.ColumnHeaderGroup.prototype.getGroupSpan.call(this.view,j,q),k=Ext.ux.grid.ColumnHeaderGroup.prototype.getGroupSpan.call(this.view,j,g),q=d.col;g=k.col+(b=="after"?k.colspan:0);if(g>=d.col&&g<=d.col+d.colspan){return false;}var p=Ext.ux.grid.ColumnHeaderGroup.prototype.getGroupSpan.call(this.view,j-1,q);if(g<p.col||g>p.col+p.colspan){return false;}return{r:c,px:a,pt:b,row:j,oldIndex:q,newIndex:g,colspan:d.colspan};}});Ext.ns("Ext.ux.tree");Ext.ux.tree.ColumnTree=Ext.extend(Ext.tree.TreePanel,{lines:false,borderWidth:Ext.isBorderBox?0:2,cls:"x-column-tree",onRender:function(){Ext.tree.ColumnTree.superclass.onRender.apply(this,arguments);this.headers=this.header.createChild({cls:"x-tree-headers"});var d=this.columns,e;var g=0;var a=19;for(var b=0,f=d.length;b<f;b++){e=d[b];g+=e.width;this.headers.createChild({cls:"x-tree-hd "+(e.cls?e.cls+"-hd":""),cn:{cls:"x-tree-hd-text",html:e.header},style:"width:"+(e.width-this.borderWidth)+"px;"});}this.headers.createChild({cls:"x-clear"});this.headers.setWidth(g+a);this.innerCt.setWidth(g);}});Ext.reg("columntree",Ext.ux.tree.ColumnTree);Ext.tree.ColumnTree=Ext.ux.tree.ColumnTree;Ext.ux.tree.ColumnNodeUI=Ext.extend(Ext.tree.TreeNodeUI,{focus:Ext.emptyFn,renderElements:function(j,e,o,f){this.indentMarkup=j.parentNode?j.parentNode.ui.getChildIndent():"";var h=j.getOwnerTree();var d=h.columns;var b=h.borderWidth;var p=d[0];var g=['<li class="x-tree-node"><div ext:tree-node-id="',j.id,'" class="x-tree-node-el x-tree-node-leaf ',e.cls,'">','<div class="x-tree-col" style="width:',p.width-b,'px;">','<span class="x-tree-node-indent">',this.indentMarkup,"</span>",'<img src="',this.emptyIcon,'" class="x-tree-ec-icon x-tree-elbow">','<img src="',e.icon||this.emptyIcon,'" class="x-tree-node-icon',(e.icon?" x-tree-node-inline-icon":""),(e.iconCls?" "+e.iconCls:""),'" unselectable="on">','<a hidefocus="on" class="x-tree-node-anchor" href="',e.href?e.href:"#",'" tabIndex="1" ',e.hrefTarget?' target="'+e.hrefTarget+'"':"",">",'<span unselectable="on">',j.text||(p.renderer?p.renderer(e[p.dataIndex],j,e):e[p.dataIndex]),"</span></a>","</div>"];for(var k=1,m=d.length;k<m;k++){p=d[k];g.push('<div class="x-tree-col ',(p.cls?p.cls:""),'" style="width:',p.width-b,'px;">','<div class="x-tree-col-text">',(p.renderer?p.renderer(e[p.dataIndex],j,e):e[p.dataIndex]),"</div>","</div>");}g.push('<div class="x-clear"></div></div>','<ul class="x-tree-node-ct" style="display:none;"></ul>',"</li>");if(f!==true&&j.nextSibling&&j.nextSibling.ui.getEl()){this.wrap=Ext.DomHelper.insertHtml("beforeBegin",j.nextSibling.ui.getEl(),g.join(""));}else{this.wrap=Ext.DomHelper.insertHtml("beforeEnd",o,g.join(""));}this.elNode=this.wrap.childNodes[0];this.ctNode=this.wrap.childNodes[1];var l=this.elNode.firstChild.childNodes;this.indentNode=l[0];this.ecNode=l[1];this.iconNode=l[2];this.anchor=l[3];this.textNode=l[3].firstChild;}});Ext.tree.ColumnNodeUI=Ext.ux.tree.ColumnNodeUI;Ext.DataView.LabelEditor=Ext.extend(Ext.Editor,{alignment:"tl-tl",hideEl:false,cls:"x-small-editor",shim:false,completeOnEnter:true,cancelOnEsc:true,labelSelector:"span.x-editable",constructor:function(a,b){Ext.DataView.LabelEditor.superclass.constructor.call(this,b||new Ext.form.TextField({allowBlank:false,growMin:90,growMax:240,grow:true,selectOnFocus:true}),a);},init:function(a){this.view=a;a.on("render",this.initEditor,this);this.on("complete",this.onSave,this);},initEditor:function(){this.view.on({scope:this,containerclick:this.doBlur,click:this.doBlur});this.view.getEl().on("mousedown",this.onMouseDown,this,{delegate:this.labelSelector});},doBlur:function(){if(this.editing){this.field.blur();}},onMouseDown:function(b,a){if(!b.ctrlKey&&!b.shiftKey){var d=this.view.findItemFromChild(a);b.stopEvent();var c=this.view.store.getAt(this.view.indexOf(d));this.startEdit(a,c.data[this.dataIndex]);this.activeRecord=c;}else{b.preventDefault();}},onSave:function(a,b){this.activeRecord.set(this.dataIndex,b);}});Ext.DataView.DragSelector=function(g){g=g||{};var k,j,m;var e,l,n=new Ext.lib.Region(0,0,0,0);var b=g.dragSafe===true;this.init=function(q){k=q;k.on("render",c);};function p(){e=[];k.all.each(function(q){e[e.length]=q.getRegion();});l=k.el.getRegion();}function f(){return false;}function h(q){return !b||q.target==k.el.dom;}function a(q){k.on("containerclick",f,k,{single:true});if(!j){j=k.el.createChild({cls:"x-view-selector"});}else{if(j.dom.parentNode!==k.el.dom){k.el.dom.appendChild(j.dom);}j.setDisplayed("block");}p();k.clearSelections();}function d(v){var w=m.startXY;var q=m.getXY();var y=Math.min(w[0],q[0]);var x=Math.min(w[1],q[1]);var A=Math.abs(w[0]-q[0]);var t=Math.abs(w[1]-q[1]);n.left=y;n.top=x;n.right=y+A;n.bottom=x+t;n.constrainTo(l);j.setRegion(n);for(var s=0,u=e.length;s<u;s++){var z=e[s],r=n.intersect(z);if(r&&!z.selected){z.selected=true;k.select(s,true);}else{if(!r&&z.selected){z.selected=false;k.deselect(s);}}}}function o(q){if(!Ext.isIE){k.un("containerclick",f,k);}if(j){j.setDisplayed(false);}}function c(q){m=new Ext.dd.DragTracker({onBeforeStart:h,onStart:a,onDrag:d,onEnd:o});m.initEl(q.el);}};Ext.ns("Ext.ux.form");Ext.ux.form.FileUploadField=Ext.extend(Ext.form.TextField,{buttonText:"Browse...",buttonOnly:false,buttonOffset:3,readOnly:true,autoSize:Ext.emptyFn,initComponent:function(){Ext.ux.form.FileUploadField.superclass.initComponent.call(this);this.addEvents("fileselected");},onRender:function(a,b){Ext.ux.form.FileUploadField.superclass.onRender.call(this,a,b);this.wrap=this.el.wrap({cls:"x-form-field-wrap x-form-file-wrap"});this.el.addClass("x-form-file-text");this.el.dom.removeAttribute("name");this.createFileInput();var c=Ext.applyIf(this.buttonCfg||{},{text:this.buttonText});this.button=new Ext.Button(Ext.apply(c,{renderTo:this.wrap,cls:"x-form-file-btn"+(c.iconCls?" x-btn-icon":"")}));if(this.buttonOnly){this.el.hide();this.wrap.setWidth(this.button.getEl().getWidth());}this.bindListeners();this.resizeEl=this.positionEl=this.wrap;},bindListeners:function(){this.fileInput.on({scope:this,mouseenter:function(){this.button.addClass(["x-btn-over","x-btn-focus"]);},mouseleave:function(){this.button.removeClass(["x-btn-over","x-btn-focus","x-btn-click"]);},mousedown:function(){this.button.addClass("x-btn-click");},mouseup:function(){this.button.removeClass(["x-btn-over","x-btn-focus","x-btn-click"]);},change:function(){var a=this.fileInput.dom.value;this.setValue(a);this.fireEvent("fileselected",this,a);}});},createFileInput:function(){this.fileInput=this.wrap.createChild({id:this.getFileInputId(),name:this.name||this.getId(),cls:"x-form-file",tag:"input",type:"file",size:1});},reset:function(){this.fileInput.remove();this.createFileInput();this.bindListeners();Ext.ux.form.FileUploadField.superclass.reset.call(this);},getFileInputId:function(){return this.id+"-file";},onResize:function(a,b){Ext.ux.form.FileUploadField.superclass.onResize.call(this,a,b);this.wrap.setWidth(a);if(!this.buttonOnly){var a=this.wrap.getWidth()-this.button.getEl().getWidth()-this.buttonOffset;this.el.setWidth(a);}},onDestroy:function(){Ext.ux.form.FileUploadField.superclass.onDestroy.call(this);Ext.destroy(this.fileInput,this.button,this.wrap);},onDisable:function(){Ext.ux.form.FileUploadField.superclass.onDisable.call(this);this.doDisable(true);},onEnable:function(){Ext.ux.form.FileUploadField.superclass.onEnable.call(this);this.doDisable(false);},doDisable:function(a){this.fileInput.dom.disabled=a;this.button.setDisabled(a);},preFocus:Ext.emptyFn,alignErrorIcon:function(){this.errorIcon.alignTo(this.wrap,"tl-tr",[2,0]);}});Ext.reg("fileuploadfield",Ext.ux.form.FileUploadField);Ext.form.FileUploadField=Ext.ux.form.FileUploadField;Ext.ux.GMapPanel=Ext.extend(Ext.Panel,{initComponent:function(){var a={plain:true,zoomLevel:3,yaw:180,pitch:0,zoom:0,gmapType:"map",border:false};Ext.applyIf(this,a);Ext.ux.GMapPanel.superclass.initComponent.call(this);},afterRender:function(){var b=this.ownerCt.getSize();Ext.applyIf(this,b);Ext.ux.GMapPanel.superclass.afterRender.call(this);if(this.gmapType==="map"){this.gmap=new GMap2(this.body.dom);}if(this.gmapType==="panorama"){this.gmap=new GStreetviewPanorama(this.body.dom);}if(typeof this.addControl=="object"&&this.gmapType==="map"){this.gmap.addControl(this.addControl);}if(typeof this.setCenter==="object"){if(typeof this.setCenter.geoCodeAddr==="string"){this.geoCodeLookup(this.setCenter.geoCodeAddr);}else{if(this.gmapType==="map"){var a=new GLatLng(this.setCenter.lat,this.setCenter.lng);this.gmap.setCenter(a,this.zoomLevel);}if(typeof this.setCenter.marker==="object"&&typeof a==="object"){this.addMarker(a,this.setCenter.marker,this.setCenter.marker.clear);}}if(this.gmapType==="panorama"){this.gmap.setLocationAndPOV(new GLatLng(this.setCenter.lat,this.setCenter.lng),{yaw:this.yaw,pitch:this.pitch,zoom:this.zoom});}}GEvent.bind(this.gmap,"load",this,function(){this.onMapReady();});},onMapReady:function(){this.addMarkers(this.markers);this.addMapControls();this.addOptions();},onResize:function(a,b){if(typeof this.getMap()=="object"){this.gmap.checkResize();}Ext.ux.GMapPanel.superclass.onResize.call(this,a,b);},setSize:function(a,b,c){if(typeof this.getMap()=="object"){this.gmap.checkResize();}Ext.ux.GMapPanel.superclass.setSize.call(this,a,b,c);},getMap:function(){return this.gmap;},getCenter:function(){return this.getMap().getCenter();},getCenterLatLng:function(){var a=this.getCenter();return{lat:a.lat(),lng:a.lng()};},addMarkers:function(a){if(Ext.isArray(a)){for(var c=0;c<a.length;c++){var b=new GLatLng(a[c].lat,a[c].lng);this.addMarker(b,a[c].marker,false,a[c].setCenter,a[c].listeners);}}},addMarker:function(a,b,f,e,c){Ext.applyIf(b,G_DEFAULT_ICON);if(f===true){this.getMap().clearOverlays();}if(e===true){this.getMap().setCenter(a,this.zoomLevel);}var d=new GMarker(a,b);if(typeof c==="object"){for(evt in c){GEvent.bind(d,evt,this,c[evt]);}}this.getMap().addOverlay(d);},addMapControls:function(){if(this.gmapType==="map"){if(Ext.isArray(this.mapControls)){for(i=0;i<this.mapControls.length;i++){this.addMapControl(this.mapControls[i]);}}else{if(typeof this.mapControls==="string"){this.addMapControl(this.mapControls);}else{if(typeof this.mapControls==="object"){this.getMap().addControl(this.mapControls);}}}}},addMapControl:function(b){var a=window[b];if(typeof a==="function"){this.getMap().addControl(new a());}},addOptions:function(){if(Ext.isArray(this.mapConfOpts)){var a;for(i=0;i<this.mapConfOpts.length;i++){this.addOption(this.mapConfOpts[i]);}}else{if(typeof this.mapConfOpts==="string"){this.addOption(this.mapConfOpts);}}},addOption:function(b){var a=this.getMap()[b];if(typeof a==="function"){this.getMap()[b]();}},geoCodeLookup:function(a){this.geocoder=new GClientGeocoder();this.geocoder.getLocations(a,this.addAddressToMap.createDelegate(this));},addAddressToMap:function(a){if(!a||a.Status.code!=200){Ext.MessageBox.alert("Error","Code "+a.Status.code+" Error Returned");}else{place=a.Placemark[0];addressinfo=place.AddressDetails;accuracy=addressinfo.Accuracy;if(accuracy===0){Ext.MessageBox.alert("Unable to Locate Address","Unable to Locate the Address you provided");}else{if(accuracy<7){Ext.MessageBox.alert("Address Accuracy","The address provided has a low accuracy.<br><br>Level "+accuracy+" Accuracy (8 = Exact Match, 1 = Vague Match)");}else{point=new GLatLng(place.Point.coordinates[1],place.Point.coordinates[0]);if(typeof this.setCenter.marker==="object"&&typeof point==="object"){this.addMarker(point,this.setCenter.marker,this.setCenter.marker.clear,true,this.setCenter.listeners);}}}}}});Ext.reg("gmappanel",Ext.ux.GMapPanel);Ext.namespace("Ext.ux.grid");Ext.ux.grid.GridFilters=Ext.extend(Ext.util.Observable,{autoReload:true,filterCls:"ux-filtered-column",local:false,menuFilterText:"Filters",paramPrefix:"filter",showMenu:true,stateId:undefined,updateBuffer:500,constructor:function(a){a=a||{};this.deferredUpdate=new Ext.util.DelayedTask(this.reload,this);this.filters=new Ext.util.MixedCollection();this.filters.getKey=function(b){return b?b.dataIndex:null;};this.addFilters(a.filters);delete a.filters;Ext.apply(this,a);},init:function(a){if(a instanceof Ext.grid.GridPanel){this.grid=a;this.bindStore(this.grid.getStore(),true);if(this.filters.getCount()==0){this.addFilters(this.grid.getColumnModel());}this.grid.filters=this;this.grid.addEvents({filterupdate:true});a.on({scope:this,beforestaterestore:this.applyState,beforestatesave:this.saveState,beforedestroy:this.destroy,reconfigure:this.onReconfigure});if(a.rendered){this.onRender();}else{a.on({scope:this,single:true,render:this.onRender});}}else{if(a instanceof Ext.PagingToolbar){this.toolbar=a;}}},applyState:function(d,b){var c,a;this.applyingState=true;this.clearFilters();if(b.filters){for(c in b.filters){a=this.filters.get(c);if(a){a.setValue(b.filters[c]);a.setActive(true);}}}this.deferredUpdate.cancel();if(this.local){this.reload();}delete this.applyingState;},saveState:function(b,a){var c={};this.filters.each(function(d){if(d.active){c[d.dataIndex]=d.getValue();}});return(a.filters=c);},onRender:function(){this.grid.getView().on("refresh",this.onRefresh,this);this.createMenu();},destroy:function(){this.removeAll();this.purgeListeners();if(this.filterMenu){Ext.menu.MenuMgr.unregister(this.filterMenu);this.filterMenu.destroy();this.filterMenu=this.menu.menu=null;}},removeAll:function(){if(this.filters){Ext.destroy.apply(Ext,this.filters.items);this.filters.clear();}},bindStore:function(a,b){if(!b&&this.store){if(this.local){a.un("load",this.onLoad,this);}else{a.un("beforeload",this.onBeforeLoad,this);}}if(a){if(this.local){a.on("load",this.onLoad,this);}else{a.on("beforeload",this.onBeforeLoad,this);}}this.store=a;},onReconfigure:function(){this.bindStore(this.grid.getStore());this.store.clearFilter();this.removeAll();this.addFilters(this.grid.getColumnModel());this.updateColumnHeadings();},createMenu:function(){var a=this.grid.getView(),b=a.hmenu;if(this.showMenu&&b){this.sep=b.addSeparator();this.filterMenu=new Ext.menu.Menu({id:this.grid.id+"-filters-menu"});this.menu=b.add({checked:false,itemId:"filters",text:this.menuFilterText,menu:this.filterMenu});this.menu.on({scope:this,checkchange:this.onCheckChange,beforecheckchange:this.onBeforeCheck});b.on("beforeshow",this.onMenu,this);}this.updateColumnHeadings();},getMenuFilter:function(){var a=this.grid.getView();if(!a||a.hdCtxIndex===undefined){return null;}return this.filters.get(a.cm.config[a.hdCtxIndex].dataIndex);},onMenu:function(b){var a=this.getMenuFilter();if(a){this.menu.menu=a.menu;this.menu.setChecked(a.active,false);this.menu.setDisabled(a.disabled===true);}this.menu.setVisible(a!==undefined);this.sep.setVisible(a!==undefined);},onCheckChange:function(a,b){this.getMenuFilter().setActive(b);},onBeforeCheck:function(a,b){return !b||this.getMenuFilter().isActivatable();},onStateChange:function(b,a){if(b==="serialize"){return;}if(a==this.getMenuFilter()){this.menu.setChecked(a.active,false);}if((this.autoReload||this.local)&&!this.applyingState){this.deferredUpdate.delay(this.updateBuffer);}this.updateColumnHeadings();if(!this.applyingState){this.grid.saveState();}this.grid.fireEvent("filterupdate",this,a);},onBeforeLoad:function(b,c){c.params=c.params||{};this.cleanParams(c.params);var a=this.buildQuery(this.getFilterData());Ext.apply(c.params,a);},onLoad:function(a,b){a.filterBy(this.getRecordFilter());},onRefresh:function(){this.updateColumnHeadings();},updateColumnHeadings:function(){var d=this.grid.getView(),a,c,b;if(d.mainHd){for(a=0,c=d.cm.config.length;a<c;a++){b=this.getFilter(d.cm.config[a].dataIndex);Ext.fly(d.getHeaderCell(a))[b&&b.active?"addClass":"removeClass"](this.filterCls);}}},reload:function(){if(this.local){this.grid.store.clearFilter(true);this.grid.store.filterBy(this.getRecordFilter());}else{var b,a=this.grid.store;this.deferredUpdate.cancel();if(this.toolbar){b=a.paramNames.start;if(a.lastOptions&&a.lastOptions.params&&a.lastOptions.params[b]){a.lastOptions.params[b]=0;}}a.reload();}},getRecordFilter:function(){var a=[],b,c;this.filters.each(function(d){if(d.active){a.push(d);}});b=a.length;return function(d){for(c=0;c<b;c++){if(!a[c].validateRecord(d)){return false;}}return true;};},addFilter:function(b){var a=this.getFilterClass(b.type),c=b.menu?b:(new a(b));this.filters.add(c);Ext.util.Observable.capture(c,this.onStateChange,this);return c;},addFilters:function(d){if(d){var a,f,c,e=false,b;if(d instanceof Ext.grid.ColumnModel){d=d.config;e=true;}for(a=0,f=d.length;a<f;a++){c=false;if(e){b=d[a].dataIndex;c=d[a].filter||d[a].filterable;if(c){c=(c===true)?{}:c;Ext.apply(c,{dataIndex:b});c.type=c.type||this.store.fields.get(b).type;}}else{c=d[a];}if(c){this.addFilter(c);}}}},getFilter:function(a){return this.filters.get(a);},clearFilters:function(){this.filters.each(function(a){a.setActive(false);});},getFilterData:function(){var a=[],c,b;this.filters.each(function(d){if(d.active){var e=[].concat(d.serialize());for(c=0,b=e.length;c<b;c++){a.push({field:d.dataIndex,data:e[c]});}}});return a;},buildQuery:function(a){var k={},b,g,h,d,j,c,e=a.length;if(!this.encode){for(b=0;b<e;b++){g=a[b];h=[this.paramPrefix,"[",b,"]"].join("");k[h+"[field]"]=g.field;d=h+"[data]";for(j in g.data){k[[d,"[",j,"]"].join("")]=g.data[j];}}}else{c=[];for(b=0;b<e;b++){g=a[b];c.push(Ext.apply({},{field:g.field},g.data));}if(c.length>0){k[this.paramPrefix]=Ext.util.JSON.encode(c);}}return k;},cleanParams:function(a){if(this.encode){delete a[this.paramPrefix];}else{var c,b;c=new RegExp("^"+this.paramPrefix+"[[0-9]+]");for(b in a){if(c.test(b)){delete a[b];}}}},getFilterClass:function(a){switch(a){case"auto":a="string";break;case"int":case"float":a="numeric";break;}return Ext.ux.grid.filter[a.substr(0,1).toUpperCase()+a.substr(1)+"Filter"];}});Ext.preg("gridfilters",Ext.ux.grid.GridFilters);Ext.namespace("Ext.ux.grid.filter");Ext.ux.grid.filter.Filter=Ext.extend(Ext.util.Observable,{active:false,dataIndex:null,menu:null,updateBuffer:500,constructor:function(a){Ext.apply(this,a);this.addEvents("activate","deactivate","serialize","update");Ext.ux.grid.filter.Filter.superclass.constructor.call(this);this.menu=new Ext.menu.Menu();this.init(a);if(a&&a.value){this.setValue(a.value);this.setActive(a.active!==false,true);delete a.value;}},destroy:function(){if(this.menu){this.menu.destroy();}this.purgeListeners();},init:Ext.emptyFn,getValue:Ext.emptyFn,setValue:Ext.emptyFn,isActivatable:function(){return true;},getSerialArgs:Ext.emptyFn,validateRecord:function(){return true;},serialize:function(){var a=this.getSerialArgs();this.fireEvent("serialize",a,this);return a;},fireUpdate:function(){if(this.active){this.fireEvent("update",this);}this.setActive(this.isActivatable());},setActive:function(b,a){if(this.active!=b){this.active=b;if(a!==true){this.fireEvent(b?"activate":"deactivate",this);}}}});Ext.ux.grid.filter.BooleanFilter=Ext.extend(Ext.ux.grid.filter.Filter,{defaultValue:false,yesText:"Yes",noText:"No",init:function(b){var a=Ext.id();this.options=[new Ext.menu.CheckItem({text:this.yesText,group:a,checked:this.defaultValue===true}),new Ext.menu.CheckItem({text:this.noText,group:a,checked:this.defaultValue===false})];this.menu.add(this.options[0],this.options[1]);for(var c=0;c<this.options.length;c++){this.options[c].on("click",this.fireUpdate,this);this.options[c].on("checkchange",this.fireUpdate,this);}},getValue:function(){return this.options[0].checked;},setValue:function(a){this.options[a?0:1].setChecked(true);},getSerialArgs:function(){var a={type:"boolean",value:this.getValue()};return a;},validateRecord:function(a){return a.get(this.dataIndex)==this.getValue();}});Ext.ux.grid.filter.DateFilter=Ext.extend(Ext.ux.grid.filter.Filter,{afterText:"After",beforeText:"Before",compareMap:{before:"lt",after:"gt",on:"eq"},dateFormat:"m/d/Y",menuItems:["before","after","-","on"],menuItemCfgs:{selectOnFocus:true,width:125},onText:"On",pickerOpts:{},init:function(f){var c,g,d,a,e,b;c=Ext.apply(this.pickerOpts,{minDate:this.minDate,maxDate:this.maxDate,format:this.dateFormat,listeners:{scope:this,select:this.onMenuSelect}});this.fields={};for(g=0,d=this.menuItems.length;g<d;g++){a=this.menuItems[g];if(a!=="-"){e={itemId:"range-"+a,text:this[a+"Text"],menu:new Ext.menu.DateMenu(Ext.apply(c,{itemId:a})),listeners:{scope:this,checkchange:this.onCheckChange}};b=Ext.menu.CheckItem;a=this.fields[a]=new b(e);}this.menu.add(a);}},onCheckChange:function(){this.setActive(this.isActivatable());this.fireEvent("update",this);},onInputKeyUp:function(a,c){var b=c.getKey();if(b==c.RETURN&&a.isValid()){c.stopEvent();this.menu.hide(true);return;}},onMenuSelect:function(a,b,e){var d=this.fields,c=this.fields[a.itemId];c.setChecked(true);if(c==d.on){d.before.setChecked(false,true);d.after.setChecked(false,true);}else{d.on.setChecked(false,true);if(c==d.after&&d.before.menu.picker.value<b){d.before.setChecked(false,true);}else{if(c==d.before&&d.after.menu.picker.value>b){d.after.setChecked(false,true);}}}this.fireEvent("update",this);},getValue:function(){var b,a={};for(b in this.fields){if(this.fields[b].checked){a[b]=this.fields[b].menu.picker.getValue();}}return a;},setValue:function(a,c){var b;for(b in this.fields){if(a[b]){this.fields[b].menu.picker.setValue(a[b]);this.fields[b].setChecked(true);}else{if(!c){this.fields[b].setChecked(false);}}}this.fireEvent("update",this);},isActivatable:function(){var a;for(a in this.fields){if(this.fields[a].checked){return true;}}return false;},getSerialArgs:function(){var a=[];for(var b in this.fields){if(this.fields[b].checked){a.push({type:"date",comparison:this.compareMap[b],value:this.getFieldValue(b).format(this.dateFormat)});}}return a;},getFieldValue:function(a){return this.fields[a].menu.picker.getValue();},getPicker:function(a){return this.fields[a].menu.picker;},validateRecord:function(c){var d,b,a=c.get(this.dataIndex);if(!Ext.isDate(a)){return false;}a=a.clearTime(true).getTime();for(d in this.fields){if(this.fields[d].checked){b=this.getFieldValue(d).clearTime(true).getTime();if(d=="before"&&b<=a){return false;}if(d=="after"&&b>=a){return false;}if(d=="on"&&b!=a){return false;}}}return true;}});Ext.ux.grid.filter.ListFilter=Ext.extend(Ext.ux.grid.filter.Filter,{phpMode:false,init:function(a){this.dt=new Ext.util.DelayedTask(this.fireUpdate,this);if(this.menu){this.menu.destroy();}this.menu=new Ext.ux.menu.ListMenu(a);this.menu.on("checkchange",this.onCheckChange,this);},getValue:function(){return this.menu.getSelected();},setValue:function(a){this.menu.setSelected(a);this.fireEvent("update",this);},isActivatable:function(){return this.getValue().length>0;},getSerialArgs:function(){var a={type:"list",value:this.phpMode?this.getValue().join(","):this.getValue()};return a;},onCheckChange:function(){this.dt.delay(this.updateBuffer);},validateRecord:function(a){return this.getValue().indexOf(a.get(this.dataIndex))>-1;}});Ext.ux.grid.filter.NumericFilter=Ext.extend(Ext.ux.grid.filter.Filter,{fieldCls:Ext.form.NumberField,iconCls:{gt:"ux-rangemenu-gt",lt:"ux-rangemenu-lt",eq:"ux-rangemenu-eq"},menuItemCfgs:{emptyText:"Enter Filter Text...",selectOnFocus:true,width:125},menuItems:["lt","gt","-","eq"],init:function(a){if(this.menu){this.menu.destroy();}this.menu=new Ext.ux.menu.RangeMenu(Ext.apply(a,{fieldCfg:this.fieldCfg||{},fieldCls:this.fieldCls,fields:this.fields||{},iconCls:this.iconCls,menuItemCfgs:this.menuItemCfgs,menuItems:this.menuItems,updateBuffer:this.updateBuffer}));this.menu.on("update",this.fireUpdate,this);},getValue:function(){return this.menu.getValue();},setValue:function(a){this.menu.setValue(a);},isActivatable:function(){var a=this.getValue();for(key in a){if(a[key]!==undefined){return true;}}return false;},getSerialArgs:function(){var a,c=[],b=this.menu.getValue();for(a in b){c.push({type:"numeric",comparison:a,value:b[a]});}return c;},validateRecord:function(b){var a=b.get(this.dataIndex),c=this.getValue();if(c.eq!==undefined&&a!=c.eq){return false;}if(c.lt!==undefined&&a>=c.lt){return false;}if(c.gt!==undefined&&a<=c.gt){return false;}return true;}});Ext.ux.grid.filter.StringFilter=Ext.extend(Ext.ux.grid.filter.Filter,{iconCls:"ux-gridfilter-text-icon",emptyText:"Enter Filter Text...",selectOnFocus:true,width:125,init:function(a){Ext.applyIf(a,{enableKeyEvents:true,iconCls:this.iconCls,listeners:{scope:this,keyup:this.onInputKeyUp}});this.inputItem=new Ext.form.TextField(a);this.menu.add(this.inputItem);this.updateTask=new Ext.util.DelayedTask(this.fireUpdate,this);},getValue:function(){return this.inputItem.getValue();},setValue:function(a){this.inputItem.setValue(a);this.fireEvent("update",this);},isActivatable:function(){return this.inputItem.getValue().length>0;},getSerialArgs:function(){return{type:"string",value:this.getValue()};},validateRecord:function(a){var b=a.get(this.dataIndex);if(typeof b!="string"){return(this.getValue().length===0);}return b.toLowerCase().indexOf(this.getValue().toLowerCase())>-1;},onInputKeyUp:function(a,c){var b=c.getKey();if(b==c.RETURN&&a.isValid()){c.stopEvent();this.menu.hide(true);return;}this.updateTask.delay(this.updateBuffer);}});Ext.namespace("Ext.ux.menu");Ext.ux.menu.ListMenu=Ext.extend(Ext.menu.Menu,{labelField:"text",loadingText:"Loading...",loadOnShow:true,single:false,constructor:function(e){this.selected=[];this.addEvents("checkchange");Ext.ux.menu.ListMenu.superclass.constructor.call(this,e=e||{});if(!e.store&&e.options){var a=[];for(var b=0,d=e.options.length;b<d;b++){var c=e.options[b];switch(Ext.type(c)){case"array":a.push(c);break;case"object":a.push([c.id,c[this.labelField]]);break;case"string":a.push([c,c]);break;}}this.store=new Ext.data.Store({reader:new Ext.data.ArrayReader({id:0},["id",this.labelField]),data:a,listeners:{load:this.onLoad,scope:this}});this.loaded=true;}else{this.add({text:this.loadingText,iconCls:"loading-indicator"});this.store.on("load",this.onLoad,this);}},destroy:function(){if(this.store){this.store.destroy();}Ext.ux.menu.ListMenu.superclass.destroy.call(this);},show:function(){var a=null;return function(){if(arguments.length===0){Ext.ux.menu.ListMenu.superclass.show.apply(this,a);}else{a=arguments;if(this.loadOnShow&&!this.loaded){this.store.load();}Ext.ux.menu.ListMenu.superclass.show.apply(this,arguments);}};}(),onLoad:function(f,e){var c=this.isVisible();this.hide(false);this.removeAll(true);var a=this.single?Ext.id():null;for(var g=0,d=e.length;g<d;g++){var b=new Ext.menu.CheckItem({text:e[g].get(this.labelField),group:a,checked:this.selected.indexOf(e[g].id)>-1,hideOnClick:false});b.itemId=e[g].id;b.on("checkchange",this.checkChange,this);this.add(b);}this.loaded=true;if(c){this.show();}this.fireEvent("load",this,e);},getSelected:function(){return this.selected;},setSelected:function(a){a=this.selected=[].concat(a);if(this.loaded){this.items.each(function(d){d.setChecked(false,true);for(var c=0,b=a.length;c<b;c++){if(d.itemId==a[c]){d.setChecked(true,true);}}},this);}},checkChange:function(c,b){var a=[];this.items.each(function(d){if(d.checked){a.push(d.itemId);}},this);this.selected=a;this.fireEvent("checkchange",c,b);}});Ext.ns("Ext.ux.menu");Ext.ux.menu.RangeMenu=Ext.extend(Ext.menu.Menu,{constructor:function(a){Ext.ux.menu.RangeMenu.superclass.constructor.call(this,a);this.addEvents("update");this.updateTask=new Ext.util.DelayedTask(this.fireUpdate,this);var b,e,c,f,d;for(b=0,e=this.menuItems.length;b<e;b++){c=this.menuItems[b];if(c!=="-"){f={itemId:"range-"+c,enableKeyEvents:true,iconCls:this.iconCls[c]||"no-icon",listeners:{scope:this,keyup:this.onInputKeyUp}};Ext.apply(f,Ext.applyIf(this.fields[c]||{},this.fieldCfg[c]),this.menuItemCfgs);d=f.fieldCls||this.fieldCls;c=this.fields[c]=new d(f);}this.add(c);}},fireUpdate:function(){this.fireEvent("update",this);},getValue:function(){var b={},c,a;for(c in this.fields){a=this.fields[c];if(a.isValid()&&String(a.getValue()).length>0){b[c]=a.getValue();}}return b;},setValue:function(b){var a;for(a in this.fields){this.fields[a].setValue(b[a]!==undefined?b[a]:"");}this.fireEvent("update",this);},onInputKeyUp:function(a,c){var b=c.getKey();if(b==c.RETURN&&a.isValid()){c.stopEvent();this.hide(true);return;}if(a==this.fields.eq){if(this.fields.gt){this.fields.gt.setValue(null);}if(this.fields.lt){this.fields.lt.setValue(null);}}else{this.fields.eq.setValue(null);}this.updateTask.delay(this.updateBuffer);}});Ext.ns("Ext.ux.grid");Ext.ux.grid.GroupSummary=Ext.extend(Ext.util.Observable,{constructor:function(a){Ext.apply(this,a);Ext.ux.grid.GroupSummary.superclass.constructor.call(this);},init:function(b){this.grid=b;var a=this.view=b.getView();a.doGroupEnd=this.doGroupEnd.createDelegate(this);a.afterMethod("onColumnWidthUpdated",this.doWidth,this);a.afterMethod("onAllColumnWidthsUpdated",this.doAllWidths,this);a.afterMethod("onColumnHiddenUpdated",this.doHidden,this);a.afterMethod("onUpdate",this.doUpdate,this);a.afterMethod("onRemove",this.doRemove,this);if(!this.rowTpl){this.rowTpl=new Ext.Template('<div class="x-grid3-summary-row" style="{tstyle}">','<table class="x-grid3-summary-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">',"<tbody><tr>{cells}</tr></tbody>","</table></div>");this.rowTpl.disableFormats=true;}this.rowTpl.compile();if(!this.cellTpl){this.cellTpl=new Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} {css}" style="{style}">','<div class="x-grid3-cell-inner x-grid3-col-{id}" unselectable="on">{value}</div>',"</td>");this.cellTpl.disableFormats=true;}this.cellTpl.compile();},toggleSummaries:function(b){var a=this.grid.getGridEl();if(a){if(b===undefined){b=a.hasClass("x-grid-hide-summary");}a[b?"removeClass":"addClass"]("x-grid-hide-summary");}},renderSummary:function(l,e){e=e||this.view.getColumnData();var f=this.grid.getColumnModel().config,a=[],g,j={},k,h=e.length-1;for(var b=0,d=e.length;b<d;b++){g=e[b];k=f[b];j.id=g.id;j.style=g.style;j.css=b==0?"x-grid3-cell-first ":(b==h?"x-grid3-cell-last ":"");if(k.summaryType||k.summaryRenderer){j.value=(k.summaryRenderer||g.renderer)(l.data[g.name],j,l);}else{j.value="";}if(j.value==undefined||j.value===""){j.value="&#160;";}a[a.length]=this.cellTpl.apply(j);}return this.rowTpl.apply({tstyle:"width:"+this.view.getTotalWidth()+";",cells:a.join("")});},calculate:function(l,d){var a={},h,f,e=this.grid.getColumnModel().config,k;for(var m=0,g=l.length;m<g;m++){h=l[m];for(var n=0,b=d.length;n<b;n++){f=d[n];k=e[n];if(k.summaryType){a[f.name]=Ext.ux.grid.GroupSummary.Calculations[k.summaryType](a[f.name]||0,h,f.name,a);}}}return a;},doGroupEnd:function(e,b,f,d,a){var c=this.calculate(b.rs,f);e.push("</div>",this.renderSummary({data:c},f),"</div>");},doWidth:function(a,e,g){var f=this.view.getGroups(),c;for(var b=0,d=f.length;b<d;b++){c=f[b].childNodes[2];c.style.width=g;c.firstChild.style.width=g;c.firstChild.rows[0].childNodes[a].style.width=e;}},doAllWidths:function(f,c){var k=this.view.getGroups(),h,g,d=f.length;for(var b=0,e=k.length;b<e;b++){h=k[b].childNodes[2];h.style.width=c;h.firstChild.style.width=c;g=h.firstChild.rows[0].childNodes;for(var a=0;a<d;a++){g[a].style.width=f[a];}}},doHidden:function(f,a,e){var d=this.view.getGroups(),h,b=a?"none":"";for(var g=0,c=d.length;g<c;g++){h=d[g].childNodes[2];h.style.width=e;h.firstChild.style.width=e;h.firstChild.rows[0].childNodes[f].style.display=b;}},refreshSummary:function(a){return this.refreshSummaryById(this.view.getGroupId(a));},getSummaryNode:function(a){var b=Ext.fly(a,"_gsummary");if(b){return b.down(".x-grid3-summary-row",true);}return null;},refreshSummaryById:function(h){var b=Ext.getDom(h);if(!b){return false;}var e=[];this.grid.getStore().each(function(g){if(g._groupId==h){e[e.length]=g;}});var f=this.view.getColumnData(),c=this.calculate(e,f),d=this.renderSummary({data:c},f),a=this.getSummaryNode(h);if(a){b.removeChild(a);}Ext.DomHelper.append(b,d);return true;},doUpdate:function(b,a){this.refreshSummaryById(a._groupId);},doRemove:function(b,c,d,a){if(!a){this.refreshSummaryById(c._groupId);}},showSummaryMsg:function(c,b){var d=this.view.getGroupId(c),a=this.getSummaryNode(d);if(a){a.innerHTML='<div class="x-grid3-summary-msg">'+b+"</div>";}}});Ext.grid.GroupSummary=Ext.ux.grid.GroupSummary;Ext.ux.grid.GroupSummary.Calculations={sum:function(c,b,a){return c+(b.data[a]||0);},count:function(d,c,b,a){return a[b+"count"]?++a[b+"count"]:(a[b+"count"]=1);},max:function(a,e,c,b){var a=e.data[c];var d=b[c+"max"]===undefined?(b[c+"max"]=a):b[c+"max"];return a>d?(b[c+"max"]=a):d;},min:function(e,d,c,b){var e=d.data[c];var a=b[c+"min"]===undefined?(b[c+"min"]=e):b[c+"min"];return e<a?(b[c+"min"]=e):a;},average:function(g,f,d,b){var e=b[d+"count"]?++b[d+"count"]:(b[d+"count"]=1);var a=(b[d+"total"]=((b[d+"total"]||0)+(f.data[d]||0)));return a===0?0:a/e;}};Ext.grid.GroupSummary.Calculations=Ext.ux.grid.GroupSummary.Calculations;Ext.ux.grid.HybridSummary=Ext.extend(Ext.ux.grid.GroupSummary,{calculate:function(e,b){var d=this.view.getGroupField(),a=e[0].data[d],c=this.getSummaryData(a);return c||Ext.ux.grid.HybridSummary.superclass.calculate.call(this,e,b);},updateSummaryData:function(c,b,a){var d=this.grid.getStore().reader.jsonData;if(!d.summaryData){d.summaryData={};}d.summaryData[c]=b;if(!a){this.refreshSummary(c);}},getSummaryData:function(a){var b=this.grid.getStore().reader.jsonData;if(b&&b.summaryData){return b.summaryData[a];}return null;}});Ext.grid.HybridSummary=Ext.ux.grid.HybridSummary;Ext.ux.GroupTab=Ext.extend(Ext.Container,{mainItem:0,expanded:true,deferredRender:true,activeTab:null,idDelimiter:"__",headerAsText:false,frame:false,hideBorders:true,initComponent:function(a){Ext.apply(this,a);this.frame=false;Ext.ux.GroupTab.superclass.initComponent.call(this);this.addEvents("activate","deactivate","changemainitem","beforetabchange","tabchange");this.setLayout(new Ext.layout.CardLayout({deferredRender:this.deferredRender}));if(!this.stack){this.stack=Ext.TabPanel.AccessStack();}this.initItems();this.on("beforerender",function(){this.groupEl=this.ownerCt.getGroupEl(this);},this);this.on("add",this.onAdd,this,{target:this});this.on("remove",this.onRemove,this,{target:this});if(this.mainItem!==undefined){var b=(typeof this.mainItem=="object")?this.mainItem:this.items.get(this.mainItem);delete this.mainItem;this.setMainItem(b);}},setActiveTab:function(a){a=this.getComponent(a);if(!a){return false;}if(!this.rendered){this.activeTab=a;return true;}if(this.activeTab!=a&&this.fireEvent("beforetabchange",this,a,this.activeTab)!==false){if(this.activeTab&&this.activeTab!=this.mainItem){var b=this.getTabEl(this.activeTab);if(b){Ext.fly(b).removeClass("x-grouptabs-strip-active");}}var c=this.getTabEl(a);Ext.fly(c).addClass("x-grouptabs-strip-active");this.activeTab=a;this.stack.add(a);this.layout.setActiveItem(a);if(this.layoutOnTabChange&&a.doLayout){a.doLayout();}if(this.scrolling){this.scrollToTab(a,this.animScroll);}this.fireEvent("tabchange",this,a);return true;}return false;},getTabEl:function(a){if(a==this.mainItem){return this.groupEl;}return Ext.TabPanel.prototype.getTabEl.call(this,a);},onRender:function(c,b){Ext.ux.GroupTab.superclass.onRender.call(this,c,b);this.strip=Ext.fly(this.groupEl).createChild({tag:"ul",cls:"x-grouptabs-sub"});this.tooltip=new Ext.ToolTip({target:this.groupEl,delegate:"a.x-grouptabs-text",trackMouse:true,renderTo:document.body,listeners:{beforeshow:function(e){var d=(e.triggerElement.parentNode===this.mainItem.tabEl)?this.mainItem:this.findById(e.triggerElement.parentNode.id.split(this.idDelimiter)[1]);if(!d.tabTip){return false;}e.body.dom.innerHTML=d.tabTip;},scope:this}});if(!this.itemTpl){var a=new Ext.Template('<li class="{cls}" id="{id}">','<a onclick="return false;" class="x-grouptabs-text {iconCls}">{text}</a>',"</li>");a.disableFormats=true;a.compile();Ext.ux.GroupTab.prototype.itemTpl=a;}this.items.each(this.initTab,this);},afterRender:function(){Ext.ux.GroupTab.superclass.afterRender.call(this);if(this.activeTab!==undefined){var a=(typeof this.activeTab=="object")?this.activeTab:this.items.get(this.activeTab);delete this.activeTab;this.setActiveTab(a);}},initTab:function(a,d){var b=this.strip.dom.childNodes[d];var c=Ext.TabPanel.prototype.getTemplateArgs.call(this,a);if(a===this.mainItem){a.tabEl=this.groupEl;c.cls+=" x-grouptabs-main-item";}var e=b?this.itemTpl.insertBefore(b,c):this.itemTpl.append(this.strip,c);a.tabEl=a.tabEl||e;a.on("disable",this.onItemDisabled,this);a.on("enable",this.onItemEnabled,this);a.on("titlechange",this.onItemTitleChanged,this);a.on("iconchange",this.onItemIconChanged,this);a.on("beforeshow",this.onBeforeShowItem,this);},setMainItem:function(a){a=this.getComponent(a);if(!a||this.fireEvent("changemainitem",this,a,this.mainItem)===false){return;}this.mainItem=a;},getMainItem:function(){return this.mainItem||null;},onBeforeShowItem:function(a){if(a!=this.activeTab){this.setActiveTab(a);return false;}},onAdd:function(b,a,c){if(this.rendered){this.initTab.call(this,a,c);}},onRemove:function(a,c){Ext.destroy(Ext.get(this.getTabEl(c)));this.stack.remove(c);c.un("disable",this.onItemDisabled,this);c.un("enable",this.onItemEnabled,this);c.un("titlechange",this.onItemTitleChanged,this);c.un("iconchange",this.onItemIconChanged,this);c.un("beforeshow",this.onBeforeShowItem,this);if(c==this.activeTab){var b=this.stack.next();if(b){this.setActiveTab(b);}else{if(this.items.getCount()>0){this.setActiveTab(0);}else{this.activeTab=null;}}}},onBeforeAdd:function(c){var b=c.events?(this.items.containsKey(c.getItemId())?c:null):this.items.get(c);if(b){this.setActiveTab(c);return false;}Ext.TabPanel.superclass.onBeforeAdd.apply(this,arguments);var a=c.elements;c.elements=a?a.replace(",header",""):a;c.border=(c.border===true);},onItemDisabled:Ext.TabPanel.prototype.onItemDisabled,onItemEnabled:Ext.TabPanel.prototype.onItemEnabled,onItemTitleChanged:function(b){var a=this.getTabEl(b);if(a){Ext.fly(a).child("a.x-grouptabs-text",true).innerHTML=b.title;}},onItemIconChanged:function(b,c,a){var d=this.getTabEl(b);if(d){Ext.fly(d).child("a.x-grouptabs-text").replaceClass(a,c);}},beforeDestroy:function(){Ext.TabPanel.prototype.beforeDestroy.call(this);this.tooltip.destroy();}});Ext.reg("grouptab",Ext.ux.GroupTab);Ext.ns("Ext.ux");Ext.ux.GroupTabPanel=Ext.extend(Ext.TabPanel,{tabPosition:"left",alternateColor:false,alternateCls:"x-grouptabs-panel-alt",defaultType:"grouptab",deferredRender:false,activeGroup:null,initComponent:function(){Ext.ux.GroupTabPanel.superclass.initComponent.call(this);this.addEvents("beforegroupchange","groupchange");this.elements="body,header";this.stripTarget="header";this.tabPosition=this.tabPosition=="right"?"right":"left";this.addClass("x-grouptabs-panel");if(this.tabStyle&&this.tabStyle!=""){this.addClass("x-grouptabs-panel-"+this.tabStyle);}if(this.alternateColor){this.addClass(this.alternateCls);}this.on("beforeadd",function(c,a,b){this.initGroup(a,b);});},initEvents:function(){this.mon(this.strip,"mousedown",this.onStripMouseDown,this);},onRender:function(a,e){Ext.TabPanel.superclass.onRender.call(this,a,e);if(this.plain){var d=this.tabPosition=="top"?"header":"footer";this[d].addClass("x-tab-panel-"+d+"-plain");}var f=this[this.stripTarget];this.stripWrap=f.createChild({cls:"x-tab-strip-wrap ",cn:{tag:"ul",cls:"x-grouptabs-strip x-grouptabs-tab-strip-"+this.tabPosition}});var c=(this.tabPosition=="bottom"?this.stripWrap:null);this.strip=new Ext.Element(this.stripWrap.dom.firstChild);this.header.addClass("x-grouptabs-panel-header");this.bwrap.addClass("x-grouptabs-bwrap");this.body.addClass("x-tab-panel-body-"+this.tabPosition+" x-grouptabs-panel-body");if(!this.groupTpl){var b=new Ext.Template('<li class="{cls}" id="{id}">','<a class="x-grouptabs-expand" onclick="return false;"></a>','<a class="x-grouptabs-text {iconCls}" href="#" onclick="return false;">',"<span>{text}</span></a>","</li>");b.disableFormats=true;b.compile();Ext.ux.GroupTabPanel.prototype.groupTpl=b;}this.items.each(this.initGroup,this);},afterRender:function(){Ext.ux.GroupTabPanel.superclass.afterRender.call(this);this.tabJoint=Ext.fly(this.body.dom.parentNode).createChild({cls:"x-tab-joint"});this.addClass("x-tab-panel-"+this.tabPosition);this.header.setWidth(this.tabWidth);if(this.activeGroup!==undefined){var a=(typeof this.activeGroup=="object")?this.activeGroup:this.items.get(this.activeGroup);delete this.activeGroup;this.setActiveGroup(a);a.setActiveTab(a.getMainItem());}},getGroupEl:Ext.TabPanel.prototype.getTabEl,findTargets:function(a){var c=null,b=a.getTarget("li",this.strip);if(b){c=this.findById(b.id.split(this.idDelimiter)[1]);if(c.disabled){return{expand:null,item:null,el:null};}}return{expand:a.getTarget(".x-grouptabs-expand",this.strip),isGroup:!a.getTarget("ul.x-grouptabs-sub",this.strip),item:c,el:b};},onStripMouseDown:function(b){if(b.button!=0){return;}b.preventDefault();var a=this.findTargets(b);if(a.expand){this.toggleGroup(a.el);}else{if(a.item){if(a.isGroup){a.item.setActiveTab(a.item.getMainItem());}else{a.item.ownerCt.setActiveTab(a.item);}}}},expandGroup:function(a){if(a.isXType){a=this.getGroupEl(a);}Ext.fly(a).addClass("x-grouptabs-expanded");this.syncTabJoint();},toggleGroup:function(a){if(a.isXType){a=this.getGroupEl(a);}Ext.fly(a).toggleClass("x-grouptabs-expanded");this.syncTabJoint();},collapseGroup:function(a){if(a.isXType){a=this.getGroupEl(a);}Ext.fly(a).removeClass("x-grouptabs-expanded");this.syncTabJoint();},syncTabJoint:function(b){if(!this.tabJoint){return;}b=b||this.getGroupEl(this.activeGroup);if(b){this.tabJoint.setHeight(Ext.fly(b).getHeight()-2);var a=Ext.isGecko2?0:1;if(this.tabPosition=="left"){this.tabJoint.alignTo(b,"tl-tr",[-2,a]);}else{this.tabJoint.alignTo(b,"tr-tl",[1,a]);}}else{this.tabJoint.hide();}},getActiveTab:function(){if(!this.activeGroup){return null;}return this.activeGroup.getTabEl(this.activeGroup.activeTab)||null;},onResize:function(){Ext.ux.GroupTabPanel.superclass.onResize.apply(this,arguments);this.syncTabJoint();},createCorner:function(a,b){return Ext.fly(a).createChild({cls:"x-grouptabs-corner x-grouptabs-corner-"+b});},initGroup:function(b,e){var g=this.strip.dom.childNodes[e],a=this.getTemplateArgs(b);if(e===0){a.cls+=" x-tab-first";}a.cls+=" x-grouptabs-main";a.text=b.getMainItem().title;var f=g?this.groupTpl.insertBefore(g,a):this.groupTpl.append(this.strip,a),d=this.createCorner(f,"top-"+this.tabPosition),c=this.createCorner(f,"bottom-"+this.tabPosition);b.tabEl=f;if(b.expanded){this.expandGroup(f);}if(Ext.isIE6||(Ext.isIE&&!Ext.isStrict)){c.setLeft("-10px");c.setBottom("-5px");d.setLeft("-10px");d.setTop("-5px");}this.mon(b,{scope:this,changemainitem:this.onGroupChangeMainItem,beforetabchange:this.onGroupBeforeTabChange});},setActiveGroup:function(c){c=this.getComponent(c);if(!c){return false;}if(!this.rendered){this.activeGroup=c;return true;}if(this.activeGroup!=c&&this.fireEvent("beforegroupchange",this,c,this.activeGroup)!==false){if(this.activeGroup){this.activeGroup.activeTab=null;var b=this.getGroupEl(this.activeGroup);if(b){Ext.fly(b).removeClass("x-grouptabs-strip-active");}}var a=this.getGroupEl(c);Ext.fly(a).addClass("x-grouptabs-strip-active");this.activeGroup=c;this.stack.add(c);this.layout.setActiveItem(c);this.syncTabJoint(a);this.fireEvent("groupchange",this,c);return true;}return false;},onGroupBeforeTabChange:function(b,a,c){if(b!==this.activeGroup||a!==c){this.strip.select(".x-grouptabs-sub > li.x-grouptabs-strip-active",true).removeClass("x-grouptabs-strip-active");}this.expandGroup(this.getGroupEl(b));if(b!==this.activeGroup){return this.setActiveGroup(b);}},getFrameHeight:function(){var a=this.el.getFrameWidth("tb");a+=(this.tbar?this.tbar.getHeight():0)+(this.bbar?this.bbar.getHeight():0);return a;},adjustBodyWidth:function(a){return a-this.tabWidth;}});Ext.reg("grouptabpanel",Ext.ux.GroupTabPanel);Ext.ux.form.ItemSelector=Ext.extend(Ext.form.Field,{hideNavIcons:false,imagePath:"",iconUp:"up2.gif",iconDown:"down2.gif",iconLeft:"left2.gif",iconRight:"right2.gif",iconTop:"top2.gif",iconBottom:"bottom2.gif",drawUpIcon:true,drawDownIcon:true,drawLeftIcon:true,drawRightIcon:true,drawTopIcon:true,drawBotIcon:true,delimiter:",",bodyStyle:null,border:false,defaultAutoCreate:{tag:"div"},multiselects:null,initComponent:function(){Ext.ux.form.ItemSelector.superclass.initComponent.call(this);this.addEvents({rowdblclick:true,change:true});},onRender:function(f,c){Ext.ux.form.ItemSelector.superclass.onRender.call(this,f,c);var b=[{legend:"Available",draggable:true,droppable:true,width:100,height:100},{legend:"Selected",droppable:true,draggable:true,width:100,height:100}];this.fromMultiselect=new Ext.ux.form.MultiSelect(Ext.applyIf(this.multiselects[0],b[0]));this.fromMultiselect.on("dblclick",this.onRowDblClick,this);this.toMultiselect=new Ext.ux.form.MultiSelect(Ext.applyIf(this.multiselects[1],b[1]));this.toMultiselect.on("dblclick",this.onRowDblClick,this);var a=new Ext.Panel({bodyStyle:this.bodyStyle,border:this.border,layout:"table",layoutConfig:{columns:3}});a.add(this.fromMultiselect);var e=new Ext.Panel({header:false});a.add(e);a.add(this.toMultiselect);a.render(this.el);e.el.down("."+e.bwrapCls).remove();if(this.imagePath!=""&&this.imagePath.charAt(this.imagePath.length-1)!="/"){this.imagePath+="/";}this.iconUp=this.imagePath+(this.iconUp||"up2.gif");this.iconDown=this.imagePath+(this.iconDown||"down2.gif");this.iconLeft=this.imagePath+(this.iconLeft||"left2.gif");this.iconRight=this.imagePath+(this.iconRight||"right2.gif");this.iconTop=this.imagePath+(this.iconTop||"top2.gif");this.iconBottom=this.imagePath+(this.iconBottom||"bottom2.gif");var h=e.getEl();this.toTopIcon=h.createChild({tag:"img",src:this.iconTop,style:{cursor:"pointer",margin:"2px"}});h.createChild({tag:"br"});this.upIcon=h.createChild({tag:"img",src:this.iconUp,style:{cursor:"pointer",margin:"2px"}});h.createChild({tag:"br"});this.addIcon=h.createChild({tag:"img",src:this.iconRight,style:{cursor:"pointer",margin:"2px"}});h.createChild({tag:"br"});this.removeIcon=h.createChild({tag:"img",src:this.iconLeft,style:{cursor:"pointer",margin:"2px"}});h.createChild({tag:"br"});this.downIcon=h.createChild({tag:"img",src:this.iconDown,style:{cursor:"pointer",margin:"2px"}});h.createChild({tag:"br"});this.toBottomIcon=h.createChild({tag:"img",src:this.iconBottom,style:{cursor:"pointer",margin:"2px"}});this.toTopIcon.on("click",this.toTop,this);this.upIcon.on("click",this.up,this);this.downIcon.on("click",this.down,this);this.toBottomIcon.on("click",this.toBottom,this);this.addIcon.on("click",this.fromTo,this);this.removeIcon.on("click",this.toFrom,this);if(!this.drawUpIcon||this.hideNavIcons){this.upIcon.dom.style.display="none";}if(!this.drawDownIcon||this.hideNavIcons){this.downIcon.dom.style.display="none";}if(!this.drawLeftIcon||this.hideNavIcons){this.addIcon.dom.style.display="none";}if(!this.drawRightIcon||this.hideNavIcons){this.removeIcon.dom.style.display="none";}if(!this.drawTopIcon||this.hideNavIcons){this.toTopIcon.dom.style.display="none";}if(!this.drawBotIcon||this.hideNavIcons){this.toBottomIcon.dom.style.display="none";}var d=a.body.first();this.el.setWidth(a.body.first().getWidth());a.body.removeClass();this.hiddenName=this.name;var g={tag:"input",type:"hidden",value:"",name:this.name};this.hiddenField=this.el.createChild(g);},doLayout:function(){if(this.rendered){this.fromMultiselect.fs.doLayout();this.toMultiselect.fs.doLayout();}},afterRender:function(){Ext.ux.form.ItemSelector.superclass.afterRender.call(this);this.toStore=this.toMultiselect.store;this.toStore.on("add",this.valueChanged,this);this.toStore.on("remove",this.valueChanged,this);this.toStore.on("load",this.valueChanged,this);this.valueChanged(this.toStore);},toTop:function(){var a=this.toMultiselect.view.getSelectedIndexes();var b=[];if(a.length>0){a.sort();for(var c=0;c<a.length;c++){record=this.toMultiselect.view.store.getAt(a[c]);b.push(record);}a=[];for(var c=b.length-1;c>-1;c--){record=b[c];this.toMultiselect.view.store.remove(record);this.toMultiselect.view.store.insert(0,record);a.push(((b.length-1)-c));}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(a);},toBottom:function(){var a=this.toMultiselect.view.getSelectedIndexes();var b=[];if(a.length>0){a.sort();for(var c=0;c<a.length;c++){record=this.toMultiselect.view.store.getAt(a[c]);b.push(record);}a=[];for(var c=0;c<b.length;c++){record=b[c];this.toMultiselect.view.store.remove(record);this.toMultiselect.view.store.add(record);a.push((this.toMultiselect.view.store.getCount())-(b.length-c));}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(a);},up:function(){var c=null;var a=this.toMultiselect.view.getSelectedIndexes();a.sort();var b=[];if(a.length>0){for(var d=0;d<a.length;d++){c=this.toMultiselect.view.store.getAt(a[d]);if((a[d]-1)>=0){this.toMultiselect.view.store.remove(c);this.toMultiselect.view.store.insert(a[d]-1,c);b.push(a[d]-1);}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(b);}},down:function(){var c=null;var a=this.toMultiselect.view.getSelectedIndexes();a.sort();a.reverse();var b=[];if(a.length>0){for(var d=0;d<a.length;d++){c=this.toMultiselect.view.store.getAt(a[d]);if((a[d]+1)<this.toMultiselect.view.store.getCount()){this.toMultiselect.view.store.remove(c);this.toMultiselect.view.store.insert(a[d]+1,c);b.push(a[d]+1);}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(b);}},fromTo:function(){var c=this.fromMultiselect.view.getSelectedIndexes();var e=[];if(c.length>0){for(var b=0;b<c.length;b++){record=this.fromMultiselect.view.store.getAt(c[b]);e.push(record);}if(!this.allowDup){c=[];}for(var b=0;b<e.length;b++){record=e[b];if(this.allowDup){var d=new Ext.data.Record();record.id=d.id;delete d;this.toMultiselect.view.store.add(record);}else{this.fromMultiselect.view.store.remove(record);this.toMultiselect.view.store.add(record);c.push((this.toMultiselect.view.store.getCount()-1));}}}this.toMultiselect.view.refresh();this.fromMultiselect.view.refresh();var a=this.toMultiselect.store.sortInfo;if(a){this.toMultiselect.store.sort(a.field,a.direction);}this.toMultiselect.view.select(c);},toFrom:function(){var b=this.toMultiselect.view.getSelectedIndexes();var c=[];if(b.length>0){for(var a=0;a<b.length;a++){record=this.toMultiselect.view.store.getAt(b[a]);c.push(record);}b=[];for(var a=0;a<c.length;a++){record=c[a];this.toMultiselect.view.store.remove(record);if(!this.allowDup){this.fromMultiselect.view.store.add(record);b.push((this.fromMultiselect.view.store.getCount()-1));}}}this.fromMultiselect.view.refresh();this.toMultiselect.view.refresh();var d=this.fromMultiselect.store.sortInfo;if(d){this.fromMultiselect.store.sort(d.field,d.direction);}this.fromMultiselect.view.select(b);},valueChanged:function(a){var c=null;var d=[];for(var b=0;b<a.getCount();b++){c=a.getAt(b);d.push(c.get(this.toMultiselect.valueField));}this.hiddenField.dom.value=d.join(this.delimiter);this.fireEvent("change",this,this.getValue(),this.hiddenField.dom.value);},getValue:function(){return this.hiddenField.dom.value;},onRowDblClick:function(a,c,d,b){if(a==this.toMultiselect.view){this.toFrom();}else{if(a==this.fromMultiselect.view){this.fromTo();}}return this.fireEvent("rowdblclick",a,c,d,b);},reset:function(){range=this.toMultiselect.store.getRange();this.toMultiselect.store.removeAll();this.fromMultiselect.store.add(range);var a=this.fromMultiselect.store.sortInfo;if(a){this.fromMultiselect.store.sort(a.field,a.direction);}this.valueChanged(this.toMultiselect.store);}});Ext.reg("itemselector",Ext.ux.form.ItemSelector);Ext.ux.ItemSelector=Ext.ux.form.ItemSelector;Ext.ns("Ext.ux.grid");Ext.ux.grid.LockingGridView=Ext.extend(Ext.grid.GridView,{lockText:"Lock",unlockText:"Unlock",rowBorderWidth:1,lockedBorderWidth:1,syncHeights:false,initTemplates:function(){var a=this.templates||{};if(!a.master){a.master=new Ext.Template('<div class="x-grid3" hidefocus="true">','<div class="x-grid3-locked">','<div class="x-grid3-header"><div class="x-grid3-header-inner"><div class="x-grid3-header-offset" style="{lstyle}">{lockedHeader}</div></div><div class="x-clear"></div></div>','<div class="x-grid3-scroller"><div class="x-grid3-body" style="{lstyle}">{lockedBody}</div><div class="x-grid3-scroll-spacer"></div></div>',"</div>",'<div class="x-grid3-viewport x-grid3-unlocked">','<div class="x-grid3-header"><div class="x-grid3-header-inner"><div class="x-grid3-header-offset" style="{ostyle}">{header}</div></div><div class="x-clear"></div></div>','<div class="x-grid3-scroller"><div class="x-grid3-body" style="{bstyle}">{body}</div><a href="#" class="x-grid3-focus" tabIndex="-1"></a></div>',"</div>",'<div class="x-grid3-resize-marker">&#160;</div>','<div class="x-grid3-resize-proxy">&#160;</div>',"</div>");}this.templates=a;Ext.ux.grid.LockingGridView.superclass.initTemplates.call(this);},getEditorParent:function(a){return this.el.dom;},initElements:function(){var a=Ext.Element;var c=this.grid.getGridEl().dom.firstChild;var b=c.childNodes;this.el=new a(c);this.lockedWrap=new a(b[0]);this.lockedHd=new a(this.lockedWrap.dom.firstChild);this.lockedInnerHd=this.lockedHd.dom.firstChild;this.lockedScroller=new a(this.lockedWrap.dom.childNodes[1]);this.lockedBody=new a(this.lockedScroller.dom.firstChild);this.mainWrap=new a(b[1]);this.mainHd=new a(this.mainWrap.dom.firstChild);if(this.grid.hideHeaders){this.lockedHd.setDisplayed(false);this.mainHd.setDisplayed(false);}this.innerHd=this.mainHd.dom.firstChild;this.scroller=new a(this.mainWrap.dom.childNodes[1]);if(this.forceFit){this.scroller.setStyle("overflow-x","hidden");}this.mainBody=new a(this.scroller.dom.firstChild);this.focusEl=new a(this.scroller.dom.childNodes[1]);this.focusEl.swallowEvent("click",true);this.resizeMarker=new a(b[2]);this.resizeProxy=new a(b[3]);},getLockedRows:function(){return this.hasRows()?this.lockedBody.dom.childNodes:[];},getLockedRow:function(a){return this.getLockedRows()[a];},getCell:function(a,b){var c=this.cm.getLockedCount();if(b<c){return this.getLockedRow(a).getElementsByTagName("td")[b];}return Ext.ux.grid.LockingGridView.superclass.getCell.call(this,a,b-c);},getHeaderCell:function(a){var b=this.cm.getLockedCount();if(a<b){return this.lockedHd.dom.getElementsByTagName("td")[a];}return Ext.ux.grid.LockingGridView.superclass.getHeaderCell.call(this,a-b);},addRowClass:function(a,b){var c=this.getLockedRow(a);if(c){this.fly(c).addClass(b);}Ext.ux.grid.LockingGridView.superclass.addRowClass.call(this,a,b);},removeRowClass:function(a,b){var c=this.getLockedRow(a);if(c){this.fly(c).removeClass(b);}Ext.ux.grid.LockingGridView.superclass.removeRowClass.call(this,a,b);},removeRow:function(a){Ext.removeNode(this.getLockedRow(a));Ext.ux.grid.LockingGridView.superclass.removeRow.call(this,a);},removeRows:function(a,c){var d=this.lockedBody.dom;for(var b=a;b<=c;b++){Ext.removeNode(d.childNodes[a]);}Ext.ux.grid.LockingGridView.superclass.removeRows.call(this,a,c);},syncScroll:function(a){var b=this.scroller.dom;this.lockedScroller.dom.scrollTop=b.scrollTop;Ext.ux.grid.LockingGridView.superclass.syncScroll.call(this,a);},updateSortIcon:function(f,e){var c=this.sortClasses,g=this.lockedHd.select("td").removeClass(c),b=this.mainHd.select("td").removeClass(c),a=this.cm.getLockedCount(),d=c[e=="DESC"?1:0];if(f<a){g.item(f).addClass(d);}else{b.item(f-a).addClass(d);}},updateAllColumnWidths:function(){var m=this.getTotalWidth(),c=this.cm.getColumnCount(),f=this.getLockedWidth(),h=this.cm.getLockedCount(),o=[],n,k;this.updateLockedWidth();for(k=0;k<c;k++){o[k]=this.getColumnWidth(k);var l=this.getHeaderCell(k);l.style.width=o[k];}var d=this.getLockedRows(),b=this.getRows(),e,a,g;for(k=0,n=b.length;k<n;k++){e=d[k];e.style.width=f;if(e.firstChild){e.firstChild.style.width=f;a=e.firstChild.rows[0];for(g=0;g<h;g++){a.childNodes[g].style.width=o[g];}}e=b[k];e.style.width=m;if(e.firstChild){e.firstChild.style.width=m;a=e.firstChild.rows[0];for(g=h;g<c;g++){a.childNodes[g-h].style.width=o[g];}}}this.onAllColumnWidthsUpdated(o,m);this.syncHeaderHeight();},updateColumnWidth:function(k,h){var f=this.getColumnWidth(k),l=this.cm.getLockedCount(),e,j,d,g;this.updateLockedWidth();if(k<l){e=this.getLockedRows();j=this.getLockedWidth();d=k;}else{e=this.getRows();j=this.getTotalWidth();d=k-l;}var a=this.getHeaderCell(k);a.style.width=f;for(var m=0,b=e.length;m<b;m++){g=e[m];g.style.width=j;if(g.firstChild){g.firstChild.style.width=j;g.firstChild.rows[0].childNodes[d].style.width=f;}}this.onColumnWidthUpdated(k,f,this.getTotalWidth());this.syncHeaderHeight();},updateColumnHidden:function(j,a){var k=this.cm.getLockedCount(),f,h,e,g,d=a?"none":"";this.updateLockedWidth();if(j<k){f=this.getLockedRows();h=this.getLockedWidth();e=j;}else{f=this.getRows();h=this.getTotalWidth();e=j-k;}var m=this.getHeaderCell(j);m.style.display=d;for(var l=0,b=f.length;l<b;l++){g=f[l];g.style.width=h;if(g.firstChild){g.firstChild.style.width=h;g.firstChild.rows[0].childNodes[e].style.display=d;}}this.onColumnHiddenUpdated(j,a,this.getTotalWidth());delete this.lastViewWidth;this.layout();},doRender:function(g,l,x,a,w,B){var d=this.templates,f=d.cell,h=d.row,n=w-1,e="width:"+this.getTotalWidth()+";",b="width:"+this.getLockedWidth()+";",q=[],v=[],z,k,s,y={},m={},t;for(var A=0,D=l.length;A<D;A++){t=l[A];z=[];k=[];var o=(A+a);for(var C=0;C<w;C++){s=g[C];y.id=s.id;y.css=(C===0?"x-grid3-cell-first ":(C==n?"x-grid3-cell-last ":""))+(this.cm.config[C].cellCls?" "+this.cm.config[C].cellCls:"");y.attr=y.cellAttr="";y.value=s.renderer(t.data[s.name],y,t,o,C,x);y.style=s.style;if(Ext.isEmpty(y.value)){y.value="&#160;";}if(this.markDirty&&t.dirty&&Ext.isDefined(t.modified[s.name])){y.css+=" x-grid3-dirty-cell";}if(s.locked){k[k.length]=f.apply(y);}else{z[z.length]=f.apply(y);}}var u=[];if(B&&((o+1)%2===0)){u[0]="x-grid3-row-alt";}if(t.dirty){u[1]=" x-grid3-dirty-row";}m.cols=w;if(this.getRowClass){u[2]=this.getRowClass(t,o,m,x);}m.alt=u.join(" ");m.cells=z.join("");m.tstyle=e;q[q.length]=h.apply(m);m.cells=k.join("");m.tstyle=b;v[v.length]=h.apply(m);}return[q.join(""),v.join("")];},processRows:function(c,m){if(!this.ds||this.ds.getCount()<1){return;}var e=this.getRows(),k=this.getLockedRows(),d,b;m=m||!this.grid.stripeRows;c=c||0;for(var h=0,j=e.length;h<j;++h){d=e[h];b=k[h];d.rowIndex=h;b.rowIndex=h;if(!m){d.className=d.className.replace(this.rowClsRe," ");b.className=b.className.replace(this.rowClsRe," ");if((h+1)%2===0){d.className+=" x-grid3-row-alt";b.className+=" x-grid3-row-alt";}}if(this.syncHeights){var g=Ext.get(d),f=Ext.get(b),a=g.getHeight(),l=f.getHeight();if(a>l){f.setHeight(a);}else{if(l>a){g.setHeight(l);}}}}if(c===0){Ext.fly(e[0]).addClass(this.firstRowCls);Ext.fly(k[0]).addClass(this.firstRowCls);}Ext.fly(e[e.length-1]).addClass(this.lastRowCls);Ext.fly(k[k.length-1]).addClass(this.lastRowCls);},afterRender:function(){if(!this.ds||!this.cm){return;}var a=this.renderRows()||["&#160;","&#160;"];this.mainBody.dom.innerHTML=a[0];this.lockedBody.dom.innerHTML=a[1];this.processRows(0,true);if(this.deferEmptyText!==true){this.applyEmptyText();}},renderUI:function(){var b=this.renderHeaders();var c=this.templates.body.apply({rows:"&#160;"});var d=this.templates.master.apply({body:c,header:b[0],ostyle:"width:"+this.getOffsetWidth()+";",bstyle:"width:"+this.getTotalWidth()+";",lockedBody:c,lockedHeader:b[1],lstyle:"width:"+this.getLockedWidth()+";"});var a=this.grid;a.getGridEl().dom.innerHTML=d;this.initElements();Ext.fly(this.innerHd).on("click",this.handleHdDown,this);Ext.fly(this.lockedInnerHd).on("click",this.handleHdDown,this);this.mainHd.on({scope:this,mouseover:this.handleHdOver,mouseout:this.handleHdOut,mousemove:this.handleHdMove});this.lockedHd.on({scope:this,mouseover:this.handleHdOver,mouseout:this.handleHdOut,mousemove:this.handleHdMove});this.scroller.on("scroll",this.syncScroll,this);if(a.enableColumnResize!==false){this.splitZone=new Ext.grid.GridView.SplitDragZone(a,this.mainHd.dom);this.splitZone.setOuterHandleElId(Ext.id(this.lockedHd.dom));this.splitZone.setOuterHandleElId(Ext.id(this.mainHd.dom));}if(a.enableColumnMove){this.columnDrag=new Ext.grid.GridView.ColumnDragZone(a,this.innerHd);this.columnDrag.setOuterHandleElId(Ext.id(this.lockedInnerHd));this.columnDrag.setOuterHandleElId(Ext.id(this.innerHd));this.columnDrop=new Ext.grid.HeaderDropZone(a,this.mainHd.dom);}if(a.enableHdMenu!==false){this.hmenu=new Ext.menu.Menu({id:a.id+"-hctx"});this.hmenu.add({itemId:"asc",text:this.sortAscText,cls:"xg-hmenu-sort-asc"},{itemId:"desc",text:this.sortDescText,cls:"xg-hmenu-sort-desc"});if(this.grid.enableColLock!==false){this.hmenu.add("-",{itemId:"lock",text:this.lockText,cls:"xg-hmenu-lock"},{itemId:"unlock",text:this.unlockText,cls:"xg-hmenu-unlock"});}if(a.enableColumnHide!==false){this.colMenu=new Ext.menu.Menu({id:a.id+"-hcols-menu"});this.colMenu.on({scope:this,beforeshow:this.beforeColMenuShow,itemclick:this.handleHdMenuClick});this.hmenu.add("-",{itemId:"columns",hideOnClick:false,text:this.columnsText,menu:this.colMenu,iconCls:"x-cols-icon"});}this.hmenu.on("itemclick",this.handleHdMenuClick,this);}if(a.trackMouseOver){this.mainBody.on({scope:this,mouseover:this.onRowOver,mouseout:this.onRowOut});this.lockedBody.on({scope:this,mouseover:this.onRowOver,mouseout:this.onRowOut});}if(a.enableDragDrop||a.enableDrag){this.dragZone=new Ext.grid.GridDragZone(a,{ddGroup:a.ddGroup||"GridDD"});}this.updateHeaderSortState();},layout:function(){if(!this.mainBody){return;}var a=this.grid;var e=a.getGridEl();var f=e.getSize(true);var h=f.width;if(!a.hideHeaders&&(h<20||f.height<20)){return;}this.syncHeaderHeight();if(a.autoHeight){this.scroller.dom.style.overflow="visible";this.lockedScroller.dom.style.overflow="visible";if(Ext.isWebKit){this.scroller.dom.style.position="static";this.lockedScroller.dom.style.position="static";}}else{this.el.setSize(f.width,f.height);var d=this.mainHd.getHeight();var b=f.height-(d);}this.updateLockedWidth();if(this.forceFit){if(this.lastViewWidth!=h){this.fitColumns(false,false);this.lastViewWidth=h;}}else{this.autoExpand();this.syncHeaderScroll();}this.onLayout(h,b);},getOffsetWidth:function(){return(this.cm.getTotalWidth()-this.cm.getTotalLockedWidth()+this.getScrollOffset())+"px";},renderHeaders:function(){var g=this.cm,e=this.templates,c=e.hcell,a=[],f=[],j={},d=g.getColumnCount(),h=d-1;for(var b=0;b<d;b++){j.id=g.getColumnId(b);j.value=g.getColumnHeader(b)||"";j.style=this.getColumnStyle(b,true);j.tooltip=this.getColumnTooltip(b);j.css=(b===0?"x-grid3-cell-first ":(b==h?"x-grid3-cell-last ":""))+(g.config[b].headerCls?" "+g.config[b].headerCls:"");if(g.config[b].align=="right"){j.istyle="padding-right:16px";}else{delete j.istyle;}if(g.isLocked(b)){f[f.length]=c.apply(j);}else{a[a.length]=c.apply(j);}}return[e.header.apply({cells:a.join(""),tstyle:"width:"+this.getTotalWidth()+";"}),e.header.apply({cells:f.join(""),tstyle:"width:"+this.getLockedWidth()+";"})];},updateHeaders:function(){var b=this.renderHeaders();this.innerHd.firstChild.innerHTML=b[0];this.innerHd.firstChild.style.width=this.getOffsetWidth();this.innerHd.firstChild.firstChild.style.width=this.getTotalWidth();this.lockedInnerHd.firstChild.innerHTML=b[1];var a=this.getLockedWidth();this.lockedInnerHd.firstChild.style.width=a;this.lockedInnerHd.firstChild.firstChild.style.width=a;},getResolvedXY:function(b){if(!b){return null;}var a=b.cell,d=b.row;return a?Ext.fly(a).getXY():[this.scroller.getX(),Ext.fly(d).getY()];},syncFocusEl:function(a,b,c){Ext.ux.grid.LockingGridView.superclass.syncFocusEl.call(this,a,b,b<this.cm.getLockedCount()?false:c);},ensureVisible:function(a,b,c){return Ext.ux.grid.LockingGridView.superclass.ensureVisible.call(this,a,b,b<this.cm.getLockedCount()?false:c);},insertRows:function(d,c,g,b){var f=d.getCount()-1;if(!b&&c===0&&g>=f){this.refresh();}else{if(!b){this.fireEvent("beforerowsinserted",this,c,g);}var e=this.renderRows(c,g),a=this.getRow(c);if(a){if(c===0){this.removeRowClass(0,this.firstRowCls);}Ext.DomHelper.insertHtml("beforeBegin",a,e[0]);a=this.getLockedRow(c);Ext.DomHelper.insertHtml("beforeBegin",a,e[1]);}else{this.removeRowClass(f-1,this.lastRowCls);Ext.DomHelper.insertHtml("beforeEnd",this.mainBody.dom,e[0]);Ext.DomHelper.insertHtml("beforeEnd",this.lockedBody.dom,e[1]);}if(!b){this.fireEvent("rowsinserted",this,c,g);this.processRows(c);}else{if(c===0||c>=f){this.addRowClass(c,c===0?this.firstRowCls:this.lastRowCls);}}}this.syncFocusEl(c);},getColumnStyle:function(c,a){var d=!a?this.cm.config[c].cellStyle||this.cm.config[c].css||"":this.cm.config[c].headerStyle||"";d+="width:"+this.getColumnWidth(c)+";";if(this.cm.isHidden(c)){d+="display:none;";}var b=this.cm.config[c].align;if(b){d+="text-align:"+b+";";}return d;},getLockedWidth:function(){return this.cm.getTotalLockedWidth()+"px";},getTotalWidth:function(){return(this.cm.getTotalWidth()-this.cm.getTotalLockedWidth())+"px";},getColumnData:function(){var b=[],d=this.cm,c=d.getColumnCount();for(var a=0;a<c;a++){var e=d.getDataIndex(a);b[a]={name:(!Ext.isDefined(e)?this.ds.fields.get(a).name:e),renderer:d.getRenderer(a),id:d.getColumnId(a),style:this.getColumnStyle(a),locked:d.isLocked(a)};}return b;},renderBody:function(){var a=this.renderRows()||["&#160;","&#160;"];return[this.templates.body.apply({rows:a[0]}),this.templates.body.apply({rows:a[1]})];},refreshRow:function(a){Ext.ux.grid.LockingGridView.superclass.refreshRow.call(this,a);var b=Ext.isNumber(a)?a:this.ds.indexOf(a);this.getLockedRow(b).rowIndex=b;},refresh:function(b){this.fireEvent("beforerefresh",this);this.grid.stopEditing(true);var a=this.renderBody();this.mainBody.update(a[0]).setWidth(this.getTotalWidth());this.lockedBody.update(a[1]).setWidth(this.getLockedWidth());if(b===true){this.updateHeaders();this.updateHeaderSortState();}this.processRows(0,true);this.layout();this.applyEmptyText();this.fireEvent("refresh",this);},onDenyColumnLock:function(){},initData:function(b,a){if(this.cm){this.cm.un("columnlockchange",this.onColumnLock,this);}Ext.ux.grid.LockingGridView.superclass.initData.call(this,b,a);if(this.cm){this.cm.on("columnlockchange",this.onColumnLock,this);}},onColumnLock:function(){this.refresh(true);},handleHdMenuClick:function(b){var e=this.hdCtxIndex,d=this.cm,c=b.getItemId(),a=d.getLockedCount();switch(c){case"lock":if(d.getColumnCount(true)<=a+1){this.onDenyColumnLock();return;}if(a!=e){d.setLocked(e,true,true);d.moveColumn(e,a);this.grid.fireEvent("columnmove",e,a);}else{d.setLocked(e,true);}break;case"unlock":if(a-1!=e){d.setLocked(e,false,true);d.moveColumn(e,a-1);this.grid.fireEvent("columnmove",e,a-1);}else{d.setLocked(e,false);}break;default:return Ext.ux.grid.LockingGridView.superclass.handleHdMenuClick.call(this,b);}return true;},handleHdDown:function(d,b){Ext.ux.grid.LockingGridView.superclass.handleHdDown.call(this,d,b);if(this.grid.enableColLock!==false){if(Ext.fly(b).hasClass("x-grid3-hd-btn")){var c=this.findHeaderCell(b),a=this.getCellIndex(c),g=this.hmenu.items,f=this.cm;g.get("lock").setDisabled(f.isLocked(a));g.get("unlock").setDisabled(!f.isLocked(a));}}},syncHeaderHeight:function(){this.innerHd.firstChild.firstChild.style.height="auto";this.lockedInnerHd.firstChild.firstChild.style.height="auto";var a=this.innerHd.firstChild.firstChild.offsetHeight,c=this.lockedInnerHd.firstChild.firstChild.offsetHeight,b=(c>a?c:a)+"px";this.innerHd.firstChild.firstChild.style.height=b;this.lockedInnerHd.firstChild.firstChild.style.height=b;},updateLockedWidth:function(){var a=this.cm.getTotalLockedWidth(),c=this.cm.getTotalWidth()-a,e=this.grid.getGridEl().getSize(true),d=Ext.isBorderBox?0:this.lockedBorderWidth,f=Ext.isBorderBox?0:this.rowBorderWidth,g=(e.width-a-d-f)+"px",h=this.getScrollOffset();if(!this.grid.autoHeight){var b=(e.height-this.mainHd.getHeight())+"px";this.lockedScroller.dom.style.height=b;this.scroller.dom.style.height=b;}this.lockedWrap.dom.style.width=(a+f)+"px";this.scroller.dom.style.width=g;this.mainWrap.dom.style.left=(a+d+f)+"px";if(this.innerHd){this.lockedInnerHd.firstChild.style.width=a+"px";this.lockedInnerHd.firstChild.firstChild.style.width=a+"px";this.innerHd.style.width=g;this.innerHd.firstChild.style.width=(c+f+h)+"px";this.innerHd.firstChild.firstChild.style.width=c+"px";}if(this.mainBody){this.lockedBody.dom.style.width=(a+f)+"px";this.mainBody.dom.style.width=(c+f)+"px";}}});Ext.ux.grid.LockingColumnModel=Ext.extend(Ext.grid.ColumnModel,{isLocked:function(a){return this.config[a].locked===true;},setLocked:function(c,a,b){if(this.isLocked(c)==a){return;}this.config[c].locked=a;if(!b){this.fireEvent("columnlockchange",this,c,a);}},getTotalLockedWidth:function(){var c=0;for(var a=0,b=this.config.length;a<b;a++){if(this.isLocked(a)&&!this.isHidden(a)){c+=this.getColumnWidth(a);}}return c;},getLockedCount:function(){for(var b=0,a=this.config.length;b<a;b++){if(!this.isLocked(b)){return b;}}},moveColumn:function(b,a){if(b<a&&this.isLocked(b)&&!this.isLocked(a)){this.setLocked(b,false,true);}else{if(b>a&&!this.isLocked(b)&&this.isLocked(a)){this.setLocked(b,true,true);}}Ext.ux.grid.LockingColumnModel.superclass.moveColumn.apply(this,arguments);}});Ext.ns("Ext.ux.form");Ext.ux.form.MultiSelect=Ext.extend(Ext.form.Field,{ddReorder:false,appendOnly:false,width:100,height:100,displayField:0,valueField:1,allowBlank:true,minSelections:0,maxSelections:Number.MAX_VALUE,blankText:Ext.form.TextField.prototype.blankText,minSelectionsText:"Minimum {0} item(s) required",maxSelectionsText:"Maximum {0} item(s) allowed",delimiter:",",defaultAutoCreate:{tag:"div"},initComponent:function(){Ext.ux.form.MultiSelect.superclass.initComponent.call(this);if(Ext.isArray(this.store)){if(Ext.isArray(this.store[0])){this.store=new Ext.data.ArrayStore({fields:["value","text"],data:this.store});this.valueField="value";}else{this.store=new Ext.data.ArrayStore({fields:["text"],data:this.store,expandData:true});this.valueField="text";}this.displayField="text";}else{this.store=Ext.StoreMgr.lookup(this.store);}this.addEvents({dblclick:true,click:true,change:true,drop:true});},onRender:function(a,d){Ext.ux.form.MultiSelect.superclass.onRender.call(this,a,d);var c=this.fs=new Ext.form.FieldSet({renderTo:this.el,title:this.legend,height:this.height,width:this.width,style:"padding:0;",tbar:this.tbar});c.body.addClass("ux-mselect");this.view=new Ext.ListView({multiSelect:true,store:this.store,columns:[{header:"Value",width:1,dataIndex:this.displayField}],hideHeaders:true});c.add(this.view);this.view.on("click",this.onViewClick,this);this.view.on("beforeclick",this.onViewBeforeClick,this);this.view.on("dblclick",this.onViewDblClick,this);this.hiddenName=this.name||Ext.id();var b={tag:"input",type:"hidden",value:"",name:this.hiddenName};this.hiddenField=this.el.createChild(b);this.hiddenField.dom.disabled=this.hiddenName!=this.name;c.doLayout();},afterRender:function(){Ext.ux.form.MultiSelect.superclass.afterRender.call(this);if(this.ddReorder&&!this.dragGroup&&!this.dropGroup){this.dragGroup=this.dropGroup="MultiselectDD-"+Ext.id();}if(this.draggable||this.dragGroup){this.dragZone=new Ext.ux.form.MultiSelect.DragZone(this,{ddGroup:this.dragGroup});}if(this.droppable||this.dropGroup){this.dropZone=new Ext.ux.form.MultiSelect.DropZone(this,{ddGroup:this.dropGroup});}},onViewClick:function(a,c,d,b){this.fireEvent("change",this,this.getValue(),this.hiddenField.dom.value);this.hiddenField.dom.value=this.getValue();this.fireEvent("click",this,b);this.validate();},onViewBeforeClick:function(a,c,d,b){if(this.disabled){return false;}},onViewDblClick:function(a,c,d,b){return this.fireEvent("dblclick",a,c,d,b);},getValue:function(c){var b=[];var a=this.view.getSelectedIndexes();if(a.length==0){return"";}for(var d=0;d<a.length;d++){b.push(this.store.getAt(a[d]).get((c!=null)?c:this.valueField));}return b.join(this.delimiter);},setValue:function(c){var d;var b=[];this.view.clearSelections();this.hiddenField.dom.value="";if(!c||(c=="")){return;}if(!Ext.isArray(c)){c=c.split(this.delimiter);}for(var a=0;a<c.length;a++){d=this.view.store.indexOf(this.view.store.query(this.valueField,new RegExp("^"+c[a]+"$","i")).itemAt(0));b.push(d);}this.view.select(b);this.hiddenField.dom.value=this.getValue();this.validate();},reset:function(){this.setValue("");},getRawValue:function(a){var b=this.getValue(a);if(b.length){b=b.split(this.delimiter);}else{b=[];}return b;},setRawValue:function(a){setValue(a);},validateValue:function(a){if(a.length<1){if(this.allowBlank){this.clearInvalid();return true;}else{this.markInvalid(this.blankText);return false;}}if(a.length<this.minSelections){this.markInvalid(String.format(this.minSelectionsText,this.minSelections));return false;}if(a.length>this.maxSelections){this.markInvalid(String.format(this.maxSelectionsText,this.maxSelections));return false;}return true;},disable:function(){this.disabled=true;this.hiddenField.dom.disabled=true;this.fs.disable();},enable:function(){this.disabled=false;this.hiddenField.dom.disabled=false;this.fs.enable();},destroy:function(){Ext.destroy(this.fs,this.dragZone,this.dropZone);Ext.ux.form.MultiSelect.superclass.destroy.call(this);}});Ext.reg("multiselect",Ext.ux.form.MultiSelect);Ext.ux.Multiselect=Ext.ux.form.MultiSelect;Ext.ux.form.MultiSelect.DragZone=function(b,a){this.ms=b;this.view=b.view;var d=a.ddGroup||"MultiselectDD";var c;if(Ext.isArray(d)){c=d.shift();}else{c=d;d=null;}Ext.ux.form.MultiSelect.DragZone.superclass.constructor.call(this,this.ms.fs.body,{containerScroll:true,ddGroup:c});this.setDraggable(d);};Ext.extend(Ext.ux.form.MultiSelect.DragZone,Ext.dd.DragZone,{onInitDrag:function(b,a){var c=Ext.get(this.dragData.ddel.cloneNode(true));this.proxy.update(c.dom);c.setWidth(c.child("em").getWidth());this.onStartDrag(b,a);return true;},collectSelection:function(b){b.repairXY=Ext.fly(this.view.getSelectedNodes()[0]).getXY();var a=0;this.view.store.each(function(c){if(this.view.isSelected(a)){var d=this.view.getNode(a);var e=d.cloneNode(true);e.id=Ext.id();b.ddel.appendChild(e);b.records.push(this.view.store.getAt(a));b.viewNodes.push(d);}a++;},this);},onEndDrag:function(b,c){var a=Ext.get(this.dragData.ddel);if(a&&a.hasClass("multi-proxy")){a.remove();}},getDragData:function(b){var a=this.view.findItemFromChild(b.getTarget());if(a){if(!this.view.isSelected(a)&&!b.ctrlKey&&!b.shiftKey){this.view.select(a);this.ms.setValue(this.ms.getValue());}if(this.view.getSelectionCount()==0||b.ctrlKey||b.shiftKey){return false;}var f={sourceView:this.view,viewNodes:[],records:[]};if(this.view.getSelectionCount()==1){var d=this.view.getSelectedIndexes()[0];var c=this.view.getNode(d);f.viewNodes.push(f.ddel=c);f.records.push(this.view.store.getAt(d));f.repairXY=Ext.fly(c).getXY();}else{f.ddel=document.createElement("div");f.ddel.className="multi-proxy";this.collectSelection(f);}return f;}return false;},getRepairXY:function(a){return this.dragData.repairXY;},setDraggable:function(a){if(!a){return;}if(Ext.isArray(a)){Ext.each(a,this.setDraggable,this);return;}this.addToGroup(a);}});Ext.ux.form.MultiSelect.DropZone=function(b,a){this.ms=b;this.view=b.view;var d=a.ddGroup||"MultiselectDD";var c;if(Ext.isArray(d)){c=d.shift();}else{c=d;d=null;}Ext.ux.form.MultiSelect.DropZone.superclass.constructor.call(this,this.ms.fs.body,{containerScroll:true,ddGroup:c});this.setDroppable(d);};Ext.extend(Ext.ux.form.MultiSelect.DropZone,Ext.dd.DropZone,{getTargetFromEvent:function(b){var a=b.getTarget();return a;},getDropPoint:function(d,k,h){if(k==this.ms.fs.body.dom){return"below";}var j=Ext.lib.Dom.getY(k),a=j+k.offsetHeight;var g=j+(a-j)/2;var f=Ext.lib.Event.getPageY(d);if(f<=g){return"above";}else{return"below";}},isValidDropPoint:function(e,b,c){if(!c.viewNodes||(c.viewNodes.length!=1)){return true;}var a=c.viewNodes[0];if(a==b){return false;}if((e=="below")&&(b.nextSibling==a)){return false;}if((e=="above")&&(b.previousSibling==a)){return false;}return true;},onNodeEnter:function(b,c,a,d){return false;},onNodeOver:function(c,d,b,h){var f=this.dropNotAllowed;var a=this.getDropPoint(b,c,d);if(this.isValidDropPoint(a,c,h)){if(this.ms.appendOnly){return"x-tree-drop-ok-below";}if(a){var g;if(a=="above"){f=c.previousSibling?"x-tree-drop-ok-between":"x-tree-drop-ok-above";g="x-view-drag-insert-above";}else{f=c.nextSibling?"x-tree-drop-ok-between":"x-tree-drop-ok-below";g="x-view-drag-insert-below";}if(this.lastInsertClass!=g){Ext.fly(c).replaceClass(this.lastInsertClass,g);this.lastInsertClass=g;}}}return f;},onNodeOut:function(b,c,a,d){this.removeDropIndicators(b);},onNodeDrop:function(a,h,g,d){if(this.ms.fireEvent("drop",this,a,h,g,d)===false){return false;}var j=this.getDropPoint(g,a,h);if(a!=this.ms.fs.body.dom){a=this.view.findItemFromChild(a);}if(this.ms.appendOnly){insertAt=this.view.store.getCount();}else{insertAt=a==this.ms.fs.body.dom?this.view.store.getCount()-1:this.view.indexOf(a);if(j=="below"){insertAt++;}}var b=false;if(d.sourceView==this.view){if(j=="below"){if(d.viewNodes[0]==a){d.viewNodes.shift();}}else{if(d.viewNodes[d.viewNodes.length-1]==a){d.viewNodes.pop();}}if(!d.viewNodes.length){return false;}if(insertAt>this.view.store.indexOf(d.records[0])){b="down";insertAt--;}}for(var f=0;f<d.records.length;f++){var k=d.records[f];if(d.sourceView){d.sourceView.store.remove(k);}this.view.store.insert(b=="down"?insertAt:insertAt++,k);var c=this.view.store.sortInfo;if(c){this.view.store.sort(c.field,c.direction);}}return true;},removeDropIndicators:function(a){if(a){Ext.fly(a).removeClass(["x-view-drag-insert-above","x-view-drag-insert-left","x-view-drag-insert-right","x-view-drag-insert-below"]);this.lastInsertClass="_noclass";}},setDroppable:function(a){if(!a){return;}if(Ext.isArray(a)){Ext.each(a,this.setDroppable,this);return;}this.addToGroup(a);}});if(!Array.prototype.map){Array.prototype.map=function(e){var d=this.length;if(typeof e!="function"){throw new TypeError();}var c=new Array(d);var b=arguments[1];for(var a=0;a<d;a++){if(a in this){c[a]=e.call(b,this[a],a,this);}}return c;};}Ext.ns("Ext.ux.data");Ext.ux.data.PagingMemoryProxy=Ext.extend(Ext.data.MemoryProxy,{constructor:function(a){Ext.ux.data.PagingMemoryProxy.superclass.constructor.call(this);this.data=a;},doRequest:function(k,l,j,m,c,d,f){j=j||{};var g;try{g=m.readRecords(this.data);}catch(a){this.fireEvent("loadexception",this,f,null,a);c.call(d,null,f,false);return;}if(j.filter!==undefined){g.records=g.records.filter(function(e){if(typeof(e)=="object"){var n=j.filterCol||0;return String(e.data[n]).match(j.filter)?true:false;}else{return String(e).match(j.filter)?true:false;}});g.totalRecords=g.records.length;}if(j.sort!==undefined){var h=String(j.dir).toUpperCase()=="DESC"?-1:1;var b=function(e,n){return e>n?1:(e<n?-1:0);};g.records.sort(function(o,n){var e=0;if(typeof(o)=="object"){e=b(o.data[j.sort],n.data[j.sort])*h;}else{e=b(o,n)*h;}if(e==0){e=(o.index<n.index?-1:1);}return e;});}if(j.start!==undefined&&j.limit!==undefined){g.records=g.records.slice(j.start,j.start+j.limit);}c.call(d,g,f,true);}});Ext.data.PagingMemoryProxy=Ext.ux.data.PagingMemoryProxy;Ext.ux.PanelResizer=Ext.extend(Ext.util.Observable,{minHeight:0,maxHeight:10000000,constructor:function(a){Ext.apply(this,a);this.events={};Ext.ux.PanelResizer.superclass.constructor.call(this,a);},init:function(a){this.panel=a;if(this.panel.elements.indexOf("footer")==-1){a.elements+=",footer";}a.on("render",this.onRender,this);},onRender:function(a){this.handle=a.footer.createChild({cls:"x-panel-resize"});this.tracker=new Ext.dd.DragTracker({onStart:this.onDragStart.createDelegate(this),onDrag:this.onDrag.createDelegate(this),onEnd:this.onDragEnd.createDelegate(this),tolerance:3,autoStart:300});this.tracker.initEl(this.handle);a.on("beforedestroy",this.tracker.destroy,this.tracker);},onDragStart:function(a){this.dragging=true;this.startHeight=this.panel.el.getHeight();this.fireEvent("dragstart",this,a);},onDrag:function(a){this.panel.setHeight((this.startHeight-this.tracker.getOffset()[1]).constrain(this.minHeight,this.maxHeight));this.fireEvent("drag",this,a);},onDragEnd:function(a){this.dragging=false;this.fireEvent("dragend",this,a);}});Ext.preg("panelresizer",Ext.ux.PanelResizer);Ext.ux.Portal=Ext.extend(Ext.Panel,{layout:"column",autoScroll:true,cls:"x-portal",defaultType:"portalcolumn",initComponent:function(){Ext.ux.Portal.superclass.initComponent.call(this);this.addEvents({validatedrop:true,beforedragover:true,dragover:true,beforedrop:true,drop:true});},initEvents:function(){Ext.ux.Portal.superclass.initEvents.call(this);this.dd=new Ext.ux.Portal.DropZone(this,this.dropConfig);},beforeDestroy:function(){if(this.dd){this.dd.unreg();}Ext.ux.Portal.superclass.beforeDestroy.call(this);}});Ext.reg("portal",Ext.ux.Portal);Ext.ux.Portal.DropZone=function(a,b){this.portal=a;Ext.dd.ScrollManager.register(a.body);Ext.ux.Portal.DropZone.superclass.constructor.call(this,a.bwrap.dom,b);a.body.ddScrollConfig=this.ddScrollConfig;};Ext.extend(Ext.ux.Portal.DropZone,Ext.dd.DropTarget,{ddScrollConfig:{vthresh:50,hthresh:-1,animate:true,increment:200},createEvent:function(g,b,a,h,f,d){return{portal:this.portal,panel:a.panel,columnIndex:h,column:f,position:d,data:a,source:g,rawEvent:b,status:this.dropAllowed};},notifyOver:function(w,u,x){var g=u.getXY(),a=this.portal,r=w.proxy;if(!this.grid){this.grid=this.getGrid();}var b=a.body.dom.clientWidth;if(!this.lastCW){this.lastCW=b;}else{if(this.lastCW!=b){this.lastCW=b;a.doLayout();this.grid=this.getGrid();}}var f=0,o=this.grid.columnX,q=false;for(var j=o.length;f<j;f++){if(g[0]<(o[f].x+o[f].w)){q=true;break;}}if(!q){f--;}var t,n=false,l=0,v=a.items.itemAt(f),s=v.items.items,m=false;for(var j=s.length;l<j;l++){t=s[l];var d=t.el.getHeight();if(d===0){m=true;}else{if((t.el.getY()+(d/2))>g[1]){n=true;break;}}}l=(n&&t?l:v.items.getCount())+(m?-1:0);var k=this.createEvent(w,u,x,f,v,l);if(a.fireEvent("validatedrop",k)!==false&&a.fireEvent("beforedragover",k)!==false){r.getProxy().setWidth("auto");if(t){r.moveProxy(t.el.dom.parentNode,n?t.el.dom:null);}else{r.moveProxy(v.el.dom,null);}this.lastPos={c:v,col:f,p:m||(n&&t)?l:false};this.scrollPos=a.body.getScroll();a.fireEvent("dragover",k);return k.status;}else{return k.status;}},notifyOut:function(){delete this.grid;},notifyDrop:function(k,f,b){delete this.grid;if(!this.lastPos){return;}var h=this.lastPos.c,a=this.lastPos.col,j=this.lastPos.p;var m=this.createEvent(k,f,b,a,h,j!==false?j:h.items.getCount());if(this.portal.fireEvent("validatedrop",m)!==false&&this.portal.fireEvent("beforedrop",m)!==false){k.proxy.getProxy().remove();k.panel.el.dom.parentNode.removeChild(k.panel.el.dom);if(j!==false){if(h==k.panel.ownerCt&&(h.items.items.indexOf(k.panel)<=j)){j++;}h.insert(j,k.panel);}else{h.add(k.panel);}h.doLayout();this.portal.fireEvent("drop",m);var l=this.scrollPos.top;if(l){var g=this.portal.body.dom;setTimeout(function(){g.scrollTop=l;},10);}}delete this.lastPos;},getGrid:function(){var a=this.portal.bwrap.getBox();a.columnX=[];this.portal.items.each(function(b){a.columnX.push({x:b.el.getX(),w:b.el.getWidth()});});return a;},unreg:function(){Ext.ux.Portal.DropZone.superclass.unreg.call(this);}});Ext.ux.PortalColumn=Ext.extend(Ext.Container,{layout:"anchor",defaultType:"portlet",cls:"x-portal-column"});Ext.reg("portalcolumn",Ext.ux.PortalColumn);Ext.ux.Portlet=Ext.extend(Ext.Panel,{anchor:"100%",frame:true,collapsible:true,draggable:true,cls:"x-portlet"});Ext.reg("portlet",Ext.ux.Portlet);Ext.ux.ProgressBarPager=Ext.extend(Object,{progBarWidth:225,defaultText:"Loading...",defaultAnimCfg:{duration:1,easing:"bounceOut"},constructor:function(a){if(a){Ext.apply(this,a);}},init:function(a){if(a.displayInfo){this.parent=a;var b=a.items.indexOf(a.displayItem);a.remove(a.displayItem,true);this.progressBar=new Ext.ProgressBar({text:this.defaultText,width:this.progBarWidth,animate:this.defaultAnimCfg});a.displayItem=this.progressBar;a.add(a.displayItem);a.doLayout();Ext.apply(a,this.parentOverrides);this.progressBar.on("render",function(c){c.mon(c.getEl().applyStyles("cursor:pointer"),"click",this.handleProgressBarClick,this);},this,{single:true});}},handleProgressBarClick:function(b){var g=this.parent,d=g.displayItem,h=this.progressBar.getBox(),a=b.getXY(),f=a[0]-h.x,c=Math.ceil(g.store.getTotalCount()/g.pageSize),j=Math.ceil(f/(d.width/c));g.changePage(j);},parentOverrides:{updateInfo:function(){if(this.displayItem){var e=this.store.getCount(),d=this.getPageData(),b=this.readPage(d),c=e==0?this.emptyMsg:String.format(this.displayMsg,this.cursor+1,this.cursor+e,this.store.getTotalCount());b=d.activePage;var a=b/d.pages;this.displayItem.updateProgress(a,c,this.animate||this.defaultAnimConfig);}}}});Ext.preg("progressbarpager",Ext.ux.ProgressBarPager);Ext.ns("Ext.ux.grid");Ext.ux.grid.RowEditor=Ext.extend(Ext.Panel,{floating:true,shadow:false,layout:"hbox",cls:"x-small-editor",buttonAlign:"center",baseCls:"x-row-editor",elements:"header,footer,body",frameWidth:5,buttonPad:3,clicksToEdit:"auto",monitorValid:true,focusDelay:250,errorSummary:true,saveText:"Save",cancelText:"Cancel",commitChangesText:"You need to commit or cancel your changes",errorText:"Errors",defaults:{normalWidth:true},initComponent:function(){Ext.ux.grid.RowEditor.superclass.initComponent.call(this);this.addEvents("beforeedit","canceledit","validateedit","afteredit");},init:function(a){this.grid=a;this.ownerCt=a;if(this.clicksToEdit===2){a.on("rowdblclick",this.onRowDblClick,this);}else{a.on("rowclick",this.onRowClick,this);if(Ext.isIE){a.on("rowdblclick",this.onRowDblClick,this);}}a.getStore().on("remove",function(){this.stopEditing(false);},this);a.on({scope:this,keydown:this.onGridKey,columnresize:this.verifyLayout,columnmove:this.refreshFields,reconfigure:this.refreshFields,beforedestroy:this.beforedestroy,destroy:this.destroy,bodyscroll:{buffer:250,fn:this.positionButtons}});a.getColumnModel().on("hiddenchange",this.verifyLayout,this,{delay:1});a.getView().on("refresh",this.stopEditing.createDelegate(this,[]));},beforedestroy:function(){this.grid.getStore().un("remove",this.onStoreRemove,this);this.stopEditing(false);Ext.destroy(this.btns);},refreshFields:function(){this.initFields();this.verifyLayout();},isDirty:function(){var a;this.items.each(function(b){if(String(this.values[b.id])!==String(b.getValue())){a=true;return false;}},this);return a;},startEditing:function(o,e){if(this.editing&&this.isDirty()){this.showTooltip(this.commitChangesText);return;}if(Ext.isObject(o)){o=this.grid.getStore().indexOf(o);}if(this.fireEvent("beforeedit",this,o)!==false){this.editing=true;var l=this.grid,p=l.getView(),d=p.getRow(o),j=l.store.getAt(o);this.record=j;this.rowIndex=o;this.values={};if(!this.rendered){this.render(p.getEditorParent());}var a=Ext.fly(d).getWidth();this.setSize(a);if(!this.initialized){this.initFields();}var b=l.getColumnModel(),k=this.items.items,n,c;for(var h=0,m=b.getColumnCount();h<m;h++){c=this.preEditValue(j,b.getDataIndex(h));n=k[h];n.setValue(c);this.values[n.id]=Ext.isEmpty(c)?"":c;}this.verifyLayout(true);if(!this.isVisible()){this.setPagePosition(Ext.fly(d).getXY());}else{this.el.setXY(Ext.fly(d).getXY(),{duration:0.15});}if(!this.isVisible()){this.show().doLayout();}if(e!==false){this.doFocus.defer(this.focusDelay,this);}}},stopEditing:function(f){this.editing=false;if(!this.isVisible()){return;}if(f===false||!this.isValid()){this.hide();this.fireEvent("canceledit",this,f===false);return;}var b={},h=this.record,c=false,e=this.grid.colModel,l=this.items.items;for(var k=0,a=e.getColumnCount();k<a;k++){if(!e.isHidden(k)){var j=e.getDataIndex(k);if(!Ext.isEmpty(j)){var g=h.data[j],d=this.postEditValue(l[k].getValue(),g,h,j);if(String(g)!==String(d)){b[j]=d;c=true;}}}}if(c&&this.fireEvent("validateedit",this,b,h,this.rowIndex)!==false){h.beginEdit();Ext.iterate(b,function(n,m){h.set(n,m);});h.endEdit();this.fireEvent("afteredit",this,b,h,this.rowIndex);}this.hide();},verifyLayout:function(a){if(this.el&&(this.isVisible()||a===true)){var c=this.grid.getView().getRow(this.rowIndex);this.setSize(Ext.fly(c).getWidth(),Ext.isIE?Ext.fly(c).getHeight()+9:undefined);var f=this.grid.colModel,e=this.items.items;for(var g=0,d=f.getColumnCount();g<d;g++){if(!f.isHidden(g)){var b=0;if(g===(d-1)){b+=3;}else{b+=1;}e[g].show();e[g].setWidth(f.getColumnWidth(g)-b);}else{e[g].hide();}}this.doLayout();this.positionButtons();}},slideHide:function(){this.hide();},initFields:function(){var g=this.grid.getColumnModel(),d=Ext.layout.ContainerLayout.prototype.parseMargins;this.removeAll(false);for(var b=0,f=g.getColumnCount();b<f;b++){var e=g.getColumnAt(b),a=e.getEditor();if(!a){a=e.displayEditor||new Ext.form.DisplayField();}else{a=a.field;}if(b==0){a.margins=d("0 1 2 1");}else{if(b==f-1){a.margins=d("0 0 2 1");}else{a.margins=d("0 1 2");}}a.setWidth(g.getColumnWidth(b));a.column=e;if(a.ownerCt!==this){a.on("focus",this.ensureVisible,this);a.on("specialkey",this.onKey,this);}this.insert(b,a);}this.initialized=true;},onKey:function(a,b){if(b.getKey()===b.ENTER){this.stopEditing(true);b.stopPropagation();}},onGridKey:function(a){if(a.getKey()===a.ENTER&&!this.isVisible()){var c=this.grid.getSelectionModel().getSelected();if(c){var b=this.grid.store.indexOf(c);this.startEditing(b);a.stopPropagation();}}},ensureVisible:function(a){if(this.isVisible()){this.grid.getView().ensureVisible(this.rowIndex,this.grid.colModel.getIndexById(a.column.id),true);}},onRowClick:function(d,b,a){if(this.clicksToEdit=="auto"){var c=this.lastClickIndex;this.lastClickIndex=b;if(c!=b&&!this.isVisible()){return;}}this.startEditing(b,false);this.doFocus.defer(this.focusDelay,this,[a.getPoint()]);},onRowDblClick:function(b,a,c){this.startEditing(a,false);this.doFocus.defer(this.focusDelay,this,[c.getPoint()]);},onRender:function(){Ext.ux.grid.RowEditor.superclass.onRender.apply(this,arguments);this.el.swallowEvent(["keydown","keyup","keypress"]);this.btns=new Ext.Panel({baseCls:"x-plain",cls:"x-btns",elements:"body",layout:"table",width:(this.minButtonWidth*2)+(this.frameWidth*2)+(this.buttonPad*4),items:[{ref:"saveBtn",itemId:"saveBtn",xtype:"button",text:this.saveText,width:this.minButtonWidth,handler:this.stopEditing.createDelegate(this,[true])},{xtype:"button",text:this.cancelText,width:this.minButtonWidth,handler:this.stopEditing.createDelegate(this,[false])}]});this.btns.render(this.bwrap);},afterRender:function(){Ext.ux.grid.RowEditor.superclass.afterRender.apply(this,arguments);this.positionButtons();if(this.monitorValid){this.startMonitoring();}},onShow:function(){if(this.monitorValid){this.startMonitoring();}Ext.ux.grid.RowEditor.superclass.onShow.apply(this,arguments);},onHide:function(){Ext.ux.grid.RowEditor.superclass.onHide.apply(this,arguments);this.stopMonitoring();this.grid.getView().focusRow(this.rowIndex);},positionButtons:function(){if(this.btns){var c=this.grid,b=this.el.dom.clientHeight,f=c.getView(),e=f.scroller.dom.scrollLeft,d=this.btns.getWidth(),a=Math.min(c.getWidth(),c.getColumnModel().getTotalWidth());this.btns.el.shift({left:(a/2)-(d/2)+e,top:b-2,stopFx:true,duration:0.2});}},preEditValue:function(b,a){var c=b.data[a];return this.autoEncode&&typeof c==="string"?Ext.util.Format.htmlDecode(c):c;},postEditValue:function(a,c,d,b){return this.autoEncode&&typeof a=="string"?Ext.util.Format.htmlEncode(a):a;},doFocus:function(b){if(this.isVisible()){var h=0,g=this.grid.getColumnModel(),d,f;if(b){h=this.getTargetColumnIndex(b);}for(var a=h||0,e=g.getColumnCount();a<e;a++){d=g.getColumnAt(a);f=d.getEditor();if(!d.hidden&&f){f.field.focus();break;}}}},getTargetColumnIndex:function(j){var k=this.grid,h=k.view,g=j.left,e=k.colModel.config,a=0,b=false;for(var d=e.length,f;f=e[a];a++){if(!f.hidden){if(Ext.fly(h.getHeaderCell(a)).getRegion().right>=g){b=a;break;}}}return b;},startMonitoring:function(){if(!this.bound&&this.monitorValid){this.bound=true;Ext.TaskMgr.start({run:this.bindHandler,interval:this.monitorPoll||200,scope:this});}},stopMonitoring:function(){this.bound=false;if(this.tooltip){this.tooltip.hide();}},isValid:function(){var a=true;this.items.each(function(b){if(!b.isValid(true)){a=false;return false;}});return a;},bindHandler:function(){if(!this.bound){return false;}var a=this.isValid();if(!a&&this.errorSummary){this.showTooltip(this.getErrorText().join(""));}this.btns.saveBtn.setDisabled(!a);this.fireEvent("validation",this,a);},showTooltip:function(d){var a=this.tooltip;if(!a){a=this.tooltip=new Ext.ToolTip({maxWidth:600,cls:"errorTip",width:300,title:this.errorText,autoHide:false,anchor:"left",anchorToTarget:true,mouseOffset:[40,0]});}var f=this.grid.getView(),c=parseInt(this.el.dom.style.top,10),e=f.scroller.dom.scrollTop,b=this.el.getHeight();if(c+b>=e){a.initTarget(this.items.last().getEl());if(!a.rendered){a.show();a.hide();}a.body.update(d);a.doAutoWidth(20);a.show();}else{if(a.rendered){a.hide();}}},getErrorText:function(){var a=["<ul>"];this.items.each(function(b){if(!b.isValid(true)){a.push("<li>",b.getActiveError(),"</li>");}});a.push("</ul>");return a;}});Ext.preg("roweditor",Ext.ux.grid.RowEditor);Ext.ns("Ext.ux.grid");Ext.ux.grid.RowExpander=Ext.extend(Ext.util.Observable,{expandOnEnter:true,expandOnDblClick:true,header:"",width:20,sortable:false,fixed:true,menuDisabled:true,dataIndex:"",id:"expander",lazyRender:true,enableCaching:true,constructor:function(a){Ext.apply(this,a);this.addEvents({beforeexpand:true,expand:true,beforecollapse:true,collapse:true});Ext.ux.grid.RowExpander.superclass.constructor.call(this);if(this.tpl){if(typeof this.tpl=="string"){this.tpl=new Ext.Template(this.tpl);}this.tpl.compile();}this.state={};this.bodyContent={};},getRowClass:function(d,c,b,a){b.cols=b.cols-1;var e=this.bodyContent[d.id];if(!e&&!this.lazyRender){e=this.getBodyContent(d,c);}if(e){b.body=e;}return this.state[d.id]?"x-grid3-row-expanded":"x-grid3-row-collapsed";},init:function(b){this.grid=b;var a=b.getView();a.getRowClass=this.getRowClass.createDelegate(this);a.enableRowBody=true;b.on("render",this.onRender,this);b.on("destroy",this.onDestroy,this);},onRender:function(){var a=this.grid;var b=a.getView().mainBody;b.on("mousedown",this.onMouseDown,this,{delegate:".x-grid3-row-expander"});if(this.expandOnEnter){this.keyNav=new Ext.KeyNav(this.grid.getGridEl(),{enter:this.onEnter,scope:this});}if(this.expandOnDblClick){a.on("rowdblclick",this.onRowDblClick,this);}},onDestroy:function(){if(this.keyNav){this.keyNav.disable();delete this.keyNav;}var a=this.grid.getView().mainBody;if(a){a.un("mousedown",this.onMouseDown,this);}},onRowDblClick:function(b,c,a){this.toggleRow(c);},onEnter:function(b){var a=this.grid;var c=a.getSelectionModel();var f=c.getSelections();for(var h=0,d=f.length;h<d;h++){var j=a.getStore().indexOf(f[h]);this.toggleRow(j);}},getBodyContent:function(b,c){if(!this.enableCaching){return this.tpl.apply(b.data);}var a=this.bodyContent[b.id];if(!a){a=this.tpl.apply(b.data);this.bodyContent[b.id]=a;}return a;},onMouseDown:function(c,b){c.stopEvent();var a=c.getTarget(".x-grid3-row");this.toggleRow(a);},renderer:function(c,a,b){a.cellAttr='rowspan="2"';return'<div class="x-grid3-row-expander">&#160;</div>';},beforeExpand:function(c,b,a){if(this.fireEvent("beforeexpand",this,c,b,a)!==false){if(this.tpl&&this.lazyRender){b.innerHTML=this.getBodyContent(c,a);}return true;}else{return false;}},toggleRow:function(a){if(typeof a=="number"){a=this.grid.view.getRow(a);}this[Ext.fly(a).hasClass("x-grid3-row-collapsed")?"expandRow":"collapseRow"](a);},expandRow:function(a){if(typeof a=="number"){a=this.grid.view.getRow(a);}var c=this.grid.store.getAt(a.rowIndex);var b=Ext.DomQuery.selectNode("tr:nth(2) div.x-grid3-row-body",a);if(this.beforeExpand(c,b,a.rowIndex)){this.state[c.id]=true;Ext.fly(a).replaceClass("x-grid3-row-collapsed","x-grid3-row-expanded");this.fireEvent("expand",this,c,b,a.rowIndex);}},collapseRow:function(a){if(typeof a=="number"){a=this.grid.view.getRow(a);}var c=this.grid.store.getAt(a.rowIndex);var b=Ext.fly(a).child("tr:nth(1) div.x-grid3-row-body",true);if(this.fireEvent("beforecollapse",this,c,b,a.rowIndex)!==false){this.state[c.id]=false;Ext.fly(a).replaceClass("x-grid3-row-expanded","x-grid3-row-collapsed");this.fireEvent("collapse",this,c,b,a.rowIndex);}}});Ext.preg("rowexpander",Ext.ux.grid.RowExpander);Ext.grid.RowExpander=Ext.ux.grid.RowExpander;Ext.ns("Ext.ux.layout");Ext.ux.layout.RowLayout=Ext.extend(Ext.layout.ContainerLayout,{monitorResize:true,type:"row",allowContainerRemove:false,isValidParent:function(b,a){return this.innerCt&&b.getPositionEl().dom.parentNode==this.innerCt.dom;},getLayoutTargetSize:function(){var b=this.container.getLayoutTarget(),a;if(b){a=b.getViewSize();a.width-=b.getPadding("lr");a.height-=b.getPadding("tb");}return a;},renderAll:function(a,b){if(!this.innerCt){this.innerCt=b.createChild({cls:"x-column-inner"});this.innerCt.createChild({cls:"x-clear"});}Ext.layout.ColumnLayout.superclass.renderAll.call(this,a,this.innerCt);},onLayout:function(c,e){var k=c.items.items,d=k.length,j,l;this.renderAll(c,e);var g=this.getLayoutTargetSize();if(g.width<1&&g.height<1){return;}var a=g.height,b=a;this.innerCt.setSize({height:a});for(l=0;l<d;l++){j=k[l];if(!j.rowHeight){b-=(j.getHeight()+j.getEl().getMargins("tb"));}}b=b<0?0:b;for(l=0;l<d;l++){j=k[l];if(j.rowHeight){j.setSize({height:Math.floor(j.rowHeight*b)-j.getEl().getMargins("tb")});}}if(Ext.isIE){if(l=e.getStyle("overflow")&&l!="hidden"&&!this.adjustmentPass){var f=this.getLayoutTargetSize();if(f.width!=g.width){this.adjustmentPass=true;this.layoutTargetSize=f;this.onLayout(c,e);}}}delete this.adjustmentPass;}});Ext.Container.LAYOUTS["ux.row"]=Ext.ux.layout.RowLayout;Ext.ns("Ext.ux.form");Ext.ux.form.SearchField=Ext.extend(Ext.form.TwinTriggerField,{initComponent:function(){Ext.ux.form.SearchField.superclass.initComponent.call(this);this.on("specialkey",function(a,b){if(b.getKey()==b.ENTER){this.onTrigger2Click();}},this);},validationEvent:false,validateOnBlur:false,trigger1Class:"x-form-clear-trigger",trigger2Class:"x-form-search-trigger",hideTrigger1:true,width:180,hasSearch:false,paramName:"query",onTrigger1Click:function(){if(this.hasSearch){this.el.dom.value="";var a={start:0};this.store.baseParams=this.store.baseParams||{};this.store.baseParams[this.paramName]="";this.store.reload({params:a});this.triggers[0].hide();this.hasSearch=false;}},onTrigger2Click:function(){var a=this.getRawValue();if(a.length<1){this.onTrigger1Click();return;}var b={start:0};this.store.baseParams=this.store.baseParams||{};this.store.baseParams[this.paramName]=a;this.store.reload({params:b});this.hasSearch=true;this.triggers[0].show();}});Ext.ns("Ext.ux.form");Ext.ux.form.SelectBox=Ext.extend(Ext.form.ComboBox,{constructor:function(a){this.searchResetDelay=1000;a=a||{};a=Ext.apply(a||{},{editable:false,forceSelection:true,rowHeight:false,lastSearchTerm:false,triggerAction:"all",mode:"local"});Ext.ux.form.SelectBox.superclass.constructor.apply(this,arguments);this.lastSelectedIndex=this.selectedIndex||0;},initEvents:function(){Ext.ux.form.SelectBox.superclass.initEvents.apply(this,arguments);this.el.on("keydown",this.keySearch,this,true);this.cshTask=new Ext.util.DelayedTask(this.clearSearchHistory,this);},keySearch:function(c,b,g){var f=c.getKey();var a=String.fromCharCode(f);var d=0;if(!this.store.getCount()){return;}switch(f){case Ext.EventObject.HOME:c.stopEvent();this.selectFirst();return;case Ext.EventObject.END:c.stopEvent();this.selectLast();return;case Ext.EventObject.PAGEDOWN:this.selectNextPage();c.stopEvent();return;case Ext.EventObject.PAGEUP:this.selectPrevPage();c.stopEvent();return;}if((c.hasModifier()&&!c.shiftKey)||c.isNavKeyPress()||c.isSpecialKey()){return;}if(this.lastSearchTerm==a){d=this.lastSelectedIndex;}this.search(this.displayField,a,d);this.cshTask.delay(this.searchResetDelay);},onRender:function(b,a){this.store.on("load",this.calcRowsPerPage,this);Ext.ux.form.SelectBox.superclass.onRender.apply(this,arguments);if(this.mode=="local"){this.initList();this.calcRowsPerPage();}},onSelect:function(b,a,c){if(this.fireEvent("beforeselect",this,b,a)!==false){this.setValue(b.data[this.valueField||this.displayField]);if(!c){this.collapse();}this.lastSelectedIndex=a+1;this.fireEvent("select",this,b,a);}},afterRender:function(){Ext.ux.form.SelectBox.superclass.afterRender.apply(this,arguments);if(Ext.isWebKit){this.el.swallowEvent("mousedown",true);}this.el.unselectable();this.innerList.unselectable();this.trigger.unselectable();this.innerList.on("mouseup",function(a,c,b){if(c.id&&c.id==this.innerList.id){return;}this.onViewClick();},this);this.innerList.on("mouseover",function(a,c,b){if(c.id&&c.id==this.innerList.id){return;}this.lastSelectedIndex=this.view.getSelectedIndexes()[0]+1;this.cshTask.delay(this.searchResetDelay);},this);this.trigger.un("click",this.onTriggerClick,this);this.trigger.on("mousedown",function(a,c,b){a.preventDefault();this.onTriggerClick();},this);this.on("collapse",function(a,c,b){Ext.getDoc().un("mouseup",this.collapseIf,this);},this,true);this.on("expand",function(a,c,b){Ext.getDoc().on("mouseup",this.collapseIf,this);},this,true);},clearSearchHistory:function(){this.lastSelectedIndex=0;this.lastSearchTerm=false;},selectFirst:function(){this.focusAndSelect(this.store.data.first());},selectLast:function(){this.focusAndSelect(this.store.data.last());},selectPrevPage:function(){if(!this.rowHeight){return;}var a=Math.max(this.selectedIndex-this.rowsPerPage,0);this.focusAndSelect(this.store.getAt(a));},selectNextPage:function(){if(!this.rowHeight){return;}var a=Math.min(this.selectedIndex+this.rowsPerPage,this.store.getCount()-1);this.focusAndSelect(this.store.getAt(a));},search:function(a,d,b){a=a||this.displayField;this.lastSearchTerm=d;var c=this.store.find.apply(this.store,arguments);if(c!==-1){this.focusAndSelect(c);}},focusAndSelect:function(a){var b=Ext.isNumber(a)?a:this.store.indexOf(a);this.select(b,this.isExpanded());this.onSelect(this.store.getAt(b),b,this.isExpanded());},calcRowsPerPage:function(){if(this.store.getCount()){this.rowHeight=Ext.fly(this.view.getNode(0)).getHeight();this.rowsPerPage=this.maxHeight/this.rowHeight;}else{this.rowHeight=false;}}});Ext.reg("selectbox",Ext.ux.form.SelectBox);Ext.ux.SelectBox=Ext.ux.form.SelectBox;Ext.ux.SliderTip=Ext.extend(Ext.Tip,{minWidth:10,offsets:[0,-10],init:function(a){a.on("dragstart",this.onSlide,this);a.on("drag",this.onSlide,this);a.on("dragend",this.hide,this);a.on("destroy",this.destroy,this);},onSlide:function(a){this.show();this.body.update(this.getText(a));this.doAutoWidth();this.el.alignTo(a.thumb,"b-t?",this.offsets);},getText:function(a){return String(a.getValue());}});Ext.ux.SlidingPager=Ext.extend(Object,{init:function(c){var b=c.items.indexOf(c.inputItem);Ext.each(c.items.getRange(b-2,b+2),function(d){d.hide();});var a=new Ext.Slider({width:114,minValue:1,maxValue:1,plugins:new Ext.ux.SliderTip({getText:function(d){return String.format("Page <b>{0}</b> of <b>{1}</b>",d.value,d.maxValue);}}),listeners:{changecomplete:function(e,d){c.changePage(d);}}});c.insert(b+1,a);c.on({change:function(d,e){a.setMaxValue(e.pages);a.setValue(e.activePage);}});}});Ext.ns("Ext.ux.form");Ext.ux.form.SpinnerField=Ext.extend(Ext.form.NumberField,{actionMode:"wrap",deferHeight:true,autoSize:Ext.emptyFn,onBlur:Ext.emptyFn,adjustSize:Ext.BoxComponent.prototype.adjustSize,constructor:function(a){var d=Ext.copyTo({},a,"incrementValue,alternateIncrementValue,accelerate,defaultValue,triggerClass,splitterClass");var b=this.spinner=new Ext.ux.Spinner(d);var c=a.plugins?(Ext.isArray(a.plugins)?a.plugins.push(b):[a.plugins,b]):b;Ext.ux.form.SpinnerField.superclass.constructor.call(this,Ext.apply(a,{plugins:c}));},getResizeEl:function(){return this.wrap;},getPositionEl:function(){return this.wrap;},alignErrorIcon:function(){if(this.wrap){this.errorIcon.alignTo(this.wrap,"tl-tr",[2,0]);}},validateBlur:function(){return true;}});Ext.reg("spinnerfield",Ext.ux.form.SpinnerField);Ext.form.SpinnerField=Ext.ux.form.SpinnerField;Ext.ux.Spinner=Ext.extend(Ext.util.Observable,{incrementValue:1,alternateIncrementValue:5,triggerClass:"x-form-spinner-trigger",splitterClass:"x-form-spinner-splitter",alternateKey:Ext.EventObject.shiftKey,defaultValue:0,accelerate:false,constructor:function(a){Ext.ux.Spinner.superclass.constructor.call(this,a);Ext.apply(this,a);this.mimicing=false;},init:function(a){this.field=a;a.afterMethod("onRender",this.doRender,this);a.afterMethod("onEnable",this.doEnable,this);a.afterMethod("onDisable",this.doDisable,this);a.afterMethod("afterRender",this.doAfterRender,this);a.afterMethod("onResize",this.doResize,this);a.afterMethod("onFocus",this.doFocus,this);a.beforeMethod("onDestroy",this.doDestroy,this);},doRender:function(d,c){var a=this.el=this.field.getEl();var b=this.field;if(!b.wrap){b.wrap=this.wrap=a.wrap({cls:"x-form-field-wrap"});}else{this.wrap=b.wrap.addClass("x-form-field-wrap");}this.trigger=this.wrap.createChild({tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger "+this.triggerClass});if(!b.width){this.wrap.setWidth(a.getWidth()+this.trigger.getWidth());}this.splitter=this.wrap.createChild({tag:"div",cls:this.splitterClass,style:"width:13px; height:2px;"});this.splitter.setRight((Ext.isIE)?1:2).setTop(10).show();this.proxy=this.trigger.createProxy("",this.splitter,true);this.proxy.addClass("x-form-spinner-proxy");this.proxy.setStyle("left","0px");this.proxy.setSize(14,1);this.proxy.hide();this.dd=new Ext.dd.DDProxy(this.splitter.dom.id,"SpinnerDrag",{dragElId:this.proxy.id});this.initTrigger();this.initSpinner();},doAfterRender:function(){var a;if(Ext.isIE&&this.el.getY()!=(a=this.trigger.getY())){this.el.position();this.el.setY(a);}},doEnable:function(){if(this.wrap){this.wrap.removeClass(this.field.disabledClass);}},doDisable:function(){if(this.wrap){this.wrap.addClass(this.field.disabledClass);this.el.removeClass(this.field.disabledClass);}},doResize:function(a,b){if(typeof a=="number"){this.el.setWidth(a-this.trigger.getWidth());}this.wrap.setWidth(this.el.getWidth()+this.trigger.getWidth());},doFocus:function(){if(!this.mimicing){this.wrap.addClass("x-trigger-wrap-focus");this.mimicing=true;Ext.get(Ext.isIE?document.body:document).on("mousedown",this.mimicBlur,this,{delay:10});this.el.on("keydown",this.checkTab,this);}},checkTab:function(a){if(a.getKey()==a.TAB){this.triggerBlur();}},mimicBlur:function(a){if(!this.wrap.contains(a.target)&&this.field.validateBlur(a)){this.triggerBlur();}},triggerBlur:function(){this.mimicing=false;Ext.get(Ext.isIE?document.body:document).un("mousedown",this.mimicBlur,this);this.el.un("keydown",this.checkTab,this);this.field.beforeBlur();this.wrap.removeClass("x-trigger-wrap-focus");this.field.onBlur.call(this.field);},initTrigger:function(){this.trigger.addClassOnOver("x-form-trigger-over");this.trigger.addClassOnClick("x-form-trigger-click");},initSpinner:function(){this.field.addEvents({spin:true,spinup:true,spindown:true});this.keyNav=new Ext.KeyNav(this.el,{up:function(a){a.preventDefault();this.onSpinUp();},down:function(a){a.preventDefault();this.onSpinDown();},pageUp:function(a){a.preventDefault();this.onSpinUpAlternate();},pageDown:function(a){a.preventDefault();this.onSpinDownAlternate();},scope:this});this.repeater=new Ext.util.ClickRepeater(this.trigger,{accelerate:this.accelerate});this.field.mon(this.repeater,"click",this.onTriggerClick,this,{preventDefault:true});this.field.mon(this.trigger,{mouseover:this.onMouseOver,mouseout:this.onMouseOut,mousemove:this.onMouseMove,mousedown:this.onMouseDown,mouseup:this.onMouseUp,scope:this,preventDefault:true});this.field.mon(this.wrap,"mousewheel",this.handleMouseWheel,this);this.dd.setXConstraint(0,0,10);this.dd.setYConstraint(1500,1500,10);this.dd.endDrag=this.endDrag.createDelegate(this);this.dd.startDrag=this.startDrag.createDelegate(this);this.dd.onDrag=this.onDrag.createDelegate(this);},onMouseOver:function(){if(this.disabled){return;}var a=this.getMiddle();this.tmpHoverClass=(Ext.EventObject.getPageY()<a)?"x-form-spinner-overup":"x-form-spinner-overdown";this.trigger.addClass(this.tmpHoverClass);},onMouseOut:function(){this.trigger.removeClass(this.tmpHoverClass);},onMouseMove:function(){if(this.disabled){return;}var a=this.getMiddle();if(((Ext.EventObject.getPageY()>a)&&this.tmpHoverClass=="x-form-spinner-overup")||((Ext.EventObject.getPageY()<a)&&this.tmpHoverClass=="x-form-spinner-overdown")){}},onMouseDown:function(){if(this.disabled){return;}var a=this.getMiddle();this.tmpClickClass=(Ext.EventObject.getPageY()<a)?"x-form-spinner-clickup":"x-form-spinner-clickdown";this.trigger.addClass(this.tmpClickClass);},onMouseUp:function(){this.trigger.removeClass(this.tmpClickClass);},onTriggerClick:function(){if(this.disabled||this.el.dom.readOnly){return;}var b=this.getMiddle();var a=(Ext.EventObject.getPageY()<b)?"Up":"Down";this["onSpin"+a]();},getMiddle:function(){var c=this.trigger.getTop();var a=this.trigger.getHeight();var b=c+(a/2);return b;},isSpinnable:function(){if(this.disabled||this.el.dom.readOnly){Ext.EventObject.preventDefault();return false;}return true;},handleMouseWheel:function(a){if(this.wrap.hasClass("x-trigger-wrap-focus")==false){return;}var b=a.getWheelDelta();if(b>0){this.onSpinUp();a.stopEvent();}else{if(b<0){this.onSpinDown();a.stopEvent();}}},startDrag:function(){this.proxy.show();this._previousY=Ext.fly(this.dd.getDragEl()).getTop();},endDrag:function(){this.proxy.hide();},onDrag:function(){if(this.disabled){return;}var b=Ext.fly(this.dd.getDragEl()).getTop();var a="";if(this._previousY>b){a="Up";}if(this._previousY<b){a="Down";}if(a!=""){this["onSpin"+a]();}this._previousY=b;},onSpinUp:function(){if(this.isSpinnable()==false){return;}if(Ext.EventObject.shiftKey==true){this.onSpinUpAlternate();return;}else{this.spin(false,false);}this.field.fireEvent("spin",this);this.field.fireEvent("spinup",this);},onSpinDown:function(){if(this.isSpinnable()==false){return;}if(Ext.EventObject.shiftKey==true){this.onSpinDownAlternate();return;}else{this.spin(true,false);}this.field.fireEvent("spin",this);this.field.fireEvent("spindown",this);},onSpinUpAlternate:function(){if(this.isSpinnable()==false){return;}this.spin(false,true);this.field.fireEvent("spin",this);this.field.fireEvent("spinup",this);},onSpinDownAlternate:function(){if(this.isSpinnable()==false){return;}this.spin(true,true);this.field.fireEvent("spin",this);this.field.fireEvent("spindown",this);},spin:function(b,d){var c=parseFloat(this.field.getValue());var a=(d==true)?this.alternateIncrementValue:this.incrementValue;(b==true)?c-=a:c+=a;c=(isNaN(c))?this.defaultValue:c;c=this.fixBoundries(c);this.field.setRawValue(c);},fixBoundries:function(b){var a=b;if(this.field.minValue!=undefined&&a<this.field.minValue){a=this.field.minValue;}if(this.field.maxValue!=undefined&&a>this.field.maxValue){a=this.field.maxValue;}return this.fixPrecision(a);},fixPrecision:function(b){var a=isNaN(b);if(!this.field.allowDecimals||this.field.decimalPrecision==-1||a||!b){return a?"":b;}return parseFloat(parseFloat(b).toFixed(this.field.decimalPrecision));},doDestroy:function(){if(this.trigger){this.trigger.remove();}if(this.wrap){this.wrap.remove();delete this.field.wrap;}if(this.splitter){this.splitter.remove();}if(this.dd){this.dd.unreg();this.dd=null;}if(this.proxy){this.proxy.remove();}if(this.repeater){this.repeater.purgeListeners();}}});Ext.form.Spinner=Ext.ux.Spinner;Ext.ux.Spotlight=function(a){Ext.apply(this,a);};Ext.ux.Spotlight.prototype={active:false,animate:true,duration:0.25,easing:"easeNone",animated:false,createElements:function(){var a=Ext.getBody();this.right=a.createChild({cls:"x-spotlight"});this.left=a.createChild({cls:"x-spotlight"});this.top=a.createChild({cls:"x-spotlight"});this.bottom=a.createChild({cls:"x-spotlight"});this.all=new Ext.CompositeElement([this.right,this.left,this.top,this.bottom]);},show:function(c,a,b){if(this.animated){this.show.defer(50,this,[c,a,b]);return;}this.el=Ext.get(c);if(!this.right){this.createElements();}if(!this.active){this.all.setDisplayed("");this.applyBounds(true,false);this.active=true;Ext.EventManager.onWindowResize(this.syncSize,this);this.applyBounds(false,this.animate,false,a,b);}else{this.applyBounds(false,false,false,a,b);}},hide:function(b,a){if(this.animated){this.hide.defer(50,this,[b,a]);return;}Ext.EventManager.removeResizeListener(this.syncSize,this);this.applyBounds(true,this.animate,true,b,a);},doHide:function(){this.active=false;this.all.setDisplayed(false);},syncSize:function(){this.applyBounds(false,false);},applyBounds:function(a,l,g,f,h){var e=this.el.getRegion();var j=Ext.lib.Dom.getViewWidth(true);var d=Ext.lib.Dom.getViewHeight(true);var b=0,k=false;if(l){k={callback:function(){b++;if(b==4){this.animated=false;if(g){this.doHide();}Ext.callback(f,h,[this]);}},scope:this,duration:this.duration,easing:this.easing};this.animated=true;}this.right.setBounds(e.right,a?d:e.top,j-e.right,a?0:(d-e.top),k);this.left.setBounds(0,0,e.left,a?0:e.bottom,k);this.top.setBounds(a?j:e.left,0,a?0:j-e.left,e.top,k);this.bottom.setBounds(0,e.bottom,a?0:e.right,d-e.bottom,k);if(!l){if(g){this.doHide();}if(f){Ext.callback(f,h,[this]);}}},destroy:function(){this.doHide();Ext.destroy(this.right,this.left,this.top,this.bottom);delete this.el;delete this.all;}};Ext.Spotlight=Ext.ux.Spotlight;Ext.ux.StatusBar=Ext.extend(Ext.Toolbar,{cls:"x-statusbar",busyIconCls:"x-status-busy",busyText:"Loading...",autoClear:5000,emptyText:"&nbsp;",activeThreadId:0,initComponent:function(){if(this.statusAlign=="right"){this.cls+=" x-status-right";}Ext.ux.StatusBar.superclass.initComponent.call(this);},afterRender:function(){Ext.ux.StatusBar.superclass.afterRender.call(this);var a=this.statusAlign=="right";this.currIconCls=this.iconCls||this.defaultIconCls;this.statusEl=new Ext.Toolbar.TextItem({cls:"x-status-text "+(this.currIconCls||""),text:this.text||this.defaultText||""});if(a){this.add("->");this.add(this.statusEl);}else{this.insert(0,this.statusEl);this.insert(1,"->");}this.doLayout();},setStatus:function(a){a=a||{};if(typeof a=="string"){a={text:a};}if(a.text!==undefined){this.setText(a.text);}if(a.iconCls!==undefined){this.setIcon(a.iconCls);}if(a.clear){var b=a.clear,e=this.autoClear,d={useDefaults:true,anim:true};if(typeof b=="object"){b=Ext.applyIf(b,d);if(b.wait){e=b.wait;}}else{if(typeof b=="number"){e=b;b=d;}else{if(typeof b=="boolean"){b=d;}}}b.threadId=this.activeThreadId;this.clearStatus.defer(e,this,[b]);}return this;},clearStatus:function(a){a=a||{};if(a.threadId&&a.threadId!==this.activeThreadId){return this;}var c=a.useDefaults?this.defaultText:this.emptyText,b=a.useDefaults?(this.defaultIconCls?this.defaultIconCls:""):"";if(a.anim){this.statusEl.el.fadeOut({remove:false,useDisplay:true,scope:this,callback:function(){this.setStatus({text:c,iconCls:b});this.statusEl.el.show();}});}else{this.statusEl.hide();this.setStatus({text:c,iconCls:b});this.statusEl.show();}return this;},setText:function(a){this.activeThreadId++;this.text=a||"";if(this.rendered){this.statusEl.setText(this.text);}return this;},getText:function(){return this.text;},setIcon:function(a){this.activeThreadId++;a=a||"";if(this.rendered){if(this.currIconCls){this.statusEl.removeClass(this.currIconCls);this.currIconCls=null;}if(a.length>0){this.statusEl.addClass(a);this.currIconCls=a;}}else{this.currIconCls=a;}return this;},showBusy:function(a){if(typeof a=="string"){a={text:a};}a=Ext.applyIf(a||{},{text:this.busyText,iconCls:this.busyIconCls});return this.setStatus(a);}});Ext.reg("statusbar",Ext.ux.StatusBar);Ext.ux.TabCloseMenu=function(){var c,a,d;this.init=function(e){c=e;c.on("contextmenu",b);};function b(j,h,e){if(!a){a=new Ext.menu.Menu({items:[{id:c.id+"-close",text:"Close Tab",handler:function(){c.remove(d);}},{id:c.id+"-close-others",text:"Close Other Tabs",handler:function(){c.items.each(function(k){if(k.closable&&k!=d){c.remove(k);}});}}]});}d=h;var g=a.items;g.get(c.id+"-close").setDisabled(!h.closable);var f=true;c.items.each(function(){if(this!=h&&this.closable){f=false;return false;}});g.get(c.id+"-close-others").setDisabled(f);e.stopEvent();a.showAt(e.getPoint());}};Ext.preg("tabclosemenu",Ext.ux.TabCloseMenu);Ext.ns("Ext.ux.grid");Ext.ux.grid.TableGrid=function(f,k){k=k||{};Ext.apply(this,k);var e=k.fields||[],c=k.columns||[];f=Ext.get(f);var n=f.insertSibling();var o=[],p=[];var j=f.query("thead th");for(var l=0,m;m=j[l];l++){var b=m.innerHTML;var d="tcol-"+l;o.push(Ext.applyIf(e[l]||{},{name:d,mapping:"td:nth("+(l+1)+")/@innerHTML"}));p.push(Ext.applyIf(c[l]||{},{header:b,dataIndex:d,width:m.offsetWidth,tooltip:m.title,sortable:true}));}var g=new Ext.data.Store({reader:new Ext.data.XmlReader({record:"tbody tr"},o)});g.loadData(f.dom);var a=new Ext.grid.ColumnModel(p);if(k.width||k.height){n.setSize(k.width||"auto",k.height||"auto");}else{n.setWidth(f.getWidth());}if(k.remove!==false){f.remove();}Ext.applyIf(this,{ds:g,cm:a,sm:new Ext.grid.RowSelectionModel(),autoHeight:true,autoWidth:false});Ext.ux.grid.TableGrid.superclass.constructor.call(this,n,{});};Ext.extend(Ext.ux.grid.TableGrid,Ext.grid.GridPanel);Ext.grid.TableGrid=Ext.ux.grid.TableGrid;Ext.ns("Ext.ux");Ext.ux.TabScrollerMenu=Ext.extend(Object,{pageSize:10,maxText:15,menuPrefixText:"Items",constructor:function(a){a=a||{};Ext.apply(this,a);},init:function(b){Ext.apply(b,this.parentOverrides);b.tabScrollerMenu=this;var a=this;b.on({render:{scope:b,single:true,fn:function(){var c=b.createScrollers.createSequence(a.createPanelsMenu,this);b.createScrollers=c;}}});},createPanelsMenu:function(){var a=this.stripWrap.dom.offsetHeight;var d=this.header.dom.firstChild;Ext.fly(d).applyStyles({right:"18px"});var c=Ext.get(this.strip.dom.parentNode);c.applyStyles({"margin-right":"36px"});var b=this.header.insertFirst({cls:"x-tab-tabmenu-right"});b.setHeight(a);b.addClassOnOver("x-tab-tabmenu-over");b.on("click",this.showTabsMenu,this);this.scrollLeft.show=this.scrollLeft.show.createSequence(function(){b.show();});this.scrollLeft.hide=this.scrollLeft.hide.createSequence(function(){b.hide();});},getPageSize:function(){return this.pageSize;},setPageSize:function(a){this.pageSize=a;},getMaxText:function(){return this.maxText;},setMaxText:function(a){this.maxText=a;},getMenuPrefixText:function(){return this.menuPrefixText;},setMenuPrefixText:function(a){this.menuPrefixText=a;},parentOverrides:{showTabsMenu:function(a){if(this.tabsMenu){this.tabsMenu.destroy();this.un("destroy",this.tabsMenu.destroy,this.tabsMenu);this.tabsMenu=null;}this.tabsMenu=new Ext.menu.Menu();this.on("destroy",this.tabsMenu.destroy,this.tabsMenu);this.generateTabMenuItems();var c=Ext.get(a.getTarget());var b=c.getXY();b[1]+=24;this.tabsMenu.showAt(b);},generateTabMenuItems:function(){var g=this.getActiveTab();var f=this.items.getCount();var b=this.tabScrollerMenu.getPageSize();if(f>b){var k=Math.floor(f/b);var d=f%b;for(var l=0;l<k;l++){var a=(l+1)*b;var h=[];for(var c=0;c<b;c++){index=c+a-b;var e=this.items.get(index);h.push(this.autoGenMenuItem(e));}this.tabsMenu.add({text:this.tabScrollerMenu.getMenuPrefixText()+" "+(a-b+1)+" - "+a,menu:h});}if(d>0){var j=k*b;h=[];for(var l=j;l<f;l++){var e=this.items.get(l);h.push(this.autoGenMenuItem(e));}this.tabsMenu.add({text:this.tabScrollerMenu.menuPrefixText+" "+(j+1)+" - "+(j+h.length),menu:h});}}else{this.items.each(function(m){if(m.id!=g.id&&!m.hidden){h.push(this.autoGenMenuItem(m));}},this);}},autoGenMenuItem:function(c){var b=this.tabScrollerMenu.getMaxText();var a=Ext.util.Format.ellipsis(c.title,b);return{text:a,handler:this.showTabFromMenu,scope:this,disabled:c.disabled,tabToShow:c,iconCls:c.iconCls};},showTabFromMenu:function(a){this.setActiveTab(a.tabToShow);}}});Ext.reg("tabscrollermenu",Ext.ux.TabScrollerMenu);Ext.ns("Ext.ux.tree");Ext.ux.tree.XmlTreeLoader=Ext.extend(Ext.tree.TreeLoader,{XML_NODE_ELEMENT:1,XML_NODE_TEXT:3,processResponse:function(g,b,d){var a=g.responseXML;var f=a.documentElement||a;try{b.beginUpdate();b.appendChild(this.parseXml(f));b.endUpdate();if(typeof d=="function"){d(this,b);}}catch(c){this.handleFailure(g);}},parseXml:function(b){var a=[];Ext.each(b.childNodes,function(d){if(d.nodeType==this.XML_NODE_ELEMENT){var e=this.createNode(d);if(d.childNodes.length>0){var c=this.parseXml(d);if(typeof c=="string"){e.attributes.innerText=c;}else{e.appendChild(c);}}a.push(e);}else{if(d.nodeType==this.XML_NODE_TEXT){var f=d.nodeValue.trim();if(f.length>0){return a=f;}}}},this);return a;},createNode:function(b){var a={tagName:b.tagName};Ext.each(b.attributes,function(c){a[c.nodeName]=c.nodeValue;});this.processAttributes(a);return Ext.ux.tree.XmlTreeLoader.superclass.createNode.call(this,a);},processAttributes:Ext.emptyFn});Ext.ux.XmlTreeLoader=Ext.ux.tree.XmlTreeLoader;Ext.ux.ValidationStatus=Ext.extend(Ext.Component,{errorIconCls:"x-status-error",errorListCls:"x-status-error-list",validIconCls:"x-status-valid",showText:"The form has errors (click for details...)",hideText:"Click again to hide the error list",submitText:"Saving...",init:function(a){a.on("render",function(){this.statusBar=a;this.monitor=true;this.errors=new Ext.util.MixedCollection();this.listAlign=(a.statusAlign=="right"?"br-tr?":"bl-tl?");if(this.form){this.form=Ext.getCmp(this.form).getForm();this.startMonitoring();this.form.on("beforeaction",function(d,c){if(c.type=="submit"){this.monitor=false;}},this);var b=function(){this.monitor=true;};this.form.on("actioncomplete",b,this);this.form.on("actionfailed",b,this);}},this,{single:true});a.on({scope:this,afterlayout:{single:true,fn:function(){a.statusEl.getEl().on("click",this.onStatusClick,this,{buffer:200});}},beforedestroy:{single:true,fn:this.onDestroy}});},startMonitoring:function(){this.form.items.each(function(a){a.on("invalid",this.onFieldValidation,this);a.on("valid",this.onFieldValidation,this);},this);},stopMonitoring:function(){this.form.items.each(function(a){a.un("invalid",this.onFieldValidation,this);a.un("valid",this.onFieldValidation,this);},this);},onDestroy:function(){this.stopMonitoring();this.statusBar.statusEl.un("click",this.onStatusClick,this);Ext.ux.ValidationStatus.superclass.onDestroy.call(this);},onFieldValidation:function(a,b){if(!this.monitor){return false;}if(b){this.errors.add(a.id,{field:a,msg:b});}else{this.errors.removeKey(a.id);}this.updateErrorList();if(this.errors.getCount()>0){if(this.statusBar.getText()!=this.showText){this.statusBar.setStatus({text:this.showText,iconCls:this.errorIconCls});}}else{this.statusBar.clearStatus().setIcon(this.validIconCls);}},updateErrorList:function(){if(this.errors.getCount()>0){var a="<ul>";this.errors.each(function(b){a+=('<li id="x-err-'+b.field.id+'"><a href="#">'+b.msg+"</a></li>");},this);this.getMsgEl().update(a+"</ul>");}else{this.getMsgEl().update("");}},getMsgEl:function(){if(!this.msgEl){this.msgEl=Ext.DomHelper.append(Ext.getBody(),{cls:this.errorListCls+" x-hide-offsets"},true);this.msgEl.on("click",function(b){var a=b.getTarget("li",10,true);if(a){Ext.getCmp(a.id.split("x-err-")[1]).focus();this.hideErrors();}},this,{stopEvent:true});}return this.msgEl;},showErrors:function(){this.updateErrorList();this.getMsgEl().alignTo(this.statusBar.getEl(),this.listAlign).slideIn("b",{duration:0.3,easing:"easeOut"});this.statusBar.setText(this.hideText);this.form.getEl().on("click",this.hideErrors,this,{single:true});},hideErrors:function(){var a=this.getMsgEl();if(a.isVisible()){a.slideOut("b",{duration:0.2,easing:"easeIn"});this.statusBar.setText(this.showText);}this.form.getEl().un("click",this.hideErrors,this);},onStatusClick:function(){if(this.getMsgEl().isVisible()){this.hideErrors();}else{if(this.errors.getCount()>0){this.showErrors();}}}});(function(){Ext.override(Ext.list.Column,{init:function(){if(!this.type){this.type="auto";}var a=Ext.data.SortTypes;if(typeof this.sortType=="string"){this.sortType=a[this.sortType];}if(!this.sortType){switch(this.type){case"string":this.sortType=a.asUCString;break;case"date":this.sortType=a.asDate;break;default:this.sortType=a.none;}}}});Ext.tree.Column=Ext.extend(Ext.list.Column,{});Ext.tree.NumberColumn=Ext.extend(Ext.list.NumberColumn,{});Ext.tree.DateColumn=Ext.extend(Ext.list.DateColumn,{});Ext.tree.BooleanColumn=Ext.extend(Ext.list.BooleanColumn,{});Ext.reg("tgcolumn",Ext.tree.Column);Ext.reg("tgnumbercolumn",Ext.tree.NumberColumn);Ext.reg("tgdatecolumn",Ext.tree.DateColumn);Ext.reg("tgbooleancolumn",Ext.tree.BooleanColumn);})();Ext.ux.tree.TreeGridNodeUI=Ext.extend(Ext.tree.TreeNodeUI,{isTreeGridNodeUI:true,renderElements:function(k,f,b,g){var h=k.getOwnerTree(),e=h.columns,d=e[0],l,j,o;this.indentMarkup=k.parentNode?k.parentNode.ui.getChildIndent():"";j=['<tbody class="x-tree-node">','<tr ext:tree-node-id="',k.id,'" class="x-tree-node-el x-tree-node-leaf ',f.cls,'">','<td class="x-treegrid-col">','<span class="x-tree-node-indent">',this.indentMarkup,"</span>",'<img src="',this.emptyIcon,'" class="x-tree-ec-icon x-tree-elbow">','<img src="',f.icon||this.emptyIcon,'" class="x-tree-node-icon',(f.icon?" x-tree-node-inline-icon":""),(f.iconCls?" "+f.iconCls:""),'" unselectable="on">','<a hidefocus="on" class="x-tree-node-anchor" href="',f.href?f.href:"#",'" tabIndex="1" ',f.hrefTarget?' target="'+f.hrefTarget+'"':"",">",'<span unselectable="on">',(d.tpl?d.tpl.apply(f):f[d.dataIndex]||d.text),"</span></a>","</td>"];for(l=1,o=e.length;l<o;l++){d=e[l];j.push('<td class="x-treegrid-col ',(d.cls?d.cls:""),'">','<div unselectable="on" class="x-treegrid-text"',(d.align?' style="text-align: '+d.align+';"':""),">",(d.tpl?d.tpl.apply(f):f[d.dataIndex]),"</div>","</td>");}j.push('</tr><tr class="x-tree-node-ct"><td colspan="',e.length,'">','<table class="x-treegrid-node-ct-table" cellpadding="0" cellspacing="0" style="table-layout: fixed; display: none; width: ',h.innerCt.getWidth(),'px;"><colgroup>');for(l=0,o=e.length;l<o;l++){j.push('<col style="width: ',(e[l].hidden?0:e[l].width),'px;" />');}j.push("</colgroup></table></td></tr></tbody>");if(g!==true&&k.nextSibling&&k.nextSibling.ui.getEl()){this.wrap=Ext.DomHelper.insertHtml("beforeBegin",k.nextSibling.ui.getEl(),j.join(""));}else{this.wrap=Ext.DomHelper.insertHtml("beforeEnd",b,j.join(""));}this.elNode=this.wrap.childNodes[0];this.ctNode=this.wrap.childNodes[1].firstChild.firstChild;var m=this.elNode.firstChild.childNodes;this.indentNode=m[0];this.ecNode=m[1];this.iconNode=m[2];this.anchor=m[3];this.textNode=m[3].firstChild;},animExpand:function(a){this.ctNode.style.display="";Ext.ux.tree.TreeGridNodeUI.superclass.animExpand.call(this,a);}});Ext.ux.tree.TreeGridRootNodeUI=Ext.extend(Ext.tree.TreeNodeUI,{isTreeGridNodeUI:true,render:function(){if(!this.rendered){this.wrap=this.ctNode=this.node.ownerTree.innerCt.dom;this.node.expanded=true;}if(Ext.isWebKit){var a=this.ctNode;a.style.tableLayout=null;(function(){a.style.tableLayout="fixed";}).defer(1);}},destroy:function(){if(this.elNode){Ext.dd.Registry.unregister(this.elNode.id);}delete this.node;},collapse:Ext.emptyFn,expand:Ext.emptyFn});Ext.tree.ColumnResizer=Ext.extend(Ext.util.Observable,{minWidth:14,constructor:function(a){Ext.apply(this,a);Ext.tree.ColumnResizer.superclass.constructor.call(this);},init:function(a){this.tree=a;a.on("render",this.initEvents,this);},initEvents:function(a){a.mon(a.innerHd,"mousemove",this.handleHdMove,this);this.tracker=new Ext.dd.DragTracker({onBeforeStart:this.onBeforeStart.createDelegate(this),onStart:this.onStart.createDelegate(this),onDrag:this.onDrag.createDelegate(this),onEnd:this.onEnd.createDelegate(this),tolerance:3,autoStart:300});this.tracker.initEl(a.innerHd);a.on("beforedestroy",this.tracker.destroy,this.tracker);},handleHdMove:function(b,g){var c=5,f=b.getPageX(),a=b.getTarget(".x-treegrid-hd",3,true);if(a){var k=a.getRegion(),h=a.dom.style,l=a.dom.parentNode;if(f-k.left<=c&&a.dom!==l.firstChild){var j=a.dom.previousSibling;while(j&&Ext.fly(j).hasClass("x-treegrid-hd-hidden")){j=j.previousSibling;}if(j){this.activeHd=Ext.get(j);h.cursor=Ext.isWebKit?"e-resize":"col-resize";}}else{if(k.right-f<=c){var d=a.dom;while(d&&Ext.fly(d).hasClass("x-treegrid-hd-hidden")){d=d.previousSibling;}if(d){this.activeHd=Ext.get(d);h.cursor=Ext.isWebKit?"w-resize":"col-resize";}}else{delete this.activeHd;h.cursor="";}}}},onBeforeStart:function(a){this.dragHd=this.activeHd;return !!this.dragHd;},onStart:function(b){this.tree.headersDisabled=true;this.proxy=this.tree.body.createChild({cls:"x-treegrid-resizer"});this.proxy.setHeight(this.tree.body.getHeight());var a=this.tracker.getXY()[0];this.hdX=this.dragHd.getX();this.hdIndex=this.tree.findHeaderIndex(this.dragHd);this.proxy.setX(this.hdX);this.proxy.setWidth(a-this.hdX);this.maxWidth=this.tree.outerCt.getWidth()-this.tree.innerBody.translatePoints(this.hdX).left;},onDrag:function(b){var a=this.tracker.getXY()[0];this.proxy.setWidth((a-this.hdX).constrain(this.minWidth,this.maxWidth));},onEnd:function(a){var c=this.proxy.getWidth(),b=this.tree;this.proxy.remove();delete this.dragHd;b.columns[this.hdIndex].width=c;b.updateColumnWidths();setTimeout(function(){b.headersDisabled=false;},100);}});Ext.ns("Ext.ux.tree");Ext.ux.tree.TreeGridSorter=Ext.extend(Ext.tree.TreeSorter,{sortClasses:["sort-asc","sort-desc"],sortAscText:"Sort Ascending",sortDescText:"Sort Descending",constructor:function(a,b){if(!Ext.isObject(b)){b={property:a.columns[0].dataIndex||"text",folderSort:true};}Ext.ux.tree.TreeGridSorter.superclass.constructor.apply(this,arguments);this.tree=a;a.on("headerclick",this.onHeaderClick,this);a.ddAppendOnly=true;me=this;this.defaultSortFn=function(g,f){var c=me.dir&&me.dir.toLowerCase()=="desc";var k=me.property||"text";var m=me.sortType;var d=me.folderSort;var e=me.caseSensitive===true;var l=me.leafAttr||"leaf";if(d){if(g.attributes[l]&&!f.attributes[l]){return 1;}if(!g.attributes[l]&&f.attributes[l]){return -1;}}var j=m?m(g):(e?g.attributes[k]:g.attributes[k].toUpperCase());var h=m?m(f):(e?f.attributes[k]:f.attributes[k].toUpperCase());if(j<h){return c?+1:-1;}else{if(j>h){return c?-1:+1;}else{return 0;}}};a.on("afterrender",this.onAfterTreeRender,this,{single:true});a.on("headermenuclick",this.onHeaderMenuClick,this);},onAfterTreeRender:function(){if(this.tree.hmenu){this.tree.hmenu.insert(0,{itemId:"asc",text:this.sortAscText,cls:"xg-hmenu-sort-asc"},{itemId:"desc",text:this.sortDescText,cls:"xg-hmenu-sort-desc"});}this.updateSortIcon(0,"asc");},onHeaderMenuClick:function(a,d,b){if(d==="asc"||d==="desc"){this.onHeaderClick(a,null,b);return false;}},onHeaderClick:function(b,e,d){if(b&&!this.tree.headersDisabled){var a=this;a.property=b.dataIndex;a.dir=b.dir=(b.dir==="desc"?"asc":"desc");a.sortType=b.sortType;a.caseSensitive===Ext.isBoolean(b.caseSensitive)?b.caseSensitive:this.caseSensitive;a.sortFn=b.sortFn||this.defaultSortFn;this.tree.root.cascade(function(c){if(!c.isLeaf()){a.updateSort(a.tree,c);}});this.updateSortIcon(d,b.dir);}},updateSortIcon:function(d,c){var b=this.sortClasses;var a=this.tree.innerHd.select("td").removeClass(b);a.item(d).addClass(b[c=="desc"?1:0]);}});Ext.ux.tree.TreeGridLoader=Ext.extend(Ext.tree.TreeLoader,{createNode:function(a){if(!a.uiProvider){a.uiProvider=Ext.ux.tree.TreeGridNodeUI;}return Ext.tree.TreeLoader.prototype.createNode.call(this,a);}});Ext.ux.tree.TreeGrid=Ext.extend(Ext.tree.TreePanel,{rootVisible:false,useArrows:true,lines:false,borderWidth:Ext.isBorderBox?0:2,cls:"x-treegrid",columnResize:true,enableSort:true,reserveScrollOffset:true,enableHdMenu:true,columnsText:"Columns",initComponent:function(){if(!this.root){this.root=new Ext.tree.AsyncTreeNode({text:"Root"});}var a=this.loader;if(!a){a=new Ext.ux.tree.TreeGridLoader({dataUrl:this.dataUrl,requestMethod:this.requestMethod,store:this.store});}else{if(Ext.isObject(a)&&!a.load){a=new Ext.ux.tree.TreeGridLoader(a);}else{if(a){a.createNode=function(c){if(!c.uiProvider){c.uiProvider=Ext.ux.tree.TreeGridNodeUI;}return Ext.tree.TreeLoader.prototype.createNode.call(this,c);};}}}this.loader=a;Ext.ux.tree.TreeGrid.superclass.initComponent.call(this);this.initColumns();if(this.enableSort){this.treeGridSorter=new Ext.ux.tree.TreeGridSorter(this,this.enableSort);}if(this.columnResize){this.colResizer=new Ext.tree.ColumnResizer(this.columnResize);this.colResizer.init(this);}var b=this.columns;if(!this.internalTpl){this.internalTpl=new Ext.XTemplate('<div class="x-grid3-header">','<div class="x-treegrid-header-inner">','<div class="x-grid3-header-offset">','<table cellspacing="0" cellpadding="0" border="0"><colgroup><tpl for="columns"><col /></tpl></colgroup>','<thead><tr class="x-grid3-hd-row">','<tpl for="columns">','<td class="x-grid3-hd x-grid3-cell x-treegrid-hd" style="text-align: {align};" id="',this.id,'-xlhd-{#}">','<div class="x-grid3-hd-inner x-treegrid-hd-inner" unselectable="on">',this.enableHdMenu?'<a class="x-grid3-hd-btn" href="#"></a>':"",'{header}<img class="x-grid3-sort-icon" src="',Ext.BLANK_IMAGE_URL,'" />',"</div>","</td></tpl>","</tr></thead>","</div></table>","</div></div>","</div>",'<div class="x-treegrid-root-node">','<table class="x-treegrid-root-table" cellpadding="0" cellspacing="0" style="table-layout: fixed;"></table>',"</div>");}if(!this.colgroupTpl){this.colgroupTpl=new Ext.XTemplate('<colgroup><tpl for="columns"><col style="width: {width}px"/></tpl></colgroup>');}},initColumns:function(){var b=this.columns,e=b.length,a=[],f,d;for(f=0;f<e;f++){d=b[f];if(!d.isColumn){d.xtype=d.xtype?(/^tg/.test(d.xtype)?d.xtype:"tg"+d.xtype):"tgcolumn";d=Ext.create(d);}d.init(this);a.push(d);if(this.enableSort!==false&&d.sortable!==false){d.sortable=true;this.enableSort=true;}}this.columns=a;},onRender:function(){Ext.tree.TreePanel.superclass.onRender.apply(this,arguments);this.el.addClass("x-treegrid");this.outerCt=this.body.createChild({cls:"x-tree-root-ct x-treegrid-ct "+(this.useArrows?"x-tree-arrows":this.lines?"x-tree-lines":"x-tree-no-lines")});this.internalTpl.overwrite(this.outerCt,{columns:this.columns});this.mainHd=Ext.get(this.outerCt.dom.firstChild);this.innerHd=Ext.get(this.mainHd.dom.firstChild);this.innerBody=Ext.get(this.outerCt.dom.lastChild);this.innerCt=Ext.get(this.innerBody.dom.firstChild);this.colgroupTpl.insertFirst(this.innerCt,{columns:this.columns});if(this.hideHeaders){this.header.dom.style.display="none";}else{if(this.enableHdMenu!==false){this.hmenu=new Ext.menu.Menu({id:this.id+"-hctx"});if(this.enableColumnHide!==false){this.colMenu=new Ext.menu.Menu({id:this.id+"-hcols-menu"});this.colMenu.on({scope:this,beforeshow:this.beforeColMenuShow,itemclick:this.handleHdMenuClick});this.hmenu.add({itemId:"columns",hideOnClick:false,text:this.columnsText,menu:this.colMenu,iconCls:"x-cols-icon"});}this.hmenu.on("itemclick",this.handleHdMenuClick,this);}}},setRootNode:function(a){a.attributes.uiProvider=Ext.ux.tree.TreeGridRootNodeUI;a=Ext.ux.tree.TreeGrid.superclass.setRootNode.call(this,a);if(this.innerCt){this.colgroupTpl.insertFirst(this.innerCt,{columns:this.columns});}return a;},clearInnerCt:function(){if(Ext.isIE){var a=this.innerCt.dom;while(a.firstChild){a.removeChild(a.firstChild);}}else{Ext.ux.tree.TreeGrid.superclass.clearInnerCt.call(this);}},initEvents:function(){Ext.ux.tree.TreeGrid.superclass.initEvents.apply(this,arguments);this.mon(this.innerBody,"scroll",this.syncScroll,this);this.mon(this.innerHd,"click",this.handleHdDown,this);this.mon(this.mainHd,{scope:this,mouseover:this.handleHdOver,mouseout:this.handleHdOut});},onResize:function(f,a){Ext.ux.tree.TreeGrid.superclass.onResize.apply(this,arguments);var c=this.innerBody.dom;var d=this.innerHd.dom;if(!c){return;}if(Ext.isNumber(a)){c.style.height=this.body.getHeight(true)-d.offsetHeight+"px";}if(Ext.isNumber(f)){var e=Ext.num(this.scrollOffset,Ext.getScrollBarWidth());if(this.reserveScrollOffset||((c.offsetWidth-c.clientWidth)>10)){this.setScrollOffset(e);}else{var b=this;setTimeout(function(){b.setScrollOffset(c.offsetWidth-c.clientWidth>10?e:0);},10);}}},updateColumnWidths:function(){var h=this.columns,l=h.length,m=this.outerCt.query("colgroup"),k=m.length,f,d,b,a;for(b=0;b<l;b++){f=h[b];for(a=0;a<k;a++){d=m[a];d.childNodes[b].style.width=(f.hidden?0:f.width)+"px";}}for(b=0,m=this.innerHd.query("td"),len=m.length;b<len;b++){f=Ext.fly(m[b]);if(h[b]&&h[b].hidden){f.addClass("x-treegrid-hd-hidden");}else{f.removeClass("x-treegrid-hd-hidden");}}var e=this.getTotalColumnWidth();Ext.fly(this.innerHd.dom.firstChild).setWidth(e+(this.scrollOffset||0));this.outerCt.select("table").setWidth(e);this.syncHeaderScroll();},getVisibleColumns:function(){var a=[],b=this.columns,c=b.length,d;for(d=0;d<c;d++){if(!b[d].hidden){a.push(b[d]);}}return a;},getTotalColumnWidth:function(){var b=0;for(var d=0,a=this.getVisibleColumns(),c=a.length;d<c;d++){b+=a[d].width;}return b;},setScrollOffset:function(a){this.scrollOffset=a;this.updateColumnWidths();},handleHdDown:function(a,g){var k=a.getTarget(".x-treegrid-hd");if(k&&Ext.fly(g).hasClass("x-grid3-hd-btn")){var j=this.hmenu.items,h=this.columns,f=this.findHeaderIndex(k),b=h[f],d=b.sortable;a.stopEvent();Ext.fly(k).addClass("x-grid3-hd-menu-open");this.hdCtxIndex=f;this.fireEvent("headerbuttonclick",j,b,k,f);this.hmenu.on("hide",function(){Ext.fly(k).removeClass("x-grid3-hd-menu-open");},this,{single:true});this.hmenu.show(g,"tl-bl?");}else{if(k){var f=this.findHeaderIndex(k);this.fireEvent("headerclick",this.columns[f],k,f);}}},handleHdOver:function(b,c){var a=b.getTarget(".x-treegrid-hd");if(a&&!this.headersDisabled){index=this.findHeaderIndex(a);this.activeHdRef=c;this.activeHdIndex=index;var d=Ext.get(a);this.activeHdRegion=d.getRegion();d.addClass("x-grid3-hd-over");this.activeHdBtn=d.child(".x-grid3-hd-btn");if(this.activeHdBtn){this.activeHdBtn.dom.style.height=(a.firstChild.offsetHeight-1)+"px";}}},handleHdOut:function(a,b){var c=a.getTarget(".x-treegrid-hd");if(c&&(!Ext.isIE||!a.within(c,true))){this.activeHdRef=null;Ext.fly(c).removeClass("x-grid3-hd-over");c.style.cursor="";}},findHeaderIndex:function(a){a=a.dom||a;var e=a.parentNode.childNodes;for(var d=0,b;b=e[d];d++){if(b==a){return d;}}return -1;},beforeColMenuShow:function(){var a=this.columns,e=a.length,d,b;this.colMenu.removeAll();for(d=1;d<e;d++){b=a[d];if(b.hideable!==false){this.colMenu.add(new Ext.menu.CheckItem({itemId:"col-"+d,text:b.header,checked:!b.hidden,hideOnClick:false,disabled:b.hideable===false}));}}},handleHdMenuClick:function(c){var b=this.hdCtxIndex,a=c.getItemId();if(this.fireEvent("headermenuclick",this.columns[b],a,b)!==false){b=a.substr(4);if(b>0&&this.columns[b]){this.setColumnVisible(b,!c.checked);}}return true;},setColumnVisible:function(a,b){this.columns[a].hidden=!b;this.updateColumnWidths();},scrollToTop:function(){this.innerBody.dom.scrollTop=0;this.innerBody.dom.scrollLeft=0;},syncScroll:function(){this.syncHeaderScroll();var a=this.innerBody.dom;this.fireEvent("bodyscroll",a.scrollLeft,a.scrollTop);},syncHeaderScroll:function(){var a=this.innerBody.dom;this.innerHd.dom.scrollLeft=a.scrollLeft;this.innerHd.dom.scrollLeft=a.scrollLeft;},registerNode:function(a){Ext.ux.tree.TreeGrid.superclass.registerNode.call(this,a);if(!a.uiProvider&&!a.isRoot&&!a.ui.isTreeGridNodeUI){a.ui=new Ext.ux.tree.TreeGridNodeUI(a);}}});Ext.reg("treegrid",Ext.ux.tree.TreeGrid);