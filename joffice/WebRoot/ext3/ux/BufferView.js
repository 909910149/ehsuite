Ext.ns("Ext.ux.grid");Ext.ux.grid.BufferView=Ext.extend(Ext.grid.GridView,{rowHeight:19,borderHeight:2,scrollDelay:100,cacheSize:20,cleanDelay:500,initTemplates:function(){Ext.ux.grid.BufferView.superclass.initTemplates.call(this);var b=this.templates;b.rowHolder=new Ext.Template('<div class="x-grid3-row {alt}" style="{tstyle}"></div>');b.rowHolder.disableFormats=true;b.rowHolder.compile();b.rowBody=new Ext.Template('<table class="x-grid3-row-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">',"<tbody><tr>{cells}</tr>",(this.enableRowBody?'<tr class="x-grid3-row-body-tr" style="{bodyStyle}"><td colspan="{cols}" class="x-grid3-body-cell" tabIndex="0" hidefocus="on"><div class="x-grid3-row-body">{body}</div></td></tr>':""),"</tbody></table>");b.rowBody.disableFormats=true;b.rowBody.compile();},getStyleRowHeight:function(){return Ext.isBorderBox?(this.rowHeight+this.borderHeight):this.rowHeight;},getCalculatedRowHeight:function(){return this.rowHeight+this.borderHeight;},getVisibleRowCount:function(){var c=this.getCalculatedRowHeight();var d=this.scroller.dom.clientHeight;return(d<1)?0:Math.ceil(d/c);},getVisibleRows:function(){var e=this.getVisibleRowCount();var d=this.scroller.dom.scrollTop;var f=(d==0?0:Math.floor(d/this.getCalculatedRowHeight())-1);return{first:Math.max(f,0),last:Math.min(f+e+2,this.ds.getCount()-1)};},doRender:function(W,U,H,ab,K,P,T){var aa=this.templates,X=aa.cell,V=aa.row,j=aa.rowBody,R=K-1;var J=this.getStyleRowHeight();var c=this.getVisibleRows();var Z="width:"+this.getTotalWidth()+";height:"+J+"px;";var L=[],p,I,r={},S={tstyle:Z},O;for(var i=0,M=U.length;i<M;i++){O=U[i];p=[];var Q=(i+ab);var Y=Q>=c.first&&Q<=c.last;if(Y){for(var N=0;N<K;N++){I=W[N];r.id=I.id;r.css=N==0?"x-grid3-cell-first ":(N==R?"x-grid3-cell-last ":"");r.attr=r.cellAttr="";r.value=I.renderer(O.data[I.name],r,O,Q,N,H);r.style=I.style;if(r.value==undefined||r.value===""){r.value="&#160;";}if(O.dirty&&typeof O.modified[I.name]!=="undefined"){r.css+=" x-grid3-dirty-cell";}p[p.length]=X.apply(r);}}var G=[];if(P&&((Q+1)%2==0)){G[0]="x-grid3-row-alt";}if(O.dirty){G[1]=" x-grid3-dirty-row";}S.cols=K;if(this.getRowClass){G[2]=this.getRowClass(O,Q,S,H);}S.alt=G.join(" ");S.cells=p.join("");L[L.length]=!Y?aa.rowHolder.apply(S):(T?j.apply(S):V.apply(S));}return L.join("");},isRowRendered:function(d){var c=this.getRow(d);return c&&c.childNodes.length>0;},syncScroll:function(){Ext.ux.grid.BufferView.superclass.syncScroll.apply(this,arguments);this.update();},update:function(){if(this.scrollDelay){if(!this.renderTask){this.renderTask=new Ext.util.DelayedTask(this.doUpdate,this);}this.renderTask.delay(this.scrollDelay);}else{this.doUpdate();}},onRemove:function(g,f,e,h){Ext.ux.grid.BufferView.superclass.onRemove.apply(this,arguments);if(h!==true){this.update();}},doUpdate:function(){if(this.getVisibleRowCount()>0){var k=this.grid,g=k.colModel,j=k.store;var l=this.getColumnData();var i=this.getVisibleRows();for(var m=i.first;m<=i.last;m++){if(!this.isRowRendered(m)){var n=this.doRender(l,[j.getAt(m)],j,m,g.getColumnCount(),k.stripeRows,true);this.getRow(m).innerHTML=n;}}this.clean();}},clean:function(){if(!this.cleanTask){this.cleanTask=new Ext.util.DelayedTask(this.doClean,this);}this.cleanTask.delay(this.cleanDelay);},doClean:function(){if(this.getVisibleRowCount()>0){var e=this.getVisibleRows();e.first-=this.cacheSize;e.last+=this.cacheSize;var h=0,g=this.getRows();if(e.first<=0){h=e.last+1;}for(var f=this.ds.getCount();h<f;h++){if((h<e.first||h>e.last)&&g[h].innerHTML){g[h].innerHTML="";}}}},layout:function(){Ext.ux.grid.BufferView.superclass.layout.call(this);this.update();}});