Ext.ns("Ext.ux");Ext.ux.GroupTabPanel=Ext.extend(Ext.TabPanel,{tabPosition:"left",alternateColor:false,alternateCls:"x-grouptabs-panel-alt",defaultType:"grouptab",deferredRender:false,activeGroup:null,initComponent:function(){Ext.ux.GroupTabPanel.superclass.initComponent.call(this);this.addEvents("beforegroupchange","groupchange");this.elements="body,header";this.stripTarget="header";this.tabPosition=this.tabPosition=="right"?"right":"left";this.addClass("x-grouptabs-panel");if(this.tabStyle&&this.tabStyle!=""){this.addClass("x-grouptabs-panel-"+this.tabStyle);}if(this.alternateColor){this.addClass(this.alternateCls);}this.on("beforeadd",function(d,f,e){this.initGroup(f,e);});},initEvents:function(){this.mon(this.strip,"mousedown",this.onStripMouseDown,this);},onRender:function(l,h){Ext.TabPanel.superclass.onRender.call(this,l,h);if(this.plain){var i=this.tabPosition=="top"?"header":"footer";this[i].addClass("x-tab-panel-"+i+"-plain");}var g=this[this.stripTarget];this.stripWrap=g.createChild({cls:"x-tab-strip-wrap ",cn:{tag:"ul",cls:"x-grouptabs-strip x-grouptabs-tab-strip-"+this.tabPosition}});var j=(this.tabPosition=="bottom"?this.stripWrap:null);this.strip=new Ext.Element(this.stripWrap.dom.firstChild);this.header.addClass("x-grouptabs-panel-header");this.bwrap.addClass("x-grouptabs-bwrap");this.body.addClass("x-tab-panel-body-"+this.tabPosition+" x-grouptabs-panel-body");if(!this.groupTpl){var k=new Ext.Template('<li class="{cls}" id="{id}">','<a class="x-grouptabs-expand" onclick="return false;"></a>','<a class="x-grouptabs-text {iconCls}" href="#" onclick="return false;">',"<span>{text}</span></a>","</li>");k.disableFormats=true;k.compile();Ext.ux.GroupTabPanel.prototype.groupTpl=k;}this.items.each(this.initGroup,this);},afterRender:function(){Ext.ux.GroupTabPanel.superclass.afterRender.call(this);this.tabJoint=Ext.fly(this.body.dom.parentNode).createChild({cls:"x-tab-joint"});this.addClass("x-tab-panel-"+this.tabPosition);this.header.setWidth(this.tabWidth);if(this.activeGroup!==undefined){var b=(typeof this.activeGroup=="object")?this.activeGroup:this.items.get(this.activeGroup);delete this.activeGroup;this.setActiveGroup(b);b.setActiveTab(b.getMainItem());}},getGroupEl:Ext.TabPanel.prototype.getTabEl,findTargets:function(f){var d=null,e=f.getTarget("li",this.strip);if(e){d=this.findById(e.id.split(this.idDelimiter)[1]);if(d.disabled){return{expand:null,item:null,el:null};}}return{expand:f.getTarget(".x-grouptabs-expand",this.strip),isGroup:!f.getTarget("ul.x-grouptabs-sub",this.strip),item:d,el:e};},onStripMouseDown:function(c){if(c.button!=0){return;}c.preventDefault();var d=this.findTargets(c);if(d.expand){this.toggleGroup(d.el);}else{if(d.item){if(d.isGroup){d.item.setActiveTab(d.item.getMainItem());}else{d.item.ownerCt.setActiveTab(d.item);}}}},expandGroup:function(b){if(b.isXType){b=this.getGroupEl(b);}Ext.fly(b).addClass("x-grouptabs-expanded");this.syncTabJoint();},toggleGroup:function(b){if(b.isXType){b=this.getGroupEl(b);}Ext.fly(b).toggleClass("x-grouptabs-expanded");this.syncTabJoint();},collapseGroup:function(b){if(b.isXType){b=this.getGroupEl(b);}Ext.fly(b).removeClass("x-grouptabs-expanded");this.syncTabJoint();},syncTabJoint:function(c){if(!this.tabJoint){return;}c=c||this.getGroupEl(this.activeGroup);if(c){this.tabJoint.setHeight(Ext.fly(c).getHeight()-2);var d=Ext.isGecko2?0:1;if(this.tabPosition=="left"){this.tabJoint.alignTo(c,"tl-tr",[-2,d]);}else{this.tabJoint.alignTo(c,"tr-tl",[1,d]);}}else{this.tabJoint.hide();}},getActiveTab:function(){if(!this.activeGroup){return null;}return this.activeGroup.getTabEl(this.activeGroup.activeTab)||null;},onResize:function(){Ext.ux.GroupTabPanel.superclass.onResize.apply(this,arguments);this.syncTabJoint();},createCorner:function(d,c){return Ext.fly(d).createChild({cls:"x-grouptabs-corner x-grouptabs-corner-"+c});},initGroup:function(k,h){var m=this.strip.dom.childNodes[h],l=this.getTemplateArgs(k);if(h===0){l.cls+=" x-tab-first";}l.cls+=" x-grouptabs-main";l.text=k.getMainItem().title;var n=m?this.groupTpl.insertBefore(m,l):this.groupTpl.append(this.strip,l),i=this.createCorner(n,"top-"+this.tabPosition),j=this.createCorner(n,"bottom-"+this.tabPosition);k.tabEl=n;if(k.expanded){this.expandGroup(n);}if(Ext.isIE6||(Ext.isIE&&!Ext.isStrict)){j.setLeft("-10px");j.setBottom("-5px");i.setLeft("-10px");i.setTop("-5px");}this.mon(k,{scope:this,changemainitem:this.onGroupChangeMainItem,beforetabchange:this.onGroupBeforeTabChange});},setActiveGroup:function(d){d=this.getComponent(d);if(!d){return false;}if(!this.rendered){this.activeGroup=d;return true;}if(this.activeGroup!=d&&this.fireEvent("beforegroupchange",this,d,this.activeGroup)!==false){if(this.activeGroup){this.activeGroup.activeTab=null;var e=this.getGroupEl(this.activeGroup);if(e){Ext.fly(e).removeClass("x-grouptabs-strip-active");}}var f=this.getGroupEl(d);Ext.fly(f).addClass("x-grouptabs-strip-active");this.activeGroup=d;this.stack.add(d);this.layout.setActiveItem(d);this.syncTabJoint(f);this.fireEvent("groupchange",this,d);return true;}return false;},onGroupBeforeTabChange:function(e,f,d){if(e!==this.activeGroup||f!==d){this.strip.select(".x-grouptabs-sub > li.x-grouptabs-strip-active",true).removeClass("x-grouptabs-strip-active");}this.expandGroup(this.getGroupEl(e));if(e!==this.activeGroup){return this.setActiveGroup(e);}},getFrameHeight:function(){var b=this.el.getFrameWidth("tb");b+=(this.tbar?this.tbar.getHeight():0)+(this.bbar?this.bbar.getHeight():0);return b;},adjustBodyWidth:function(b){return b-this.tabWidth;}});Ext.reg("grouptabpanel",Ext.ux.GroupTabPanel);