Ext.override(Ext.tree.TreeNodeUI,{grayedValue:null,onDisableChange:function(d,c){this.disabled=c;this[c?"addClass":"removeClass"]("x-tree-node-disabled");},initEvents:function(){this.node.on("move",this.onMove,this);if(this.node.disabled){this.disabled=true;this.addClass("x-tree-node-disabled");}if(this.node.hidden){this.hide();}var c=this.node.getOwnerTree();var d=c.enableDD||c.enableDrag||c.enableDrop;if(d&&(!this.node.isRoot||c.rootVisible)){Ext.dd.Registry.register(this.elNode,{node:this.node,handles:this.getDDHandles(),isHandle:false});}},onDblClick:function(b){b.preventDefault();if(this.disabled){return;}if(!this.animating&&this.node.isExpandable()&&!b.getTarget(".x-tree-checkbox",1)){this.node.toggle();}this.fireEvent("dblclick",this.node,b);},onCheckChange:function(){var b=this.isChecked();if(b!==this.node.attributes.checked){this.node.attributes.checked=b;this.fireEvent("checkchange",this.node,b);}},toggleCheck:function(c){var d=this.checkbox;if(!d){return false;}if(c===undefined){c=this.isChecked()===false;}if(c===true){Ext.fly(d).replaceClass("x-tree-node-grayed","x-tree-node-checked");}else{if(c!==false){Ext.fly(d).replaceClass("x-tree-node-checked","x-tree-node-grayed");}else{Ext.fly(d).removeClass(["x-tree-node-checked","x-tree-node-grayed"]);}}this.onCheckChange();return c;},onCheckboxClick:function(){if(!this.disabled){this.toggleCheck();}},onCheckboxOver:function(){this.addClass("x-tree-checkbox-over");},onCheckboxOut:function(){this.removeClass("x-tree-checkbox-over");},onCheckboxDown:function(){this.addClass("x-tree-checkbox-down");},onCheckboxUp:function(){this.removeClass("x-tree-checkbox-down");},renderElements:function(q,l,m,a){this.indentMarkup=q.parentNode?q.parentNode.ui.getChildIndent():"";var p=l.checked!==undefined;var s=l.href?l.href:Ext.isGecko?"":"#";var r=['<li class="x-tree-node"><div ext:tree-node-id="',q.id,'" class="x-tree-node-el x-tree-node-leaf x-unselectable ',l.cls,'" unselectable="on">','<span class="x-tree-node-indent">',this.indentMarkup,"</span>",'<img src="',this.emptyIcon,'" class="x-tree-ec-icon x-tree-elbow" />','<img src="',l.icon||this.emptyIcon,'" class="x-tree-node-icon',(l.icon?" x-tree-node-inline-icon":""),(l.iconCls?" "+l.iconCls:""),'" unselectable="on" />',p?('<img src="'+this.emptyIcon+'" class="x-tree-checkbox'+(l.checked===true?" x-tree-node-checked":(l.checked!==false?" x-tree-node-grayed":""))+'" />'):"",'<a hidefocus="on" class="x-tree-node-anchor" href="',s,'" tabIndex="1" ',l.hrefTarget?' target="'+l.hrefTarget+'"':"",'><span unselectable="on">',q.text,"</span></a></div>",'<ul class="x-tree-node-ct" style="display:none;"></ul>',"</li>"].join("");var t;if(a!==true&&q.nextSibling&&(t=q.nextSibling.ui.getEl())){this.wrap=Ext.DomHelper.insertHtml("beforeBegin",t,r);}else{this.wrap=Ext.DomHelper.insertHtml("beforeEnd",m,r);}this.elNode=this.wrap.childNodes[0];this.ctNode=this.wrap.childNodes[1];var n=this.elNode.childNodes;this.indentNode=n[0];this.ecNode=n[1];this.iconNode=n[2];var o=3;if(p){this.checkbox=n[3];o++;}this.anchor=n[o];this.textNode=n[o].firstChild;},isChecked:function(){return this.checkbox?(Ext.fly(this.checkbox).hasClass("x-tree-node-checked")?true:Ext.fly(this.checkbox).hasClass("x-tree-node-grayed")?this.grayedValue:false):false;},getChecked:function(){return this.node.attributes.checked;}});Ext.override(Ext.tree.TreeEventModel,{initEvents:function(){var b=this.tree.getTreeEl();b.on("click",this.delegateClick,this);if(this.tree.trackMouseOver!==false){b.on("mouseover",this.delegateOver,this);b.on("mouseout",this.delegateOut,this);}b.on("mousedown",this.delegateDown,this);b.on("mouseup",this.delegateUp,this);b.on("dblclick",this.delegateDblClick,this);b.on("contextmenu",this.delegateContextMenu,this);},delegateOver:function(c,d){if(!this.beforeEvent(c)){return;}if(this.lastEcOver){this.onIconOut(c,this.lastEcOver);delete this.lastEcOver;}if(this.lastCbOver){this.onCheckboxOut(c,this.lastCbOver);delete this.lastCbOver;}if(c.getTarget(".x-tree-ec-icon",1)){this.lastEcOver=this.getNode(c);this.onIconOver(c,this.lastEcOver);}else{if(c.getTarget(".x-tree-checkbox",1)){this.lastCbOver=this.getNode(c);this.onCheckboxOver(c,this.lastCbOver);}}if(this.getNodeTarget(c)){this.onNodeOver(c,this.getNode(c));}},delegateOut:function(d,e){if(!this.beforeEvent(d)){return;}var f;if(d.getTarget(".x-tree-ec-icon",1)){f=this.getNode(d);this.onIconOut(d,f);if(f==this.lastEcOver){delete this.lastEcOver;}}else{if(d.getTarget(".x-tree-checkbox",1)){f=this.getNode(d);this.onCheckboxOut(d,f);if(f==this.lastCbOver){delete this.lastCbOver;}}}e=this.getNodeTarget(d);if(e&&!d.within(e,true)){this.onNodeOut(d,this.getNode(d));}},delegateDown:function(c,d){if(!this.beforeEvent(c)){return;}if(c.getTarget(".x-tree-checkbox",1)){this.onCheckboxDown(c,this.getNode(c));}},delegateUp:function(c,d){if(!this.beforeEvent(c)){return;}if(c.getTarget(".x-tree-checkbox",1)){this.onCheckboxUp(c,this.getNode(c));}},delegateClick:function(c,d){if(!this.beforeEvent(c)){return;}if(c.getTarget(".x-tree-checkbox",1)){this.onCheckboxClick(c,this.getNode(c));}else{if(c.getTarget(".x-tree-ec-icon",1)){this.onIconClick(c,this.getNode(c));}else{if(this.getNodeTarget(c)){console.log(this.getNodeTarget(c));this.onNodeClick(c,this.getNode(c));}}}},onCheckboxClick:function(c,d){d.ui.onCheckboxClick();},onCheckboxOver:function(c,d){d.ui.onCheckboxOver();},onCheckboxOut:function(c,d){d.ui.onCheckboxOut();},onCheckboxDown:function(c,d){d.ui.onCheckboxDown();},onCheckboxUp:function(c,d){d.ui.onCheckboxUp();}});Ext.override(Ext.tree.TreePanel,{getChecked:function(a,h){h=h||this.root;var g=[];var f=function(){if(this.ui.getChecked()){g.push(!a?this:(a=="id"?this.id:this.attributes[a]));}};h.cascade(f);return g;}});