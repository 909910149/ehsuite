Ext.ux.TabCloseMenu=Ext.extend(Object,{closeTabText:"关闭",closeOtherTabsText:"关闭其他",showCloseAll:true,closeAllTabsText:"关闭所有",constructor:function(b){Ext.apply(this,b||{});},init:function(b){this.tabs=b;b.on({scope:this,contextmenu:this.onContextMenu,destroy:this.destroy});},destroy:function(){Ext.destroy(this.menu);delete this.menu;delete this.tabs;delete this.active;},onContextMenu:function(e,n,k){this.active=n;var i=this.createMenu(),m=true,j=true,l=i.getComponent("closeall");i.getComponent("close").setDisabled(!n.closable);e.items.each(function(){if(this.closable){m=false;if(this!=n){j=false;return false;}}});i.getComponent("closeothers").setDisabled(j);if(l){l.setDisabled(m);}k.stopEvent();i.showAt(k.getPoint());},createMenu:function(){if(!this.menu){var b=[{itemId:"close",iconCls:"btn-close",text:this.closeTabText,scope:this,handler:this.onClose}];if(this.showCloseAll){b.push("-");}b.push({itemId:"closeothers",iconCls:"btn-close",text:this.closeOtherTabsText,scope:this,handler:this.onCloseOthers});if(this.showCloseAll){b.push({itemId:"closeall",iconCls:"btn-close",text:this.closeAllTabsText,scope:this,handler:this.onCloseAll});}this.menu=new Ext.menu.Menu({items:b});}return this.menu;},onClose:function(){this.tabs.remove(this.active);},onCloseOthers:function(){this.doClose(true);},onCloseAll:function(){this.doClose(false);},doClose:function(c){var d=[];this.tabs.items.each(function(a){if(a.closable){if(!c||a!=this.active){d.push(a);}}},this);Ext.each(d,function(a){this.tabs.remove(a);},this);}});Ext.preg("tabclosemenu",Ext.ux.TabCloseMenu);