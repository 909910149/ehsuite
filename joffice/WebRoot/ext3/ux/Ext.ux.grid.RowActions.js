if("function"!==typeof RegExp.escape){RegExp.escape=function(b){if("string"!==typeof b){return b;}return b.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1");};}Ext.ns("Ext.ux.grid");Ext.ux.grid.RowActions=function(b){Ext.apply(this,b);this.addEvents("beforeaction","action","beforegroupaction","groupaction");Ext.ux.grid.RowActions.superclass.constructor.call(this);};Ext.extend(Ext.ux.grid.RowActions,Ext.util.Observable,{actionEvent:"click",autoWidth:true,dataIndex:"",header:"",menuDisabled:true,sortable:false,tplGroup:'<tpl for="actions">'+'<div class="ux-grow-action-item<tpl if="\'right\'===align"> ux-action-right</tpl> '+'{cls}" style="{style}" qtip="{qtip}">{text}</div>'+"</tpl>",tplRow:'<div class="ux-row-action">'+'<tpl for="actions">'+'<div class="ux-row-action-item {cls} <tpl if="text">'+'ux-row-action-text</tpl>" style="{hide}{style}" qtip="{qtip}">'+'<tpl if="text"><span qtip="{qtip}">{text}</span></tpl></div>'+"</tpl>"+"</div>",hideMode:"visiblity",widthIntercept:4,widthSlope:23,renderer:function(k,i,h,j,m,n){this.tpl=this.processActions(this.actions,null,h);i.css+=(i.css?" ":"")+"ux-row-action-cell";var l=this.tpl.apply(this.getData(k,i,h,j,m,n));return l;},init:function(f){this.grid=f;if(this.autoWidth){this.width=this.widthSlope*this.actions.length+this.widthIntercept;this.fixed=true;}var d=f.getView();var e={scope:this};e[this.actionEvent]=this.onClick;f.afterRender=f.afterRender.createSequence(function(){d.mainBody.on(e);},this);if(d.groupTextTpl&&this.groupActions){d.interceptMouse=d.interceptMouse.createInterceptor(function(a){if(a.getTarget(".ux-grow-action-item")){return false;}});d.groupTextTpl='<div class="ux-grow-action-text">'+d.groupTextTpl+"</div>"+this.processActions(this.groupActions,this.tplGroup).apply();}},getData:function(j,h,g,i,k,l){return g.data||{};},processActions:function(h,i,f){var g=[];Ext.each(h,function(c,b){if(c.fn){if(!c.fn(f)){return true;}}if(c.iconCls&&"function"===typeof(c.callback||c.cb)){this.callbacks=this.callbacks||{};this.callbacks[c.iconCls]=c.callback||c.cb;}var a={cls:c.iconIndex?"{"+c.iconIndex+"}":(c.iconCls?c.iconCls:""),qtip:c.qtipIndex?"{"+c.qtipIndex+"}":(c.tooltip||c.qtip?c.tooltip||c.qtip:""),text:c.textIndex?"{"+c.textIndex+"}":(c.text?c.text:""),hide:c.hideIndex?'<tpl if="'+c.hideIndex+'">'+("display"===this.hideMode?"display:none":"visibility:hidden")+";</tpl>":(c.hide?("display"===this.hideMode?"display:none":"visibility:hidden;"):""),align:c.align||"right",style:c.style?c.style:""};g.push(a);},this);var j=new Ext.XTemplate(i||this.tplRow);return new Ext.XTemplate(j.apply({actions:g}));},onClick:function(s,r){var q=this.grid.getView();var v=false;var e=s.getTarget(".x-grid3-row");var x=q.findCellIndex(r.parentNode.parentNode);var n=s.getTarget(".ux-row-action-item");if(n){v=n.className.replace(/ux-row-action-item /,"");if(v){v=v.replace(/ ux-row-action-text/,"");v=v.trim();}}if(false!==e&&false!==x&&false!==v){var t=this.grid.store.getAt(e.rowIndex);if(this.callbacks&&"function"===typeof this.callbacks[v]){this.callbacks[v](this.grid,t,v,e.rowIndex,x);}if(true!==this.eventsSuspended&&false===this.fireEvent("beforeaction",this.grid,t,v,e.rowIndex,x)){return;}else{if(true!==this.eventsSuspended){this.fireEvent("action",this.grid,t,v,e.rowIndex,x);}}}n=s.getTarget(".ux-grow-action-item");if(n){var p=q.findGroup(r);var u=p?p.id.replace(/ext-gen[0-9]+-gp-/,""):null;var w;if(u){var o=new RegExp(RegExp.escape(u));w=this.grid.store.queryBy(function(a){return a._groupId.match(o);});w=w?w.items:[];}v=n.className.replace(/ux-grow-action-item (ux-action-right )*/,"");if("function"===typeof this.callbacks[v]){this.callbacks[v](this.grid,w,v,u);}if(true!==this.eventsSuspended&&false===this.fireEvent("beforegroupaction",this.grid,w,v,u)){return false;}this.fireEvent("groupaction",this.grid,w,v,u);}}});Ext.reg("rowactions",Ext.ux.grid.RowActions);