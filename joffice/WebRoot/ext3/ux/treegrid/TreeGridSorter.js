Ext.ns("Ext.ux.tree");Ext.ux.tree.TreeGridSorter=Ext.extend(Ext.tree.TreeSorter,{sortClasses:["sort-asc","sort-desc"],sortAscText:"Sort Ascending",sortDescText:"Sort Descending",constructor:function(d,c){if(!Ext.isObject(c)){c={property:d.columns[0].dataIndex||"text",folderSort:true};}Ext.ux.tree.TreeGridSorter.superclass.constructor.apply(this,arguments);this.tree=d;d.on("headerclick",this.onHeaderClick,this);d.ddAppendOnly=true;me=this;this.defaultSortFn=function(m,n){var q=me.dir&&me.dir.toLowerCase()=="desc";var t=me.property||"text";var r=me.sortType;var p=me.folderSort;var o=me.caseSensitive===true;var s=me.leafAttr||"leaf";if(p){if(m.attributes[s]&&!n.attributes[s]){return 1;}if(!m.attributes[s]&&n.attributes[s]){return -1;}}var a=r?r(m):(o?m.attributes[t]:m.attributes[t].toUpperCase());var b=r?r(n):(o?n.attributes[t]:n.attributes[t].toUpperCase());if(a<b){return q?+1:-1;}else{if(a>b){return q?-1:+1;}else{return 0;}}};d.on("afterrender",this.onAfterTreeRender,this,{single:true});d.on("headermenuclick",this.onHeaderMenuClick,this);},onAfterTreeRender:function(){if(this.tree.hmenu){this.tree.hmenu.insert(0,{itemId:"asc",text:this.sortAscText,cls:"xg-hmenu-sort-asc"},{itemId:"desc",text:this.sortDescText,cls:"xg-hmenu-sort-desc"});}this.updateSortIcon(0,"asc");},onHeaderMenuClick:function(f,c,e){if(c==="asc"||c==="desc"){this.onHeaderClick(f,null,e);return false;}},onHeaderClick:function(g,c,f){if(g&&!this.tree.headersDisabled){var h=this;h.property=g.dataIndex;h.dir=g.dir=(g.dir==="desc"?"asc":"desc");h.sortType=g.sortType;h.caseSensitive===Ext.isBoolean(g.caseSensitive)?g.caseSensitive:this.caseSensitive;h.sortFn=g.sortFn||this.defaultSortFn;this.tree.root.cascade(function(a){if(!a.isLeaf()){h.updateSort(h.tree,a);}});this.updateSortIcon(f,g.dir);}},updateSortIcon:function(e,f){var g=this.sortClasses;var h=this.tree.innerHd.select("td").removeClass(g);h.item(e).addClass(g[f=="desc"?1:0]);}});