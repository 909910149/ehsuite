Ext.ux.form.ItemSelector=Ext.extend(Ext.form.Field,{hideNavIcons:false,imagePath:"",iconUp:"up2.gif",iconDown:"down2.gif",iconLeft:"left2.gif",iconRight:"right2.gif",iconTop:"top2.gif",iconBottom:"bottom2.gif",drawUpIcon:true,drawDownIcon:true,drawLeftIcon:true,drawRightIcon:true,drawTopIcon:true,drawBotIcon:true,delimiter:",",bodyStyle:null,border:false,defaultAutoCreate:{tag:"div"},multiselects:null,initComponent:function(){Ext.ux.form.ItemSelector.superclass.initComponent.call(this);this.addEvents({"rowdblclick":true,"change":true});},onRender:function(o,j){Ext.ux.form.ItemSelector.superclass.onRender.call(this,o,j);var k=[{legend:"可选择",draggable:true,droppable:true,width:100,height:100},{legend:"已选择",droppable:true,draggable:true,width:100,height:100}];this.fromMultiselect=new Ext.ux.form.MultiSelect(Ext.applyIf(this.multiselects[0],k[0]));this.fromMultiselect.on("dblclick",this.onRowDblClick,this);this.toMultiselect=new Ext.ux.form.MultiSelect(Ext.applyIf(this.multiselects[1],k[1]));this.toMultiselect.on("dblclick",this.onRowDblClick,this);var l=new Ext.Panel({bodyStyle:this.bodyStyle,border:this.border,layout:"table",layoutConfig:{columns:3}});l.add(this.fromMultiselect);var p=new Ext.Panel({header:false});l.add(p);l.add(this.toMultiselect);l.render(this.el);p.el.down("."+p.bwrapCls).remove();if(this.imagePath!=""&&this.imagePath.charAt(this.imagePath.length-1)!="/"){this.imagePath+="/";}this.iconUp=this.imagePath+(this.iconUp||"up2.gif");this.iconDown=this.imagePath+(this.iconDown||"down2.gif");this.iconLeft=this.imagePath+(this.iconLeft||"left2.gif");this.iconRight=this.imagePath+(this.iconRight||"right2.gif");this.iconTop=this.imagePath+(this.iconTop||"top2.gif");this.iconBottom=this.imagePath+(this.iconBottom||"bottom2.gif");var m=p.getEl();this.toTopIcon=m.createChild({tag:"img",src:this.iconTop,style:{cursor:"pointer",margin:"2px"}});m.createChild({tag:"br"});this.upIcon=m.createChild({tag:"img",src:this.iconUp,style:{cursor:"pointer",margin:"2px"}});m.createChild({tag:"br"});this.addIcon=m.createChild({tag:"img",src:this.iconRight,style:{cursor:"pointer",margin:"2px"}});m.createChild({tag:"br"});this.removeIcon=m.createChild({tag:"img",src:this.iconLeft,style:{cursor:"pointer",margin:"2px"}});m.createChild({tag:"br"});this.downIcon=m.createChild({tag:"img",src:this.iconDown,style:{cursor:"pointer",margin:"2px"}});m.createChild({tag:"br"});this.toBottomIcon=m.createChild({tag:"img",src:this.iconBottom,style:{cursor:"pointer",margin:"2px"}});this.toTopIcon.on("click",this.toTop,this);this.upIcon.on("click",this.up,this);this.downIcon.on("click",this.down,this);this.toBottomIcon.on("click",this.toBottom,this);this.addIcon.on("click",this.fromTo,this);this.removeIcon.on("click",this.toFrom,this);if(!this.drawUpIcon||this.hideNavIcons){this.upIcon.dom.style.display="none";}if(!this.drawDownIcon||this.hideNavIcons){this.downIcon.dom.style.display="none";}if(!this.drawLeftIcon||this.hideNavIcons){this.addIcon.dom.style.display="none";}if(!this.drawRightIcon||this.hideNavIcons){this.removeIcon.dom.style.display="none";}if(!this.drawTopIcon||this.hideNavIcons){this.toTopIcon.dom.style.display="none";}if(!this.drawBotIcon||this.hideNavIcons){this.toBottomIcon.dom.style.display="none";}var i=l.body.first();this.el.setWidth(l.body.first().getWidth());l.body.removeClass();this.hiddenName=this.name;var n={tag:"input",type:"hidden",value:"",name:this.name};this.hiddenField=this.el.createChild(n);},doLayout:function(){if(this.rendered){this.fromMultiselect.fs.doLayout();this.toMultiselect.fs.doLayout();}},afterRender:function(){Ext.ux.form.ItemSelector.superclass.afterRender.call(this);this.toStore=this.toMultiselect.store;this.toStore.on("add",this.valueChanged,this);this.toStore.on("remove",this.valueChanged,this);this.toStore.on("load",this.valueChanged,this);this.valueChanged(this.toStore);},toTop:function(){var f=this.toMultiselect.view.getSelectedIndexes();var e=[];if(f.length>0){f.sort();for(var d=0;d<f.length;d++){record=this.toMultiselect.view.store.getAt(f[d]);e.push(record);}f=[];for(var d=e.length-1;d>-1;d--){record=e[d];this.toMultiselect.view.store.remove(record);this.toMultiselect.view.store.insert(0,record);f.push(((e.length-1)-d));}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(f);},toBottom:function(){var f=this.toMultiselect.view.getSelectedIndexes();var e=[];if(f.length>0){f.sort();for(var d=0;d<f.length;d++){record=this.toMultiselect.view.store.getAt(f[d]);e.push(record);}f=[];for(var d=0;d<e.length;d++){record=e[d];this.toMultiselect.view.store.remove(record);this.toMultiselect.view.store.add(record);f.push((this.toMultiselect.view.store.getCount())-(e.length-d));}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(f);},up:function(){var f=null;var h=this.toMultiselect.view.getSelectedIndexes();h.sort();var g=[];if(h.length>0){for(var e=0;e<h.length;e++){f=this.toMultiselect.view.store.getAt(h[e]);if((h[e]-1)>=0){this.toMultiselect.view.store.remove(f);this.toMultiselect.view.store.insert(h[e]-1,f);g.push(h[e]-1);}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(g);}},down:function(){var f=null;var h=this.toMultiselect.view.getSelectedIndexes();h.sort();h.reverse();var g=[];if(h.length>0){for(var e=0;e<h.length;e++){f=this.toMultiselect.view.store.getAt(h[e]);if((h[e]+1)<this.toMultiselect.view.store.getCount()){this.toMultiselect.view.store.remove(f);this.toMultiselect.view.store.insert(h[e]+1,f);g.push(h[e]+1);}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(g);}},fromTo:function(){var h=this.fromMultiselect.view.getSelectedIndexes();var f=[];if(h.length>0){for(var i=0;i<h.length;i++){record=this.fromMultiselect.view.store.getAt(h[i]);f.push(record);}if(!this.allowDup){h=[];}for(var i=0;i<f.length;i++){record=f[i];if(this.allowDup){var g=new Ext.data.Record();record.id=g.id;delete g;this.toMultiselect.view.store.add(record);}else{this.fromMultiselect.view.store.remove(record);this.toMultiselect.view.store.add(record);h.push((this.toMultiselect.view.store.getCount()-1));}}}this.toMultiselect.view.refresh();this.fromMultiselect.view.refresh();var j=this.toMultiselect.store.sortInfo;if(j){this.toMultiselect.store.sort(j.field,j.direction);}this.toMultiselect.view.select(h);},toFrom:function(){var g=this.toMultiselect.view.getSelectedIndexes();var f=[];if(g.length>0){for(var h=0;h<g.length;h++){record=this.toMultiselect.view.store.getAt(g[h]);f.push(record);}g=[];for(var h=0;h<f.length;h++){record=f[h];this.toMultiselect.view.store.remove(record);if(!this.allowDup){this.fromMultiselect.view.store.add(record);g.push((this.fromMultiselect.view.store.getCount()-1));}}}this.fromMultiselect.view.refresh();this.toMultiselect.view.refresh();var e=this.fromMultiselect.store.sortInfo;if(e){this.fromMultiselect.store.sort(e.field,e.direction);}this.fromMultiselect.view.select(g);},valueChanged:function(h){var f=null;var e=[];for(var g=0;g<h.getCount();g++){f=h.getAt(g);e.push(f.get(this.toMultiselect.valueField));}this.hiddenField.dom.value=e.join(this.delimiter);this.fireEvent("change",this,this.getValue(),this.hiddenField.dom.value);},getValue:function(){return this.hiddenField.dom.value;},onRowDblClick:function(h,f,e,g){if(h==this.toMultiselect.view){this.toFrom();}else{if(h==this.fromMultiselect.view){this.fromTo();}}return this.fireEvent("rowdblclick",h,f,e,g);},reset:function(){range=this.toMultiselect.store.getRange();this.toMultiselect.store.removeAll();this.fromMultiselect.store.add(range);var b=this.fromMultiselect.store.sortInfo;if(b){this.fromMultiselect.store.sort(b.field,b.direction);}this.valueChanged(this.toMultiselect.store);}});Ext.reg("itemselector",Ext.ux.form.ItemSelector);Ext.ux.ItemSelector=Ext.ux.form.ItemSelector;