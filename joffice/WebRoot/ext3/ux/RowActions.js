Ext.ns("Ext.ux.grid");if("function"!==typeof RegExp.escape){RegExp.escape=function(b){if("string"!==typeof b){return b;}return b.replace(/([.*+?\^=!:${}()|\[\]\/\\])/g,"\\$1");};}Ext.ux.grid.RowActions=function(b){Ext.apply(this,b);this.addEvents("beforeaction","action","beforegroupaction","groupaction");Ext.ux.grid.RowActions.superclass.constructor.call(this);};Ext.extend(Ext.ux.grid.RowActions,Ext.util.Observable,{actionEvent:"click",autoWidth:true,dataIndex:"",header:"",keepSelection:false,menuDisabled:true,sortable:false,tplGroup:'<tpl for="actions">'+'<div class="ux-grow-action-item<tpl if="\'right\'===align"> ux-action-right</tpl> '+'{cls}" style="{style}" qtip="{qtip}">{text}</div>'+"</tpl>",tplRow:'<div class="ux-row-action">'+'<tpl for="actions">'+'<div class="ux-row-action-item {cls} <tpl if="text">'+'ux-row-action-text</tpl>" style="{hide}{style}" qtip="{qtip}">'+'<tpl if="text"><span qtip="{qtip}">{text}</span></tpl></div>'+"</tpl>"+"</div>",hideMode:"visiblity",widthIntercept:4,widthSlope:21,init:function(f){this.grid=f;if(!this.tpl){this.tpl=this.processActions(this.actions);}if(this.autoWidth){this.width=this.widthSlope*this.actions.length+this.widthIntercept;this.fixed=true;}var d=f.getView();var e={scope:this};e[this.actionEvent]=this.onClick;f.afterRender=f.afterRender.createSequence(function(){d.mainBody.on(e);f.on("destroy",this.purgeListeners,this);},this);if(!this.renderer){this.renderer=function(b,l,k,a,c,j){l.css+=(l.css?" ":"")+"ux-row-action-cell";return this.tpl.apply(this.getData(b,l,k,a,c,j));}.createDelegate(this);}if(d.groupTextTpl&&this.groupActions){d.interceptMouse=d.interceptMouse.createInterceptor(function(a){if(a.getTarget(".ux-grow-action-item")){return false;}});d.groupTextTpl='<div class="ux-grow-action-text">'+d.groupTextTpl+"</div>"+this.processActions(this.groupActions,this.tplGroup).apply();}if(true===this.keepSelection){f.processEvent=f.processEvent.createInterceptor(function(b,a){if("mousedown"===b){return !this.getAction(a);}},this);}},getData:function(j,h,g,i,k,l){return g.data||{};},processActions:function(g,h){var f=[];Ext.each(g,function(c,b){if(c.iconCls&&"function"===typeof(c.callback||c.cb)){this.callbacks=this.callbacks||{};this.callbacks[c.iconCls]=c.callback||c.cb;}var a={cls:c.iconIndex?"{"+c.iconIndex+"}":(c.iconCls?c.iconCls:""),qtip:c.qtipIndex?"{"+c.qtipIndex+"}":(c.tooltip||c.qtip?c.tooltip||c.qtip:""),text:c.textIndex?"{"+c.textIndex+"}":(c.text?c.text:""),hide:c.hideIndex?'<tpl if="'+c.hideIndex+'">'+("display"===this.hideMode?"display:none":"visibility:hidden")+";</tpl>":(c.hide?("display"===this.hideMode?"display:none":"visibility:hidden;"):""),align:c.align||"right",style:c.style?c.style:""};f.push(a);},this);var e=new Ext.XTemplate(h||this.tplRow);return new Ext.XTemplate(e.apply({actions:f}));},getAction:function(f){var d=false;var e=f.getTarget(".ux-row-action-item");if(e){d=e.className.replace(/ux-row-action-item /,"");if(d){d=d.replace(/ ux-row-action-text/,"");d=d.trim();}}return d;},onClick:function(q,p){var o=this.grid.getView();var e=q.getTarget(".x-grid3-row");var w=o.findCellIndex(p.parentNode.parentNode);var u=this.getAction(q);if(false!==e&&false!==w&&false!==u){var r=this.grid.store.getAt(e.rowIndex);if(this.callbacks&&"function"===typeof this.callbacks[u]){this.callbacks[u](this.grid,r,u,e.rowIndex,w);}if(true!==this.eventsSuspended&&false===this.fireEvent("beforeaction",this.grid,r,u,e.rowIndex,w)){return;}else{if(true!==this.eventsSuspended){this.fireEvent("action",this.grid,r,u,e.rowIndex,w);}}}t=q.getTarget(".ux-grow-action-item");if(t){var n=o.findGroup(p);var s=n?n.id.replace(/ext-gen[0-9]+-gp-/,""):null;var v;if(s){var m=new RegExp(RegExp.escape(s));v=this.grid.store.queryBy(function(a){return a._groupId.match(m);});v=v?v.items:[];}u=t.className.replace(/ux-grow-action-item (ux-action-right )*/,"");if("function"===typeof this.callbacks[u]){this.callbacks[u](this.grid,v,u,s);}if(true!==this.eventsSuspended&&false===this.fireEvent("beforegroupaction",this.grid,v,u,s)){return false;}this.fireEvent("groupaction",this.grid,v,u,s);}}});Ext.reg("rowactions",Ext.ux.grid.RowActions);