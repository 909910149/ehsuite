Ext.namespace("Cls","Cls.form","Cls.menu");Cls.form.DateTimeField=Ext.extend(Ext.form.DateField,{timeFields:"auto",availableTimeFields:["H","h","G","g","i","s"],formatMap:{g:"h",G:"H"},timeFieldHandlers:null,initComponent:function(){Cls.form.DateTimeField.superclass.initComponent.call(this);if(!this.timeFields||this.timeFields=="auto"){this.timeFields="";for(e in this.availableTimeFields){var h=this.availableTimeFields[e];if(this.format.indexOf(h)>=0){this.timeFields+=h;}}}var g=[{tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger x-form-date-trigger"}];var f=this.availableTimeFields.join("");for(var e=0;e<this.timeFields.length;e++){var h=this.timeFields.charAt(e);if(f.indexOf(h)<0){continue;}h=this.formatMap[h]||h;g.push({tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger x-form-time-"+h+"-trigger"});}this.triggerConfig={tag:"span",cls:"x-form-dateTime-triggers",cn:g};},onResize:function(e,g){Ext.form.TriggerField.superclass.onResize.call(this,e,g);var h=this.trigger.getWidth()||(17*(this.timeFields.length+1));var f=this.el.getWidth();if(typeof e=="number"){f=this.adjustWidth("input",e-h);this.el.setWidth(f);}this.wrap.setWidth(f+h);},adjustWidth:function(d,c){if(typeof c=="number"&&(Ext.isIE&&(Ext.isIE6||!Ext.isStrict))&&/input|textarea/i.test(d)&&!this.inEditor){return c-3;}return c;},getTrigger:function(b){return this.triggers[b];},setMinValue:function(b){this.minValue=(typeof b=="string"?this.parseDate(b):b);if(this.menu){this.menu.picker.setMinDate(new Date(this.minValue.getTime()));}},setMaxValue:function(b){this.maxValue=(typeof b=="string"?this.parseDate(b):b);if(this.menu){this.menu.picker.setMaxDate(new Date(this.maxValue.getTime()));}},onTriggerClick:function(){if(this.disabled){return;}if(this.menu==null){this.menu=new Ext.menu.DateMenu({hideOnClick:false});}Ext.apply(this.menu.picker,{minDate:this.minValue?new Date(this.minValue.getTime()):this.minValue,maxDate:this.maxValue?new Date(this.maxValue.getTime()):this.maxValue,disabledDatesRE:this.disabledDatesRE,disabledDatesText:this.disabledDatesText,disabledDays:this.disabledDays,disabledDaysText:this.disabledDaysText,format:this.format,showToday:this.showToday,todayIsNow:true,minText:String.format(this.minText,this.formatDate(this.minValue)),maxText:String.format(this.maxText,this.formatDate(this.maxValue))});this.menu.picker.setValue(this.getValue()||new Date());this.menu.show(this.el,"tl-bl?");this.menuEvents("on");},onSelect:function(e,f){var d=new Date(f.getTime());if(this.getValue()){f.setHours(this.getValue().getHours());f.setSeconds(this.getValue().getSeconds());f.setMinutes(this.getValue().getMinutes());}this.setValue(f);this.fireEvent("select",this,f);this.menu.hide();},initTrigger:function(){var d=this.trigger.select(".x-form-trigger",true);this.wrap.setStyle("overflow","hidden");this.timeFieldHandlers=new Array();var c=this;d.each(function(i,b,j){i.hide=function(){var e=c.wrap.getWidth();this.dom.style.display="none";c.el.setWidth(e-c.trigger.getWidth());};i.show=function(){var e=c.wrap.getWidth();this.dom.style.display="";c.el.setWidth(e-c.trigger.getWidth());};if(j>0){var a=c.timeFields.charAt(j-1);a=this.formatMap[a]||a;var h=new Cls.form.TimeFieldHandler({parent:this,timeField:a});i.on("click",h.onTriggerClick,h,{preventDefault:true});c.timeFieldHandlers.push(h);}else{i.on("click",this.onTriggerClick,this,{preventDefault:true});}i.addClassOnOver("x-form-trigger-over");i.addClassOnClick("x-form-trigger-click");},this);this.triggers=d.elements;},onDestroy:function(){if(this.timeFieldHandlers){for(var d=this.timeFieldHandlers.length-1;d>=0;d--){var c=this.timeFieldHandlers[d];c.destroy();this.timeFieldHandlers[d]=null;delete c;}this.timeFieldHandlers=null;}Cls.form.DateTimeField.superclass.onDestroy.call(this);},validateBlur:function(){if(!Cls.form.DateTimeField.superclass.validateBlur.call(this)){return false;}for(var b=this.timeFieldHandlers.length-1;b>=0;b--){if(!this.timeFieldHandlers[b].validateBlur()){return false;}}return true;}});Ext.reg("datetimefield",Cls.form.DateTimeField);Cls.form.TimeFieldHandler=function(b){Ext.apply(this,b);};Ext.extend(Cls.form.TimeFieldHandler,Ext.util.Observable,{parent:null,timeField:null,menu:null,onTriggerClick:function(){if(this.parent.disabled){return;}if(this.menu==null){this.menu=new Cls.menu.TimeFieldMenu({timeField:this.timeField});}Ext.apply(this.menu.picker,{minDate:this.parent.minValue,maxDate:this.parent.maxValue,minText:String.format(this.parent.minText,this.parent.formatDate(this.parent.minValue)),maxText:String.format(this.parent.maxText,this.parent.formatDate(this.parent.maxValue))});this.menu.picker.setValue(this.parent.getValue()||new Date());this.menu.show(this.parent.el,"tl-bl?");this.menuEvents("on");},menuEvents:function(b){this.menu[b]("select",this.onSelect,this);this.menu[b]("hide",this.onMenuHide,this);this.menu[b]("show",this.parent.onFocus,this);},onSelect:function(e,f){if(this.parent.getValue()){var d=new Date(this.parent.getValue().getTime());this.menu.picker.copyTimeField(f,d);this.parent.setValue(d);}else{this.parent.setValue(f);}this.parent.fireEvent("select",this,f);this.menu.hide();},onMenuHide:function(){this.parent.focus(false,60);this.menuEvents("un");},destroy:function(){if(this.menu){this.menu.destroy();}},validateBlur:function(){return !this.menu||!this.menu.isVisible();}});Cls.menu.TimeFieldMenu=Ext.extend(Ext.menu.Menu,{cls:"x-timeField-menu",enableScrolling:false,initComponent:function(){this.on("beforeshow",this.onBeforeShow,this);if(this.strict=(Ext.isIE7&&Ext.isStrict)){this.on("show",this.onShow,this,{single:true,delay:20});}var b=Ext.apply({internalRender:this.strict||!Ext.isIE,ctCls:"x-menu-timeField-item"},this.initialConfig);Ext.apply(this,{plain:true,items:this.picker=Ext.ComponentMgr.create(b,"timepicker"+this.initialConfig.timeField)});this.picker.purgeListeners();Cls.menu.TimeFieldMenu.superclass.initComponent.call(this);me=this;this.relayEvents(this.picker,["select"]);},onBeforeShow:function(){},onClick:function(){if(this.hideOnClick){this.hide(true);}},onShow:function(){var b=this.picker.getEl();b.setWidth(b.getWidth());},beforeDestroy:function(){this.picker.destroy();}});Cls.TimeFieldPicker=Ext.extend(Ext.Component,{minText:"This date is before the minimum date",maxText:"This date is after the maximum date",nowText:"Now",constrainToViewport:true,initComponent:function(){Cls.TimeFieldPicker.superclass.initComponent.call(this);var b=this.value;this.value=new Date();if(b){this.value.setTime(b.getTime());}this.addEvents("select");if(this.handler){this.on("select",this.handler,this.scope||this);}},setMinDate:function(b){this.minDate=b;this.update(this.value,true);},setMaxDate:function(b){this.maxDate=b;this.update(this.value,true);},setValue:function(b){this.value=new Date();this.value.setTime(b.getTime());if(this.el){this.update(this.value,true);}},getValue:function(){return this.value;},focus:function(){if(this.el){this.update(this.activeDate);}},onRender:function(m,n){var h=['<table cellspacing="0" width="'+this.columns*25+'">','<tr><td class="x-date-middle" align="center">'+this.header+"</td></tr>",'<tr><td><table class="x-date-inner" cellspacing="0">'];h[h.length]="<tbody><tr>";for(var k=0;k<this.max;k++){if(k%this.columns==0&&k!=0){h[h.length]="</tr><tr>";}var i=(k<10)?"0"+k:""+k;h[h.length]='<td><a href="#" hidefocus="on" class="x-date-date" tabIndex="1"><em><span>'+i+"</span></em></a></td>";}h.push("</tr></tbody></table></td></tr>",'</table><div class="x-date-mp"></div>');var j=document.createElement("div");j.className="x-date-picker";j.innerHTML=this.generateContent();m.dom.insertBefore(j,n);this.el=Ext.get(j);this.eventEl=Ext.get(j.firstChild);this.eventEl.on("mousewheel",this.handleMouseWheel,this);var l=new Ext.KeyNav(this.eventEl,{"left":function(a){this.update(this.activeDate.add(this.timeField,-1));},"right":function(a){this.update(this.activeDate.add(this.timeField,1));},"up":function(a){this.update(this.activeDate.add(this.timeField,-this.columns));},"down":function(a){this.update(this.activeDate.add(this.timeField,this.columns));},"enter":function(a){a.stopPropagation();return true;},scope:this});this.eventEl.on("click",this.handleDateClick,this,{delegate:"a.x-date-date"});this.el.unselectable();this.cells=this.el.select("table.x-date-inner tbody td");if(Ext.isIE){this.el.repaint();}this.update(this.value);},generateContent:function(g){var e=['<table cellspacing="0" width="'+this.columns*25+'">','<tr><td class="x-date-middle" align="center">'+this.header+"</td></tr>",'<tr><td><table class="x-date-inner" cellspacing="0">'];e[e.length]="<tbody><tr>";for(var h=0;h<this.max;h++){if(h%this.columns==0&&h!=0){e[e.length]="</tr><tr>";}var f=(h<10)?"0"+h:""+h;e[e.length]='<td><a href="#" hidefocus="on" class="x-date-date" tabIndex="1"><em><span>'+f+"</span></em></a></td>";}e.push("</tr></tbody></table></td></tr>",'</table><div class="x-date-mp"></div>');return e.join("");},handleMouseWheel:function(d){var c=d.getWheelDelta();if(c>0){this.update(this.activeDate.add(this.timeField,1));d.stopEvent();}else{if(c<0){this.update(this.activeDate.add(this.timeField,-1));d.stopEvent();}}},handleDateClick:function(f,d){f.stopEvent();if(d.timeFieldValue!=undefined&&!Ext.fly(d.parentNode).hasClass("x-date-disabled")){var e=new Date(this.activeDate.getTime());this.updateTimeField(e,d.timeFieldValue);this.setValue(e);this.fireEvent("select",this,this.value);}},update:function(A,d){var w=this.activeDate;this.activeDate=A;if(!d&&w&&this.el){var q=this.extractTimeField(A);this.cells.removeClass("x-date-selected");this.cells.each(function(a){if(a.dom.firstChild.timeFieldValue==q){a.addClass("x-date-selected");setTimeout(function(){try{a.dom.firstChild.focus();}catch(b){}},50);return false;}});return;}this.cells.removeClass("x-date-selected");var i=this.cells.elements;var B=new Date();var y=this.minDate?this.minTime(this.minDate).getTime():Number.NEGATIVE_INFINITY;var t=this.maxDate?this.maxTime(this.maxDate).getTime():Number.POSITIVE_INFINITY;var v=new Date(A.getTime());var s=this;var u=function(b,e){e.title="";var a=v.getTime();var c=s.extractTimeField(v);e.firstChild.timeFieldValue=c;if(c==s.extractTimeField(B)){e.className+=" x-date-today";e.title=b.nowText;}if(c==s.extractTimeField(A)){e.className+=" x-date-selected";setTimeout(function(){try{e.firstChild.focus();}catch(f){}},50);}if(a<y){e.className=" x-date-disabled";e.title=b.minText;return;}if(a>t){e.className=" x-date-disabled";e.title=b.maxText;return;}};for(var x=0;x<this.max;x++){this.updateTimeField(v,x);i[x].className="x-date-active";u(this,i[x]);}if(!this.internalRender){var z=this.el.dom.firstChild;var r=z.offsetWidth;this.el.setWidth(r+this.el.getBorderWidth("lr"));Ext.fly(z).setWidth(r);this.internalRender=true;if(Ext.isOpera&&!this.secondPass){z.rows[0].cells[1].style.width=(r-(z.rows[0].cells[0].offsetWidth+z.rows[0].cells[2].offsetWidth))+"px";this.secondPass=true;this.update.defer(10,this,[A]);}}},updateTimeField:Ext.emptyFn,extractTimeField:Ext.emptyFn,copyTimeField:function(d,c){this.updateTimeField(c,this.extractTimeField(d));},minTime:function(b){return new Date(Math.floor(b.getTime()/this.fieldInMillis)*this.fieldInMillis);},maxTime:function(b){return new Date((Math.floor(b.getTime()/this.fieldInMillis)+1)*this.fieldInMillis-1);}});Cls.DateHourPicker=Ext.extend(Cls.TimeFieldPicker,{max:24,columns:6,timeField:"H",header:"时",fieldInMillis:1000*60*60,updateTimeField:function(d,c){d.setHours(c);},extractTimeField:function(b){return b.getHours();}});Ext.reg("timepickerH",Cls.DateHourPicker);Cls.DateAMPMHourPicker=Ext.extend(Cls.DateHourPicker,{timeField:"h",generateContent:function(){var b=['<table cellspacing="0" width="'+this.columns*25+'">','<tr><td class="x-date-middle" align="center">'+this.header+"</td></tr>"];b.push(this.generateXMContent("AM"));b.push(this.generateXMContent("PM"));b.push('</table><div class="x-date-mp"></div>');return b.join("");},generateXMContent:function(g){var e=["<tr><td>",'<table class="x-date-inner" cellspacing="0">','<th colspan="6"><span>'+g+"</span></th>","<tbody><tr>"];for(var h=0;h<12;h++){if(h%this.columns==0&&h!=0){e[e.length]="</tr><tr>";}var f=(h<10)?"0"+h:""+h;e[e.length]='<td><a href="#" hidefocus="on" class="x-date-date" tabIndex="1"><em><span>'+f+"</span></em></a></td>";}e.push("</tr></tbody></table></td></tr>");return e.join("");}});Ext.reg("timepickerh",Cls.DateAMPMHourPicker);Cls.DateMinutePicker=Ext.extend(Cls.TimeFieldPicker,{max:60,columns:10,timeField:"i",header:"分",fieldInMillis:1000*60,updateTimeField:function(d,c){d.setMinutes(c);},extractTimeField:function(b){return b.getMinutes();}});Ext.reg("timepickeri",Cls.DateMinutePicker);Cls.DateSecondPicker=Ext.extend(Cls.DateMinutePicker,{timeField:"s",header:"秒",fieldInMillis:1000,updateTimeField:function(d,c){d.setSeconds(c);},extractTimeField:function(b){return b.getSeconds();}});Ext.reg("timepickers",Cls.DateSecondPicker);