Ext.namespace("Ext.ux.menu");Ext.ux.menu.ListMenu=Ext.extend(Ext.menu.Menu,{labelField:"text",loadingText:"Loading...",loadOnShow:true,single:false,constructor:function(f){this.selected=[];this.addEvents("checkchange");Ext.ux.menu.ListMenu.superclass.constructor.call(this,f=f||{});if(!f.store&&f.options){var j=[];for(var i=0,g=f.options.length;i<g;i++){var h=f.options[i];switch(Ext.type(h)){case"array":j.push(h);break;case"object":j.push([h.id,h[this.labelField]]);break;case"string":j.push([h,h]);break;}}this.store=new Ext.data.Store({reader:new Ext.data.ArrayReader({id:0},["id",this.labelField]),data:j,listeners:{"load":this.onLoad,scope:this}});this.loaded=true;}else{this.add({text:this.loadingText,iconCls:"loading-indicator"});this.store.on("load",this.onLoad,this);}},destroy:function(){if(this.store){this.store.destroy();}Ext.ux.menu.ListMenu.superclass.destroy.call(this);},show:function(){var b=null;return function(){if(arguments.length===0){Ext.ux.menu.ListMenu.superclass.show.apply(this,b);}else{b=arguments;if(this.loadOnShow&&!this.loaded){this.store.load();}Ext.ux.menu.ListMenu.superclass.show.apply(this,arguments);}};}(),onLoad:function(n,h){var j=this.isVisible();this.hide(false);this.removeAll(true);var l=this.single?Ext.id():null;for(var m=0,i=h.length;m<i;m++){var k=new Ext.menu.CheckItem({text:h[m].get(this.labelField),group:l,checked:this.selected.indexOf(h[m].id)>-1,hideOnClick:false});k.itemId=h[m].id;k.on("checkchange",this.checkChange,this);this.add(k);}this.loaded=true;if(j){this.show();}this.fireEvent("load",this,h);},getSelected:function(){return this.selected;},setSelected:function(b){b=this.selected=[].concat(b);if(this.loaded){this.items.each(function(e){e.setChecked(false,true);for(var f=0,a=b.length;f<a;f++){if(e.itemId==b[f]){e.setChecked(true,true);}}},this);}},checkChange:function(d,e){var f=[];this.items.each(function(a){if(a.checked){f.push(a.itemId);}},this);this.selected=f;this.fireEvent("checkchange",d,e);}});