Ext.ns("Ext.ux.form");Ext.ux.form.SelectBox=Ext.extend(Ext.form.ComboBox,{constructor:function(b){this.searchResetDelay=1000;b=b||{};b=Ext.apply(b||{},{editable:false,forceSelection:true,rowHeight:false,lastSearchTerm:false,triggerAction:"all",mode:"local"});Ext.ux.form.SelectBox.superclass.constructor.apply(this,arguments);this.lastSelectedIndex=this.selectedIndex||0;},initEvents:function(){Ext.ux.form.SelectBox.superclass.initEvents.apply(this,arguments);this.el.on("keydown",this.keySearch,this,true);this.cshTask=new Ext.util.DelayedTask(this.clearSearchHistory,this);},keySearch:function(j,k,e){var h=j.getKey();var l=String.fromCharCode(h);var i=0;if(!this.store.getCount()){return;}switch(h){case Ext.EventObject.HOME:j.stopEvent();this.selectFirst();return;case Ext.EventObject.END:j.stopEvent();this.selectLast();return;case Ext.EventObject.PAGEDOWN:this.selectNextPage();j.stopEvent();return;case Ext.EventObject.PAGEUP:this.selectPrevPage();j.stopEvent();return;}if((j.hasModifier()&&!j.shiftKey)||j.isNavKeyPress()||j.isSpecialKey()){return;}if(this.lastSearchTerm==l){i=this.lastSelectedIndex;}this.search(this.displayField,l,i);this.cshTask.delay(this.searchResetDelay);},onRender:function(c,d){this.store.on("load",this.calcRowsPerPage,this);Ext.ux.form.SelectBox.superclass.onRender.apply(this,arguments);if(this.mode=="local"){this.initList();this.calcRowsPerPage();}},onSelect:function(e,f,d){if(this.fireEvent("beforeselect",this,e,f)!==false){this.setValue(e.data[this.valueField||this.displayField]);if(!d){this.collapse();}this.lastSelectedIndex=f+1;this.fireEvent("select",this,e,f);}},afterRender:function(){Ext.ux.form.SelectBox.superclass.afterRender.apply(this,arguments);if(Ext.isWebKit){this.el.swallowEvent("mousedown",true);}this.el.unselectable();this.innerList.unselectable();this.trigger.unselectable();this.innerList.on("mouseup",function(f,d,e){if(d.id&&d.id==this.innerList.id){return;}this.onViewClick();},this);this.innerList.on("mouseover",function(f,d,e){if(d.id&&d.id==this.innerList.id){return;}this.lastSelectedIndex=this.view.getSelectedIndexes()[0]+1;this.cshTask.delay(this.searchResetDelay);},this);this.trigger.un("click",this.onTriggerClick,this);this.trigger.on("mousedown",function(f,d,e){f.preventDefault();this.onTriggerClick();},this);this.on("collapse",function(f,d,e){Ext.getDoc().un("mouseup",this.collapseIf,this);},this,true);this.on("expand",function(f,d,e){Ext.getDoc().on("mouseup",this.collapseIf,this);},this,true);},clearSearchHistory:function(){this.lastSelectedIndex=0;this.lastSearchTerm=false;},selectFirst:function(){this.focusAndSelect(this.store.data.first());},selectLast:function(){this.focusAndSelect(this.store.data.last());},selectPrevPage:function(){if(!this.rowHeight){return;}var b=Math.max(this.selectedIndex-this.rowsPerPage,0);this.focusAndSelect(this.store.getAt(b));},selectNextPage:function(){if(!this.rowHeight){return;}var b=Math.min(this.selectedIndex+this.rowsPerPage,this.store.getCount()-1);this.focusAndSelect(this.store.getAt(b));},search:function(h,e,g){h=h||this.displayField;this.lastSearchTerm=e;var f=this.store.find.apply(this.store,arguments);if(f!==-1){this.focusAndSelect(f);}},focusAndSelect:function(d){var c=Ext.isNumber(d)?d:this.store.indexOf(d);this.select(c,this.isExpanded());this.onSelect(this.store.getAt(c),c,this.isExpanded());},calcRowsPerPage:function(){if(this.store.getCount()){this.rowHeight=Ext.fly(this.view.getNode(0)).getHeight();this.rowsPerPage=this.maxHeight/this.rowHeight;}else{this.rowHeight=false;}}});Ext.reg("selectbox",Ext.ux.form.SelectBox);Ext.ux.SelectBox=Ext.ux.form.SelectBox;