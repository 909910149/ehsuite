Ext.namespace("e2cs.schedviews");e2cs.schedviews.subView={Day:0,Week:1,Month:2,TwoMonths:3,Quarter:4};e2cs.schedviews.Units={Hours:0,Days:1,Weeks:2};Ext.ECalendar.scheduleview=function(b){Ext.apply(this,b);this.addEvents("headerClick","beforePeriodChange","afterPeriodChange");Ext.ECalendar.scheduleview.superclass.constructor.call(this);};Ext.extend(Ext.ECalendar.scheduleview,Ext.util.Observable,{referid:"schedule",header:true,headerFormat:"M-Y",headerButtons:true,headerAction:"gotoview",periodSelector:false,blankzonebg:"#6C90B4",blankHTML:"",listItems:{headerTitle:"Events on the period",periodFormats:{Day:"l - d - F  - Y",DayScheduler_format:"d",hourFormat:"h:i a",startTime:"7:00:00 am",endTime:"10:00:00 pm",WeekTPL:'<tpl for=".">'+e2cs.cal_locale.scheduler_headerListStrings.week+" {numweek} "+e2cs.cal_locale.scheduler_headerListStrings.start+"{datestart} "+e2cs.cal_locale.scheduler_headerListStrings.end+" {dateend}</tpl>",WeekFormat:"W",DatesFormat:"d/m/Y",Month:"M-Y",TwoMonthsTPL:'<tpl for=".">'+e2cs.cal_locale.scheduler_headerListStrings.period+" {numperiod} "+e2cs.cal_locale.scheduler_headerListStrings.start+" {datestart} "+e2cs.cal_locale.scheduler_headerListStrings.end+" {dateend}</tpl>",QuarterTPL:'<tpl for=".">'+e2cs.cal_locale.scheduler_headerListStrings.period+" {numperiod} "+e2cs.cal_locale.scheduler_headerListStrings.start+" {datestart} "+e2cs.cal_locale.scheduler_headerListStrings.end+" {dateend}</tpl>"},useStoreColor:false,descriptionWidth:250,parentLists:false,launchEventOn:"click",editableEvents:false,moreMenuItems:[],ShowMenuItems:[1,1,1,1,1,1,1,1],taskdd_ShowMenuItems:[1,1,1],taskdd_BaseColor:"#ffffff",taskdd_clsOver:"",taskdd_showqtip:true,taskdd_shownames:true},listbody:{periodType:e2cs.schedviews.subView.Month,headerUnit:e2cs.schedviews.Units.Days,headerUnitWidth:25},contextMenuLabels:e2cs.cal_locale.contextMenuLabelsSchedule,thisview:null,init:function(c,d){this.calx=c;this.datetohandle=d;if(this.listbody.periodType>=1||this.listbody.periodType<=4){if(this.listbody.headerUnit==0){this.listbody.headerUnit=1;}}if(this.listbody.periodType==1||this.listbody.periodType==2){if(this.listbody.headerUnit!=1){this.listbody.headerUnit=1;}}if(this.listbody.periodType==0&&this.listbody.headerUnit!=0){this.listbody.headerUnit=0;}},refreshView:function(){this.render();},render:function(){var ab=new Ext.LoadMask(this.calx.id,{removeMask:true,msg:e2cs.cal_locale.loadmaskText});ab.show();this.datetohandle=this.calx.currentdate;var T=Ext.get(this.calx.body);var i=T.dom.childNodes.length;if(i){for(var H=i;H<i;H++){T.dom.removeChild(T.dom.childNodes[0]);}}T.update("");var N='<div id="'+this.calx.id+'-main-calendar-header"></div>';N+='<div id="'+this.calx.id+'-main-calendar-sched-body"></div>';T.update(N);if(this.header){var I=Ext.get(this.calx.id+"-main-calendar-header");var R=I.wrap({tag:"div",cls:"x-calendar-sched-header",html:""});if(this.headerButtons){var Q=R.createChild({id:this.calx.id+"-btn-nm",tag:"div",cls:"x-calendar-sched-next",html:""});var U=R.createChild({id:this.calx.id+"-btn-pm",tag:"div",cls:"x-calendar-sched-previous",html:""});U.dom["qtip"]=e2cs.cal_locale.headerTooltipsScheduler.prev;U.addListener("click",this.onclickprev_period,this);U.addClassOnOver("x-calendar-sched-previous-over");Q.dom["qtip"]=e2cs.cal_locale.headerTooltipsScheduler.next;Q.addListener("click",this.onclicknext_period,this);Q.addClassOnOver("x-calendar-sched-next-over");}var S=this.getHeaderLabel();var L=R.createChild({tag:"div",id:"header",html:""+S+""});}this.numelements=0;var Y=this.genSchedbodyHeader();var O=Ext.get(this.calx.id+"-main-calendar-sched-body");if(this.calx.ownerCt!=undefined){if(this.calx.ownerCt.ctype&&this.calx.ownerCt.ctype=="Ext.Component"){this.calx.height=this.calx.ownerCt.getInnerHeight();}}anchoCalendar=Ext.get(this.calx.body).getWidth();if(Ext.isIE){O.setWidth(anchoCalendar,false);}if(this.calx.border){anchoCalendar+=(-2);}anchotable2cntheaders=anchoCalendar-this.listItems.descriptionWidth;countxvalwidth=(this.listbody.headerUnitWidth*this.numelements);var P={TABLEXXW1:anchoCalendar,TDXXVAL2:anchotable2cntheaders,TDXXVAL3:countxvalwidth};var E=new Ext.XTemplate('<tpl for=".">'+Y+"</tpl>");var X=E.applyTemplate(P);var aa=O.wrap({tag:"div",cls:"x-calendar-sched-body-header",html:X});Ext.get(this.calx.id+"-container_header_sched_base").setStyle("background-color",this.blankzonebg);if(Ext.isIE){aa.setStyle("overflow","hidden");aa.setWidth(anchoCalendar,false);this.refercolmns=Ext.select("div.sched_hdrbody_vals_IE",true);}else{this.refercolmns=Ext.select("div.sched_hdrbody_vals",true);}this.refercolmns.each(function(b,a,c){if(b.id.indexOf(this.calx.id+"-tdsched_valcols-")+1>=1){if(Ext.isIE){b.addClassOnOver("sched_hdrbody_valsover_IE");}else{b.addClassOnOver("sched_hdrbody_valsover");}b.addListener("click",this.onclick_myheadersvalues,this);}},this);var M=this.getTasksforPeriod();if(M.length>0){var Z=this.genShedContentList(M);var V={ANCHO1TOTAL:countxvalwidth+this.listItems.descriptionWidth,ANCHOREFLIST:this.listItems.descriptionWidth,anchocolgrids:countxvalwidth,TOPcontenedorTASKS:100};var C=new Ext.XTemplate('<tpl for=".">'+Z+"</tpl>");var W=C.applyTemplate(V);O.insertHtml("beforeEnd",W,false);if(this.calx.ownerCt!=undefined){var G=0;if(this.calx.header){G+=27;}if(this.calx.showCal_tbar){G+=26;}if(this.header){G+=47;}var J=this.calx.ownerCt.getInnerHeight()-G;Ext.get(this.calx.id+"-body-sched-container-list").setStyle("height",J+"px");}else{if(this.header){Ext.get(this.calx.id+"-body-sched-container-list").setStyle("height",(Ext.get(this.calx.body).getHeight()-47)+"px");}else{Ext.get(this.calx.id+"-body-sched-container-list").setStyle("height",(Ext.get(this.calx.body).getHeight()-23)+"px");}}if(Ext.isIE){Ext.get(this.calx.id+"-body-sched-container-list").setWidth(anchoCalendar,false);Ext.get(this.calx.id+"-body-sched-container-list").setStyle("overflow","auto");}Ext.get(this.calx.id+"-body-sched-container-list").setStyle("background-color",this.blankzonebg);Ext.get(this.calx.id+"body-sched-insider").setStyle("height",(Ext.get(this.calx.id+"-skeleton_sched").getHeight()+1)+"px");Ext.get(this.calx.id+"body-sched-insider").setStyle("width",(countxvalwidth+this.listItems.descriptionWidth)+"px");Ext.get(this.calx.id+"body-sched-insider").setStyle("background-color","#FFFFFF");myscrollelement=Ext.get(this.calx.id+"-body-sched-container-list");mycalendartmp=this.calx;myscrollelement.on("scroll",function(){var a=this.dom.scrollLeft;Ext.get(mycalendartmp.id+"-subcontainer_sched_headers").setStyle("margin-left","-"+a+"px");},myscrollelement);var D=Ext.get(this.calx.id+"-skeleton_sched").getHeight();var F=Ext.get(this.calx.id+"-taskdd-container");F.setStyle("top","-"+D+"px");F.setStyle("height",D+"px");this.refertasks=Ext.select("div.sched_lisItem_div",true);this.refertasks.each(function(b,a,c){if(b.id.indexOf(this.calx.id+"-eventno-")+1>=1){b.addClassOnOver("sched_listItem_mouseOver");if(this.listItems.launchEventOn!=""){b.addListener(this.listItems.launchEventOn,this.onclick_listItems,this);}if(this.listItems.editableEvents){if(Ext.isOpera){b.addListener("mousedown",this.operabuttons_for_listItem,this);}else{b.addListener("contextmenu",this.oncontextmenu_for_lisItem,this,{stopPropagation:true,normalized:true,preventDefault:true});}}}},this);myddcontainer=Ext.get(this.calx.id+"-taskdd-container");this.createTasksDD(M,myddcontainer);}else{notaskhtml=this.genShedNoContentScreen();O.insertHtml("beforeEnd",notaskhtml,false);if(this.header){Ext.get(this.calx.id+"-body-sched-no-task-screen").setStyle("height",(Ext.get(this.calx.body).getHeight()-46)+"px");}else{Ext.get(this.calx.id+"-body-sched-no-task-screen").setStyle("height",(Ext.get(this.calx.body).getHeight()-23)+"px");}Ext.get(this.calx.id+"-body-sched-no-task-screen").setStyle("background-color",this.blankzonebg);var K=Ext.DomQuery.selectNode("div[id="+this.calx.id+"_addevent_element_screen]");if(K!=undefined){Ext.get(K.id).addListener("click",this.neweventlaunch,this);}}ab.hide();},operabuttons_for_listItem:function(d,f,e){if(d.button==2){this.oncontextmenu_for_lisItem(d,f,e);}},operabuttons_for_taskdd:function(d,f,e){if(d.button==2){this.oncontextmenu_for_taskdd(d,f,e);}},oncontextmenu_for_lisItem:function(m,o,l){if(o.id.indexOf(this.calx.id+"-eventno-")+1>=1){}else{return false;}m.stopEvent();if(this.menu_listItem){this.menu_listItem.removeAll();}var p=o.id.replace(this.calx.id+"-eventno-","");var k=parseInt(p);var i=this.calx.store.getById(k).data;tmpmenuobjs=[];if(this.listItems.ShowMenuItems[0]){buttonx1=new Ext.menu.Item({id:this.calx.id+"-listItem-mnuitem-Add",iconCls:"x-calendar-sched-btnmv_add",text:e2cs.cal_locale.contextMenuLabelsSchedule.taskAdd});buttonx1.addListener("click",function(){this.neweventlaunch();},this);tmpmenuobjs.push(buttonx1);}if(this.listItems.ShowMenuItems[2]){buttonx3=new Ext.menu.Item({id:this.calx.id+"-listItem-mnuitem-Delete",iconCls:"x-calendar-sched-btnmv_delete",text:e2cs.cal_locale.contextMenuLabelsSchedule.taskDelete+" "+k+" "});buttonx3.addListener("click",function(){var a=this.getTaskarray(i);var b=this.calx.fireEvent("beforeTaskDelete",a,this.vday);if(b){if(this.calx.fireEvent("onTaskDelete",a)==true){this.calx.fireEvent("afterTaskDelete",a,true);}else{this.calx.fireEvent("afterTaskDelete",null,false);}}},this);tmpmenuobjs.push(buttonx3);}if(this.listItems.ShowMenuItems[1]){buttonx2=new Ext.menu.Item({id:this.calx.id+"-listItem-mnuitem-Edit",iconCls:"x-calendar-sched-btnmv_edit",text:e2cs.cal_locale.contextMenuLabelsSchedule.taskEdit+" "+k+" "});buttonx2.addListener("click",function(){var a=this.getTaskarray(i);var b=this.calx.fireEvent("beforeTaskEdit",a,this.vday);if(b){if(this.calx.fireEvent("onTaskEdit",a)==true){this.calx.fireEvent("afterTaskEdit",a,true);}else{this.calx.fireEvent("afterTaskEdit",null,false);}}},this);tmpmenuobjs.push(buttonx2);}if(this.listItems.ShowMenuItems[0]||this.listItems.ShowMenuItems[1]||this.listItems.ShowMenuItems[2]){button_sep_one=new Ext.menu.Separator({});tmpmenuobjs.push(button_sep_one);}if(this.listItems.ShowMenuItems[3]){buttonx4=new Ext.menu.Item({id:this.calx.id+"-listItem-mnuitem-gnp",iconCls:"x-calendar-sched-btnmv_nextperiod",text:e2cs.cal_locale.contextMenuLabelsSchedule.NextPeriod});buttonx4.addListener("click",this.onclicknext_period,this);tmpmenuobjs.push(buttonx4);}if(this.listItems.ShowMenuItems[4]){buttonx5=new Ext.menu.Item({id:this.calx.id+"-listItem-mnuitem-gpp",iconCls:"x-calendar-sched-btnmv_prevperiod",text:e2cs.cal_locale.contextMenuLabelsSchedule.PreviousPeriod});buttonx5.addListener("click",this.onclickprev_period,this);tmpmenuobjs.push(buttonx5);}if(this.listItems.ShowMenuItems[3]||this.listItems.ShowMenuItems[4]){button_sep_two=new Ext.menu.Separator({});tmpmenuobjs.push(button_sep_two);}if(this.listItems.ShowMenuItems[5]&&this.listItems.ShowMenuItems[6]&&this.listItems.ShowMenuItems[7]){}else{if(this.listItems.ShowMenuItems[3]&&this.listItems.ShowMenuItems[4]){}else{if(this.listItems.ShowMenuItems[0]&&this.listItems.ShowMenuItems[1]&&this.listItems.ShowMenuItems[2]){}else{tmpmenuobjs.pop();}}}if(this.listItems.ShowMenuItems[5]){buttonx6=new Ext.menu.Item({id:this.calx.id+"-listItem-mnuitem-chgm",iconCls:"x-calendar-sched-btnmv_viewmonth",text:e2cs.cal_locale.contextMenuLabelsSchedule.chgmview});buttonx6.addListener("click",function(){this.changeCalview(0);},this);tmpmenuobjs.push(buttonx6);}if(this.listItems.ShowMenuItems[6]){buttonx6=new Ext.menu.Item({id:this.calx.id+"-listItem-mnuitem-chgw",iconCls:"x-calendar-sched-btnmv_viewweek",text:e2cs.cal_locale.contextMenuLabelsSchedule.chgwview});buttonx6.addListener("click",function(){this.changeCalview(1);},this);tmpmenuobjs.push(buttonx6);}if(this.listItems.ShowMenuItems[7]){buttonx7=new Ext.menu.Item({id:this.calx.id+"-listItem-mnuitem-chgd",iconCls:"x-calendar-sched-btnmv_viewday",text:e2cs.cal_locale.contextMenuLabelsSchedule.chgdview});buttonx7.addListener("click",function(){this.changeCalview(2);},this);tmpmenuobjs.push(buttonx7);}if((this.listItems.ShowMenuItems[5]||this.listItems.ShowMenuItems[6]||this.listItems.ShowMenuItems[7])&&this.listItems.moreMenuItems.length>0){button_sep_three=new Ext.menu.Separator({});tmpmenuobjs.push(button_sep_three);}if(this.listItems.moreMenuItems.length>0){for(var n=0;n<this.listItems.moreMenuItems.length;n++){var r=this.listItems.moreMenuItems[n].id;this.listItems.moreMenuItems[n].rendered=false;this.listItems.moreMenuItems[n].addListener("click",function(a){this.onCustomMenuAction(a.id,Ext.get(o));},this);tmpmenuobjs.push(this.listItems.moreMenuItems[n]);}}this.menu_listItem=new Ext.menu.Menu({id:this.calx.id+"-contextmenu-listItem-sel",shadow:true,items:[]});var q=tmpmenuobjs.length;for(var n=0;n<q;n++){this.menu_listItem.add(tmpmenuobjs[n]);}this.menu_listItem.on("hide",this.onContextHide,this);this.menu_listItem.showAt([m.getPageX(),m.getPageY()]);},oncontextmenu_for_taskdd:function(u,z,t){if(z.id.indexOf(this.calx.id+"-shced-taskdd-")+1>=1){}else{return false;}if(this.listItems.taskdd_ShowMenuItems[0]==false&&this.listItems.taskdd_ShowMenuItems[1]==false&&this.listItems.taskdd_ShowMenuItems[2]==false&&this.listItems.moreMenuItems.length>0){return false;}u.stopEvent();if(this.taskmenu_listItem){this.taskmenu_listItem.removeAll();}var B=z.id.replace(this.calx.id+"-shced-taskdd-","");var s=parseInt(B);var i=this.calx.store.getById(s).data;var r=this.getTaskarray(i);var y=[];var q=this.listItems.taskdd_ShowMenuItems;var w=[];var C=this.listItems.moreMenuItems;var A=this.calx.fireEvent("beforeContextMenuTask","schedule-task",r,q,w);if(A==false){if(w[0]==false){if(w[1]==true){if(w[2]==true){var C=w[3];}var q=w[4];}else{var C=this.listItems.moreMenuItems;var q=this.listItems.taskdd_ShowMenuItems;}}else{return false;}}else{var C=this.listItems.moreMenuItems;}if(q[0]){buttonx1=new Ext.menu.Item({id:this.calx.id+"-listItem-mnuitem-Add",iconCls:"x-calendar-sched-btnmv_add",text:e2cs.cal_locale.contextMenuLabelsSchedule.taskAdd});buttonx1.addListener("click",function(){this.neweventlaunch();},this);y.push(buttonx1);}if(q[2]){buttonx3=new Ext.menu.Item({id:this.calx.id+"-listItem-mnuitem-Delete",iconCls:"x-calendar-sched-btnmv_delete",text:e2cs.cal_locale.contextMenuLabelsSchedule.taskDelete+" "+s+" "});buttonx3.addListener("click",function(){var b=this.getTaskarray(i);var a=this.calx.fireEvent("beforeTaskDelete",b,this.vday);if(a){if(this.calx.fireEvent("onTaskDelete",b)==true){this.calx.fireEvent("afterTaskDelete",b,true);}else{this.calx.fireEvent("afterTaskDelete",null,false);}}},this);y.push(buttonx3);}if(q[1]){buttonx2=new Ext.menu.Item({id:this.calx.id+"-listItem-mnuitem-Edit",iconCls:"x-calendar-sched-btnmv_edit",text:e2cs.cal_locale.contextMenuLabelsSchedule.taskEdit+" "+s+" "});buttonx2.addListener("click",function(){var b=this.getTaskarray(i);var a=this.calx.fireEvent("beforeTaskEdit",b,this.vday);if(a){if(this.calx.fireEvent("onTaskEdit",b)==true){this.calx.fireEvent("afterTaskEdit",b,true);}else{this.calx.fireEvent("afterTaskEdit",null,false);}}},this);y.push(buttonx2);}if((q[0]||q[1]||q[2])&&C.length>0){button_sep_one=new Ext.menu.Separator({});y.push(button_sep_one);}if(C.length>0){for(var x=0;x<C.length;x++){C[x].rendered=false;if(C[x].menu==undefined){if(C[x].ctype=="Ext.menu.Item"){C[x].addListener("click",function(b,a){this.onCustomMenuAction(b.id,Ext.get(z));},this);}else{}y.push(C[x]);}else{for(var v=0;v<C[x].menu.items.length;v++){C[x].menu.items.items[v].rendered=false;if(C[x].menu.items.items[v].ctype=="Ext.menu.Item"){C[x].menu.items.items[v].addListener("click",function(b,a){this.onCustomMenuAction(b.id,Ext.get(z));},this);}else{}}y.push(C[x]);}}}this.taskmenu_listItem=new Ext.menu.Menu({id:this.calx.id+"-contextmenu-listItem-taskdd-sel",shadow:true,items:[]});var D=y.length;for(var x=0;x<D;x++){this.taskmenu_listItem.add(y[x]);}this.taskmenu_listItem.on("hide",this.onContextHide,this);this.taskmenu_listItem.showAt([u.getPageX(),u.getPageY()]);},onContextHide:function(){},onCustomMenuAction:function(h,f){if(f.id.indexOf(this.calx.id+"-eventno-")+1>=1){var i=f.id.replace(this.calx.id+"-eventno-","");var g=parseInt(i);var j=this.getTaskarray(this.calx.store.getById(g).data);this.calx.fireEvent("customMenuAction",h,"scheduler",j,f,this);}if(f.id.indexOf(this.calx.id+"-shced-taskdd-")+1>=1){var i=f.id.replace(this.calx.id+"-shced-taskdd-","");var g=parseInt(i);var j=this.getTaskarray(this.calx.store.getById(g).data);this.calx.fireEvent("customMenuAction",h,"scheduler",j,f,this);}this.taskmenu_listItem.hide();},onclick_myheadersvalues:function(j,i,l){if(i.id.indexOf("hour-")+1>0){var k=i.id.replace("hour-"+this.calx.id+"-tdsched_valcols-","");k=k.substr(k.indexOf("-")+1);if(this.headerAction=="gotoview"){if(this.calx.viewday!=null||this.calx.viewday!=undefined){if(this.calx.fireEvent("beforeChangeView","day","schedule",this.calx)==false){return false;}else{this.calx.currentdate=new Date(k);this.calx.selector_dateMenu.picker.setValue(this.calx.currentdate);this.calx.currentView="day";this.calx.viewday.render();this.calx.fireEvent("onChangeView","day","schedule",this);}}}else{mydatetohandledt=new Date(k);if(this.headerAction=="event"){this.fireEvent("headerClick","hour",mydatetohandledt,this,this.calx);}}}if(i.id.indexOf("days-")+1>0){var k=i.id.replace("days-"+this.calx.id+"-tdsched_valcols-","");if(this.headerAction=="gotoview"){if(this.calx.viewday!=null||this.calx.viewday!=undefined){if(this.calx.fireEvent("beforeChangeView","day","schedule",this.calx)==false){return false;}else{this.calx.currentdate=new Date(k);this.calx.selector_dateMenu.picker.setValue(this.calx.currentdate);this.calx.currentView="day";this.calx.viewday.render();this.calx.fireEvent("onChangeView","day","schedule",this);}}}else{mydatetohandledt=new Date(k);if(this.headerAction=="event"){this.fireEvent("headerClick","day",mydatetohandledt,this,this.calx);}}}if(i.id.indexOf("weeks-")+1>0){var g=i.id.replace("weeks-"+this.calx.id+"-tdsched_valcols-","");var h=this.calx.getDateRangeOfWeek(g);if(this.headerAction=="gotoview"){if(this.calx.viewweek!=null||this.calx.viewweek!=undefined){if(this.calx.fireEvent("beforeChangeView","week","schedule",this.calx)==false){return false;}else{this.calx.currentdate=new Date(h[0]);this.calx.currentView="week";this.calx.viewweek.render();this.calx.fireEvent("onChangeView","week","schedule",this);}}}else{if(this.headerAction=="event"){this.fireEvent("headerClick","week",h,this,this.calx);}}}},onclick_listItems:function(k,j,n){var l=j.id.replace(this.calx.id+"-eventno-","");var h=parseInt(l);var m=this.calx.store.getById(h).data;var i=this.getTaskarray(m);this.calx.fireEvent("taskDblClick",i,this,this.calx,"schedule");},onclick_taskItems:function(k,j,n){var l=j.id.replace(this.calx.id+"-shced-taskdd-","");var h=parseInt(l);var m=this.calx.store.getById(h).data;var i=this.getTaskarray(m);this.calx.fireEvent("taskDblClick",i,this,this.calx,"schedule");},neweventlaunch:function(){refdate=new Date(this.calx.currentdate);this.calx.fireEvent("taskAdd",refdate);},changeCalview:function(b){if(b==0){varview="month";}else{if(b==1){varview="week";}else{varview="day";}}this.calx.changeView(varview);},onclickprev_period:function(){refdate=new Date(this.calx.currentdate);var o=this.listbody.periodType;if(o<0||o>4){o=2;}switch(o){case 0:var m=refdate.add(Date.DAY,-1);var j=this.fireEvent("beforePeriodChange",0,refdate,m);if(j){if(this.dateSelector){this.calx.selector_dateMenu.picker.setValue(this.calx.currentdate);}this.calx.currentdate=m;this.datetohandle=m;this.render();myMask.hide();this.fireEvent("afterPeriodChange",0,m);}break;case 1:var i=refdate.format("W");var n=parseInt(i)-1;var p=this.calx.getDateRangeOfWeek(parseInt(i));var k=this.calx.getDateRangeOfWeek(n);var j=this.fireEvent("beforePeriodChange",1,p,k);if(j){if(this.dateSelector){this.calx.selector_dateMenu.picker.setValue(k[0]);}this.calx.currentdate=k[0];this.render();this.fireEvent("afterPeriodChange",1,k);}break;case 2:var l=refdate.add(Date.MONTH,-1);var j=this.fireEvent("beforePeriodChange",2,refdate,l);if(j){if(this.dateSelector){this.calx.selector_dateMenu.picker.setValue(this.calx.currentdate);}this.calx.currentdate=l;this.render();this.fireEvent("afterPeriodChange",2,l);}break;case 3:var l=refdate.add(Date.MONTH,-2);var j=this.fireEvent("beforePeriodChange",3,refdate,l);if(j){if(this.dateSelector){this.calx.selector_dateMenu.picker.setValue(this.calx.currentdate);}this.calx.currentdate=l;this.render();this.fireEvent("afterPeriodChange",3,l);}break;case 4:var l=refdate.add(Date.MONTH,-3);var j=this.fireEvent("beforePeriodChange",4,refdate,l);if(j){if(this.dateSelector){this.calx.selector_dateMenu.picker.setValue(this.calx.currentdate);}this.calx.currentdate=l;this.render();this.fireEvent("afterPeriodChange",4,l);}break;}},onclicknext_period:function(){refdate=new Date(this.calx.currentdate);var o=this.listbody.periodType;if(o<0||o>4){o=2;}switch(o){case 0:var m=refdate.add(Date.DAY,+1);var j=this.fireEvent("beforePeriodChange",0,refdate,m);if(j){if(this.dateSelector){this.calx.selector_dateMenu.picker.setValue(this.calx.currentdate);}this.calx.currentdate=m;this.datetohandle=m;this.render();this.fireEvent("afterPeriodChange",0,m);}break;case 1:var i=refdate.format("W");var n=parseInt(i)+1;var p=this.calx.getDateRangeOfWeek(parseInt(i));var k=this.calx.getDateRangeOfWeek(n);var j=this.fireEvent("beforePeriodChange",1,p,k);if(j){if(this.dateSelector){this.calx.selector_dateMenu.picker.setValue(k[0]);}this.calx.currentdate=k[0];this.render();this.fireEvent("afterPeriodChange",1,k);}break;case 2:var l=refdate.add(Date.MONTH,+1);var j=this.fireEvent("beforePeriodChange",2,refdate,l);if(j){if(this.dateSelector){this.calx.selector_dateMenu.picker.setValue(this.calx.currentdate);}this.calx.currentdate=l;this.render();this.fireEvent("afterPeriodChange",2,l);}break;case 3:var l=refdate.add(Date.MONTH,+2);var j=this.fireEvent("beforePeriodChange",3,refdate,l);if(j){if(this.dateSelector){this.calx.selector_dateMenu.picker.setValue(this.calx.currentdate);}this.calx.currentdate=l;this.render();this.fireEvent("afterPeriodChange",3,l);}break;case 4:var l=refdate.add(Date.MONTH,+3);var j=this.fireEvent("beforePeriodChange",4,refdate,l);if(j){if(this.dateSelector){this.calx.selector_dateMenu.picker.setValue(this.calx.currentdate);}this.calx.currentdate=l;this.render();this.fireEvent("afterPeriodChange",4,l);}break;}},getDatesforWeek:function(h){var e=new Date(h).getDay();e=((e==0)?6:e-1);var g=new Date(h.add(Date.DAY,-e).format("m/d/Y")+" "+this.listItems.periodFormats.startTime);var f=new Date(h.add(Date.DAY,-e+6).format("m/d/Y")+" "+this.listItems.periodFormats.endTime);return[g,f];},getDatesforBimonth:function(g){var l=new Date(g);var h=l.getMonth();var i=(Math.floor(h/2)+1);var k=(i*2)-1;var j=(i*2);datestarts=new Date(k+"/01/"+l.getUTCFullYear()+" "+this.listItems.periodFormats.startTime);tmpdate=new Date(j+"/01/"+l.getUTCFullYear());tmplastday=tmpdate.getLastDateOfMonth();dateends=new Date(j+"/"+tmplastday.getUTCDate()+"/"+l.getUTCFullYear()+" "+this.listItems.periodFormats.endTime);return[datestarts,dateends];},getDatesForQuarter:function(g){var k=new Date(g);var h=k.getMonth();var l=Math.floor(h/3)+1;var j=(l*3)-2;var i=(l*3);datestarts=new Date(j+"/01/"+k.getUTCFullYear()+" "+this.listItems.periodFormats.startTime);tmpdate=new Date(i+"/01/"+k.getUTCFullYear());tmplastday=tmpdate.getLastDateOfMonth();dateends=new Date(i+"/"+tmplastday.getUTCDate()+"/"+k.getUTCFullYear()+" "+this.listItems.periodFormats.endTime);return[datestarts,dateends];},getTaskarray:function(c){var d=[];d[0]=c[this.calx.fieldsRefer.id];d[1]=c[this.calx.fieldsRefer.id];d[2]=c[this.calx.fieldsRefer.subject];d[3]=c[this.calx.fieldsRefer.startdate];d[4]=c[this.calx.fieldsRefer.enddate];d[5]=c[this.calx.fieldsRefer.description];d[6]=this.calx.store.indexOfId(c[this.calx.fieldsRefer.id]);d[7]=c[this.calx.fieldsRefer.location];d[8]=c[this.calx.fieldsRefer.alldaytask];d[9]=c[this.calx.fieldsRefer.isHoliday];return d;},getHeaderLabel:function(){var o="";var v=this.listbody.periodType;if(v<0||v>4){v=2;}var t=new Date(this.calx.currentdate);switch(v){case 0:o=t.format(this.listItems.periodFormats.Day);break;case 1:var n=t.format(this.listItems.periodFormats.WeekFormat);var p=this.getDatesforWeek(t);var l={numweek:n,datestart:p[0].format(this.listItems.periodFormats.DatesFormat),dateend:p[1].format(this.listItems.periodFormats.DatesFormat)};var q=new Ext.XTemplate(this.listItems.periodFormats.WeekTPL);o=q.apply(l);break;case 2:o=t.format(this.listItems.periodFormats.Month);break;case 3:var u=new Date(t);var m=u.getMonth();var r=(Math.floor(m/2)+1);var p=this.getDatesforBimonth(t);var l={numperiod:r,datestart:p[0].format(this.listItems.periodFormats.DatesFormat),dateend:p[1].format(this.listItems.periodFormats.DatesFormat)};var q=new Ext.XTemplate(this.listItems.periodFormats.TwoMonthsTPL);o=q.apply(l);break;case 4:var u=new Date(t);var m=u.getMonth();var s=Math.floor(m/3)+1;var p=this.getDatesForQuarter(t);var l={numperiod:s,datestart:p[0].format(this.listItems.periodFormats.DatesFormat),dateend:p[1].format(this.listItems.periodFormats.DatesFormat)};var q=new Ext.XTemplate(this.listItems.periodFormats.QuarterTPL);o=q.apply(l);break;}return o;},createTasksDD:function(T,Z){var O=new Date(this.calx.currentdate);var N=T.length;var ad=[];for(var i=0;i<N;i++){if(this.calx.store.getAt(T[i]).data[this.calx.fieldsRefer.color]){colortask=this.calx.store.getAt(T[i]).data[this.calx.fieldsRefer.color];}else{colortask=this.listItems.taskdd_BaseColor;}var aa="";if(this.listItems.taskdd_shownames){aa=this.calx.store.getAt(T[i]).data[this.calx.fieldsRefer.subject];}else{aa="&nbsp;";}var J='<div id="'+this.calx.id+"-shced-taskdd-"+this.calx.store.getAt(T[i]).data[this.calx.fieldsRefer.id];J+='" class="sched_taskdd_base" style="background-color:'+colortask;if(Ext.isIE){J+=";height:21px;";}J+='">';J+=aa;J+="</div>";var V=Z.insertHtml("beforeEnd",J,true);if(this.listItems.taskdd_showqtip){var U=new Date(this.calx.store.getAt(T[i]).data[this.calx.fieldsRefer.startdate]);var aj=U.format(this.listItems.periodFormats.DatesFormat+" "+this.listItems.periodFormats.hourFormat);U=new Date(this.calx.store.getAt(T[i]).data[this.calx.fieldsRefer.enddate]);var P=U.format(this.listItems.periodFormats.DatesFormat+" "+this.listItems.periodFormats.hourFormat);V.dom.qtitle=this.calx.store.getAt(T[i]).data[this.calx.fieldsRefer.subject];if(this.calx.store.getAt(T[i]).data[this.calx.fieldsRefer.description]==""){var L="&nbsp;<br/>&nbsp;";}else{var L=this.calx.store.getAt(T[i]).data[this.calx.fieldsRefer.description];}if(L.length>this.calx.tipmaxLength){var ae=L.substring(0,this.calx.tipmaxLength)+"...";}else{var ae=L;}var W={starxl:e2cs.cal_locale.task_qtip_starts,startval:aj,endxl:e2cs.cal_locale.task_qtip_ends,endval:P,details:ae,location:this.calx.store.getAt(T[i]).data[this.calx.fieldsRefer.location]};V.dom.qtip=this.calx.tplTaskTip.apply(W);}switch(this.listbody.headerUnit){case 0:var X=new Date(this.calx.store.getAt(T[i]).data[this.calx.fieldsRefer.startdate]);var G=O.format("m/d/Y")+" "+this.listItems.periodFormats.startTime;var af=new Date(G);if(X<=af){ad[0]=0;}else{mydiff_a=this.calx.dateDiff(af,X,e2cs.dateParts.MINUTE);if(mydiff_a<=0){ad[0]=0;}else{ad[0]=((this.listbody.headerUnitWidth*mydiff_a)/60);}}var ab=new Date(this.calx.store.getAt(T[i]).data[this.calx.fieldsRefer.enddate]);var H=O.format("m/d/Y")+" "+this.listItems.periodFormats.endTime;var ai=new Date(H);if(ab>=ai){ad[1]=(Z.getWidth(false)-ad[0]);}else{mydiff_b=this.calx.dateDiff(X,ab,e2cs.dateParts.MINUTE);mydiff_allday=this.calx.dateDiff(af,ai,e2cs.dateParts.MINUTE);if(mydiff_b>=mydiff_allday){ad[1]=(Z.getWidth(false)-ad[0]);}else{ad[1]=((this.listbody.headerUnitWidth*mydiff_b)/60);}}break;case 1:if(this.listbody.periodType==1){var I=this.getDatesforWeek(O);}else{if(this.listbody.periodType==2){var ag=new Date(O.format("m")+"/01/"+O.format("Y")+" "+this.listItems.periodFormats.startTime);var R=O.getLastDateOfMonth();var S=new Date(R.format("m/d/")+O.format("Y")+" "+this.listItems.periodFormats.endTime);var I=[ag,S];}else{if(this.listbody.periodType==3){var I=this.getDatesforBimonth(O);}else{if(this.listbody.periodType==4){var I=this.getDatesForQuarter(O);}}}}var X=new Date(this.calx.store.getAt(T[i]).data[this.calx.fieldsRefer.startdate]);mydiff_a=this.calx.dateDiff(I[0],X,e2cs.dateParts.DAY);if(mydiff_a<=0){ad[0]=0;}else{if(parseInt(X.format("j"))==mydiff_a){ad[0]=((this.listbody.headerUnitWidth*(mydiff_a+1)));}else{if(I[0].add(Date.HOUR,(i)).format("m/d/Y")==X.format("m/d/Y")){ad[0]=((this.listbody.headerUnitWidth*mydiff_a+1));}else{ad[0]=((this.listbody.headerUnitWidth*(mydiff_a)));}}}var ab=new Date(this.calx.store.getAt(T[i]).data[this.calx.fieldsRefer.enddate]);mydiff_b=this.calx.dateDiff(X,ab,e2cs.dateParts.DAY);mydiff_c=this.calx.dateDiff(I[0],ab,e2cs.dateParts.DAY);mydiff_allperiod=this.calx.dateDiff(I[1],ab,e2cs.dateParts.DAY);if(mydiff_allperiod>=0){ad[1]=(Z.getWidth(false)-ad[0]);}else{if(mydiff_a<0){if((this.listbody.headerUnitWidth*mydiff_c)>Z.getWidth(false)){ad[1]=Z.getWidth(false);}else{if(parseInt(ab.format("j"))==mydiff_c){ad[1]=((this.listbody.headerUnitWidth*mydiff_c));}else{ad[1]=this.listbody.headerUnitWidth*(mydiff_c+1);}}}else{var M=0;if(mydiff_b==0){M=mydiff_b+1;}else{if(X.format("m/d")==ab.format("m/d")){M=1;}else{if(mydiff_b>0){M=mydiff_b+1;}}}ad[1]=((this.listbody.headerUnitWidth*M));}}break;case 2:if(this.listbody.periodType==2){var ag=new Date(O.format("m")+"/01/"+O.format("Y")+" "+this.listItems.periodFormats.startTime);var R=O.getLastDateOfMonth();var S=new Date(R.format("m/d/")+O.format("Y")+" "+this.listItems.periodFormats.endTime);var I=[ag,S];}else{if(this.listbody.periodType==3){var I=this.getDatesforBimonth(O);}else{if(this.listbody.periodType==4){var I=this.getDatesForQuarter(O);}}}var Q=parseInt(I[0].format("W"));var K=parseInt(I[1].format("W"));if(K!=(this.lastweekofPeriod_tmp)){K=this.lastweekofPeriod_tmp;}var X=new Date(this.calx.store.getAt(T[i]).data[this.calx.fieldsRefer.startdate]);var Y=parseInt(X.format("W"));if(Y<Q){ad[0]=0;}else{var ah=(Y-Q);ad[0]=(this.listbody.headerUnitWidth*ah);}var ab=new Date(this.calx.store.getAt(T[i]).data[this.calx.fieldsRefer.enddate]);var ac=parseInt(ab.format("W"));if(Y==ac){ad[1]=this.listbody.headerUnitWidth;}else{if(ac>K){ad[1]=Z.getWidth(false);}else{ad[1]=this.listbody.headerUnitWidth*((ac-Y)+1);}}break;}if(Ext.isGecko3||Ext.isSafari||Ext.isIE){ad[0]+=-1;}V.setX(Ext.get(this.calx.id+"-taskdd-container").getLeft()+ad[0]);if(Ext.isIE){V.setWidth(ad[1]+1);}else{V.setStyle("width",(ad[1]-1)+"px");}if(this.listItems.taskdd_clsOver!=""){V.addClassOnOver(this.listItems.taskdd_clsOver);}if(this.listItems.launchEventOn!=""){V.addListener(this.listItems.launchEventOn,this.onclick_taskItems,this);}if(this.listItems.editableEvents){if(Ext.isOpera){V.addListener("mousedown",this.operabuttons_for_taskdd,this);}else{V.addListener("contextmenu",this.oncontextmenu_for_taskdd,this,{stopPropagation:true,normalized:true,preventDefault:true});}}}},genSchedbodyHeader:function(){var x="";if(Ext.isSafari){myDatatoGen="";}else{myDatatoGen='<div id="'+this.calx.id+'-container-tablehdr-sched-bdy-submain">';}myDatatoGen+='<table id="'+this.calx.id+'-table-hdr-sched-body" width="{TABLEXXW1}" border="0" cellpadding="0" cellspacing="0"><tr>';myDatatoGen+='<td width="'+this.listItems.descriptionWidth+'" valign="top">';if(Ext.isIE6||Ext.isIE7){myDatatoGen+='<div class="scheduler_header_eventslist_IE" style="width:'+this.listItems.descriptionWidth+';"><div class="sched_tab2_IE">'+this.listItems.headerTitle+"</div></div></td>";}else{myDatatoGen+='<div class="scheduler_header_eventslist" style="width:'+this.listItems.descriptionWidth+';"><div class="sched_tab2"><div class="sched_tab1">'+this.listItems.headerTitle+"</div></div></div></td>";}myDatatoGen+='<td width="{TDXXVAL2}">';if(Ext.isSafari){myDatatoGen+='<div id="'+this.calx.id+'-container_header_sched_base" style="width:{TDXXVAL2}px; overflow:hidden; overflow-x:hidden; overflow-y:auto;">';}else{if(Ext.isGecko3){myDatatoGen+='<div id="'+this.calx.id+'-container_header_sched_base" style="width:{TDXXVAL2}px; overflow:hidden;">';}else{myDatatoGen+='<div id="'+this.calx.id+'-container_header_sched_base" style="width:100%; overflow:hidden;">';}}myDatatoGen+='<div id="'+this.calx.id+'-subcontainer_sched_headers" style="width:{TDXXVAL3}px;">';myDatatoGen+='<table id="'+this.calx.id+"-table-hdr-sched-units"+'" width="{TDXXVAL3}" border="0" cellspacing="0" cellpadding="0">';if(Ext.isIE){myDatatoGen+='<tr id="'+this.calx.id+'-scheduler_row_headers"  class="sched_dayheader_base" style="height:20px;">';}else{myDatatoGen+='<tr id="'+this.calx.id+'-scheduler_row_headers"  class="sched_dayheader_base">';}if(this.listbody.headerUnit<0||this.listbody.headerUnit>2){this.listbody.headerUnit=1;}switch(this.listbody.headerUnit){case 0:if(this.listbody.headerUnitWidth<70){this.listbody.headerUnitWidth=70;}x="";var w=new Date(this.calx.currentdate);var s=new Date(w.format("m/d/Y")+" "+this.listItems.periodFormats.startTime);var v=new Date(w.format("m/d/Y")+" "+this.listItems.periodFormats.endTime);this.diffhrs=this.calx.dateDiff(s,v,e2cs.dateParts.HOUR);for(var q=0;q<=this.diffhrs;q++){var i=s.add(Date.HOUR,(q)).format(this.listItems.periodFormats.DatesFormat);var p=s.add(Date.HOUR,(q)).format("m/d/Y h:i:s");x+='<td width="'+this.listbody.headerUnitWidth+'" class="tdshx">';if(Ext.isIE){x+='<div class="sched_hdrbody_vals_IE" ';}else{x+='<div class="sched_hdrbody_vals" ';}x+='id="hour-'+this.calx.id+"-tdsched_valcols-"+q+"-"+p+'" ';x+='ext:qtitle="'+s.add(Date.HOUR,(q)).format(this.listItems.periodFormats.hourFormat);x+='" ext:qtip="'+s.add(Date.HOUR,(q)).format(this.listItems.periodFormats.DatesFormat)+'"';x+=">"+s.add(Date.HOUR,(q)).format(this.listItems.periodFormats.hourFormat)+"</div></td>";}this.numelements=q;break;case 1:var w=new Date(this.calx.currentdate);if(this.listbody.periodType==1){var y=this.getDatesforWeek(w);}else{if(this.listbody.periodType==2){var z=new Date(w.format("m")+"/01/"+w.format("Y"));var o=w.getLastDateOfMonth();var y=[z,o];}else{if(this.listbody.periodType==3){var y=this.getDatesforBimonth(w);}else{if(this.listbody.periodType==4){var y=this.getDatesForQuarter(w);}else{var z=new Date(w.format("m")+"/01/"+w.format("Y"));var o=new w.getLastDateOfMonth();var y=[z,o];}}}}var t=this.calx.dateDiff(y[0],y[1],e2cs.dateParts.DAY);s=y[0];if(this.listbody.periodType==1){t+=0;}if(this.listbody.periodType==2){t+=1;}x="";for(var q=0;q<t;q++){var u=s.add(Date.DAY,(q)).format(this.listItems.periodFormats.DayScheduler_format);var i=s.add(Date.DAY,(q)).format(this.listItems.periodFormats.DatesFormat);var p=s.add(Date.DAY,(q)).format("m/d/Y");x+='<td width="'+this.listbody.headerUnitWidth+'" class="tdshx">';x+='<div class="sched_hdrbody_vals" ';x+='id="days-'+this.calx.id+"-tdsched_valcols-"+p+'" ';x+='ext:qtitle="'+e2cs.cal_locale.scheduler_headerListStrings.Day+" "+u;x+='" ext:qtip="'+i+'"';x+=">"+u+"</div></td>";}this.numelements=q;break;case 2:var w=new Date(this.calx.currentdate);if(this.listbody.periodType==3){var y=this.getDatesforBimonth(w);}else{if(this.listbody.periodType==4){var y=this.getDatesForQuarter(w);}}diffweeks=this.calx.dateDiff(y[0],y[1],e2cs.dateParts.WEEK);initWeek=y[0].format("W");numinitWeek=parseInt(initWeek);Totalweekstoloop=(numinitWeek+diffweeks);if(this.listbody.periodType==3){Totalweekstoloop=Totalweekstoloop+2;}else{Totalweekstoloop=Totalweekstoloop+1;}x="";for(var q=numinitWeek;q<Totalweekstoloop;q++){var r=this.calx.getDateRangeOfWeek(q);var u=q;x+='<td width="'+this.listbody.headerUnitWidth+'" class="tdshx">';x+='<div id="weeks-'+this.calx.id+"-tdsched_valcols-"+u+'" class="sched_hdrbody_vals" style="width:'+this.listbody.headerUnitWidth+'px;" ';x+='ext:qtitle="'+e2cs.cal_locale.scheduler_headerListStrings.week+" "+u;x+='" ext:qtip="'+e2cs.cal_locale.scheduler_headerListStrings.week+" "+u;x+=" "+e2cs.cal_locale.scheduler_period_from_to.starts+" "+r[0].format(this.listItems.periodFormats.DatesFormat);x+=" "+e2cs.cal_locale.scheduler_period_from_to.ends+" "+r[1].format(this.listItems.periodFormats.DatesFormat);x+='"';x+=">"+u+"</div></td>";this.lastweekofPeriod_tmp=u;}if(this.listbody.periodType==3){this.numelements=diffweeks+2;}else{this.numelements=diffweeks+1;}break;}myDatatoGen+=x;myDatatoGen+="</tr></table></div></div></td></tr></table>";if(Ext.isSafari){}else{myDatatoGen+="</div>";}return myDatatoGen;},genShedContentList:function(j){var h="";h+='<div id="'+this.calx.id+'-body-sched-container-list" class="sched_container_body">';h+='<div id="'+this.calx.id+'body-sched-insider" class="sched_container_insider">';h+='<table id="'+this.calx.id+'-skeleton_sched" width="{ANCHO1TOTAL}" border="0" cellspacing="0" cellpadding="0">';var l=j.length;for(var n=0;n<l;n++){var i="";if(this.listItems.useStoreColor){i='style="background-color:'+this.calx.store.getAt(j[n]).data[this.calx.fieldsRefer.color]+';"';}else{i="";}h+='<tr id="'+this.calx.id+"-tr-list-event-"+this.calx.store.getAt(j[n]).data[this.calx.fieldsRefer.id]+'">';if(this.listItems.parentLists){if(this.calx.store.getAt(j[n]).data[this.calx.fieldsRefer.parent]){h+='<td width="{ANCHOREFLIST}" class="sched_listItem sched_childItem"><div id="'+this.calx.id+"-eventno-"+this.calx.store.getAt(j[n]).data[this.calx.fieldsRefer.id]+'" class="sched_lisItem_div" '+i+">"+this.calx.store.getAt(j[n]).data[this.calx.fieldsRefer.subject]+"</div></td>";}else{h+='<td width="{ANCHOREFLIST}" class="sched_listItem sched_parentItem"><div id="'+this.calx.id+"-eventno-"+this.calx.store.getAt(j[n]).data[this.calx.fieldsRefer.id]+'" class="sched_lisItem_div"'+i+">"+this.calx.store.getAt(j[n]).data[this.calx.fieldsRefer.subject]+"</div></td>";}}else{h+='<td width="{ANCHOREFLIST}" class="sched_listItem sched_parentItem"><div id="'+this.calx.id+"-eventno-"+this.calx.store.getAt(j[n]).data[this.calx.fieldsRefer.id]+'" class="sched_lisItem_div"'+i+">"+this.calx.store.getAt(j[n]).data[this.calx.fieldsRefer.subject]+"</div></td>";}h+="<td>";h+='<table width="{anchocolgrids}" border="0" cellspacing="0" cellpadding="0"><tr><td>';h+='<div id="'+this.calx.id+"-container_sched_rec-"+this.calx.store.getAt(j[n]).data[this.calx.fieldsRefer.id]+'" style="width:100%;">';h+='<div id="'+this.calx.id+"-subcontainer_sched_rec-"+this.calx.store.getAt(j[n]).data[this.calx.fieldsRefer.id]+'" style="width:{anchocolgrids}px;">';h+='<table width="{anchocolgrids}" border="0" cellspacing="0" cellpadding="0">';h+='<tr id="'+this.calx.id+"-scheduler_row_grid-"+this.calx.store.getAt(j[n]).data[this.calx.fieldsRefer.id]+'" class="sched_linetask'+this.listbody.headerUnitWidth+'">';var k=this.numelements;if(this.listbody.headerUnit==2){if(this.listbody.periodType==3){k+=2;}else{k+=1;}}for(var m=0;m<k;m++){h+='<td width="'+this.listbody.headerUnitWidth+'" class="tdshx_grid"><div style="height:20px;">&nbsp;</div></td>';}h+="</tr></table>";h+="</div>";h+="</div>";h+="</td></tr></table>";h+="</td>";h+="</tr>";}h+="</table>";h+='<div id="'+this.calx.id+'-taskdd-container" style="left:{ANCHOREFLIST}px; top:-{TOPcontenedorTASKS}px;width:{anchocolgrids}px;height:{TOPcontenedorTASKS}px;position:relative;float:inherit;clear:both;overflow:hidden;">';h+="{TASKSTODISPLAY}";h+="</div>";h+="</div>";h+="</div>";return h;},genShedNoContentScreen:function(){var d="";d+='<div id="'+this.calx.id+"-body-sched-no-task-screen"+'">';if(this.blankHTML!=""){var e={calx:this.calx.id,sched_addevent_id:this.calx.id+"_addevent_element_screen"};var f=new Ext.XTemplate('<tpl for=".">'+this.blankHTML+"</tpl>");d+=f.applyTemplate(e);}else{d+=e2cs.cal_locale.scheduler_noeventsonview;}d+="</div>";return d;},getTasksforPeriod:function(){var s="";var E=this.listbody.periodType;var D=new Date(this.calx.currentdate);var w=[];switch(E){case 0:s=D.format(this.listItems.periodFormats.Day);var y=new Date(D.format("m/d/Y")+" "+this.listItems.periodFormats.startTime);var C=new Date(D.format("m/d/Y")+" "+this.listItems.periodFormats.endTime);var w=[];var v=0;counttasks=this.calx.store.getCount();for(var u=0;u<counttasks;u++){var F=this.calx.store.getAt(u).data;testdateinit=this.calx.store.getAt(u).data[this.calx.fieldsRefer.startdate];testdateend=this.calx.store.getAt(u).data[this.calx.fieldsRefer.enddate];checkdates=this.datetohandle.between(new Date(testdateinit),new Date(testdateend));chkformat=this.datetohandle.format("m/d/Y");test=new Date(testdateinit);if(test.format("m/d/Y")==chkformat){checkdates=true;}test=new Date(testdateend);if(test.format("m/d/Y")==chkformat){checkdates=true;}if(checkdates){w[v]=u;v+=1;}}break;case 1:var t=this.getDatesforWeek(D);firstdayofweek=t[0];lastdayofweek=t[1];var w=[];var v=0;counttasks=this.calx.store.getCount();for(var u=0;u<counttasks;u++){dateinit=new Date(this.calx.store.getAt(u).data[this.calx.fieldsRefer.startdate]);dateend=new Date(this.calx.store.getAt(u).data[this.calx.fieldsRefer.enddate]);checkdates_a=dateinit.between(firstdayofweek,lastdayofweek);checkdates_b=dateend.between(firstdayofweek,lastdayofweek);if(dateinit.format("W")==firstdayofweek.format("W")||dateinit.format("W")==lastdayofweek.format("W")){checkdates_a=true;}if(dateend.format("W")==firstdayofweek.format("W")||dateend.format("W")==lastdayofweek.format("W")){checkdates_b=true;}if(dateinit<firstdayofweek&&dateend>lastdayofweek){checkdates_a=true;checkdates_b=true;}if(checkdates_a||checkdates_b){w[v]=u;v+=1;}}break;case 2:firstdayofmonth=new Date(D.format("m")+"/01/"+D.format("Y"));lastdaytmp=D.getLastDateOfMonth();lastdayofmonth=new Date(D.format("m")+"/"+lastdaytmp.format("d")+"/"+D.format("Y"));var w=[];var v=0;counttasks=this.calx.store.getCount();for(var u=0;u<counttasks;u++){dateinit=new Date(this.calx.store.getAt(u).data[this.calx.fieldsRefer.startdate]);dateend=new Date(this.calx.store.getAt(u).data[this.calx.fieldsRefer.enddate]);checkdates_a=dateinit.between(firstdayofmonth,lastdayofmonth);checkdates_b=dateend.between(firstdayofmonth,lastdayofmonth);if(dateinit.format("m")==firstdayofmonth.format("m")||dateinit.format("m")==lastdayofmonth.format("m")){checkdates_a=true;}if(dateend.format("m")==firstdayofmonth.format("m")||dateend.format("m")==lastdayofmonth.format("m")){checkdates_b=true;}var G=dateinit.getMonth()+1;var x=dateend.getMonth()+1;var z=D.getMonth()+1;if(G<z&&x>z){checkdates_a=true;checkdates_b=true;}if(dateinit<firstdayofmonth&&dateend>lastdayofmonth){checkdates_a=true;checkdates_b=true;}if(checkdates_a||checkdates_b){w[v]=u;v+=1;}}break;case 3:var H=new Date(D);var i=H.getMonth();var A=(Math.floor(i/2)+1);var t=this.getDatesforBimonth(D);firstdayofbim=t[0];lastdayofbim=t[1];var w=[];var v=0;counttasks=this.calx.store.getCount();for(var u=0;u<counttasks;u++){dateinit=new Date(this.calx.store.getAt(u).data[this.calx.fieldsRefer.startdate]);dateend=new Date(this.calx.store.getAt(u).data[this.calx.fieldsRefer.enddate]);checkdates_a=dateinit.between(firstdayofbim,lastdayofbim);checkdates_b=dateend.between(firstdayofbim,lastdayofbim);if(dateinit.format("m")==firstdayofbim.format("m")||dateinit.format("m")==lastdayofbim.format("m")){checkdates_a=true;}if(dateend.format("m")==firstdayofbim.format("m")||dateend.format("m")==lastdayofbim.format("m")){checkdates_b=true;}var G=dateinit.getMonth()+1;var x=dateend.getMonth()+1;var z=D.getMonth()+1;if(G<z&&x>z){checkdates_a=true;checkdates_b=true;}if(dateinit<firstdayofbim&&dateend>lastdayofbim){checkdates_a=true;checkdates_b=true;}if(checkdates_a||checkdates_b){w[v]=u;v+=1;}}break;case 4:var H=new Date(D);var i=H.getMonth();var B=Math.floor(i/3)+1;var t=this.getDatesForQuarter(D);firstdayofqua=t[0];lastdayofqua=t[1];var w=[];var v=0;counttasks=this.calx.store.getCount();for(var u=0;u<counttasks;u++){dateinit=new Date(this.calx.store.getAt(u).data[this.calx.fieldsRefer.startdate]);dateend=new Date(this.calx.store.getAt(u).data[this.calx.fieldsRefer.enddate]);checkdates_a=dateinit.between(firstdayofqua,lastdayofqua);checkdates_b=dateend.between(firstdayofqua,lastdayofqua);if(dateinit.format("m")==firstdayofqua.format("m")||dateinit.format("m")==firstdayofqua.format("m")){checkdates_a=true;}if(dateend.format("m")==lastdayofqua.format("m")||dateend.format("m")==lastdayofqua.format("m")){checkdates_b=true;}var G=dateinit.getMonth()+1;var x=dateend.getMonth()+1;var z=D.getMonth()+1;if(G<z&&x>z){checkdates_a=true;checkdates_b=true;}if(dateinit<firstdayofqua&&dateend>lastdayofqua){checkdates_a=true;checkdates_b=true;}if(dateinit>=firstdayofqua&&dateend<lastdayofqua){checkdates_a=true;checkdates_b=true;}if(dateinit>=firstdayofqua&&dateend<lastdayofqua){checkdates_a=true;checkdates_b=true;}if(checkdates_a||checkdates_b){w[v]=u;v+=1;}}break;default:s=D.format(this.headerFormat);break;}return w;}});