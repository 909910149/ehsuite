Ext.ECalendar.monthview=function(b){Ext.apply(this,b);this.addEvents("dayClick","beforeMonthChange","afterMonthChange");Ext.ECalendar.monthview.superclass.constructor.call(this);};Ext.extend(Ext.ECalendar.monthview,Ext.util.Observable,{referid:"monthview",header:true,headerUseTpl:false,headerTpl:new Ext.XTemplate('<tpl for=".">{title}-{datetouse:this.formatx}</tpl>',{formatx:function(d){var c=11;return d.format("M-Y");}}),headerData:{title:"Custom header for Month",datetouse:new Date()},headerFormat:"M-Y",headerButtons:true,moreMenuItems:[],dayAction:"viewday",showTaskcount:true,showTaskList:false,showNumTasks:5,task_format:"Y-m-d H:i:s",TaskList_launchEventOn:"click",contextMenuLabels:e2cs.cal_locale.contextMenuLabelsDay,ShowMenuItems:[1,1,1,1,1,1],TaskList_ShowMenuItems:[1,1,1],TaskList_moreMenuItems:[],taskStyle:"margin-top: 10px;",startDay:0,thisview:null,init:function(c,d){this.calx=c;this.datetohandle=d;},render:function(){if(this.calx.loadMask){var T=new Ext.LoadMask(this.calx.id,{removeMask:true,msg:this.calx.customMaskText});T.show();}this.showTaskcount==true?this.showTaskList=false:this.showTaskList=this.showTaskList;var I=new Date(this.calx.currentdate);Date.monthNames=e2cs.cal_locale.monthtitles;Date.dayNames=e2cs.cal_locale.daytitles;if(this.header){var E=this.genHeader(this.datetohandle);}var L=Ext.get(this.calx.body);var A=L.dom.childNodes.length;if(A){for(var D=A;D<A;D++){L.dom.removeChild(L.dom.childNodes[0]);}}L.update("");var N='<div id="'+this.calx.id+'-main-calendar-header"></div>';N+='<div id="'+this.calx.id+'-main-calendar-month-body"></div>';L.update(N);if(this.header){var E=Ext.get(this.calx.id+"-main-calendar-header");var S=E;var K=S.wrap({tag:"div",cls:"x-calendar-month-header",html:""});if(this.headerButtons){var M=K.createChild({id:this.calx.id+"-btn-pm",tag:"div",cls:"x-calendar-month-previous",html:""});var J=K.createChild({id:this.calx.id+"-btn-nm",tag:"div",cls:"x-calendar-month-next",html:""});M.dom["qtip"]=e2cs.cal_locale.headerTooltipsMonth.prev;M.addListener("click",this.onclickprev_month,this);M.addClassOnOver("x-calendar-month-previous-over");J.dom["qtip"]=e2cs.cal_locale.headerTooltipsMonth.next;J.addListener("click",this.onclicknext_month,this);J.addClassOnOver("x-calendar-month-next-over");}if(this.headerUseTpl){var R=this.headerTpl.apply(this.headerData);var i=K.createChild({tag:"div",id:"header",html:""+R+""});}else{var i=K.createChild({tag:"div",id:"header",html:""+I.format(this.headerFormat)+""});}}var Q=Ext.get(this.calx.id+"-main-calendar-month-body");var z=this.genDaysHeader();var y=this.genBody(I,{styletasks:this.taskStyle});var G=Q.wrap({tag:"div",cls:"x-calendar-month-days",html:""});var P=G.createChild({tag:"div",id:this.calx.id+"-calendar-view-month",cls:"header-days",html:' <table id="'+this.calx.id+'-month_skel" width="100%" border="0" cellspacing="0" cellpadding="0"><tr class="skel_hdrdays" id="'+this.calx.id+'-skel_hdrdays">'+z+"</tr>"+y+"</table>"});Ext.get(this.calx.id+"-skel_hdrdays").setHeight(17);if(Ext.isIE){var B=P.dom.childNodes[0].childNodes[0].rows.length-1;}else{var B=P.dom.childNodes[1].childNodes[0].rows.length-1;}if(this.calx.ownerCt!=undefined){if(this.calx.ownerCt.ctype&&this.calx.ownerCt.ctype=="Ext.Component"){this.calx.height=this.calx.ownerCt.getInnerHeight();}}if(!this.calx.height||this.calx.height=="undefined"){if(this.calx.getEl().dom.offsetParent!=null){var H=this.calx.getEl().dom.offsetParent.clientHeight;}else{var H=0;}if(H==0){H=300;}if(this.header){H+=-27;}if(this.calx.showCal_tbar){H+=-27;}if(this.calx.header){H+=-22;}H+=-16;var C=0;Ext.get(this.calx.id+"-month_skel").setStyle({height:""+H-C+"px"});valtosethtmp=Math.round((H)/B);valtosethtmp+=-3;}else{var H=0;if(this.header){H+=-27;}if(this.calx.showCal_tbar){H+=-27;}if(this.calx.header){H+=-22;}H+=-16;H+=this.calx.height;if(this.calx.showCal_tbar){var C=77;}else{var C=24;}valtosethtmp=Math.round((H)/B);valtosethtmp+=-3;}Ext.get(this.calx.id+"-month_skel").setHeight(H);newsize=H;valtosethtmp=Math.round(newsize/B);var P=Ext.select("td.daybody",true);P.each(function(d,b,c){var f=d;if(f.id==undefined||f==null){var a=d.dom.id;}else{var a=d.id;}if(a.indexOf("m-td-"+this.calx.id+"-")>=0){var e=Ext.get(a);e.setStyle({height:""+valtosethtmp+"px"});e.addClassOnOver("daybody-over");if(Ext.isOpera){e.addListener("mousedown",this.operabuttons,this);}else{e.addListener("click",this.onhandler_day,this);e.addListener("contextmenu",this.oncontextmenu,this,{stopPropagation:true,normalized:true,preventDefault:true});}}},this);if(this.showTaskcount==false&&this.showTaskList==true){var O=Ext.select("div.tasks_list",true);O.each(function(a,b,d){if((a.id.indexOf(this.calx.id)+1)>0){element_id=a.id;testtdobjref=element_id.replace(this.calx.id+"-tasklist-","");objtd=Ext.get("m-td-"+this.calx.id+"-"+testtdobjref);objtdtd={top:objtd.getTop(),heigth:objtd.getHeight()};tmprefdata=0;tmprefdata=Ext.get(element_id).getTop()-objtdtd.top;tmprefdata=tmprefdata+4;var c=0;c=objtdtd.heigth-tmprefdata;Ext.get(element_id).setHeight(c);}},this);var F=Ext.select("div.tasks_list_item",true);F.each(function(b,a,c){if((b.id.indexOf(this.calx.id)+1)>0){test=11;b.addClassOnOver("task_list_item_over");if(this.TaskList_launchEventOn!=""){b.addListener(this.TaskList_launchEventOn,this.onDblClick_tasklistitem,this);}if(Ext.isOpera){b.addListener("mousedown",this.operataskitembuttons,this);}else{b.addListener("contextmenu",this.oncontextmenuTaskitem,this,{stopPropagation:true,normalized:true,preventDefault:true});}}},this);}if(this.calx.loadMask){T.hide();}},refreshView:function(){this.render();},ZoomDay:function(o){var p=new Date(o);var n=this.calx.store.getCount();if(n>0){var l=0;taskstmp=[];for(var q=0;q<n;q++){var r=this.calx.store.getAt(q).data;dateinit=this.calx.store.getAt(q).data[this.calx.fieldsRefer.startdate];dateend=this.calx.store.getAt(q).data[this.calx.fieldsRefer.enddate];checkdates=p.between(new Date(dateinit),new Date(dateend));chkformat=p.format("m/d/Y");test=new Date(dateinit);if(test.format("m/d/Y")==chkformat){checkdates=true;}test=new Date(dateend);if(test.format("m/d/Y")==chkformat){checkdates=true;}if(checkdates){taskstmp[l]=r;l+=1;}}if(l<=0){return false;}}else{return false;}showdata=[];for(var m=0;m<taskstmp.length;m++){showdata[m]=[taskstmp[m][this.calx.fieldsRefer.id],taskstmp[m][this.calx.fieldsRefer.subject],taskstmp[m][this.calx.fieldsRefer.description],taskstmp[m][this.calx.fieldsRefer.startdate],taskstmp[m][this.calx.fieldsRefer.enddate],taskstmp[m][this.calx.fieldsRefer.color]];}var k=new Ext.data.ArrayReader({},[{name:this.calx.fieldsRefer.id,type:"int"},{name:this.calx.fieldsRefer.subject,type:"string"},{name:this.calx.fieldsRefer.description,type:"string"},{name:this.calx.fieldsRefer.startdate,type:"string"},{name:this.calx.fieldsRefer.enddate,type:"string"},{name:this.calx.fieldsRefer.color,type:"string"}]);tmpstore=new Ext.data.Store({reader:k,data:showdata});tmppanel=new Ext.Panel({id:"ecal-more-task-panel",header:false,autoDestroy:true,autoScroll:true,monitorResize:true,border:false,autoWidth:false,autoHeight:false,items:new Ext.DataView({loadingText:e2cs.cal_locale.win_tasks_loading,store:tmpstore,tpl:this.calx.tplTaskZoom,autoWidth:true,autoHeight:true,overClass:"",itemSelector:"",emptyText:e2cs.cal_locale.win_tasks_empty})});var i=new Ext.Window({id:"ecal-win-moretasks",name:"ecal-win-moretasks",title:e2cs.cal_locale.win_month_zoomlabel+" "+p.format(e2cs.cal_locale.win_tasks_format),width:450,height:300,closeAction:"close",resizable:true,resizeHandles:"all",hideBorders:true,maximizable:true,plain:true,modal:true,layout:"fit",iconCls:"x-calendar-more-tasks-win",items:[tmppanel]});i.show();return true;},operabuttons:function(d,f,e){if(Ext.isOpera){if(d.button==0){this.onhandler_day(d,f,e);}if(d.button==2){this.oncontextmenu(d,f,e);}}},oncontextmenu:function(j,i,k){if(Ext.isOpera){if(j.button!=2){return false;}}if(i.className=="tasks_list_item"||i.className=="tasks_list_item task_list_item_over"||i.className.indexOf("task_list_item_over")>0){return false;}if(this.ShowMenuItems[0]!=true&&this.ShowMenuItems[1]!=true&&this.ShowMenuItems[2]!=true&&this.ShowMenuItems[3]!=true&&this.ShowMenuItems[4]!=true&&this.ShowMenuItems[5]!=true&&this.moreMenuItems.length<=0){return false;}j.stopEvent();if(i.className=="noday"||i.className=="today"||i.className=="monthday"){var h=new Date(i.id.substring(this.calx.id.length+1));}else{if(i.className=="tasks"){var h=new Date(i.parentNode.firstChild.id.substring(this.calx.id.length+1));}else{if(i.id.indexOf("-tasklist-")>0){tmpdata=i.id.replace(this.calx.id+"-tasklist-","");var h=new Date(tmpdata+"");}else{var h=new Date(i.firstChild.id.substring(this.calx.id.length+1));}}}if(this.menu){this.menu.removeAll();}this.menu=new Ext.menu.Menu({id:this.calx.id+"-contextmenu-month",shadow:true,items:[{id:this.calx.id+"-month_ctxbtn_task",iconCls:"x-calendar-month-btnmv_task",text:e2cs.cal_locale.contextMenuLabelsMonth.task+" ("+h.format(this.calx.dateformat)+")",scope:this},"-",{id:this.calx.id+"-month_ctxbtn_nextmonth",iconCls:"x-calendar-month-btnmv_nextmth",text:e2cs.cal_locale.contextMenuLabelsMonth.gonextmonth,scope:this},{id:this.calx.id+"-month_ctxbtn_prevmonth",iconCls:"x-calendar-month-btnmv_prevmth",text:e2cs.cal_locale.contextMenuLabelsMonth.goprevmonth,scope:this},"-",{id:this.calx.id+"-month_ctxbtn_viewweek",iconCls:"x-calendar-month-btnmv_viewweek",text:e2cs.cal_locale.contextMenuLabelsMonth.chgwview,scope:this},{id:this.calx.id+"-month_ctxbtn_viewday",iconCls:"x-calendar-month-btnmv_viewday",text:e2cs.cal_locale.contextMenuLabelsMonth.chgdview,scope:this},{id:this.calx.id+"-month_ctxbtn_viewsched",iconCls:"x-calendar-month-btnmv_viewsched",text:e2cs.cal_locale.contextMenuLabelsMonth.chgsview,scope:this}]});if(this.moreMenuItems.length>0){this.menu.add("-");for(var l=0;l<this.moreMenuItems.length;l++){var g=this.moreMenuItems[l].id;this.moreMenuItems[l].rendered=false;this.moreMenuItems[l].addListener("click",function(a){this.onCustomMenuAction(a.id,Ext.get(i),this);},this);this.menu.add(this.moreMenuItems[l]);}}this.menu.items.items[0].addListener("click",function(){this.onTaskAdd(Ext.get(i),this);},this);this.menu.items.items[2].addListener("click",function(){this.onclicknext_month();},this);this.menu.items.items[3].addListener("click",function(){this.onclickprev_month();},this);this.menu.items.items[5].addListener("click",function(){this.changeCalview(Ext.get(i),this,1);},this);this.menu.items.items[6].addListener("click",function(){this.changeCalview(Ext.get(i),this,2);},this);this.menu.items.items[7].addListener("click",function(){this.changeCalview(Ext.get(i),this,3);},this);if(this.ShowMenuItems[0]!=true){this.menu.items.items[0].hidden=true;this.menu.items.items[1].hidden=true;}if(this.ShowMenuItems[1]!=true&&this.ShowMenuItems[2]!=true&&this.ShowMenuItems[3]!=true&&this.ShowMenuItems[4]!=true&&this.ShowMenuItems[5]!=true){this.menu.items.items[1].hidden=true;}if(this.ShowMenuItems[1]!=true){this.menu.items.items[2].hidden=true;}if(this.ShowMenuItems[2]!=true){this.menu.items.items[3].hidden=true;}if(this.ShowMenuItems[1]!=true&&this.ShowMenuItems[2]!=true){this.menu.items.items[4].hidden=true;}if(this.ShowMenuItems[3]!=true){this.menu.items.items[5].hidden=true;}if(this.ShowMenuItems[4]!=true){this.menu.items.items[6].hidden=true;}if(this.ShowMenuItems[5]!=true){this.menu.items.items[7].hidden=true;}if(this.ShowMenuItems[3]==false&&this.ShowMenuItems[4]==false&&this.ShowMenuItems[5]==false){if(this.moreMenuItems.length>0){this.menu.items.items[8].hidden=true;}}if(!this.calx.dview){this.menu.items.items[6].hidden=true;}if(!this.calx.wview){this.menu.items.items[5].hidden=true;}if(!this.calx.sview){this.menu.items.items[7].hidden=true;}if(this.menu.items.items[5].hidden&&this.menu.items.items[6].hidden&&this.menu.items.items[7].hidden){if(this.moreMenuItems.length>0){this.menu.items.items[8].hidden=true;}}this.menu.on("hide",this.onContextHide,this);this.menu.showAt([j.getPageX(),j.getPageY()]);},onCustomMenuAction:function(i,g,h){var f=[];var j=Ext.get(g);if(g.dom.className=="noday"||g.dom.className=="today"||g.dom.className=="monthday"){f[0]=Ext.get(g).dom.id.substring(this.calx.id.length+1);f[1]=Ext.get(g).getAttributeNS("tag","class");}else{if(g.dom.className=="tasks"){f[0]=Ext.get(g).dom.parentNode.firstChild.id.substring(this.calx.id.length+1);f[1]=Ext.get(g.dom.parentNode.firstChild).getAttributeNS("tag","class");}else{f[0]=Ext.get(g).dom.firstChild.id.substring(this.calx.id.length+1);f[1]=Ext.get(g.dom.firstChild).getAttributeNS("tag","class");}}this.calx.fireEvent("customMenuAction",i,"month",f,g,this);},changeCalview:function(h,g,e){if(h.dom.className=="noday"||h.dom.className=="today"||h.dom.className=="monthday"){var f=new Date(h.id.substring(this.calx.id.length+1));}else{if(h.dom.className=="tasks"){var f=new Date(h.dom.parentNode.firstChild.id.substring(this.calx.id.length+1));}else{var f=new Date(h.dom.firstChild.id.substring(this.calx.id.length+1));}}if(e==1){varview="week";}else{if(e==2){varview="day";}else{varview="schedule";}}this.calx.changeView(varview);},onTaskAdd:function(d,f){if(d.dom.className=="noday"||d.dom.className=="today"||d.dom.className=="monthday"){var e=new Date(d.id.substring(this.calx.id.length+1));}else{if(d.dom.className=="tasks"){var e=new Date(d.dom.parentNode.firstChild.id.substring(this.calx.id.length+1));}else{if(d.dom.className=="tasks_list_item"||d.dom.className=="tasks_list_item task_list_item_over"||d.dom.className.indexOf("task_list_item_over")>0){tmpdata=d.id.replace(this.calx.id+"-tasklist-","");e=new Date(tmpdata+"");}else{if(d.dom.className=="tasks_list"){tmpdata=d.id.replace(this.calx.id+"-tasklist-","");var e=new Date(tmpdata+"");}else{if(d.dom.className=="daybody"){tmpdata=d.id.replace("m-td-"+this.calx.id+"-","");e=new Date(tmpdata+"");}else{var e=new Date(d.dom.firstChild.id.substring(this.calx.id.length+1));}}}}}this.calx.fireEvent("taskAdd",e);},onContextHide:function(){},operataskitembuttons:function(p,w,o){if(Ext.isOpera){p.stopEvent();var z=Ext.get(w.id);var i=this.TaskList_ShowMenuItems;var y=this.TaskList_moreMenuItems;var u=[];var q=this.getTaskarray(z);var x=this.calx.fireEvent("beforeContextMenuTask","monthview-task",q,i,u);if(x==false){if(u[0]==false){if(u[1]==true){if(u[2]==true){var y=u[3];}var i=u[4];}else{var y=this.TaskList_moreMenuItems;var i=this.TaskList_ShowMenuItems;}}else{return false;}}else{var y=this.TaskList_moreMenuItems;}var t=w.id.replace(this.calx.id+"-tasklist-","");if(this.taskitem_menu){this.taskitem_menu.removeAll();}this.taskitem_menu=new Ext.menu.Menu({ignoreParentClicks:true,shadow:false,items:[{id:"month_tskitem_btn_task-add",iconCls:"x-calendar-day-btnmv_add",text:this.contextMenuLabels.taskAdd,scope:this},{id:"month_tskitem_btn_task-delete",iconCls:"x-calendar-day-btnmv_delete",text:this.contextMenuLabels.taskDelete,scope:this},"-",{id:"month_tskitem_btn_task-edit",iconCls:"x-calendar-day-btnmv_task",text:this.contextMenuLabels.taskEdit+z.getAttributeNS("tag","ec_subject"),scope:this}]});if(y.length>0){this.taskitem_menu.add("-");for(var v=0;v<y.length;v++){y[v].rendered=false;if(y[v].menu==undefined){if(y[v].ctype=="Ext.menu.Item"){y[v].rendered=false;y[v].addListener("click",function(b,a){this.onCustomMenuAction_TaskItem(b.id,Ext.get(w),this);},this);}else{var r=11;}this.taskitem_menu.add(y[v]);}else{y[v].menu.rendered=false;for(var s=0;s<y[v].menu.items.length;s++){y[v].menu.items.items[s].rendered=false;if(y[v].menu.items.items[s].ctype=="Ext.menu.Item"){y[v].menu.items.items[s].addListener("click",function(b,a){this.onCustomMenuAction_TaskItem(b.id,Ext.get(w),this);},this);}else{}}this.taskitem_menu.add(y[v]);}}}this.taskitem_menu.items.items[0].addListener("click",function(){this.onActionTask(1,Ext.get(w),this);},this);this.taskitem_menu.items.items[1].addListener("click",function(){this.onActionTask(2,Ext.get(w),this);},this);this.taskitem_menu.items.items[3].addListener("click",function(){this.onActionTask(3,Ext.get(w),this);},this);if(i[0]!=true){this.taskitem_menu.items.items[0].hidden=true;}if(i[1]!=true){this.taskitem_menu.items.items[1].hidden=true;}if(i[0]!=true&&i[1]!=true){this.taskitem_menu.items.items[2].hidden=true;}if(i[2]!=true){this.taskitem_menu.items.items[3].hidden=true;}this.taskitem_menu.on("hide",this.onContextHide_Taskitem,this);this.taskitem_menu.showAt(p.xy);}},onDblClick_tasklistitem:function(h,g,e){test=g.id.indexOf(this.calx.id+"-mtask-item-")+1;if(test){var f=this.getTaskarray(g);this.calx.fireEvent("taskDblClick",f,this,this.calx,"month");}},oncontextmenuTaskitem:function(o,u,n){if(Ext.isOpera){if(o.button!=2){return false;}}o.stopEvent();if(this.TaskList_ShowMenuItems[0]!=true&&this.TaskList_ShowMenuItems[1]!=true&&this.TaskList_ShowMenuItems[2]!=true&&this.TaskList_moreMenuItems.length<=0){return false;}var x=Ext.get(u.id);var i=this.TaskList_ShowMenuItems;var w=this.TaskList_moreMenuItems;var s=[];var p=this.getTaskarray(x);var v=this.calx.fireEvent("beforeContextMenuTask","monthview-task",p,i,s);if(v==false){if(s[0]==false){if(s[1]==true){if(s[2]==true){var w=s[3];}var i=s[4];}else{var w=this.TaskList_moreMenuItems;var i=this.TaskList_ShowMenuItems;}}else{return false;}}else{var w=this.TaskList_moreMenuItems;}var r=u.id.replace(this.calx.id+"-tasklist-","");if(this.taskitem_menu){this.taskitem_menu.removeAll();}this.taskitem_menu=new Ext.menu.Menu({allowOtherMenus:true,shadow:true,items:[{id:"month_tskitem_btn_task-add",iconCls:"x-calendar-day-btnmv_add",text:this.contextMenuLabels.taskAdd,scope:this},{id:"month_tskitem_btn_task-delete",iconCls:"x-calendar-day-btnmv_delete",text:this.contextMenuLabels.taskDelete,scope:this},"-",{id:"month_tskitem_btn_task-edit",iconCls:"x-calendar-day-btnmv_task",text:this.contextMenuLabels.taskEdit+x.getAttributeNS("tag","ec_subject"),scope:this}]});if(w.length>0){this.taskitem_menu.add("-");for(var t=0;t<w.length;t++){w[t].rendered=false;if(w[t].menu==undefined){w[t].rendered=false;if(w[t].ctype=="Ext.menu.Item"){w[t].rendered=false;w[t].addListener("click",function(b,a){this.onCustomMenuAction_TaskItem(b.id,Ext.get(u),this);},this);}else{}this.taskitem_menu.add(w[t]);}else{this.taskitem_menu.addMenuItem({iconCls:w[t].iconCls,text:w[t].text,menu:w[t].menu});for(var q=0;q<w[t].menu.items.length;q++){w[t].menu.items.items[q].rendered=false;if(w[t].menu.items.items[q].ctype=="Ext.menu.Item"){w[t].menu.items.items[q].addListener("click",function(b,a){this.onCustomMenuAction_TaskItem(b.id,Ext.get(u),this);},this);}else{}}}}}this.taskitem_menu.items.items[0].addListener("click",function(){this.onActionTask(1,Ext.get(u),this);},this);this.taskitem_menu.items.items[1].addListener("click",function(){this.onActionTask(2,Ext.get(u),this);},this);this.taskitem_menu.items.items[3].addListener("click",function(){this.onActionTask(3,Ext.get(u),this);},this);if(i[0]!=true){this.taskitem_menu.items.items[0].hidden=true;}if(i[1]!=true){this.taskitem_menu.items.items[1].hidden=true;}if(i[0]!=true&&i[1]!=true){this.taskitem_menu.items.items[2].hidden=true;}if(i[2]!=true){this.taskitem_menu.items.items[3].hidden=true;if(w.length>0){this.taskitem_menu.items.items[4].hidden=true;}}this.taskitem_menu.on("hide",this.onContextHide_Taskitem,this);this.taskitem_menu.showAt(o.xy);},onActionTask:function(l,j,k){this.taskitem_menu.hide();var h=this.getTaskarray(j);switch(l){case 1:if(j.id.indexOf("-mtask-item-")>0){var m=j.id.replace(this.calx.id+"-mtask-item-","");}else{if(j.id.indexOf("-tasklist-")>0){var m=j.id.replace(this.calx.id+"-tasklist-","");}}m=m.substr(0,10);var n=new Date(m);this.calx.fireEvent("taskAdd",n);break;case 2:var i=this.calx.fireEvent("beforeTaskDelete",h,this);if(i){if(this.calx.fireEvent("onTaskDelete",h)==true){this.calx.fireEvent("afterTaskDelete",h,true);}else{this.calx.fireEvent("afterTaskDelete",null,false);}}break;case 3:var i=this.calx.fireEvent("beforeTaskEdit",h,this);if(i){if(this.calx.fireEvent("onTaskEdit",h)==true){this.calx.fireEvent("afterTaskEdit",h,true);}else{this.calx.fireEvent("afterTaskEdit",null,false);}}break;default:break;}},onCustomMenuAction_TaskItem:function(e,g,h){var f=this.getTaskarray(g);this.calx.fireEvent("customMenuAction",e,"month",f,g,this);this.taskitem_menu.hide();},onContextHide_Taskitem:function(b){},onhandler_day:function(i,h,j){if(h.className=="noday"||h.className=="today"||h.className=="monthday"){var g=new Date(h.id.substring(this.calx.id.length+1));}else{if(h.className=="tasks"){var g=new Date(h.parentNode.firstChild.id.substring(this.calx.id.length+1));}else{if(h.className=="tasks_list_item"||h.className=="tasks_list"||h.className=="tasks_list_item task_list_item_over"||h.className.indexOf("task_list_item_over")>0){var f=11;}else{var g=new Date(h.firstChild.id.substring(this.calx.id.length+1));}}}if(h.className=="tasks_list_item"||h.className=="tasks_list"||h.className=="tasks_list_item task_list_item_over"||h.className.indexOf("task_list_item_over")>0){var f=11;}else{if(this.dayAction=="viewday"){if(this.calx.fireEvent("beforeChangeView","day",this.calx.currentView,this.calx)==false){return false;}else{this.calx.currentdate=g;this.calx.selector_dateMenu.picker.setValue(this.calx.currentdate);this.calx.currentView="day";this.calx.viewday.render();this.calx.fireEvent("onChangeView","day","month",this);}}if(this.dayAction=="event"){this.fireEvent("dayClick",g,this,this.calx);}if(this.dayAction=="window"){this.ZoomDay(g);}}},onclickprev_month:function(){var c=this.calx.currentdate.add(Date.MONTH,-1);var d=this.fireEvent("beforeMonthChange",this.calx.currentdate,c);if(d){this.calx.currentdate=c;this.calx.selector_dateMenu.picker.setValue(this.calx.currentdate);this.render();this.fireEvent("afterMonthChange",c);}},onclicknext_month:function(){var c=this.calx.currentdate.add(Date.MONTH,1);var d=this.fireEvent("beforeMonthChange",this.calx.currentdate,c);if(d){this.calx.currentdate=c;this.calx.selector_dateMenu.picker.setValue(this.calx.currentdate);this.render();this.fireEvent("afterMonthChange",c);}},genHeader:function(f){var d=new Date(f);Date.monthNames=e2cs.cal_locale.monthtitles;var e='<div class="x-calendar-month-header" style="width:'+(this.calx.width-10)+'px;">';e+='<div id="header">'+d.format(this.headerFormat)+"</div>";if(this.headerButtons){e+='<div class="x-calendar-month-previous"></div>';e+='<div class="x-calendar-month-next"></div>';}e+="</div>";return e;},genDaysHeader:function(){var d="";for(var e=0;e<e2cs.cal_locale.daytitles.length;e++){var f=this.startDay+e;if(f>6){f=f-7;}d+='<td width="14%"><div class="dayheader">'+e2cs.cal_locale.daytitles[f]+"</div></td>";}return d;},getDateRangeOfMonth:function(w){var A=new Date(w);var r=A.getFirstDayOfMonth()-this.startDay;var s=A.getDaysInMonth();if(A.getMonth()==1){if((A.getFullYear()%4==0&&A.getFullYear()%100!=0)||A.getFullYear()%400==0){s=29;}}if(r<0){r=7+(r);}var t=new Date((w.getMonth()+1)+"/1/"+w.getFullYear()).add(Date.DAY,(r*-1));var v=r;startmonthdate=new Date(A.format("m")+"/01/"+A.format("Y"));for(var u=0;u<s;u++){if(v>=7){v=0;}var z=new Date(startmonthdate).add(Date.DAY,u);v+=1;}var o=new Date((w.getMonth()+1)+"/1/"+w.getFullYear()).add(Date.DAY,(s));var y=o.getDay();if(v<7){var p=0;for(var x=v;x<7;x++){p=p+1;var B=new Date(z).add(Date.DAY,p);}}var q=[t,B];return q;},genBody:function(s,n){var y=new Date(s);var p=y.getFirstDayOfMonth()-this.startDay;var q=y.getDaysInMonth();var u=0;if(y.getMonth()==1){if((y.getFullYear()%4==0&&y.getFullYear()%100!=0)||y.getFullYear()%400==0){q=29;}}var w="<tr>";if(p<0){p=7+(p);}if(p!=0){for(var x=(p);x>0;x--){writedt=new Date((s.getMonth()+1)+"/1/"+s.getFullYear()).add(Date.DAY,(x*-1));w+='<td valign="top" id="m-td-'+this.calx.id+"-"+writedt.format("m/d/Y")+'" class="daybody">';w+='<div class="noday" id="'+this.calx.id+"-"+writedt.format("m/d/Y")+'">'+writedt.format("j-M")+"</div>";if(this.showTaskcount){tmptasks=this.getCountTask(writedt,this.calx.store);if(tmptasks>0){w+='<div class="tasks" style="'+n.styletasks+'">'+e2cs.cal_locale.labelforTasksinMonth+" ("+tmptasks+")</div>";}}else{if(this.showTaskList){var t=this.getTaskList(writedt,this.calx.store);if(t!=""){w+='<div class="tasks_list" id="'+this.calx.id+"-tasklist-"+writedt.format("m/d/Y")+'" style="height:5px;'+n.styletasks+'">';w+=t;w+="</div>";}}}w+="</td>";}}icount=p;u=1;startmonthdate=new Date(y.format("m")+"/01/"+y.format("Y"));for(var r=0;r<q;r++){if(icount>=7){icount=0;w+="</tr><tr>";u+=1;}var v=new Date(startmonthdate).add(Date.DAY,r);if(v.format("m/d/Y")==y.format("m/d/Y")){w+='<td valign="top" id="m-td-'+this.calx.id+"-"+v.format("m/d/Y")+'" class="daybody" height="10px">';w+='<div class="today" id="'+this.calx.id+"-"+v.format("m/d/Y")+'">'+v.format("j")+"</div>";if(this.showTaskcount){tmptasks=this.getCountTask(v,this.calx.store);if(tmptasks>0){w+='<div class="tasks" style="'+n.styletasks+'">'+e2cs.cal_locale.labelforTasksinMonth+" ("+tmptasks+")</div>";}}else{if(this.showTaskList){var t=this.getTaskList(v,this.calx.store);if(t!=""){w+='<div class="tasks_list" id="'+this.calx.id+"-tasklist-"+v.format("m/d/Y")+'" style="height:5px;'+n.styletasks+'">';w+=t;w+="</div>";}}}w+="</td>";}else{w+='<td valign="top" id="m-td-'+this.calx.id+"-"+v.format("m/d/Y")+'" class="daybody" height="10px">';w+='<div class="monthday" id="'+this.calx.id+"-"+v.format("m/d/Y")+'">'+v.format("j")+"</div>";if(this.showTaskcount){tmptasks=this.getCountTask(v,this.calx.store);if(tmptasks>0){w+='<div class="tasks" style="'+n.styletasks+'">'+e2cs.cal_locale.labelforTasksinMonth+" ("+tmptasks+")</div>";}}else{if(this.showTaskList){var t=this.getTaskList(v,this.calx.store);if(t!=""){w+='<div class="tasks_list" id="'+this.calx.id+"-tasklist-"+v.format("m/d/Y")+'" style="height:5px;'+n.styletasks+'">';w+=t;w+="</div>";}}}w+="</td>";}icount+=1;}if(icount<7){var o=0;for(var x=icount;x<7;x++){o=o+1;var z=new Date(v).add(Date.DAY,o);w+='<td valign="top"   id="m-td-'+this.calx.id+"-"+z.format("m/d/Y")+'" class="daybody" height="10px">';w+='<div class="noday" id="'+this.calx.id+"-"+z.format("m/d/Y")+'">'+z.format("j-M")+"</div>";if(this.showTaskcount){tmptasks=this.getCountTask(z,this.calx.store);if(tmptasks>0){w+='<div class="tasks" style="'+n.styletasks+'">'+e2cs.cal_locale.labelforTasksinMonth+" ("+tmptasks+")</div>";}}else{if(this.showTaskList){var t=this.getTaskList(z,this.calx.store);if(t!=""){w+='<div class="tasks_list" id="'+this.calx.id+"-tasklist-"+z.format("m/d/Y")+'" style="height:5px;'+n.styletasks+'">';w+=t;w+="</div>";}}}w+="</td>";}}w+="</tr>";return w;},getCountTask:function(k,l){var i=l.getCount();if(i>0){var j=0;for(var h=0;h<i;h++){dateinit=l.getAt(h).data[this.calx.fieldsRefer.startdate];dateend=l.getAt(h).data[this.calx.fieldsRefer.enddate];checkdates=k.between(new Date(dateinit),new Date(dateend));chkformat=k.format("m/d/Y");test=new Date(dateinit);if(test.format("m/d/Y")==chkformat){checkdates=true;}test=new Date(dateend);if(test.format("m/d/Y")==chkformat){checkdates=true;}var m=new Date(dateinit);var n=new Date(dateend);if(m<k&&n>k){checkdates=true;}if(checkdates){j+=1;}}return j;}else{return 0;}},getTaskList:function(C,v){var p="";var z=v.getCount();if(z>0){var x=0;for(var D=0;D<z;D++){dateinit=v.getAt(D).data[this.calx.fieldsRefer.startdate];dateend=v.getAt(D).data[this.calx.fieldsRefer.enddate];checkdates=C.between(new Date(dateinit),new Date(dateend));chkformat=C.format("m/d/Y");test=new Date(dateinit);if(test.format("m/d/Y")==chkformat){checkdates=true;}test=new Date(dateend);if(test.format("m/d/Y")==chkformat){checkdates=true;}var w=new Date(dateinit);var A=new Date(dateend);if(w<C&&A>C){checkdates=true;}if(checkdates){if(x<this.showNumTasks){var q=new Date(v.getAt(D).data[this.calx.fieldsRefer.startdate]);var B=q.format(this.task_format);tmpdateb=new Date(v.getAt(D).data[this.calx.fieldsRefer.enddate]);var r=tmpdateb.format(this.task_format);var t=v.getAt(D).data[this.calx.fieldsRefer.description];var u=t;if(t.length>this.calx.tipmaxLength){var u=t.substring(0,this.calx.tipmaxLength)+"...";}p+='<div class="tasks_list_item"';p+='style="background-color:'+v.getAt(D).data[this.calx.fieldsRefer.color]+'" ';p+='id="'+this.calx.id+"-mtask-item-"+chkformat+"-"+v.getAt(D).data[this.calx.fieldsRefer.id]+'" ';p+='ec_id="'+v.getAt(D).data[this.calx.fieldsRefer.id]+'" ';p+='ec_starts="'+B+'" ';p+='ec_ends="'+r+'" ';p+='ec_subject="'+v.getAt(D).data[this.calx.fieldsRefer.subject]+'" ';p+='ec_cnt="'+u+'" ';p+='ec_storeindex="'+D+'" ';p+='ec_location="'+v.getAt(D).data[this.calx.fieldsRefer.location]+'" ';p+='ec_allday="'+v.getAt(D).data[this.calx.fieldsRefer.alldaytask]+'" ';p+='ec_isholiday="'+v.getAt(D).data[this.calx.fieldsRefer.isHoliday]+'" ';p+=' ext:qtitle="'+v.getAt(D).data[this.calx.fieldsRefer.subject]+'" ';var y={starxl:e2cs.cal_locale.task_qtip_starts,startval:B,endxl:e2cs.cal_locale.task_qtip_ends,endval:r,details:u,color:v.getAt(D).data[this.calx.fieldsRefer.color],location:v.getAt(D).data[this.calx.fieldsRefer.location]};var s=this.calx.tplTaskTip.apply(y);p+='ext:qtip="'+s+'">';p+=v.getAt(D).data[this.calx.fieldsRefer.subject]+"</div>";x+=1;}}}return p;}else{return 0;}},getTaskarray:function(e){var f=Ext.get(e);var d=[];d[0]=f.getAttributeNS("tag","id");d[1]=f.getAttributeNS("tag","ec_id");d[2]=f.getAttributeNS("tag","ec_subject");d[3]=f.getAttributeNS("tag","ec_starts");d[4]=f.getAttributeNS("tag","ec_ends");d[5]=f.getAttributeNS("tag","ec_cnt");d[6]=f.getAttributeNS("tag","ec_storeindex");d[7]=f.getAttributeNS("tag","ec_location");d[8]=f.getAttributeNS("tag","ec_allday");d[9]=f.getAttributeNS("tag","ec_isholiday");return d;}});