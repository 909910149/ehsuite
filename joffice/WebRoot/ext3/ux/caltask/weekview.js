Ext.ECalendar.weekview=function(b){Ext.apply(this,b);this.addEvents("dblClickTaskAllDay","beforeWeekChange","afterWeekChange","launchEventList");Ext.ECalendar.weekview.superclass.constructor.call(this);};Ext.extend(Ext.ECalendar.weekview,Ext.util.Observable,{referid:"weekview",header:true,headerButtons:true,headerFormat:"W",headerShowDates:true,dayformatLabel:"D j",scrolltoHour:false,hourFormat:"G:i",startTime:"00:00:00 am",endTime:"11:59:59 pm",style:"google",alldayTaksMore:"window",alldayTaskTPL:new Ext.XTemplate('<tpl for="."><div class="ecal-show-basetasktpl-div">Event:{subject}<br>Location:{location}',"Starts:{startdate}<br>Ends:{enddate}<br>Description:<br>{description}<div><hr></tpl>"),alldayTasksMaxView:3,alldayTasks:[],weekTasks:[],store:null,headerDayClick:"none",currentweek:1,task_format:"Y-m-d H:i:s",task_bgcolor_base:"#E0FFA2",task_showqtip:true,task_width:50,tasksOffset:20,taskelements:0,ShowMenuItems:[1,1,1,1,1,1],task_ShowMenuItems:[1,1,1,1,1],moreMenuItems:[],task_eventLaunch:"click",taskAdd_timer_dblclick:false,scrolltoHour:false,allday24HinsideBody:false,task_clsOver:"",forceTaskFit:false,startDay:1,customHTMLinpos:"before",headerUseTpl:false,headerTpl:new Ext.XTemplate('<tpl for=".">{title}-from {initday:this.formatx} to {enday:this.formatx}</tpl>',{formatx:function(b){return b.format("m-d-y");}}),headerData:{title:"Custom header for Week",initday:new Date(),enday:new Date()},init:function(c,d){this.calx=c;this.datetohandle=d;},refreshView:function(){this.render();},render:function(){this.datetohandle=this.calx.currentdate;var ae=this.getDatesforWeek(this.datetohandle);var av=Ext.get(this.calx.body);var aI=av.dom.childNodes.length;if(aI){for(var X=aI;X<aI;X++){av.dom.removeChild(av.dom.childNodes[0]);}}av.update("");var av=Ext.get(this.calx.body);var aB='<div id="'+this.calx.id+'-main-calendar-header"></div>';aB+='<div id="'+this.calx.id+'-main-calendar-week-body"></div>';av.update(aB);if(this.header){var aF=this.datetohandle;var ax=Ext.get(this.calx.id+"-main-calendar-header");var aJ=ax;var af=aJ.wrap({tag:"div",cls:"x-calendar-weekv-header",html:""});if(this.headerButtons){var az=af.createChild({id:this.calx.id+"-btn-pw",tag:"div",cls:"x-calendar-week-previous",html:""});var ad=af.createChild({id:this.calx.id+"-btn-nw",tag:"div",cls:"x-calendar-week-next",html:""});az.dom["qtip"]=e2cs.cal_locale.headerTooltipsWeek.prev;az.addListener("click",function(){this.onclickprev_week();},this);az.addClassOnOver("x-calendar-week-previous-over");ad.dom["qtip"]=e2cs.cal_locale.headerTooltipsWeek.next;ad.addListener("click",function(){this.onclicknext_week();},this);ad.addClassOnOver("x-calendar-week-next-over");}if(this.headerUseTpl){var U=this.headerTpl.apply(this.headerData);var at=af.createChild({tag:"div",id:this.calx.id+"-sub-"+"header",html:""+U+""});}else{complementtext="";if(this.headerShowDates){complementtext=' <span class="x-calendar-weekv-header-small">'+e2cs.cal_locale.weekheaderlabel_from+ae[0].format("d/m/Y")+e2cs.cal_locale.weekheaderlabel_to+ae[1].format("d/m/Y")+"</span>";}if(ae[0].format(this.headerFormat)==ae[1].format(this.headerFormat)){var aE=e2cs.cal_locale.weekheaderlabel+aF.format(this.headerFormat);}else{var aE=e2cs.cal_locale.weekheaderlabel+ae[0].format(this.headerFormat)+" - "+ae[1].format(this.headerFormat);}var at=af.createChild({tag:"div",id:this.calx.id+"-sub-"+"header",html:""+aE+complementtext+""});}}var aK=Ext.get(this.calx.id+"-main-calendar-week-body");var an=aK.createChild({tag:"div",id:this.calx.id+"-weekvbody",cls:"x-calendar-weekv-body",html:""});var ae=this.getDatesforWeek(this.datetohandle);if(this.style=="plain"){daysintro=this.genDaysHeader(ae[0]);an.insertHtml("beforeEnd",daysintro,false);}else{daysintro=this.genAlldayContainer(ae[0]);an.insertHtml("beforeEnd",daysintro,false);var ah=Ext.get(this.calx.id+"-allday1");var aa=Ext.get(this.calx.id+"-alldaycontainer");var ab=Ext.get("alldayrefer");aa.setXY(ah.getXY());aa.setHeight(ah.getHeight(true));ancho=0;for(var X=1;X<8;X++){ancho+=Ext.get(this.calx.id+"-allday"+X).getWidth(false);}if(Ext.isIE){ancho+=7;}else{ancho+=5;}aa.setWidth(ancho,false);var ac=Ext.get("alldaylistbutton");var au=this.getWeekTasks(this.datetohandle,0);if(aa.dom.childNodes.length==1&&aa.dom.childNodes[0].childNodes.length==0){ac.setDisplayed("none");}else{if(au.length>this.alldayTasksMaxView){ac.setDisplayed("block");}else{ac.setDisplayed("none");}}ac.addClassOnOver("alldaylistover");ac.addListener("click",function(){this.showMoreTasksList();},this);}var aq=this.genBody(ae[0]);an.insertHtml("beforeEnd",aq,false);for(var X=1;X<8;X++){var Y=Ext.get(this.calx.id+"-day"+X);Y.setHeight(Ext.get(this.calx.id+"-wd"+X).getHeight(true));var W=Ext.get(Y.dom.childNodes[0]);W.setHeight(Ext.get(this.calx.id+"-wd"+X).getHeight(false));if(Ext.isOpera){W.addListener("mousedown",this.operabuttons_body,this);}else{W.addListener("contextmenu",this.oncontextmenu_bodyday,this,{stopPropagation:false,normalized:true,preventDefault:true});}}var am=Ext.get(this.calx.id+"-weekbodydisplay");if(Ext.isIE){am.setStyle({position:"relative"});}if(this.calx.ownerCt!=undefined){if(this.calx.ownerCt.ctype&&this.calx.ownerCt.ctype=="Ext.Component"){this.calx.height=this.calx.ownerCt.getInnerHeight();}}if(!this.calx.height||this.calx.height=="undefined"){if(this.calx.getEl().dom.offsetParent!=null){var ay=this.calx.getEl().dom.offsetParent.clientHeight;}else{var ay=0;}}else{var ay=this.calx.height;}if(ay==0){ay=300;}styleheaderheight=0;if(this.style=="plain"){styleheaderheight=Ext.get(this.calx.id+"-allday_w_task").getHeight(true)+8;}else{styleheaderheight=Ext.get(this.calx.id+"-allday_w_task").getHeight(true)+8;styleheaderheight+=Ext.get("alldaylistbutton").getHeight(true);}if(this.header){ay+=-24;}if(this.calx.showCal_tbar){ay+=-26;}if(this.calx.header){ay+=-26;}var ak=0;am.setStyle({height:""+(ay-styleheaderheight)-ak+"px"});am.setStyle({overflow:"auto"});if(Ext.isIE||Ext.isIE6){Ext.get(this.calx.id+"-tableweek-layout").setWidth(Ext.get(this.calx.id+"-tableweek-layout").getWidth()-16,false);Ext.get(this.calx.id+"-tableweek-layout").setStyle({position:"relative"});}var aD=Ext.get(this.calx.id+"-weekbodydisplay").getHeight(true);var aG=Ext.get(this.calx.id+"-week-skeleton").getHeight(true);if(aG>aD){if(this.style=="plain"){var i=Ext.get(this.calx.id+"-alldaygridbodylayout");var ap=Ext.get(this.calx.id+"-tableallcontainer");for(var X=1;X<8;X++){Ext.get(this.calx.id+"-weekhdrday-"+X).setWidth(Ext.get(this.calx.id+"-wd"+X).getWidth(false),false);}ancho=i.getWidth(false);if(Ext.isIE||Ext.isIE6){i.setWidth((i.getWidth()-17),false);}else{i.setWidth((ancho-19),false);}}else{var i=Ext.get(this.calx.id+"-alldaygridbodylayout");var ap=Ext.get(this.calx.id+"-tableallcontainer");ancho=0;for(var X=1;X<8;X++){ancho+=Ext.get(this.calx.id+"-allday"+X).getWidth(false);}if(Ext.isIE){ancho+=7;}else{ancho+=4;}aa.setWidth(ancho,false);ancho=i.getWidth(false);if(Ext.isIE||Ext.isIE6){i.setWidth((i.getWidth()-19),true);aa.setWidth(aa.getWidth()-19,true);}else{i.setWidth((ancho-18),false);aa.setWidth(aa.getWidth()-18,false);}}}if(this.style=="plain"){}else{var ac=Ext.get("alldaylistbutton");if(aa.dom.childNodes[0].childNodes.length==0&&aa.dom.childNodes[0].childNodes.length==0){}else{if(aa.dom.childNodes.length<this.alldayTasksMaxView){allcounterproc=aa.dom.childNodes.length;}else{allcounterproc=this.alldayTasksMaxView;}for(var X=0;X<allcounterproc;X++){alldaytasktmp=Ext.get(aa.dom.childNodes[X]);this.formatallDayTask(alldaytasktmp);if(this.task_eventLaunch!=""){alldaytasktmp.addListener(this.task_eventLaunch,this.onDblclick,this);}if(Ext.isOpera){alldaytasktmp.addListener("mousedown",this.operadaybuttons,this);}else{alldaytasktmp.addListener("contextmenu",this.oncontextmenu,this,{stopPropagation:false,normalized:true,preventDefault:true});}}}}this.snapweek=[];for(var X=1;X<8;X++){var aH=new Date(ae[0].add(Date.DAY,(X-1)));var ao=Ext.get(Ext.get(this.calx.id+"-day"+X).dom.childNodes[0]);var ai=ao.dom.childNodes;tmpcalc=(this.task_width*ai);if(tmpcalc>ao.getWidth(false)){}if(ai.length==1&&ai[0].childNodes.length==0){}else{var aj=ai.length;for(var Z=0;Z<aj;Z++){var V=Ext.get(ai[Z]);if(Ext.isOpera){V.addClass("taskondayopera");}else{V.addClass("taskonday");}checkel=V.id.indexOf(this.calx.id+"-ecal-daytask",0);if(checkel<0){}else{if(this.task_eventLaunch!=""){V.addListener(this.task_eventLaunch,this.onDblclickSingleday,this);}if(this.task_clsOver!=""){V.addClassOnOver(this.task_clsOver);}if(Ext.isOpera){V.addListener("mousedown",this.operadaybuttons,this);}else{V.addListener("contextmenu",this.oncontextmenu,this,{stopPropagation:false,normalized:true,preventDefault:true});}this.formatdayTask(aH,X,V,Z);}}}}if(this.headerDayClick=="viewday"){var al=Ext.select("td.x-calendar-weekv-header-days",true);al.each(function(a,c,b){if(a.id.indexOf(this.calx.id+"-weekhdrday-")>=0){a.addClassOnOver("overwday");a.addListener("click",this.onWeekHeaderdayClick,this);}},this);}if(this.taskAdd_timer_dblclick){if(Ext.isIE){var j=Ext.select("td.hour-marker_ie",true);}else{var j=Ext.select("td.hour-marker",true);}var ar=this.datetohandle;var aA=this.calx;j.each(function(a,c,b){if(a.id.indexOf(aA.id+"-tdbody-weekv-")+1>=1){a.addListener("dblclick",function(h,g,k){if(g.id.indexOf(aA.id+"-tdbody-weekv-")<0){var e=Ext.get(g).parent().id.replace(aA.id+"-tdbody-weekv-","");}else{var e=g.id.replace(aA.id+"-tdbody-weekv-","");}var f=new Date(e);var d=new Date(ar.format("m/d/Y")+" "+f.format("G:i"));aA.fireEvent("taskAdd",d);});}},this);}var aw=Ext.get(this.calx.id+"-weekbodydisplay");aw.dom.scrollTop=0;if(this.scrolltoHour){var ag=0;if(Ext.isIE){var j=Ext.select("td.hour-marker_ie",true);}else{var j=Ext.select("td.hour-marker",true);}j.each(function(a,c,b){if(a.id.indexOf(aA.id+"-tdbody-weekv-")+1>=1){var d=this.datetohandle.format("G:i");if(d=="00:00"||d=="0:00"){d=new Date().format("G:1");}if(a.id.indexOf(d)+1>=1){ag=Ext.get(a).getY();return false;}}},this);if(ag>0){ag=ag-aw.getY();aw.dom.scrollTop=ag;}}am.setStyle({height:""+(ay-styleheaderheight)-ak+"px"});for(var X=0;X<7;X++){var aD=1;if(X>0){aD=2;}else{aD=0;}var aC=Ext.get(this.calx.id+"-allday"+(X+1));aC.setWidth(Ext.get(this.calx.id+"-wd"+(X+1)).getWidth());}},onWeekHeaderdayClick:function(k,i,l){if(i.className.indexOf("x-calendar-weekv-header-days")<0){return false;}var h=Ext.get(i);var j=h.getAttributeNS("tag","dayval");var g=new Date(j);if(this.headerDayClick=="viewday"){if(this.calx.fireEvent("beforeChangeView","day","week",this.calx)==false){return false;}else{this.calx.currentdate=g;this.calx.selector_dateMenu.picker.setValue(this.calx.currentdate);this.calx.currentView="day";this.calx.viewday.render();this.calx.fireEvent("onChangeView","day","week",this);}}else{return false;}},onDblclickSingleday:function(j,h,f){var i=Ext.get(h.id);var g=this.getTaskarray(h);this.calx.fireEvent("taskDblClick",g,this,this.calx,"week");},onDblclick:function(j,h,f){var i=Ext.get(h.id);var g=this.getTaskarray(h);this.calx.fireEvent("taskDblClick",g,this,this.calx,"week");},operabuttons_body:function(d,f,e){if(Ext.isOpera){if(d.button==2){this.oncontextmenu_bodyday(d,f,e);}}},operabuttons:function(d,f,e){if(Ext.isOpera){if(d.button==2){this.oncontextmenu(d,f,e);}}},oncontextmenu_bodyday:function(m,q,l){if(Ext.isOpera){if(m.button!=2){return false;}}if(q.id.indexOf("containeronday")<0){return false;}if(this.ShowMenuItems[0]!=true&&this.ShowMenuItems[1]!=true&&this.ShowMenuItems[2]!=true&&this.ShowMenuItems[3]!=true&&this.ShowMenuItems[4]!=true&&this.ShowMenuItems[5]!=true){return false;}if(Ext.isIE){k=Ext.get(q.parentNode);var p=k.getAttributeNS("tag","iddate");}else{var k=q.parentNode;var p=q.parentNode.attributes[1].nodeValue;}m.stopEvent();var r=Ext.get(q.id);if(this.menu){this.menu.removeAll();}this.menu=new Ext.menu.Menu({shadow:true,items:[{id:"week_ctxbtn_task-add",iconCls:"x-calendar-day-btnmv_add",text:e2cs.cal_locale.contextMenuLabelsDay.taskAdd,scope:this},"-",{id:"week_ctxbtn_task-go-nd",iconCls:"x-calendar-week-btnmv_nextweek",text:e2cs.cal_locale.contextMenuLabelsWeek.next,scope:this},{id:"week_ctxbtn_task-go-pd",iconCls:"x-calendar-week-btnmv_prevweek",text:e2cs.cal_locale.contextMenuLabelsWeek.prev,scope:this},"-",{id:"week_ctxbtn_viewmonth",iconCls:"x-calendar-month-btnmv_viewmonth",text:e2cs.cal_locale.contextMenuLabelsWeek.chgmview,scope:this},{id:"week_ctxbtn_viewday",iconCls:"x-calendar-month-btnmv_viewday",text:e2cs.cal_locale.contextMenuLabelsWeek.chgdview,scope:this},{id:"week_ctxbtn_viewsched",iconCls:"x-calendar-month-btnmv_viewsched",text:e2cs.cal_locale.contextMenuLabelsWeek.chgsview,scope:this}]});var j=this.calx;var n=this;var o=q;this.menu.items.items[0].addListener("click",function(){var e=n.getDatesforWeek(new Date(p));var a=o.parentNode.id.replace(j.id+"-day","");var h=parseInt(a)-1;var g=e[0].add(Date.DAY,h);var c;var d=Ext.get(j.id+"-weekbodydisplay").getY();if(Ext.isIE){var f=Ext.select("td.hour-marker_ie",true);}else{var f=Ext.select("td.hour-marker",true);}f.each(function(i,G,C){if(i.id.indexOf(j.id+"-tdbody-weekv-")+1>=1){var F=Ext.get(i).getY();var B=Ext.get(i).getHeight();var D=m.getPageY();if(D>=F&&D<=(F+B)){if(i.id.indexOf(j.id+"-tdbody-weekv-")<0){var H=Ext.get(i).parent().id.replace(j.id+"-tdbody-weekv-","");}else{var H=i.id.replace(j.id+"-tdbody-weekv-","");}var E=H.toUpperCase();if(n.hourFormat=="H"||n.hourFormat=="G"){E=E.replace("AM","");E=E.replace("PM","");}else{if(n.hourFormat=="h"||n.hourFormat=="g"){var A=11;}}c=new Date(E);return false;}else{return true;}}},this);var b=new Date(g.format("m/d/Y")+" "+c.format("H:i:s"));this.calx.fireEvent("taskAdd",b);},this);this.menu.items.items[2].addListener("click",function(){this.onclicknext_week();},this);this.menu.items.items[3].addListener("click",function(){this.onclickprev_week();},this);this.menu.items.items[5].addListener("click",function(){this.changeCalview(k,this,1);},this);this.menu.items.items[6].addListener("click",function(){this.changeCalview(k,this,2);},this);this.menu.items.items[7].addListener("click",function(){this.changeCalview(k,this,3);},this);if(this.ShowMenuItems[0]!=true){this.menu.items.items[0].hidden=true;this.menu.items.items[1].hidden=true;}if(this.ShowMenuItems[1]!=true&&this.ShowMenuItems[2]!=true&this.ShowMenuItems[3]!=true&&this.ShowMenuItems[4]!=true&&this.ShowMenuItems[5]!=true){this.menu.items.items[1].hidden=true;}if(this.ShowMenuItems[1]!=true){this.menu.items.items[2].hidden=true;}if(this.ShowMenuItems[2]!=true){this.menu.items.items[3].hidden=true;}if(this.ShowMenuItems[1]!=true&&this.ShowMenuItems[2]!=true){this.menu.items.items[4].hidden=true;}if(this.ShowMenuItems[3]!=true){this.menu.items.items[5].hidden=true;}if(this.ShowMenuItems[4]!=true){this.menu.items.items[6].hidden=true;}if(this.ShowMenuItems[5]!=true){this.menu.items.items[7].hidden=true;}if(!this.calx.mview){this.menu.items.items[6].hidden=true;}if(!this.calx.dview){this.menu.items.items[5].hidden=true;}if(!this.calx.sview){this.menu.items.items[7].hidden=true;}this.menu.showAt([m.getPageX(),m.getPageY()]);},changeCalview:function(h,g,e){if(Ext.isIE){var f=h.getAttributeNS("tag","iddate");}else{var f=h.attributes[1].nodeValue;}this.calx.currentdate=new Date(f);this.calx.selector_dateMenu.picker.setValue(this.calx.currentdate);if(e==1){varview="month";}else{if(e==2){varview="day";}else{varview="schedule";}}this.calx.changeView(varview);},oncontextmenu:function(n,s,m){if(Ext.isOpera){if(n.button!=2){return false;}}if(this.task_ShowMenuItems[0]!=true&&this.task_ShowMenuItems[1]!=true&&this.task_ShowMenuItems[2]!=true&&this.task_ShowMenuItems[3]!=true&&this.task_ShowMenuItems[4]!=true&&this.moreMenuItems.length<=0){return false;}n.stopEvent();if(s.id.indexOf(this.calx.id+"-ecal-daytask-")<0){if(s.id.indexOf(this.calx.id+"-ecal-alldaytask-")<0){var v=Ext.get(s.parentNode.id);}else{var v=Ext.get(s.id);}}else{var v=Ext.get(s.id);}var i=this.task_ShowMenuItems;var u=this.moreMenuItems;var q=[];var o=this.getTaskarray(v);var t=this.calx.fireEvent("beforeContextMenuTask","weekview-task",o,i,q);if(t==false){if(q[0]==false){if(q[1]==true){if(q[2]==true){var u=q[3];}var i=q[4];}else{var u=this.moreMenuItems;var i=this.task_ShowMenuItems;}}else{return false;}}else{var u=this.moreMenuItems;}if(this.menu){this.menu.removeAll();}this.menu=new Ext.menu.Menu({shadow:true,items:[{id:"week_ctxbtn_task-add",iconCls:"x-calendar-day-btnmv_add",text:e2cs.cal_locale.contextMenuLabelsDay.taskAdd,scope:this},{id:"week_ctxbtn_task-delete",iconCls:"x-calendar-day-btnmv_delete",text:e2cs.cal_locale.contextMenuLabelsDay.taskDelete,scope:this},"-",{id:"week_ctxbtn_task-edit",iconCls:"x-calendar-day-btnmv_task",text:e2cs.cal_locale.contextMenuLabelsDay.taskEdit+v.getAttributeNS("tag","ec_subject"),scope:this},"-",{id:"week_ctxbtn_task-go-nw",iconCls:"x-calendar-week-btnmv_nextweek",text:e2cs.cal_locale.contextMenuLabelsWeek.next,scope:this},{id:"week_ctxbtn_task-go-pw",iconCls:"x-calendar-week-btnmv_prevweek",text:e2cs.cal_locale.contextMenuLabelsWeek.prev,scope:this}]});if(u.length>0){this.menu.add("-");for(var r=0;r<u.length;r++){u[r].rendered=false;if(u[r].menu==undefined){if(u[r].ctype=="Ext.menu.Item"){u[r].addListener("click",function(a,b){this.onCustomMenuAction(a.id,Ext.get(s),this);},this);}else{}this.menu.add(u[r]);}else{for(var p=0;p<u[r].menu.items.length;p++){u[r].menu.items.items[p].rendered=false;if(u[r].menu.items.items[p].ctype=="Ext.menu.Item"){u[r].menu.items.items[p].addListener("click",function(a,b){this.onCustomMenuAction(a.id,Ext.get(s),this);},this);}else{}}this.menu.add(u[r]);}}}this.menu.items.items[0].addListener("click",function(){this.onActionTask(1,Ext.get(s),this);},this);this.menu.items.items[1].addListener("click",function(){this.onActionTask(2,Ext.get(s),this);},this);this.menu.items.items[3].addListener("click",function(){this.onActionTask(3,Ext.get(s),this);},this);this.menu.items.items[5].addListener("click",function(){this.onclicknext_week();},this);this.menu.items.items[6].addListener("click",function(){this.onclickprev_week();},this);if(i[0]!=true){this.menu.items.items[0].hidden=true;}if(i[1]!=true){this.menu.items.items[1].hidden=true;}if(i[0]!=true&&i[1]!=true){this.menu.items.items[2].hidden=true;}if(i[2]!=true&&i[3]!=true&&i[4]!=true&&u.length<=0){this.menu.items.items[2].hidden=true;}if(i[2]!=true){this.menu.items.items[3].hidden=true;this.menu.items.items[4].hidden=true;}if(i[3]!=true&&i[4]!=true&&u.length<=0){this.menu.items.items[4].hidden=true;}if(i[3]!=true){this.menu.items.items[5].hidden=true;}if(i[4]!=true){this.menu.items.items[6].hidden=true;}if(u.length>0){if(i[3]!=true&&i[4]!=true){this.menu.items.items[7].hidden=true;}}this.menu.on("hide",this.onContextTaskMenu_Hide,this);this.menu.showAt(n.xy);},onContextTaskMenu_Hide:function(){},onCustomMenuAction:function(e,g,h){var f=this.getTaskarray(g);this.calx.fireEvent("customMenuAction",e,"week",f,g,this);this.menu.hide();},onActionTask:function(l,i,j){var g=this.getTaskarray(i);switch(l){case 1:if(i.id.indexOf(this.calx.id+"-ecal-alldaytask")>=0){this.calx.fireEvent("taskAdd",this.calx.currentdate);}else{if(Ext.isIE){testxxx=Ext.get(i.dom.parentNode.parentNode);var k=new Date(testxxx.getAttributeNS("tag","iddate"));}else{var k=new Date(i.dom.parentNode.parentNode.attributes[1].nodeValue);}this.calx.fireEvent("taskAdd",k);}break;case 2:var h=this.calx.fireEvent("beforeTaskDelete",g,this);if(h){if(this.calx.fireEvent("onTaskDelete",g)==true){this.calx.fireEvent("afterTaskDelete",g,true);}else{this.calx.fireEvent("afterTaskDelete",null,false);}}break;case 3:var h=this.calx.fireEvent("beforeTaskEdit",g,this);if(h){if(this.calx.fireEvent("onTaskEdit",g)==true){this.calx.fireEvent("afterTaskEdit",g,true);}else{this.calx.fireEvent("afterTaskEdit",null,false);}}break;default:break;}},getTaskarray:function(e){var f=Ext.get(e);var d=[];d[0]=f.getAttributeNS("tag","id");d[1]=f.getAttributeNS("tag","ec_id");d[2]=f.getAttributeNS("tag","ec_subject");d[3]=f.getAttributeNS("tag","ec_starts");d[4]=f.getAttributeNS("tag","ec_ends");d[5]=f.getAttributeNS("tag","ec_cnt");d[6]=f.getAttributeNS("tag","ec_storeindex");d[7]=f.getAttributeNS("tag","ec_location");d[8]=f.getAttributeNS("tag","ec_allday");d[9]=f.getAttributeNS("tag","ec_isholiday");return d;},getDatesforWeek:function(h){var e=new Date(h).getDay();if(this.startDay==1){e=((e==0)?6:e-1);var g=new Date(h.add(Date.DAY,-e).format("m/d/Y")+" "+this.startTime);var f=new Date(h.add(Date.DAY,-e+6).format("m/d/Y")+" "+this.endTime);}else{if(this.startDay==0){if(e==0){var g=new Date(h.add(Date.DAY,0).format("m/d/Y")+" "+this.startTime);var f=new Date(h.add(Date.DAY,6).format("m/d/Y")+" "+this.endTime);}else{var g=new Date(h.add(Date.DAY,-(e)).format("m/d/Y")+" "+this.startTime);var f=new Date(g.add(Date.DAY,6).format("m/d/Y")+" "+this.endTime);}}else{if(e==6){var g=new Date(h.add(Date.DAY,0).format("m/d/Y")+" "+this.startTime);var f=new Date(h.add(Date.DAY,6).format("m/d/Y")+" "+this.endTime);}else{var g=new Date(h.add(Date.DAY,-(e+1)).format("m/d/Y")+" "+this.startTime);var f=new Date(g.add(Date.DAY,6).format("m/d/Y")+" "+this.endTime);}}}return[g,f];},getWeekTasks:function(w,F){var D=this.getDatesforWeek(this.datetohandle);var G=[];switch(F){case 0:var i=this.calx.store.getCount();var y=0;var t=new Date(w.format("m/d/Y")+" "+this.startTime);var v=new Date(w.format("m/d/Y")+" "+this.endTime);var u=this.calx.dateDiff(t,v,e2cs.dateParts.MINUTE);for(var x=0;x<i;x++){var H=this.calx.store.getAt(x).data;tstdateini=new Date(H[this.calx.fieldsRefer.startdate]);tstdateend=new Date(H[this.calx.fieldsRefer.enddate]);if(H[this.calx.fieldsRefer.alldaytask]){if(tstdateini.between(D[0],D[1])||tstdateend.between(D[0],D[1])){G[y]=H;y+=1;}}else{var z=this.calx.dateDiff(tstdateini,tstdateend,e2cs.dateParts.MINUTE);if(z>=u){if(this.allday24HinsideBody==true&&z==u){if(tstdateini<D[0]&&tstdateend>D[1]){var A=tstdateend.add(Date.SECOND,-1);if(tstdateini.format("m/d/Y")==A.format("m/d/Y")){}else{G[y]=H;y+=1;}}else{if(tstdateini.between(D[0],D[1])||tstdateend.between(D[0],D[1])){var A=tstdateend.add(Date.SECOND,-1);if(tstdateini.format("m/d/Y")==A.format("m/d/Y")){}else{G[y]=H;y+=1;}}}}else{if(tstdateini<D[0]&&tstdateend>D[1]){G[y]=H;y+=1;}else{if(tstdateini.between(D[0],D[1])||tstdateend.between(D[0],D[1])){G[y]=H;y+=1;}}}}else{}}}break;case 1:var s=new Date(w.format("m/d/Y")+" "+this.startTime);var B=new Date(w.format("m/d/Y")+" "+this.endTime);var i=this.calx.store.getCount();var y=0;var u=this.calx.dateDiff(s,B,e2cs.dateParts.MINUTE);for(var x=0;x<i;x++){var H=this.calx.store.getAt(x).data;tstdateini=new Date(H[this.calx.fieldsRefer.startdate]);tstdateend=new Date(H[this.calx.fieldsRefer.enddate]);var z=this.calx.dateDiff(tstdateini,tstdateend,e2cs.dateParts.MINUTE);if(tstdateini<s&&tstdateend>B){}else{if(tstdateini.format("m/d/Y")==s.format("m/d/Y")&&z<u){if(tstdateini.between(s,B)||tstdateend.between(s,B)){if(H[this.calx.fieldsRefer.alldaytask]!=true){G[y]=H;y+=1;}}}else{if(tstdateend.format("m/d/Y")==s.format("m/d/Y")&&z<u){if(tstdateini.between(s,B)||tstdateend.between(s,B)){if(H[this.calx.fieldsRefer.alldaytask]!=true){G[y]=H;y+=1;}}}else{if(tstdateini.format("m/d/Y")==w.format("m/d/Y")){var A=tstdateend.add(Date.SECOND,-1);if(tstdateini.format("m/d/Y")==A.format("m/d/Y")){var C=this.calx.dateDiff(tstdateini,tstdateend,e2cs.dateParts.MINUTE);if(u==C){if(this.allday24HinsideBody==true){G[y]=H;y+=1;}}}}}}}}break;case 2:var s=new Date(w.format("m/d/Y")+" "+this.startTime);var B=new Date(w.format("m/d/Y")+" "+this.endTime);var i=this.calx.store.getCount();var y=0;for(var x=0;x<i;x++){var H=this.calx.store.getAt(x).data;tstdateini=new Date(H[this.calx.fieldsRefer.startdate]);tstdateend=new Date(H[this.calx.fieldsRefer.enddate]);checkdates=this.datetohandle.between(new Date(tstdateini),new Date(tstdateend));chkformat=this.datetohandle.format("m/d/Y");test=new Date(dateinit);if(test.format("m/d/Y")==chkformat){checkdates=true;}test=new Date(dateend);if(test.format("m/d/Y")==chkformat){checkdates=true;}var E=this.calx.dateDiff(tstdateini,tstdateend,e2cs.dateParts.DAY);if(E<1){if(tstdateini.between(s,B)&&tstdateend.between(s,B)){G[y]=H;y+=1;}}else{if(E>=1){if(tstdateini<s&&tstdateend>B){G[y]=H;y+=1;}else{if(tstdateini.between(s,B)||tstdateend.between(s,B)){G[y]=H;y+=1;}}}}}break;default:G=[];break;}return G;},showMoreTasksList:function(){taskstmp=this.getWeekTasks(this.datetohandle,0);showdata=[];for(var d=0;d<taskstmp.length;d++){showdata[d]=[taskstmp[d][this.calx.fieldsRefer.id],taskstmp[d][this.calx.fieldsRefer.subject],taskstmp[d][this.calx.fieldsRefer.description],taskstmp[d][this.calx.fieldsRefer.startdate],taskstmp[d][this.calx.fieldsRefer.enddate],taskstmp[d][this.calx.fieldsRefer.color],taskstmp[d][this.calx.fieldsRefer.location],taskstmp[d][this.calx.fieldsRefer.isHoliday],taskstmp[d][this.calx.fieldsRefer.alldaytask]];}if(this.alldayTaksMore=="event"){this.fireEvent("launchEventList",showdata[d]);return false;}else{if(this.alldayTaksMore=="window"){var e=new Ext.data.ArrayReader({},[{name:this.calx.fieldsRefer.id,type:"int"},{name:this.calx.fieldsRefer.subject,type:"string"},{name:this.calx.fieldsRefer.description,type:"string"},{name:this.calx.fieldsRefer.startdate,type:"string"},{name:this.calx.fieldsRefer.enddate,type:"string"},{name:this.calx.fieldsRefer.color,type:"string"},{name:this.calx.fieldsRefer.location,type:"string"},{name:this.calx.fieldsRefer.isHoliday,type:"boolean"},{name:this.calx.fieldsRefer.alldaytask,type:"boolean"}]);tmpstore=new Ext.data.Store({reader:e,data:showdata});tmppanel=new Ext.Panel({id:"ecal-more-task-panel",header:false,autoDestroy:true,autoScroll:true,monitorResize:true,border:false,autoWidth:false,autoHeight:false,items:new Ext.DataView({loadingText:e2cs.cal_locale.win_tasks_loading,store:tmpstore,tpl:this.alldayTaskTPL,autoWidth:true,autoHeight:true,overClass:"",itemSelector:"",emptyText:e2cs.cal_locale.win_tasks_empty})});var f=new Ext.Window({id:"ecal-win-moretasks",name:"ecal-win-moretasks",title:e2cs.cal_locale.win_week_zoomlabel,width:450,height:300,closeAction:"close",resizable:true,resizeHandles:"all",hideBorders:true,maximizable:true,plain:true,modal:true,layout:"fit",iconCls:"x-calendar-more-tasks-win",items:[tmppanel]});f.show();}}},formatdayTask:function(x,v,E,t){if(this.style=="plain"){var y=this.getWeekTasks(x,2);}else{var y=this.getWeekTasks(x,1);}var r=y.length;var G=Ext.get(this.calx.id+"-day"+v);var D=x.format("m/d/Y ")+this.startTime;var F=x.format("m/d/Y ")+this.endTime;this.totalhours=this.calx.dateDiff(new Date(D),new Date(F),e2cs.dateParts.HOUR);var z=this.checkTasktime(E.getAttributeNS("tag","ec_starts"));var H=this.checkTasktime(E.getAttributeNS("tag","ec_ends"));var s=this.calx.dateDiff(new Date(D),new Date(z),e2cs.dateParts.MINUTE);if(s<0){initpos=0;flagstarttasttext=e2cs.cal_locale.task_LessDaysFromTask;}else{initpos=s;flagstarttasttext="";}var B=this.calx.dateDiff(new Date(F),new Date(H),e2cs.dateParts.MINUTE);if(B>0){endpos=(this.totalhours+1)*60;endpos=Math.abs(initpos-endpos);flagendtasttext=e2cs.cal_locale.task_MoreDaysFromTask;}else{var u=new Date(z);var w=new Date(x.format("m/d/Y")+" "+this.startTime);if(u<w){endpos=this.calx.dateDiff(new Date(D),new Date(H),e2cs.dateParts.MINUTE);}else{endpos=this.calx.dateDiff(new Date(z),new Date(H),e2cs.dateParts.MINUTE);}if(endpos==(this.totalhours*60)){endpos=endpos;}else{if(endpos>(this.totalhours*60)){endpos=(this.totalhours*60);}}flagendtasttext="";}E.setHeight(endpos,false);if(this.forceTaskFit){var C=98/r;E.setStyle({width:""+C+"%"});E.setStyle({left:""+(C*t)+"%"});}else{E.setWidth(this.task_width,false);if(Ext.isOpera){var A=(t+1)*this.task_width;if(((t+1)*this.task_width)>G.getWidth(false)){E.setStyle("display","none");}if((t+1)>1){E.setLeft("0px");}}else{E.setLeft(""+(t*this.task_width)+"px");}}if(Ext.isOpera){E.setY(G.getY()+initpos);E.setStyle({top:""+initpos+"px"});E.setStyle("float","left");}else{E.setY(G.getY()+initpos);}if(Ext.isIE){E.setStyle("z-index","2000");}else{E.setStyle("z-index","auto");}},checkTasktime:function(e){if(e instanceof Date){var d=e.format("m/d/Y G:i");}else{var d=e;}var f=d.indexOf(":",0);if(f<=0){taskvaluefix=d+" "+this.startTime;}else{taskvaluefix=d;}return taskvaluefix;},getstartdayelements:function(j,f){var g=0;for(var i=0;i<7;i++){var h=j[0].add(Date.DAY,i);if(h.format("m/d/Y")==f.format("m/d/Y")){g=i;break;}}g+=1;return g;},formatallDayTask:function(z){var A=this.getDatesforWeek(this.datetohandle);var B=new Date(z.getAttributeNS("tag","ec_starts"));var y=new Date(z.getAttributeNS("tag","ec_ends"));var t=this.calx.dateDiff(B,y,e2cs.dateParts.DAY);if(t>7){t=7;}var x=new Date(B.format("m/d/Y ")+this.startTime);initdaystart=this.calx.dateDiff(A[0],x,e2cs.dateParts.DAY);if(initdaystart<0){t=this.calx.dateDiff(A[0],y,e2cs.dateParts.DAY);if(t>7){t=7;}initdaystart=0;}var w=Ext.get(this.calx.id+"-alldaycontainer");newposx=0;var q=this.getstartdayelements(A,B);initdaystart+=q;for(var v=1;v<q;v++){if(v>7){break;}newposx+=Ext.get(this.calx.id+"-allday"+(v+1)).getWidth(true);}if(Ext.isIE){z.setX(w.getX()+newposx);}else{z.setX(Ext.get(this.calx.id+"-allday"+q).getX());}ancho=0;if(y>A[1]){var p=0;var u=this.getAnchoalldaytoUse(B,y);var q=this.getstartdayelements(A,B);u+=q;for(var v=q;v<u;v++){if(v>7){break;}ancho+=Ext.get(this.calx.id+"-allday"+(v)).getWidth(false);p+=1;}if(Ext.isIE){p=-1;}z.setWidth(ancho+(p-1),false);}else{var p=0;if(t<=1){var r=new Date(B.format("m/d/Y G:i:s"));var s=new Date(y.format("m/d/Y G:i:s"));var i=new Date(s).add(Date.SECOND,-1);if(B.format("m/d/Y")==i.format("m/d/Y")){ancho+=Ext.get(this.calx.id+"-allday1").getWidth(false);}else{if(B.format("m/d/Y")!=y.format("m/d/Y")){var u=this.getAnchoalldaytoUse(B,y);var q=this.getstartdayelements(A,B);u+=q;for(var v=q;v<u;v++){if(v>7){break;}ancho+=Ext.get(this.calx.id+"-allday"+(v)).getWidth(false);p+=1;}}}}else{var u=this.getAnchoalldaytoUse(B,y);var q=this.getstartdayelements(A,B);u+=q;var p=0;for(var v=q;v<u;v++){if(v>7){break;}ancho+=Ext.get(this.calx.id+"-allday"+(v)).getWidth(false);p+=1;}}if(Ext.isIE){p=p*-1-1;}z.setWidth(ancho+(p-1),false);}},getAnchoalldaytoUse:function(i,j){var k=this.getDatesforWeek(this.datetohandle);count=0;countxx=0;var l=j.format("m/d/Y");if(i<=k[0]){var g=k[0];}else{var g=i;}while(countxx<99999){testdata=new Date(g).add(Date.DAY,count);varprueba=testdata.format("m/d/Y");var h=l;count+=1;if(varprueba==h){break;}countxx+=1;}return count;},onclickprev_week:function(){var c=this.datetohandle.add(Date.DAY,+(-7));var d=this.fireEvent("beforeWeekChange",this.datetohandle,c);if(d){this.datetohandle=c;this.calx.currentdate=c;this.render();this.fireEvent("afterWeekChange",c);}},onclicknext_week:function(){var c=this.datetohandle.add(Date.DAY,+(+7));var d=this.fireEvent("beforeWeekChange",this.datetohandle,c);if(d){this.datetohandle=c;this.calx.currentdate=c;this.render();this.fireEvent("afterWeekChange",c);}},genDaysHeader:function(g){var j="";j='<div id="'+this.calx.id+'-allday_w_task" class="allday_w_task">';j+='<div id="'+this.calx.id+'-alldaygridbodylayout" class="alldaygridbody">';j+='<table width="100%" border="1" cellpadding="0" cellspacing="1" bordercolor="#004E9B" bgcolor="#004E9B"><tr>';j+='<td width="50"><table width="50" border="0" align="center" cellpadding="0" cellspacing="0">';j+='<tr><td width="50" class="allday-marker" id="alldayrefer" ><div class="taskallday-layoutbase">&nbsp;</div>';j+="</td></tr></table></td>";for(var f=0;f<7;f++){var h=g.add(Date.DAY,f).format(this.dayformatLabel);var i=g.add(Date.DAY,f).format("m/d/Y");j+='<td valign="top"  class="x-calendar-weekv-header-days" dayval="'+i+'" id="'+this.calx.id+"-weekhdrday-"+(f+1)+'">'+h+"</td>";}j+="</tr></table></div></div>";return j;},genAlldayContainer:function(r){var t="";t+='<div id="'+this.calx.id+'-alldaycontainer" class="allday-container">';var A=this.getWeekTasks(this.datetohandle,0);if(A.length==0){t+="&nbsp;";}else{if(A.length<=this.alldayTasksMaxView){tasktoshow=A.length;}else{tasktoshow=this.alldayTasksMaxView;}for(var x=0;x<tasktoshow;x++){var j=new Date(A[x][this.calx.fieldsRefer.startdate]);var i=new Date(A[x][this.calx.fieldsRefer.enddate]);var q=A[x][this.calx.fieldsRefer.description];if(q.length>this.calx.tipmaxLength){var s=q.substring(0,this.calx.tipmaxLength)+"...";}else{var s=q;}var y={starxl:e2cs.cal_locale.task_qtip_starts,startval:j.format(this.task_format),endxl:e2cs.cal_locale.task_qtip_ends,endval:i.format(this.task_format),details:s,location:A[x][this.calx.fieldsRefer.location],alldaytask:A[x][this.calx.fieldsRefer.alldaytask],isHoliday:A[x][this.calx.fieldsRefer.isHoliday]};var u=this.calx.tplTaskTip.apply(y);t+='<div id="'+this.calx.id+"-ecal-alldaytask-"+x+'" class="taskallday-taskbase"  style="background-color:'+A[x][this.calx.fieldsRefer.color]+'"';t+='ext:qtitle="'+A[x][this.calx.fieldsRefer.subject]+'" ext:qtip="'+u+'"';t+='ec_id="'+A[x][this.calx.fieldsRefer.id]+'" ec_starts="'+A[x][this.calx.fieldsRefer.startdate]+'"';t+='ec_ends="'+A[x][this.calx.fieldsRefer.enddate]+'" ec_subject="'+A[x][this.calx.fieldsRefer.subject]+'"';t+='ec_cnt="'+A[x][this.calx.fieldsRefer.description]+'" ec_storeindex="'+x+'" ';t+='ec_location="'+A[x][this.calx.fieldsRefer.location]+'" ';t+='ec_allday="'+A[x][this.calx.fieldsRefer.alldaytask]+'" ';t+='ec_isholiday="'+A[x][this.calx.fieldsRefer.isHoliday]+'">';t+=A[x][this.calx.fieldsRefer.subject]+"</div>";}}t+="</div>";t+='<div id="'+this.calx.id+'-allday_w_task" class="allday_w_task">';t+='<div id="'+this.calx.id+'-alldaygridbodylayout" class="alldaygridbody">';t+='<table id="'+this.calx.id+'-tableallcontainer" width="100%" border="0" ';t+='cellpadding="0" cellspacing="1" bordercolor="#004E9B" bgcolor="#004E9B"><tr>';if(Ext.isIE){var z="51";}else{var z="51";}t+='<td class="" width="50">&nbsp;</td>';for(var w=0;w<7;w++){var v=r.add(Date.DAY,w).format(this.dayformatLabel);var B=r.add(Date.DAY,w).format("m/d/Y");t+='<td valign="top"  class="x-calendar-weekv-header-days" dayval="'+B+'" id="'+this.calx.id+"-weekhdrday-"+(w+1)+'">'+v+"</td>";}t+="</tr><tr><td>";t+='<table width="'+z+'" border="0" align="center" cellpadding="0" cellspacing="0">';t+='<tr><td width="50" class="allday-marker" id="alldayrefer" >';if(A.length){if(A.length<=this.alldayTasksMaxView){tasktoshow=A.length;}else{tasktoshow=this.alldayTasksMaxView;}for(var w=0;w<tasktoshow;w++){t+='<div class="taskallday-layoutbase">&nbsp;</div>';}}else{t+='<div class="taskallday-layoutbase">&nbsp;</div>';t+='<div class="taskallday-layoutbase">&nbsp;</div>';}t+="</td></tr></table></td>";for(var w=0;w<7;w++){todaytmp=new Date();gendatetd=r.add(Date.DAY,w);var v=gendatetd.format(this.dayformatLabel);if(w==0){t+='<td width="14%" bgcolor="#FFFFFF" valign="top" class="weekstartday" id="'+this.calx.id+"-allday"+(w+1)+'"><div>&nbsp;</div></td>';}else{if(w==6){t+='<td width="14%" bgcolor="#FFFFFF" valign="top" class="weekendday" id="'+this.calx.id+"-allday"+(w+1)+'"><div>&nbsp;</div></td>';}else{t+='<td width="14%" bgcolor="#FFFFFF" valign="top" class="weekmidday" id="'+this.calx.id+"-allday"+(w+1)+'"><div>&nbsp;</div></td>';}}}t+="</tr></table></div></div>";t+='<div id="alldaylistbutton" class="x-calendar-weekv-header-alldaylist">';t+=e2cs.cal_locale.alldayTasksMaxLabel+" </div>";return t;},genBody:function(P){var E=new Date(P);var Q=new Date(E.format("m/d/Y")+" "+this.startTime);var i=new Date(E.format("m/d/Y")+" "+this.endTime);this.diffhrs=this.calx.dateDiff(Q,i,e2cs.dateParts.HOUR);var j='<div id="'+this.calx.id+'-weekbodydisplay" class="weekbodydisplay">';var y="";if(Ext.isIE||Ext.isIE6){mydatacomp=' style="position:relative;" ';y="97";}else{mydatacomp="";y="100";}y="100";j+='<div id="'+this.calx.id+'-tableweek-layout">';j+='<table id="'+this.calx.id+'-week-skeleton" width="'+y+'%" border="0" cellspacing="1" cellpadding="0"'+mydatacomp+">";j+='<tr><td width="50"><table width="50" border="0" align="center" cellpadding="0" cellspacing="0">';for(var A=0;A<this.diffhrs;A++){tmpdatetohandleontd=E.format("m/d/Y");tmpdatetohandleontd+=" "+Q.add(Date.HOUR,(A)).format("G");tmpdatetohandleontd+=":"+Q.add(Date.HOUR,(A)).format("i");if(Ext.isIE){var G="hour-marker_ie";}else{var G="hour-marker";}j+='<tr><td id="'+this.calx.id+"-tdbody-weekv-"+tmpdatetohandleontd+'" class="'+G+'">';j+="<span>"+Q.add(Date.HOUR,(A)).format(this.hourFormat)+"</span></td></tr>";}j+="</table></td>";for(var A=0;A<7;A++){gendatetddiv=P.add(Date.DAY,A);if(A==0){j+='<td width="14%" valign="top" class="weekstartday" id="'+this.calx.id+"-wd"+(A+1)+'">';}else{if(A==6){j+='<td width="14%" valign="top" class="weekendday" id="'+this.calx.id+"-wd"+(A+1)+'">';}else{j+='<td width="14%" valign="top" class="weekmidday" id="'+this.calx.id+"-wd"+(A+1)+'">';}}var M=new Date();if(gendatetddiv.format("m/d/Y")==M.format("m/d/Y")){j+='<div id="'+this.calx.id+"-day"+(A+1)+'" iddate="'+gendatetddiv.format("m/d/Y")+'" class="currentday"'+mydatacomp+">";}else{j+='<div id="'+this.calx.id+"-day"+(A+1)+'" iddate="'+gendatetddiv.format("m/d/Y")+'" class="basegridweek"'+mydatacomp+">";}if(this.style=="plain"){var N=this.getWeekTasks(gendatetddiv,2);}else{var N=this.getWeekTasks(gendatetddiv,1);}if(N.length==0){j+='<div id="containeronday" class="containeronday"'+mydatacomp+">";j+="&nbsp;";j+="</div>";}else{j+='<div id="containeronday" class="containeronday"'+mydatacomp+">";for(var B=0;B<N.length;B++){var J=new Date(N[B][this.calx.fieldsRefer.startdate]);var K=new Date(N[B][this.calx.fieldsRefer.enddate]);var z="";if(this.task_showqtip){var R=N[B][this.calx.fieldsRefer.description];if(R.length>this.calx.tipmaxLength){var D=R.substring(0,this.calx.tipmaxLength)+"...";}else{var D=R;}var H={starxl:e2cs.cal_locale.task_qtip_starts,startval:J.format(this.task_format),endxl:e2cs.cal_locale.task_qtip_ends,endval:K.format(this.task_format),details:D,location:N[B][this.calx.fieldsRefer.location],alldaytask:N[B][this.calx.fieldsRefer.alldaytask],isHoliday:N[B][this.calx.fieldsRefer.isHoliday]};var F=this.calx.tplTaskTip.apply(H);z='ext:qtitle="'+N[B][this.calx.fieldsRefer.subject]+'" ext:qtip="'+F+'"';}var I="";if(N[B][this.calx.fieldsRefer.color]){I=N[B][this.calx.fieldsRefer.color];}else{I=this.task_bgcolor_base;}if(this.calx.fieldsRefer.html!=""){var L=N[B][this.calx.fieldsRefer.html];if(L==null||L==undefined){var C="";var O="";}else{if(this.customHTMLinpos=="before"){var C=L+" ";var O="";}else{if(this.customHTMLinpos=="after"){var C="";var O=L+" ";}else{var C="";var O="";}}}}else{var C="";var O="";}j+='<div id="'+this.calx.id+"-ecal-daytask-"+this.taskelements+'" style="background-color:'+I+'" ';j+=z;j+='ec_id="'+N[B][this.calx.fieldsRefer.id]+'" ec_starts="'+N[B][this.calx.fieldsRefer.startdate]+'"';j+='ec_ends="'+N[B][this.calx.fieldsRefer.enddate]+'" ec_subject="'+N[B][this.calx.fieldsRefer.subject]+'"';j+='ec_cnt="'+N[B][this.calx.fieldsRefer.description]+'" ec_storeindex="'+B+'" ';j+='ec_location="'+N[B][this.calx.fieldsRefer.location]+'" ';j+='ec_allday="'+N[B][this.calx.fieldsRefer.alldaytask]+'" ';j+='ec_isholiday="'+N[B][this.calx.fieldsRefer.isHoliday]+'">';j+=C+N[B][this.calx.fieldsRefer.subject]+O+"</div>";this.taskelements+=1;}j+="</div>";}j+="</div></td>";}j+="</tr></table></div></div>";return j;}});