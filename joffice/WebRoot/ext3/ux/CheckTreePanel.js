Ext.ns("Ext.ux.tree");Ext.ux.tree.CheckTreePanel=Ext.extend(Ext.tree.TreePanel,{bubbleCheck:"checked",cascadeCheck:"unchecked",deepestOnly:false,expandOnCheck:true,filter:true,separator:",",cls:"ux-checktree",baseAttrs:{},initComponent:function(){this.eventModel=new Ext.ux.tree.CheckTreeEventModel(this);Ext.ux.tree.CheckTreePanel.superclass.initComponent.apply(this,arguments);var d=Ext.apply({uiProvider:Ext.ux.tree.CheckTreeNodeUI},this.baseAttrs);Ext.applyIf(this.loader,{baseAttrs:d,preloadChildren:true});if(true===this.loader.preloadChildren){this.loader.on("load",function(b,a){a.cascade(function(f){b.doPreload(f);f.loaded=true;});});}if(true===this.filter){var c=Ext.ux.tree.TreeFilterX?Ext.ux.tree.TreeFilterX:Ext.tree.TreeFilter;this.filter=new c(this,{autoClear:true});}},getValue:function(){var a=[];this.root.cascade(function(b){if(true===b.attributes.checked){if(false===this.deepestOnly||!this.isChildChecked(b)){a.push(b.id);}}},this);return a;},isChildChecked:function(c){var d=false;Ext.each(c.childNodes,function(a){if(a.attributes.checked){d=true;}});return d;},clearValue:function(){this.root.cascade(function(c){var d=c.getUI();if(d&&d.setChecked){d.setChecked(false);}});this.value=[];return this;},convertValue:function(e){var a=[];if(1<arguments.length){for(var f=0;f<arguments.length;f++){a.push(this.convertValue(arguments[f]));}}else{if(Ext.isArray(e)){a=e;}else{if("number"===typeof e){a.push(e);}else{if("string"===typeof e){a=e.split(this.separator);}}}}return a;},setValue:function(b){this.clearValue();this.value=this.convertValue.apply(this,arguments);Ext.each(this.value,function(e){var f=this.getNodeById(e);if(f){var a=f.getUI();if(a&&a.setChecked){a.setChecked(true);if(true===this.expandOnCheck){f.bubbleExpand();}}}},this);return this.value;},serialize:function(a){a=a||"text";var d=[];this.root.cascade(function(b){if(true===b.attributes.checked){if(false===this.deepestOnly||!this.isChildChecked(b)){d.push(b[a]);}}},this);return d.join(this.separator+" ");},getText:function(b){return this.serialize(b);},onRender:function(){Ext.ux.tree.CheckTreePanel.superclass.onRender.apply(this,arguments);if(true===this.isFormField){this.hiddenField=this.body.createChild({tag:"input",type:"hidden",name:this.name||this.id},undefined,true);}},updateHidden:function(){if(this.hiddenField){this.hiddenField.value=this.getValue().join(this.separator);}},clearInvalid:Ext.emptyFn,markInvalid:Ext.emptyFn,validate:function(){return true;},isValid:function(){return true;},getName:function(){return this.name||this.id||"";}});Ext.reg("checktreepanel",Ext.ux.tree.CheckTreePanel);Ext.override(Ext.tree.TreeNode,{bubbleExpand:function(){var e=this.getOwnerTree().root;var d=[];var f=this;while(f!==e){f=f.parentNode;d.push(f);}d.reverse();Ext.each(d,function(a){a.expand(false,false);});}});Ext.ux.tree.CheckTreeNodeUI=Ext.extend(Ext.tree.TreeNodeUI,{renderElements:function(o,l,m,a){this.indentMarkup=o.parentNode?o.parentNode.ui.getChildIndent():"";var k=o.attributes.checked;var q=l.href?l.href:Ext.isGecko?"":"#";var p=['<li class="x-tree-node"><div ext:tree-node-id="',o.id,'" class="x-tree-node-el x-tree-node-leaf x-unselectable ',l.cls,'" unselectable="on">','<span class="x-tree-node-indent">',this.indentMarkup,"</span>",'<img src="',this.emptyIcon,'" class="x-tree-ec-icon x-tree-elbow" />','<img src="',l.icon||this.emptyIcon,'" class="x-tree-node-icon',(l.icon?" x-tree-node-inline-icon":""),(l.iconCls?" "+l.iconCls:""),'" unselectable="on" />','<img src="'+this.emptyIcon+'" class="x-tree-checkbox'+(true===k?" x-tree-node-checked":"")+'" />','<a hidefocus="on" class="x-tree-node-anchor" href="',q,'" tabIndex="1" ',l.hrefTarget?' target="'+l.hrefTarget+'"':"",'><span unselectable="on">',o.text,"</span></a></div>",'<ul class="x-tree-node-ct" style="display:none;"></ul>',"</li>"].join("");var r;if(a!==true&&o.nextSibling&&(r=o.nextSibling.ui.getEl())){this.wrap=Ext.DomHelper.insertHtml("beforeBegin",r,p);}else{this.wrap=Ext.DomHelper.insertHtml("beforeEnd",m,p);}this.elNode=this.wrap.childNodes[0];this.ctNode=this.wrap.childNodes[1];var n=this.elNode.childNodes;this.indentNode=n[0];this.ecNode=n[1];this.iconNode=n[2];this.checkbox=n[3];this.cbEl=Ext.get(this.checkbox);this.anchor=n[4];this.textNode=n[4].firstChild;},setIconCls:function(b){Ext.fly(this.iconNode).set({cls:"x-tree-node-icon "+b});},isChecked:function(){return this.node.attributes.checked===true;},onCheckChange:function(){var g=this.isChecked();var f=this.node.getOwnerTree();var e=f.bubbleCheck;var h=f.cascadeCheck;if("all"===e||(g&&"checked"===e)||(!g&&"unchecked"===e)){this.updateParent(g);}if("all"===h||(g&&"checked"===h)||(!g&&"unchecked"===h)){this.updateChildren(g);}f.updateHidden();this.fireEvent("checkchange",this.node,g);},setChecked:function(c){c=true===c?c:false;var d=this.cbEl||false;if(d){true===c?d.addClass("x-tree-node-checked"):d.removeClass("x-tree-node-checked");}this.node.attributes.checked=c;this.onCheckChange();return c;},toggleCheck:function(){var b=!this.isChecked();this.setChecked(b);return b;},updateParent:function(e){var f=this.node.parentNode;var d=f?f.getUI():false;if(d&&d.setChecked){d.setChecked(e);}},updateChildren:function(b){this.node.eachChild(function(d){var a=d.getUI();if(a&&a.setChecked){a.setChecked(b);}});},onCheckboxClick:function(){if(!this.disabled){this.toggleCheck();}},onCheckboxOver:function(){this.addClass("x-tree-checkbox-over");},onCheckboxOut:function(){this.removeClass("x-tree-checkbox-over");},onCheckboxDown:function(){this.addClass("x-tree-checkbox-down");},onCheckboxUp:function(){this.removeClass("x-tree-checkbox-down");}});Ext.ux.tree.CheckTreeEventModel=Ext.extend(Ext.tree.TreeEventModel,{initEvents:function(){var b=this.tree.getTreeEl();b.on("click",this.delegateClick,this);if(this.tree.trackMouseOver!==false){b.on("mouseover",this.delegateOver,this);b.on("mouseout",this.delegateOut,this);}b.on("mousedown",this.delegateDown,this);b.on("mouseup",this.delegateUp,this);b.on("dblclick",this.delegateDblClick,this);b.on("contextmenu",this.delegateContextMenu,this);},delegateOver:function(c,d){if(!this.beforeEvent(c)){return;}if(this.lastEcOver){this.onIconOut(c,this.lastEcOver);delete this.lastEcOver;}if(this.lastCbOver){this.onCheckboxOut(c,this.lastCbOver);delete this.lastCbOver;}if(c.getTarget(".x-tree-ec-icon",1)){this.lastEcOver=this.getNode(c);this.onIconOver(c,this.lastEcOver);}else{if(c.getTarget(".x-tree-checkbox",1)){this.lastCbOver=this.getNode(c);this.onCheckboxOver(c,this.lastCbOver);}}if(d=this.getNodeTarget(c)){this.onNodeOver(c,this.getNode(c));}},delegateOut:function(d,e){if(!this.beforeEvent(d)){return;}if(d.getTarget(".x-tree-ec-icon",1)){var f=this.getNode(d);this.onIconOut(d,f);if(f==this.lastEcOver){delete this.lastEcOver;}}else{if(d.getTarget(".x-tree-checkbox",1)){var f=this.getNode(d);this.onCheckboxOut(d,f);if(f==this.lastCbOver){delete this.lastCbOver;}}}if((e=this.getNodeTarget(d))&&!d.within(e,true)){this.onNodeOut(d,this.getNode(d));}},delegateDown:function(c,d){if(!this.beforeEvent(c)){return;}if(c.getTarget(".x-tree-checkbox",1)){this.onCheckboxDown(c,this.getNode(c));}},delegateUp:function(c,d){if(!this.beforeEvent(c)){return;}if(c.getTarget(".x-tree-checkbox",1)){this.onCheckboxUp(c,this.getNode(c));}},delegateOut:function(d,e){if(!this.beforeEvent(d)){return;}if(d.getTarget(".x-tree-ec-icon",1)){var f=this.getNode(d);this.onIconOut(d,f);if(f==this.lastEcOver){delete this.lastEcOver;}}else{if(d.getTarget(".x-tree-checkbox",1)){var f=this.getNode(d);this.onCheckboxOut(d,f);if(f==this.lastCbOver){delete this.lastCbOver;}}}if((e=this.getNodeTarget(d))&&!d.within(e,true)){this.onNodeOut(d,this.getNode(d));}},delegateClick:function(c,d){if(!this.beforeEvent(c)){return;}if(c.getTarget(".x-tree-checkbox",1)){this.onCheckboxClick(c,this.getNode(c));}else{if(c.getTarget(".x-tree-ec-icon",1)){this.onIconClick(c,this.getNode(c));}else{if(this.getNodeTarget(c)){this.onNodeClick(c,this.getNode(c));}}}},onCheckboxClick:function(c,d){d.ui.onCheckboxClick();},onCheckboxOver:function(c,d){d.ui.onCheckboxOver();},onCheckboxOut:function(c,d){d.ui.onCheckboxOut();},onCheckboxDown:function(c,d){d.ui.onCheckboxDown();},onCheckboxUp:function(c,d){d.ui.onCheckboxUp();}});